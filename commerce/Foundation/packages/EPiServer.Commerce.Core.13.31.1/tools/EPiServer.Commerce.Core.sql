-- EPiServer.Commerce.Core database script--


SET QUOTED_IDENTIFIER ON;

PRINT N'Creating [aspnet_Personalization_ReportingAccess]...';


CREATE ROLE [aspnet_Personalization_ReportingAccess];

GO

PRINT N'Creating [aspnet_Personalization_BasicAccess]...';

GO

CREATE ROLE [aspnet_Personalization_BasicAccess]

GO


PRINT N'Creating [aspnet_Personalization_FullAccess]...';


GO
CREATE ROLE [aspnet_Personalization_FullAccess];


GO
PRINT N'Creating [aspnet_Roles_ReportingAccess]...';


GO
CREATE ROLE [aspnet_Roles_ReportingAccess];


GO
PRINT N'Creating [aspnet_Roles_BasicAccess]...';


GO
CREATE ROLE [aspnet_Roles_BasicAccess];


GO
PRINT N'Creating [aspnet_Roles_FullAccess]...';


GO
CREATE ROLE [aspnet_Roles_FullAccess];


GO
PRINT N'Creating [aspnet_Profile_ReportingAccess]...';


GO
CREATE ROLE [aspnet_Profile_ReportingAccess];


GO
PRINT N'Creating [aspnet_Profile_BasicAccess]...';


GO
CREATE ROLE [aspnet_Profile_BasicAccess];


GO
PRINT N'Creating [aspnet_Profile_FullAccess]...';


GO
CREATE ROLE [aspnet_Profile_FullAccess];


GO
PRINT N'Creating [aspnet_Membership_ReportingAccess]...';


GO
CREATE ROLE [aspnet_Membership_ReportingAccess];


GO
PRINT N'Creating [aspnet_Membership_BasicAccess]...';


GO
CREATE ROLE [aspnet_Membership_BasicAccess];


GO
PRINT N'Creating [aspnet_Membership_FullAccess]...';


GO
CREATE ROLE [aspnet_Membership_FullAccess];


GO
PRINT N'Creating [aspnet_WebEvent_FullAccess]...';


GO
CREATE ROLE [aspnet_WebEvent_FullAccess];

GO



EXECUTE sp_addrolemember @rolename = N'aspnet_Personalization_ReportingAccess', @membername = N'aspnet_Personalization_FullAccess';


GO
EXECUTE sp_addrolemember @rolename = N'aspnet_Personalization_BasicAccess', @membername = N'aspnet_Personalization_FullAccess';


GO
EXECUTE sp_addrolemember @rolename = N'aspnet_Roles_ReportingAccess', @membername = N'aspnet_Roles_FullAccess';


GO
EXECUTE sp_addrolemember @rolename = N'aspnet_Roles_BasicAccess', @membername = N'aspnet_Roles_FullAccess';


GO
EXECUTE sp_addrolemember @rolename = N'aspnet_Profile_ReportingAccess', @membername = N'aspnet_Profile_FullAccess';


GO
EXECUTE sp_addrolemember @rolename = N'aspnet_Profile_BasicAccess', @membername = N'aspnet_Profile_FullAccess';


GO
EXECUTE sp_addrolemember @rolename = N'aspnet_Membership_ReportingAccess', @membername = N'aspnet_Membership_FullAccess';


GO
EXECUTE sp_addrolemember @rolename = N'aspnet_Membership_BasicAccess', @membername = N'aspnet_Membership_FullAccess';


GO
PRINT N'Creating [aspnet_Membership_ReportingAccess]...';


GO
CREATE SCHEMA [aspnet_Membership_ReportingAccess]
    AUTHORIZATION [aspnet_Membership_ReportingAccess];


GO
PRINT N'Creating [aspnet_Membership_FullAccess]...';


GO
CREATE SCHEMA [aspnet_Membership_FullAccess]
    AUTHORIZATION [aspnet_Membership_FullAccess];


GO
PRINT N'Creating [aspnet_Membership_BasicAccess]...';


GO
CREATE SCHEMA [aspnet_Membership_BasicAccess]
    AUTHORIZATION [aspnet_Membership_BasicAccess];


GO
PRINT N'Creating [aspnet_WebEvent_FullAccess]...';


GO
CREATE SCHEMA [aspnet_WebEvent_FullAccess]
    AUTHORIZATION [aspnet_WebEvent_FullAccess];


GO
PRINT N'Creating [aspnet_Roles_ReportingAccess]...';


GO
CREATE SCHEMA [aspnet_Roles_ReportingAccess]
    AUTHORIZATION [aspnet_Roles_ReportingAccess];


GO
PRINT N'Creating [aspnet_Roles_FullAccess]...';


GO
CREATE SCHEMA [aspnet_Roles_FullAccess]
    AUTHORIZATION [aspnet_Roles_FullAccess];


GO
PRINT N'Creating [aspnet_Roles_BasicAccess]...';


GO
CREATE SCHEMA [aspnet_Roles_BasicAccess]
    AUTHORIZATION [aspnet_Roles_BasicAccess];


GO
PRINT N'Creating [aspnet_Profile_ReportingAccess]...';


GO
CREATE SCHEMA [aspnet_Profile_ReportingAccess]
    AUTHORIZATION [aspnet_Profile_ReportingAccess];


GO
PRINT N'Creating [aspnet_Profile_FullAccess]...';


GO
CREATE SCHEMA [aspnet_Profile_FullAccess]
    AUTHORIZATION [aspnet_Profile_FullAccess];


GO
PRINT N'Creating [aspnet_Profile_BasicAccess]...';


GO
CREATE SCHEMA [aspnet_Profile_BasicAccess]
    AUTHORIZATION [aspnet_Profile_BasicAccess];


GO
PRINT N'Creating [aspnet_Personalization_ReportingAccess]...';


GO
CREATE SCHEMA [aspnet_Personalization_ReportingAccess]
    AUTHORIZATION [aspnet_Personalization_ReportingAccess];


GO
PRINT N'Creating [aspnet_Personalization_FullAccess]...';


GO
CREATE SCHEMA [aspnet_Personalization_FullAccess]
    AUTHORIZATION [aspnet_Personalization_FullAccess];


GO
PRINT N'Creating [aspnet_Personalization_BasicAccess]...';


GO
CREATE SCHEMA [aspnet_Personalization_BasicAccess]
    AUTHORIZATION [aspnet_Personalization_BasicAccess];


GO
/*End Predeployment*/
GO

GO
PRINT N'Creating [dbo].[udttContentGuidList]...';


GO
CREATE TYPE [dbo].[udttContentGuidList] AS TABLE (
    [ContentGuid] UNIQUEIDENTIFIER NOT NULL);


GO
PRINT N'Creating [dbo].[udttSerializableCart]...';


GO
CREATE TYPE [dbo].[udttSerializableCart] AS TABLE (
    [CartId]     INT              NOT NULL,
    [CustomerId] UNIQUEIDENTIFIER NOT NULL,
    [Name]       NVARCHAR (128)   NULL,
    [MarketId]   NVARCHAR (16)    NOT NULL,
    [Created]    DATETIME         NOT NULL,
    [Modified]   DATETIME         NULL,
    [Data]       NVARCHAR (MAX)   NULL);


GO
PRINT N'Creating [dbo].[udttOrderReportData]...';


GO
CREATE TYPE [dbo].[udttOrderReportData] AS TABLE (
    [OrderGroupId]        INT              NOT NULL,
    [OrderNumber]         NVARCHAR (512)   NOT NULL,
    [Currency]            NVARCHAR (8)     NOT NULL,
    [CustomerId]          UNIQUEIDENTIFIER NOT NULL,
    [CustomerName]        NVARCHAR (64)    NULL,
    [Status]              NVARCHAR (64)    NOT NULL,
    [OrderCreated]        DATETIME         NOT NULL,
    [MarketId]            NVARCHAR (8)     NOT NULL,
    [TotalQuantity]       DECIMAL (38, 9)  NOT NULL,
    [TotalDiscountAmount] DECIMAL (38, 9)  NOT NULL,
    [ShippingTotal]       DECIMAL (38, 9)  NOT NULL,
    [HandlingTotal]       DECIMAL (38, 9)  NOT NULL,
    [TaxTotal]            DECIMAL (38, 9)  NOT NULL,
    [SubTotal]            DECIMAL (38, 9)  NOT NULL,
    [Total]               DECIMAL (38, 9)  NOT NULL);


GO
PRINT N'Creating [dbo].[udttWarehouse]...';


GO
CREATE TYPE [dbo].[udttWarehouse] AS TABLE (
    [WarehouseId]         INT            NULL,
    [Name]                NVARCHAR (255) NOT NULL,
    [CreatorId]           NVARCHAR (256) NOT NULL,
    [Created]             DATETIME       NOT NULL,
    [ModifierId]          NVARCHAR (256) NOT NULL,
    [Modified]            DATETIME       NOT NULL,
    [IsActive]            BIT            NOT NULL,
    [IsPrimary]           BIT            NOT NULL,
    [SortOrder]           INT            NOT NULL,
    [Code]                NVARCHAR (50)  NOT NULL,
    [IsFulfillmentCenter] BIT            NOT NULL,
    [IsPickupLocation]    BIT            NOT NULL,
    [IsDeliveryLocation]  BIT            NOT NULL,
    [FirstName]           NVARCHAR (64)  NULL,
    [LastName]            NVARCHAR (64)  NULL,
    [Organization]        NVARCHAR (80)  NULL,
    [Line1]               NVARCHAR (80)  NULL,
    [Line2]               NVARCHAR (64)  NULL,
    [City]                NVARCHAR (64)  NULL,
    [State]               NVARCHAR (64)  NULL,
    [CountryCode]         NVARCHAR (50)  NULL,
    [CountryName]         NVARCHAR (50)  NULL,
    [PostalCode]          NVARCHAR (20)  NULL,
    [RegionCode]          NVARCHAR (50)  NULL,
    [RegionName]          NVARCHAR (64)  NULL,
    [DaytimePhoneNumber]  NVARCHAR (32)  NULL,
    [EveningPhoneNumber]  NVARCHAR (32)  NULL,
    [FaxNumber]           NVARCHAR (32)  NULL,
    [Email]               NVARCHAR (64)  NULL);


GO
PRINT N'Creating [dbo].[udttLineItemReportData]...';


GO
CREATE TYPE [dbo].[udttLineItemReportData] AS TABLE (
    [LineItemId]          INT             NOT NULL,
    [LineItemCode]        NVARCHAR (255)  NOT NULL,
    [DisplayName]         NVARCHAR (255)  NULL,
    [PlacedPrice]         DECIMAL (38, 9) NOT NULL,
    [Quantity]            DECIMAL (38, 9) NOT NULL,
    [EntryDiscountAmount] DECIMAL (38, 9) NOT NULL,
    [OrderDiscountAmount] DECIMAL (38, 9) NOT NULL,
    [ExtendedPrice]       DECIMAL (38, 9) NOT NULL,
    [SalesTax]            DECIMAL (38, 9) NOT NULL,
    [OrderGroupId]        INT             NOT NULL,
    [OrderCreated]        DATETIME        NOT NULL,
    PRIMARY KEY CLUSTERED ([LineItemId] ASC));


GO
PRINT N'Creating [dbo].[udttCatalogContentAccess]...';


GO
CREATE TYPE [dbo].[udttCatalogContentAccess] AS TABLE (
    [Name]       NVARCHAR (255) NOT NULL,
    [IsRole]     INT            DEFAULT 1 NOT NULL,
    [AccessMask] INT            NOT NULL);


GO
PRINT N'Creating [dbo].[udttCatalogContentPropertyReference]...';


GO
CREATE TYPE [dbo].[udttCatalogContentPropertyReference] AS TABLE (
    [ObjectId]     INT           NOT NULL,
    [ObjectTypeId] INT           NOT NULL,
    [MetaClassId]  INT           NOT NULL,
    [LanguageName] NVARCHAR (50) NOT NULL,
    PRIMARY KEY CLUSTERED ([ObjectId] ASC, [ObjectTypeId] ASC));


GO
PRINT N'Creating [dbo].[udttInventoryCode]...';


GO
CREATE TYPE [dbo].[udttInventoryCode] AS TABLE (
    [Code] NVARCHAR (100) NOT NULL,
    PRIMARY KEY CLUSTERED ([Code] ASC));


GO
PRINT N'Creating [dbo].[udttPromotionInformationShipment]...';


GO
CREATE TYPE [dbo].[udttPromotionInformationShipment] AS TABLE (
    [PromotionInformationId] INT              NULL,
    [ShippingMethodId]       UNIQUEIDENTIFIER NOT NULL,
    [OrderAddressName]       NVARCHAR (64)    NULL,
    [ShippingMethodName]     NVARCHAR (100)   NOT NULL,
    [SavedAmount]            DECIMAL (18, 3)  NOT NULL);


GO
PRINT N'Creating [dbo].[udttCatalogCodeId]...';


GO
CREATE TYPE [dbo].[udttCatalogCodeId] AS TABLE (
    [ObjectId] INT            NULL,
    [Code]     NVARCHAR (100) NULL);


GO
PRINT N'Creating [dbo].[udttMetaStringDictionaryValues]...';


GO
CREATE TYPE [dbo].[udttMetaStringDictionaryValues] AS TABLE (
    [Key]   NVARCHAR (100) NOT NULL,
    [Value] NTEXT          NOT NULL);


GO
PRINT N'Creating [dbo].[udttOrderGroupNote]...';


GO
CREATE TYPE [dbo].[udttOrderGroupNote] AS TABLE (
    [OrderNoteId]  INT              NULL,
    [OrderGroupId] INT              NOT NULL,
    [CustomerId]   UNIQUEIDENTIFIER NOT NULL,
    [Title]        NVARCHAR (255)   NULL,
    [Type]         NVARCHAR (50)    NULL,
    [Detail]       NTEXT            NULL,
    [Created]      DATETIME         NOT NULL,
    [LineItemId]   INT              NULL,
    [IsModified]   BIT              NOT NULL,
    [Channel]      NVARCHAR (50)    NULL,
    [EventType]    NVARCHAR (50)    NULL);


GO
PRINT N'Creating [dbo].[udttCatalogContentAsset]...';


GO
CREATE TYPE [dbo].[udttCatalogContentAsset] AS TABLE (
    [WorkId]    INT            NOT NULL,
    [AssetType] NVARCHAR (190) NOT NULL,
    [AssetKey]  NVARCHAR (254) NOT NULL,
    [GroupName] NVARCHAR (100) NULL,
    [SortOrder] INT            NOT NULL);


GO
PRINT N'Creating [dbo].[udttObjectWorkId]...';


GO
CREATE TYPE [dbo].[udttObjectWorkId] AS TABLE (
    [ObjectId]     INT           NULL,
    [ObjectTypeId] INT           NULL,
    [WorkId]       INT           NULL,
    [LanguageName] NVARCHAR (50) NULL);


GO
PRINT N'Creating [dbo].[udttIdTable]...';


GO
CREATE TYPE [dbo].[udttIdTable] AS TABLE (
    [ID] INT NOT NULL);


GO
PRINT N'Creating [dbo].[udttCatalogContentEx]...';


GO
CREATE TYPE [dbo].[udttCatalogContentEx] AS TABLE (
    [ObjectId]     INT            NOT NULL,
    [ObjectTypeId] INT            NOT NULL,
    [CreatedBy]    NVARCHAR (256) NULL,
    [Created]      DATETIME       NULL,
    [ModifiedBy]   NVARCHAR (256) NULL,
    [Modified]     DATETIME       NULL UNIQUE CLUSTERED ([ObjectId] ASC, [ObjectTypeId] ASC));


GO
PRINT N'Creating [dbo].[udttMetaFieldMapping]...';


GO
CREATE TYPE [dbo].[udttMetaFieldMapping] AS TABLE (
    [MetaFieldName] NVARCHAR (256) NOT NULL,
    [DataTypeName]  NVARCHAR (256) NOT NULL);


GO
PRINT N'Creating [dbo].[udttVariantDraft]...';


GO
CREATE TYPE [dbo].[udttVariantDraft] AS TABLE (
    [WorkId]         INT             NOT NULL,
    [TaxCategoryId]  INT             NULL,
    [TrackInventory] BIT             NULL,
    [Weight]         FLOAT (53)      NULL,
    [MinQuantity]    DECIMAL (38, 9) NULL,
    [MaxQuantity]    DECIMAL (38, 9) NULL,
    [Length]         FLOAT (53)      NULL,
    [Height]         FLOAT (53)      NULL,
    [Width]          FLOAT (53)      NULL,
    [PackageId]      INT             NULL);


GO
PRINT N'Creating [dbo].[udttVersionCatalog]...';


GO
CREATE TYPE [dbo].[udttVersionCatalog] AS TABLE (
    [WorkId]          INT             NOT NULL,
    [DefaultCurrency] NVARCHAR (150)  NULL,
    [WeightBase]      NVARCHAR (128)  NULL,
    [LengthBase]      NVARCHAR (128)  NULL,
    [DefaultLanguage] NVARCHAR (50)   NULL,
    [Languages]       NVARCHAR (4000) NULL,
    [IsPrimary]       BIT             NULL,
    [Owner]           NVARCHAR (255)  NULL);


GO
PRINT N'Creating [dbo].[udttVersion]...';


GO
CREATE TYPE [dbo].[udttVersion] AS TABLE (
    [WorkId]             INT            NULL,
    [ObjectId]           INT            NOT NULL,
    [ObjectTypeId]       INT            NOT NULL,
    [CatalogId]          INT            NOT NULL,
    [Name]               NVARCHAR (100) NULL,
    [Code]               NVARCHAR (100) NULL,
    [LanguageName]       NVARCHAR (50)  NOT NULL,
    [MasterLanguageName] NVARCHAR (50)  NULL,
    [IsCommonDraft]      BIT            NULL,
    [StartPublish]       DATETIME       NULL,
    [StopPublish]        DATETIME       NULL,
    [Status]             INT            NULL,
    [CreatedBy]          NVARCHAR (100) NOT NULL,
    [Created]            DATETIME       NOT NULL,
    [ModifiedBy]         NVARCHAR (256) NULL,
    [Modified]           DATETIME       NULL,
    [SeoUri]             NVARCHAR (255) NULL,
    [SeoTitle]           NVARCHAR (150) NULL,
    [SeoDescription]     NVARCHAR (355) NULL,
    [SeoKeywords]        NVARCHAR (355) NULL,
    [SeoUriSegment]      NVARCHAR (255) NULL);


GO
PRINT N'Creating [dbo].[udttCatalogContentProperty]...';


GO
CREATE TYPE [dbo].[udttCatalogContentProperty] AS TABLE (
    [PropertyId]      BIGINT           NULL,
    [ObjectId]        INT              NULL,
    [ObjectTypeId]    INT              NULL,
    [WorkId]          INT              NULL,
    [MetaFieldId]     INT              NOT NULL,
    [MetaClassId]     INT              NOT NULL,
    [MetaFieldName]   NVARCHAR (255)   NULL,
    [LanguageName]    NVARCHAR (50)    NULL,
    [CultureSpecific] BIT              NULL,
    [Boolean]         BIT              NULL,
    [Number]          INT              NULL,
    [FloatNumber]     DECIMAL (38, 9)  NULL,
    [Money]           MONEY            NULL,
    [Decimal]         DECIMAL (38, 9)  NULL,
    [Date]            DATETIME         NULL,
    [Binary]          VARBINARY (MAX)  NULL,
    [String]          NVARCHAR (450)   NULL,
    [LongString]      NVARCHAR (MAX)   NULL,
    [Guid]            UNIQUEIDENTIFIER NULL,
    [IsNull]          BIT              NULL,
    [IsEncrypted]     BIT              NULL UNIQUE CLUSTERED ([ObjectId] ASC, [ObjectTypeId] ASC, [WorkId] ASC, [MetaFieldId] ASC, [LanguageName] ASC));


GO
PRINT N'Creating [dbo].[udttPromotionInformation]...';


GO
CREATE TYPE [dbo].[udttPromotionInformation] AS TABLE (
    [PromotionInformationId] INT              NULL,
    [OrderFormId]            INT              NOT NULL,
    [PromotionGuid]          UNIQUEIDENTIFIER NOT NULL,
    [RewardType]             VARCHAR (50)     NOT NULL,
    [Name]                   NVARCHAR (4000)  NULL,
    [Description]            NVARCHAR (4000)  NULL,
    [DiscountType]           VARCHAR (50)     NOT NULL,
    [CouponCode]             NVARCHAR (100)   NULL,
    [AdditionalInformation]  NVARCHAR (MAX)   NULL,
    [VisitorGroup]           UNIQUEIDENTIFIER NULL,
    [CustomerId]             UNIQUEIDENTIFIER NOT NULL,
    [OrderLevelSavedAmount]  DECIMAL (18, 3)  NULL,
    [IsRedeemed]             BIT              DEFAULT (1) NOT NULL,
    [IsReturnOrderForm]      BIT              DEFAULT (0) NOT NULL);


GO
PRINT N'Creating [dbo].[udttCatalogItemSeo]...';


GO
CREATE TYPE [dbo].[udttCatalogItemSeo] AS TABLE (
    [LanguageCode]   NVARCHAR (50)  NOT NULL,
    [CatalogNodeId]  INT            NULL,
    [CatalogEntryId] INT            NULL,
    [Uri]            NVARCHAR (255) NOT NULL,
    [UriSegment]     NVARCHAR (255) NULL);


GO
PRINT N'Creating [dbo].[udttContentList]...';


GO
CREATE TYPE [dbo].[udttContentList] AS TABLE (
    [ContentId] INT NULL);


GO
PRINT N'Creating [dbo].[udttInventory]...';


GO
CREATE TYPE [dbo].[udttInventory] AS TABLE (
    [CatalogEntryCode]           NVARCHAR (100)  NULL,
    [WarehouseCode]              NVARCHAR (50)   NULL,
    [IsTracked]                  BIT             NULL,
    [PurchaseAvailableQuantity]  DECIMAL (38, 9) NULL,
    [PreorderAvailableQuantity]  DECIMAL (38, 9) NULL,
    [BackorderAvailableQuantity] DECIMAL (38, 9) NULL,
    [PurchaseRequestedQuantity]  DECIMAL (38, 9) NULL,
    [PreorderRequestedQuantity]  DECIMAL (38, 9) NULL,
    [BackorderRequestedQuantity] DECIMAL (38, 9) NULL,
    [PurchaseAvailableUtc]       DATETIME2 (7)   NULL,
    [PreorderAvailableUtc]       DATETIME2 (7)   NULL,
    [BackorderAvailableUtc]      DATETIME2 (7)   NULL,
    [AdditionalQuantity]         DECIMAL (38, 9) NULL,
    [ReorderMinQuantity]         DECIMAL (38, 9) NULL);


GO
PRINT N'Creating [dbo].[udttPromotionInformationEntry]...';


GO
CREATE TYPE [dbo].[udttPromotionInformationEntry] AS TABLE (
    [PromotionInformationId] INT             NULL,
    [EntryCode]              NVARCHAR (100)  NOT NULL,
    [SavedAmount]            DECIMAL (18, 3) NOT NULL);


GO
PRINT N'Creating [dbo].[udttWarehouseCode]...';


GO
CREATE TYPE [dbo].[udttWarehouseCode] AS TABLE (
    [WarehouseCode] NVARCHAR (50) NOT NULL);


GO
PRINT N'Creating [dbo].[udttPriceDetail]...';


GO
CREATE TYPE [dbo].[udttPriceDetail] AS TABLE (
    [PriceValueId]     BIGINT          NOT NULL,
    [CatalogEntryCode] NVARCHAR (100)  NULL,
    [MarketId]         NVARCHAR (8)    NULL,
    [CurrencyCode]     NVARCHAR (8)    NULL,
    [PriceTypeId]      INT             NULL,
    [PriceCode]        NVARCHAR (256)  NULL,
    [ValidFrom]        DATETIME        NULL,
    [ValidUntil]       DATETIME        NULL,
    [MinQuantity]      DECIMAL (38, 9) NULL,
    [UnitPrice]        DECIMAL (38, 9) NULL);


GO
PRINT N'Creating [dbo].[udttPriceType]...';


GO
CREATE TYPE [dbo].[udttPriceType] AS TABLE (
    [PriceTypeId]   INT            NOT NULL,
    [PriceTypeName] NVARCHAR (256) NOT NULL);


GO
PRINT N'Creating [dbo].[udttCatalogEntryPrice]...';


GO
CREATE TYPE [dbo].[udttCatalogEntryPrice] AS TABLE (
    [CatalogEntryCode] NVARCHAR (100)  NOT NULL,
    [MarketId]         NVARCHAR (8)    NOT NULL,
    [CurrencyCode]     NVARCHAR (8)    NOT NULL,
    [PriceTypeId]      INT             NOT NULL,
    [PriceCode]        NVARCHAR (256)  NOT NULL,
    [ValidFrom]        DATETIME        NOT NULL,
    [ValidUntil]       DATETIME        NULL,
    [MinQuantity]      DECIMAL (38, 9) NOT NULL,
    [MaxQuantity]      DECIMAL (38, 9) NULL,
    [UnitPrice]        DECIMAL (38, 9) NOT NULL);


GO
PRINT N'Creating [dbo].[udttCustomerPricing]...';


GO
CREATE TYPE [dbo].[udttCustomerPricing] AS TABLE (
    [PriceTypeId] INT            NOT NULL,
    [PriceCode]   NVARCHAR (256) NOT NULL);


GO
PRINT N'Creating [dbo].[udttCatalogKeyAndQuantity]...';


GO
CREATE TYPE [dbo].[udttCatalogKeyAndQuantity] AS TABLE (
    [CatalogEntryCode] NVARCHAR (100)  NOT NULL,
    [Quantity]         DECIMAL (38, 9) NOT NULL);


GO
PRINT N'Creating [dbo].[udttCatalogKey]...';


GO
CREATE TYPE [dbo].[udttCatalogKey] AS TABLE (
    [CatalogEntryCode] NVARCHAR (100) NOT NULL);


GO
PRINT N'Creating [dbo].[udttCompatCurrencyRate]...';


GO
CREATE TYPE [dbo].[udttCompatCurrencyRate] AS TABLE (
    [Operation]        CHAR (1)   NULL,
    [CurrencyRateId]   INT        NULL,
    [AverageRate]      FLOAT (53) NULL,
    [EndOfDayRate]     FLOAT (53) NULL,
    [ModifiedDate]     DATETIME   NULL,
    [FromCurrencyId]   INT        NULL,
    [ToCurrencyId]     INT        NULL,
    [CurrencyRateDate] DATETIME   NULL);


GO
PRINT N'Creating [dbo].[udttCompatCurrency]...';


GO
CREATE TYPE [dbo].[udttCompatCurrency] AS TABLE (
    [Operation]    CHAR (1)      NULL,
    [CurrencyId]   INT           NULL,
    [CurrencyCode] NVARCHAR (8)  NULL,
    [Name]         NVARCHAR (50) NULL,
    [ModifiedDate] DATETIME      NULL);


GO
PRINT N'Creating [dbo].[udttCatalogNodeList]...';


GO
CREATE TYPE [dbo].[udttCatalogNodeList] AS TABLE (
    [CatalogNodeId] INT NULL);


GO
PRINT N'Creating [dbo].[udttCatalogList]...';


GO
CREATE TYPE [dbo].[udttCatalogList] AS TABLE (
    [CatalogId] INT NULL);


GO
PRINT N'Creating [dbo].[udttEntityList]...';


GO
CREATE TYPE [dbo].[udttEntityList] AS TABLE (
    [EntityId]  INT NULL,
    [SortOrder] INT NULL);


GO
PRINT N'Creating [dbo].[udttOrderGroupId]...';


GO
CREATE TYPE [dbo].[udttOrderGroupId] AS TABLE (
    [OrderGroupId] INT NULL);


GO
PRINT N'Creating [dbo].[udttCountryCode]...';


GO
CREATE TYPE [dbo].[udttCountryCode] AS TABLE (
    [CountryCode] NVARCHAR (8) NULL);


GO
PRINT N'Creating [dbo].[udttLanguageCode]...';


GO
CREATE TYPE [dbo].[udttLanguageCode] AS TABLE (
    [LanguageCode] NVARCHAR (84) NULL);


GO
PRINT N'Creating [dbo].[udttCurrencyCode]...';


GO
CREATE TYPE [dbo].[udttCurrencyCode] AS TABLE (
    [CurrencyCode] NVARCHAR (8) NULL);


GO
PRINT N'Creating [dbo].[OrderPerPromotionReportData]...';


GO
CREATE TABLE [dbo].[OrderPerPromotionReportData] (
    [PromotionGuid] UNIQUEIDENTIFIER NOT NULL,
    [OrderCount]    INT              NOT NULL,
    PRIMARY KEY CLUSTERED ([PromotionGuid] ASC)
);


GO
PRINT N'Creating [dbo].[OrderReportData]...';


GO
CREATE TABLE [dbo].[OrderReportData] (
    [Id]                  INT              IDENTITY (1, 1) NOT NULL,
    [OrderGroupId]        INT              NOT NULL,
    [OrderNumber]         NVARCHAR (512)   NOT NULL,
    [Currency]            NVARCHAR (8)     NOT NULL,
    [CustomerId]          UNIQUEIDENTIFIER NOT NULL,
    [CustomerName]        NVARCHAR (64)    NULL,
    [Status]              NVARCHAR (64)    NOT NULL,
    [OrderCreated]        DATETIME         NOT NULL,
    [MarketId]            NVARCHAR (8)     NOT NULL,
    [TotalQuantity]       DECIMAL (38, 9)  NOT NULL,
    [TotalDiscountAmount] DECIMAL (38, 9)  NOT NULL,
    [ShippingTotal]       DECIMAL (38, 9)  NOT NULL,
    [HandlingTotal]       DECIMAL (38, 9)  NOT NULL,
    [TaxTotal]            DECIMAL (38, 9)  NOT NULL,
    [SubTotal]            DECIMAL (38, 9)  NOT NULL,
    [Total]               DECIMAL (38, 9)  NOT NULL,
    CONSTRAINT [PK_OrderReportData] PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[OrderReportData].[IX_OrderReportData_OrderCreated]...';


GO
CREATE NONCLUSTERED INDEX [IX_OrderReportData_OrderCreated]
    ON [dbo].[OrderReportData]([OrderCreated] ASC);


GO
PRINT N'Creating [dbo].[OrderReportData].[IX_OrderData_OrderGroupId]...';


GO
CREATE NONCLUSTERED INDEX [IX_OrderData_OrderGroupId]
    ON [dbo].[OrderReportData]([OrderGroupId] ASC);


GO
PRINT N'Creating [dbo].[LineItemReportData]...';


GO
CREATE TABLE [dbo].[LineItemReportData] (
    [Id]                  INT             IDENTITY (1, 1) NOT NULL,
    [LineItemId]          INT             NOT NULL,
    [OrderGroupId]        INT             NOT NULL,
    [LineItemCode]        NVARCHAR (255)  NOT NULL,
    [DisplayName]         NVARCHAR (255)  NULL,
    [PlacedPrice]         DECIMAL (38, 9) NOT NULL,
    [Quantity]            DECIMAL (38, 9) NOT NULL,
    [EntryDiscountAmount] DECIMAL (38, 9) NOT NULL,
    [OrderDiscountAmount] DECIMAL (38, 9) NOT NULL,
    [ExtendedPrice]       DECIMAL (38, 9) NOT NULL,
    [SalesTax]            DECIMAL (38, 9) NOT NULL,
    [OrderCreated]        DATETIME        NOT NULL
);


GO
PRINT N'Creating [dbo].[LineItemReportData].[IX_LineItemReportData_OrderGroupId]...';


GO
CREATE CLUSTERED INDEX [IX_LineItemReportData_OrderGroupId]
    ON [dbo].[LineItemReportData]([OrderGroupId] ASC);


GO
PRINT N'Creating [dbo].[LineItemReportData].[IX_LineItemReportData_OrderCreated]...';


GO
CREATE NONCLUSTERED INDEX [IX_LineItemReportData_OrderCreated]
    ON [dbo].[LineItemReportData]([OrderCreated] ASC);


GO
PRINT N'Creating [dbo].[CatalogContentAccess]...';


GO
CREATE TABLE [dbo].[CatalogContentAccess] (
    [ObjectId]     INT            NOT NULL,
    [ObjectTypeId] INT            NOT NULL,
    [Name]         NVARCHAR (255) NOT NULL,
    [IsRole]       INT            NOT NULL,
    [AccessMask]   INT            NOT NULL,
    CONSTRAINT [PK_CatalogContentAccess] PRIMARY KEY CLUSTERED ([ObjectId] ASC, [ObjectTypeId] ASC, [Name] ASC) ON [PRIMARY]
);


GO
PRINT N'Creating [dbo].[CatalogItemChange]...';


GO
CREATE TABLE [dbo].[CatalogItemChange] (
    [CatalogEntryId] INT NOT NULL,
    [CatalogId]      INT NOT NULL,
    [IsBeingIndexed] BIT NOT NULL,
    CONSTRAINT [PK_CatalogItemChange] PRIMARY KEY CLUSTERED ([CatalogEntryId] ASC, [CatalogId] ASC, [IsBeingIndexed] ASC)
);


GO
PRINT N'Creating [dbo].[SerializableCart]...';


GO
CREATE TABLE [dbo].[SerializableCart] (
    [CartId]     INT              IDENTITY (1, 1) NOT NULL,
    [CustomerId] UNIQUEIDENTIFIER NOT NULL,
    [Name]       NVARCHAR (128)   NULL,
    [MarketId]   NVARCHAR (16)    NOT NULL,
    [Created]    DATETIME         NOT NULL,
    [Modified]   DATETIME         NULL,
    [Data]       NVARCHAR (MAX)   NULL,
    CONSTRAINT [PK_SerializableCart] PRIMARY KEY CLUSTERED ([CartId] ASC)
);


GO
PRINT N'Creating [dbo].[SerializableCart].[IDX_SerializableCart_Indexed_CustomerId_Name]...';


GO
CREATE NONCLUSTERED INDEX [IDX_SerializableCart_Indexed_CustomerId_Name]
    ON [dbo].[SerializableCart]([CustomerId] ASC, [Name] ASC);


GO
PRINT N'Creating [dbo].[SerializableCart].[IDX_SerializableCart_Indexed_Modified]...';


GO
CREATE NONCLUSTERED INDEX [IDX_SerializableCart_Indexed_Modified]
    ON [dbo].[SerializableCart]([Modified] ASC);


GO
PRINT N'Creating [dbo].[SerializableCart].[IDX_SerializableCart_Indexed_CustomerId]...';


GO
CREATE NONCLUSTERED INDEX [IDX_SerializableCart_Indexed_CustomerId]
    ON [dbo].[SerializableCart]([CustomerId] ASC);


GO
PRINT N'Creating [dbo].[PromotionInformationShipment]...';


GO
CREATE TABLE [dbo].[PromotionInformationShipment] (
    [PromotionInformationId] INT              NOT NULL,
    [ShippingMethodId]       UNIQUEIDENTIFIER NOT NULL,
    [OrderAddressName]       NVARCHAR (64)    NULL,
    [ShippingMethodName]     NVARCHAR (100)   NOT NULL,
    [SavedAmount]            DECIMAL (18, 3)  NOT NULL
);


GO
PRINT N'Creating [dbo].[PromotionInformationShipment].[IDX_PromotionInformationShipment]...';


GO
CREATE CLUSTERED INDEX [IDX_PromotionInformationShipment]
    ON [dbo].[PromotionInformationShipment]([PromotionInformationId] ASC);


GO
PRINT N'Creating [dbo].[CatalogContentEx]...';


GO
CREATE TABLE [dbo].[CatalogContentEx] (
    [ObjectId]     INT            NOT NULL,
    [ObjectTypeId] INT            NOT NULL,
    [CreatedBy]    NVARCHAR (256) NULL,
    [Created]      DATETIME       NULL,
    [ModifiedBy]   NVARCHAR (256) NULL,
    [Modified]     DATETIME       NULL,
    CONSTRAINT [PK_CatalogContentEx] PRIMARY KEY CLUSTERED ([ObjectId] ASC, [ObjectTypeId] ASC)
);


GO
PRINT N'Creating [dbo].[ecfVersionCatalog]...';


GO
CREATE TABLE [dbo].[ecfVersionCatalog] (
    [WorkId]          INT             NOT NULL,
    [DefaultCurrency] NVARCHAR (150)  NULL,
    [WeightBase]      NVARCHAR (128)  NULL,
    [LengthBase]      NVARCHAR (128)  NULL,
    [DefaultLanguage] NVARCHAR (20)   NULL,
    [Languages]       NVARCHAR (4000) NULL,
    [IsPrimary]       BIT             NOT NULL,
    [Owner]           NVARCHAR (255)  NULL,
    CONSTRAINT [PK_ecfVersionCatalog] PRIMARY KEY CLUSTERED ([WorkId] ASC)
);


GO
PRINT N'Creating [dbo].[ecfVersionVariation]...';


GO
CREATE TABLE [dbo].[ecfVersionVariation] (
    [WorkId]         INT             NOT NULL,
    [TaxCategoryId]  INT             NULL,
    [TrackInventory] BIT             NULL,
    [Weight]         FLOAT (53)      NULL,
    [MinQuantity]    DECIMAL (38, 9) NULL,
    [MaxQuantity]    DECIMAL (38, 9) NULL,
    [Length]         FLOAT (53)      NULL,
    [Height]         FLOAT (53)      NULL,
    [Width]          FLOAT (53)      NULL,
    [PackageId]      INT             NULL,
    CONSTRAINT [PK_VariationContent] PRIMARY KEY CLUSTERED ([WorkId] ASC)
);


GO
PRINT N'Creating [dbo].[ecfVersionAsset]...';


GO
CREATE TABLE [dbo].[ecfVersionAsset] (
    [pkId]      BIGINT         IDENTITY (1, 1) NOT NULL,
    [WorkId]    INT            NOT NULL,
    [AssetType] NVARCHAR (190) NOT NULL,
    [AssetKey]  NVARCHAR (254) NOT NULL,
    [GroupName] NVARCHAR (100) NULL,
    [SortOrder] INT            NOT NULL,
    CONSTRAINT [PK_ecfVersionAsset] PRIMARY KEY CLUSTERED ([WorkId] ASC, [AssetType] ASC, [AssetKey] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogContentProperty]...';


GO
CREATE TABLE [dbo].[CatalogContentProperty] (
    [pkId]            BIGINT           IDENTITY (1, 1) NOT NULL,
    [ObjectId]        INT              NOT NULL,
    [ObjectTypeId]    INT              NOT NULL,
    [MetaFieldId]     INT              NOT NULL,
    [MetaClassId]     INT              NOT NULL,
    [MetaFieldName]   NVARCHAR (255)   NULL,
    [CultureSpecific] BIT              NULL,
    [LanguageName]    NVARCHAR (50)    NULL,
    [Boolean]         BIT              NULL,
    [Number]          INT              NULL,
    [FloatNumber]     FLOAT (53)       NULL,
    [Money]           MONEY            NULL,
    [Decimal]         DECIMAL (38, 9)  NULL,
    [Date]            DATETIME         NULL,
    [Binary]          VARBINARY (MAX)  NULL,
    [String]          NVARCHAR (450)   NULL,
    [LongString]      NVARCHAR (MAX)   NULL,
    [Guid]            UNIQUEIDENTIFIER NULL,
    CONSTRAINT [PK_CatalogContentProperty] PRIMARY KEY NONCLUSTERED ([pkId] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogContentProperty].[IDX_CatalogContentProperty_ContentID]...';


GO
CREATE UNIQUE CLUSTERED INDEX [IDX_CatalogContentProperty_ContentID]
    ON [dbo].[CatalogContentProperty]([ObjectId] ASC, [ObjectTypeId] ASC, [LanguageName] ASC, [MetaFieldId] ASC);


GO
PRINT N'Creating [dbo].[ecfVersionProperty]...';


GO
CREATE TABLE [dbo].[ecfVersionProperty] (
    [WorkId]          INT              NOT NULL,
    [ObjectId]        INT              NOT NULL,
    [ObjectTypeId]    INT              NOT NULL,
    [MetaFieldId]     INT              NOT NULL,
    [MetaClassId]     INT              NOT NULL,
    [MetaFieldName]   NVARCHAR (255)   NULL,
    [CultureSpecific] BIT              NULL,
    [LanguageName]    NVARCHAR (50)    NULL,
    [Boolean]         BIT              NULL,
    [Number]          INT              NULL,
    [FloatNumber]     FLOAT (53)       NULL,
    [Money]           MONEY            NULL,
    [Decimal]         DECIMAL (38, 9)  NULL,
    [Date]            DATETIME         NULL,
    [Binary]          VARBINARY (MAX)  NULL,
    [String]          NVARCHAR (450)   NULL,
    [LongString]      NVARCHAR (MAX)   NULL,
    [Guid]            UNIQUEIDENTIFIER NULL,
    CONSTRAINT [PK_ecfVersionProperty] PRIMARY KEY CLUSTERED ([WorkId] ASC, [MetaFieldId] ASC)
);


GO
PRINT N'Creating [dbo].[PromotionInformation]...';


GO
CREATE TABLE [dbo].[PromotionInformation] (
    [PromotionInformationId] INT              IDENTITY (1, 1) NOT NULL,
    [OrderFormId]            INT              NOT NULL,
    [PromotionGuid]          UNIQUEIDENTIFIER NOT NULL,
    [RewardType]             VARCHAR (50)     NOT NULL,
    [Name]                   NVARCHAR (4000)  NULL,
    [Description]            NVARCHAR (4000)  NULL,
    [DiscountType]           VARCHAR (50)     NOT NULL,
    [CouponCode]             NVARCHAR (100)   NULL,
    [AdditionalInformation]  NVARCHAR (MAX)   NULL,
    [VisitorGroup]           UNIQUEIDENTIFIER NULL,
    [CustomerId]             UNIQUEIDENTIFIER NOT NULL,
    [OrderLevelSavedAmount]  DECIMAL (18, 3)  NULL,
    [IsRedeemed]             BIT              NOT NULL,
    [IsReturnOrderForm]      BIT              NOT NULL,
    CONSTRAINT [PK_PromotionInformationId] PRIMARY KEY NONCLUSTERED ([PromotionInformationId] ASC)
);


GO
PRINT N'Creating [dbo].[PromotionInformation].[IDX_PromotionInformation_OrderFormId]...';


GO
CREATE CLUSTERED INDEX [IDX_PromotionInformation_OrderFormId]
    ON [dbo].[PromotionInformation]([OrderFormId] ASC);


GO
PRINT N'Creating [dbo].[PromotionInformation].[IDX_PromotionInformation_PromotionGuid_CustomerId]...';


GO
CREATE NONCLUSTERED INDEX [IDX_PromotionInformation_PromotionGuid_CustomerId]
    ON [dbo].[PromotionInformation]([PromotionGuid] ASC) WHERE IsRedeemed = 1 AND IsReturnOrderForm = 0;


GO
PRINT N'Creating [dbo].[PromotionInformation].[IDX_PromotionInformation_CustomerId_PromotionGuid]...';


GO
CREATE NONCLUSTERED INDEX [IDX_PromotionInformation_CustomerId_PromotionGuid]
    ON [dbo].[PromotionInformation]([CustomerId] ASC, [PromotionGuid] ASC);


GO
PRINT N'Creating [dbo].[MarketShippingMethods]...';


GO
CREATE TABLE [dbo].[MarketShippingMethods] (
    [MarketId]         NVARCHAR (8)     NOT NULL,
    [ShippingMethodId] UNIQUEIDENTIFIER NOT NULL,
    CONSTRAINT [PK_MarketShippingMethods] PRIMARY KEY CLUSTERED ([MarketId] ASC, [ShippingMethodId] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogItemAsset]...';


GO
CREATE TABLE [dbo].[CatalogItemAsset] (
    [CatalogNodeId]  INT            NOT NULL,
    [CatalogEntryId] INT            NOT NULL,
    [AssetType]      NVARCHAR (190) NOT NULL,
    [AssetKey]       NVARCHAR (254) NOT NULL,
    [GroupName]      NVARCHAR (100) NULL,
    [SortOrder]      INT            NOT NULL,
    CONSTRAINT [PK_CatalogItemAsset] PRIMARY KEY CLUSTERED ([CatalogEntryId] ASC, [CatalogNodeId] ASC, [AssetType] ASC, [AssetKey] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogItemAsset].[IX_CatalogItemAsset_NodeId]...';


GO
CREATE NONCLUSTERED INDEX [IX_CatalogItemAsset_NodeId]
    ON [dbo].[CatalogItemAsset]([CatalogNodeId] ASC)
    INCLUDE([GroupName], [SortOrder]) WHERE CatalogNodeId > 0;


GO
PRINT N'Creating [dbo].[InventoryService]...';


GO
CREATE TABLE [dbo].[InventoryService] (
    [CatalogEntryCode]           NVARCHAR (100)  NOT NULL,
    [WarehouseCode]              NVARCHAR (50)   NOT NULL,
    [IsTracked]                  BIT             NOT NULL,
    [PurchaseAvailableQuantity]  DECIMAL (38, 9) NOT NULL,
    [PreorderAvailableQuantity]  DECIMAL (38, 9) NOT NULL,
    [BackorderAvailableQuantity] DECIMAL (38, 9) NOT NULL,
    [PurchaseRequestedQuantity]  DECIMAL (38, 9) NOT NULL,
    [PreorderRequestedQuantity]  DECIMAL (38, 9) NOT NULL,
    [BackorderRequestedQuantity] DECIMAL (38, 9) NOT NULL,
    [PreorderAvailableUtc]       DATETIME2 (7)   NOT NULL,
    [PurchaseAvailableUtc]       DATETIME2 (7)   NOT NULL,
    [BackorderAvailableUtc]      DATETIME2 (7)   NOT NULL,
    [AdditionalQuantity]         DECIMAL (38, 9) NOT NULL,
    [ReorderMinQuantity]         DECIMAL (38, 9) NOT NULL,
    CONSTRAINT [PK_ManagedInventory] PRIMARY KEY CLUSTERED ([CatalogEntryCode] ASC, [WarehouseCode] ASC)
);


GO
PRINT N'Creating [dbo].[PromotionInformationEntry]...';


GO
CREATE TABLE [dbo].[PromotionInformationEntry] (
    [PromotionInformationId] INT             NOT NULL,
    [EntryCode]              NVARCHAR (100)  NOT NULL,
    [SavedAmount]            DECIMAL (18, 3) NOT NULL
);


GO
PRINT N'Creating [dbo].[PromotionInformationEntry].[IDX_PromotionInformationEntry]...';


GO
CREATE CLUSTERED INDEX [IDX_PromotionInformationEntry]
    ON [dbo].[PromotionInformationEntry]([PromotionInformationId] ASC);


GO
PRINT N'Creating [dbo].[AzureCompatible]...';


GO
CREATE TABLE [dbo].[AzureCompatible] (
    [AzureCompatible] BIT NULL
);


GO
PRINT N'Creating [dbo].[AzureCompatible].[IX_AzureCompatible_AzureCompatible]...';


GO
CREATE CLUSTERED INDEX [IX_AzureCompatible_AzureCompatible]
    ON [dbo].[AzureCompatible]([AzureCompatible] ASC);


GO
PRINT N'Creating [dbo].[ApplicationLog]...';


GO
CREATE TABLE [dbo].[ApplicationLog] (
    [LogId]      INT            IDENTITY (1, 1) NOT NULL,
    [Source]     NVARCHAR (100) NOT NULL,
    [Operation]  NVARCHAR (50)  NOT NULL,
    [ObjectKey]  NVARCHAR (100) NOT NULL,
    [ObjectType] NVARCHAR (50)  NOT NULL,
    [Username]   NVARCHAR (256) NOT NULL,
    [Created]    DATETIME       NOT NULL,
    [Succeeded]  BIT            NOT NULL,
    [IPAddress]  NVARCHAR (50)  NULL,
    [Notes]      NVARCHAR (255) NULL,
    CONSTRAINT [PK_ApplicationLog] PRIMARY KEY CLUSTERED ([LogId] ASC)
);


GO
PRINT N'Creating [dbo].[McBlobStorage]...';


GO
CREATE TABLE [dbo].[McBlobStorage] (
    [uid]           UNIQUEIDENTIFIER NOT NULL,
    [contentType]   NVARCHAR (255)   NULL,
    [ownerType]     NVARCHAR (254)   NULL,
    [ownerKey]      NVARCHAR (254)   NULL,
    [provider]      NVARCHAR (50)    NULL,
    [BlobData]      IMAGE            NULL,
    [fileName]      NVARCHAR (1024)  NULL,
    [fileExtension] NVARCHAR (8)     NULL,
    [allowSearch]   BIT              NULL,
    [created]       DATETIME         NOT NULL,
    [isTemporary]   BIT              NOT NULL
);


GO
PRINT N'Creating [dbo].[McBlobStorage].[IX_McBlobStorage_McBlobStorage]...';


GO
CREATE CLUSTERED INDEX [IX_McBlobStorage_McBlobStorage]
    ON [dbo].[McBlobStorage]([uid] ASC);


GO
PRINT N'Creating [dbo].[MarketCountries]...';


GO
CREATE TABLE [dbo].[MarketCountries] (
    [MarketId]    NVARCHAR (8) NOT NULL,
    [CountryCode] NVARCHAR (8) NOT NULL,
    CONSTRAINT [PK_MarketCountries] PRIMARY KEY CLUSTERED ([MarketId] ASC, [CountryCode] ASC)
);


GO
PRINT N'Creating [dbo].[Merchant]...';


GO
CREATE TABLE [dbo].[Merchant] (
    [MerchantId] UNIQUEIDENTIFIER NOT NULL,
    [Name]       NVARCHAR (150)   NOT NULL,
    CONSTRAINT [PK_Merchant] PRIMARY KEY CLUSTERED ([MerchantId] ASC)
);


GO
PRINT N'Creating [dbo].[CommonSettings]...';


GO
CREATE TABLE [dbo].[CommonSettings] (
    [SettingId] INT            IDENTITY (1, 1) NOT NULL,
    [Name]      NVARCHAR (100) NOT NULL,
    [Value]     NVARCHAR (50)  NULL,
    CONSTRAINT [PK_CommonSettings] PRIMARY KEY CLUSTERED ([SettingId] ASC)
);


GO
PRINT N'Creating [dbo].[MarketLanguages]...';


GO
CREATE TABLE [dbo].[MarketLanguages] (
    [MarketId]     NVARCHAR (8)  NOT NULL,
    [LanguageCode] NVARCHAR (84) NOT NULL,
    CONSTRAINT [PK_MarketLanguages] PRIMARY KEY CLUSTERED ([MarketId] ASC, [LanguageCode] ASC)
);


GO
PRINT N'Creating [dbo].[mcweb_ListViewProfile]...';


GO
CREATE TABLE [dbo].[mcweb_ListViewProfile] (
    [ListViewProfileId] INT              IDENTITY (1, 1) NOT NULL,
    [UserId]            INT              NOT NULL,
    [MetaClassName]     NVARCHAR (50)    NOT NULL,
    [ViewName]          NVARCHAR (50)    NOT NULL,
    [PlaceName]         NVARCHAR (50)    NOT NULL,
    [IsSystem]          BIT              NOT NULL,
    [IsPublic]          BIT              NOT NULL,
    [XSListViewProfile] NTEXT            NOT NULL,
    [UserUid]           UNIQUEIDENTIFIER NULL,
    CONSTRAINT [PK_mcweb_ListViewProfile] PRIMARY KEY CLUSTERED ([ListViewProfileId] ASC)
);


GO
PRINT N'Creating [dbo].[CurrencyRate]...';


GO
CREATE TABLE [dbo].[CurrencyRate] (
    [CurrencyRateId]   INT        IDENTITY (1, 1) NOT NULL,
    [AverageRate]      FLOAT (53) NULL,
    [EndOfDayRate]     FLOAT (53) NULL,
    [ModifiedDate]     DATETIME   NOT NULL,
    [FromCurrencyId]   INT        NOT NULL,
    [ToCurrencyId]     INT        NOT NULL,
    [CurrencyRateDate] DATETIME   NOT NULL,
    CONSTRAINT [CurrencyRate_PK] PRIMARY KEY CLUSTERED ([CurrencyRateId] ASC)
);


GO
PRINT N'Creating [dbo].[MarketCurrencies]...';


GO
CREATE TABLE [dbo].[MarketCurrencies] (
    [MarketId]     NVARCHAR (8) NOT NULL,
    [CurrencyCode] NVARCHAR (8) NOT NULL,
    CONSTRAINT [PK_MarketCurrencies] PRIMARY KEY CLUSTERED ([MarketId] ASC, [CurrencyCode] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogSecurity]...';


GO
CREATE TABLE [dbo].[CatalogSecurity] (
    [CatalogId] INT            NOT NULL,
    [SID]       NVARCHAR (250) NOT NULL,
    [Scope]     NVARCHAR (50)  NOT NULL,
    [AllowMask] BINARY (8)     NOT NULL,
    [DenyMask]  BINARY (8)     NOT NULL
);


GO
PRINT N'Creating [dbo].[CatalogSecurity].[IX_CatalogSecurity_CatalogId]...';


GO
CREATE CLUSTERED INDEX [IX_CatalogSecurity_CatalogId]
    ON [dbo].[CatalogSecurity]([CatalogId] ASC);


GO
PRINT N'Creating [dbo].[CatalogSecurity].[IX_CatalogSecurity]...';


GO
CREATE UNIQUE NONCLUSTERED INDEX [IX_CatalogSecurity]
    ON [dbo].[CatalogSecurity]([CatalogId] ASC, [SID] ASC, [Scope] ASC);


GO
PRINT N'Creating [dbo].[aspnet_WebEvent_Events]...';


GO
CREATE TABLE [dbo].[aspnet_WebEvent_Events] (
    [EventId]                CHAR (32)       NOT NULL,
    [EventTimeUtc]           DATETIME        NOT NULL,
    [EventTime]              DATETIME        NOT NULL,
    [EventType]              NVARCHAR (256)  NOT NULL,
    [EventSequence]          DECIMAL (19)    NOT NULL,
    [EventOccurrence]        DECIMAL (19)    NOT NULL,
    [EventCode]              INT             NOT NULL,
    [EventDetailCode]        INT             NOT NULL,
    [Message]                NVARCHAR (1024) NULL,
    [ApplicationPath]        NVARCHAR (256)  NULL,
    [ApplicationVirtualPath] NVARCHAR (256)  NULL,
    [MachineName]            NVARCHAR (256)  NOT NULL,
    [RequestUrl]             NVARCHAR (1024) NULL,
    [ExceptionType]          NVARCHAR (256)  NULL,
    [Details]                NTEXT           NULL,
    PRIMARY KEY CLUSTERED ([EventId] ASC)
);


GO
PRINT N'Creating [dbo].[Application]...';


GO
CREATE TABLE [dbo].[Application] (
    [Name]     NVARCHAR (200) NOT NULL,
    [IsActive] BIT            NOT NULL,
    CONSTRAINT [PK_Application_Name] PRIMARY KEY CLUSTERED ([Name] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogNodeSearchResults]...';


GO
CREATE TABLE [dbo].[CatalogNodeSearchResults] (
    [SearchSetId]   UNIQUEIDENTIFIER NOT NULL,
    [CatalogNodeId] INT              NOT NULL,
    [Created]       DATETIME         NULL
);


GO
PRINT N'Creating [dbo].[CatalogNodeSearchResults].[IX_CatalogNodeSearchResults_SearchSetId]...';


GO
CREATE CLUSTERED INDEX [IX_CatalogNodeSearchResults_SearchSetId]
    ON [dbo].[CatalogNodeSearchResults]([SearchSetId] ASC);


GO
PRINT N'Creating [dbo].[Market]...';


GO
CREATE TABLE [dbo].[Market] (
    [MarketId]            NVARCHAR (8)    NOT NULL,
    [Created]             DATETIME        NOT NULL,
    [Modified]            DATETIME        NOT NULL,
    [IsEnabled]           BIT             NOT NULL,
    [MarketName]          NVARCHAR (50)   NOT NULL,
    [MarketDescription]   NVARCHAR (4000) NOT NULL,
    [DefaultCurrencyCode] NVARCHAR (8)    NOT NULL,
    [DefaultLanguageCode] NVARCHAR (84)   NOT NULL,
    [PricesIncludeTax]    BIT             NOT NULL,
    CONSTRAINT [PK_Market] PRIMARY KEY CLUSTERED ([MarketId] ASC),
    CONSTRAINT [AX_Market_MarketName] UNIQUE NONCLUSTERED ([MarketName] ASC)
);


GO
PRINT N'Creating [dbo].[mcmd_SelectedEnumValue]...';


GO
CREATE TABLE [dbo].[mcmd_SelectedEnumValue] (
    [SelectedEnumValueId] INT              IDENTITY (1, 1) NOT NULL,
    [Key]                 UNIQUEIDENTIFIER NOT NULL,
    [TypeName]            NVARCHAR (50)    NOT NULL,
    [Id]                  INT              NOT NULL,
    CONSTRAINT [PK_mcmd_SelectedEnumValue] PRIMARY KEY CLUSTERED ([SelectedEnumValueId] ASC)
);


GO
PRINT N'Creating [dbo].[mcmd_SelectedEnumValue].[IX_mcmd_SelectedEnumValue_Indexed_Key]...';


GO
CREATE NONCLUSTERED INDEX [IX_mcmd_SelectedEnumValue_Indexed_Key]
    ON [dbo].[mcmd_SelectedEnumValue]([Key] ASC);


GO
PRINT N'Creating [dbo].[CatalogNodeRelation]...';


GO
CREATE TABLE [dbo].[CatalogNodeRelation] (
    [CatalogId]    INT NOT NULL,
    [ParentNodeId] INT NOT NULL,
    [ChildNodeId]  INT NOT NULL,
    [SortOrder]    INT NOT NULL,
    CONSTRAINT [PK_CatalogNodeRelation] PRIMARY KEY CLUSTERED ([CatalogId] ASC, [ParentNodeId] ASC, [ChildNodeId] ASC)
);


GO
PRINT N'Creating [dbo].[MetaStringDictionaryValue]...';


GO
CREATE TABLE [dbo].[MetaStringDictionaryValue] (
    [MetaKey] INT            NOT NULL,
    [Key]     NVARCHAR (100) NOT NULL,
    [Value]   NTEXT          NOT NULL,
    CONSTRAINT [PK_MetaStringDictionaryValue] PRIMARY KEY CLUSTERED ([MetaKey] ASC, [Key] ASC)
);


GO
PRINT N'Creating [dbo].[MetaStringDictionaryValue].[IX_MetaStringDictionaryMetaKey]...';


GO
CREATE NONCLUSTERED INDEX [IX_MetaStringDictionaryMetaKey]
    ON [dbo].[MetaStringDictionaryValue]([MetaKey] ASC);


GO
PRINT N'Creating [dbo].[Currency]...';


GO
CREATE TABLE [dbo].[Currency] (
    [CurrencyCode]     NVARCHAR (8)  NOT NULL,
    [Created]          DATETIME      NOT NULL,
    [Modified]         DATETIME      NOT NULL,
    [CurrencyName]     NVARCHAR (50) NOT NULL,
    [CompatCurrencyId] INT           IDENTITY (1, 1) NOT NULL,
    CONSTRAINT [PK_Currency] PRIMARY KEY CLUSTERED ([CurrencyCode] ASC),
    CONSTRAINT [AX_CompatCurrencyId] UNIQUE NONCLUSTERED ([CompatCurrencyId] ASC)
);


GO
PRINT N'Creating [dbo].[mcmd_MetaField]...';


GO
CREATE TABLE [dbo].[mcmd_MetaField] (
    [MetaFieldId]  INT            IDENTITY (1, 1) NOT NULL,
    [MetaClassId]  INT            NOT NULL,
    [Name]         NVARCHAR (50)  NOT NULL,
    [FriendlyName] NVARCHAR (255) NOT NULL,
    [TypeName]     NVARCHAR (50)  NOT NULL,
    [Nullable]     BIT            NOT NULL,
    [DefaultValue] NTEXT          NOT NULL,
    [ReadOnly]     BIT            NOT NULL,
    [XSDataSource] NTEXT          NULL,
    [XSAttributes] NTEXT          NULL,
    [Owner]        NVARCHAR (255) NOT NULL,
    [AccessLevel]  INT            NOT NULL,
    CONSTRAINT [PK_mcmd_MetaField] PRIMARY KEY CLUSTERED ([MetaFieldId] ASC),
    CONSTRAINT [IX_mcmd_MetaField] UNIQUE NONCLUSTERED ([MetaClassId] ASC, [Name] ASC)
);


GO
PRINT N'Creating [dbo].[MetaRule]...';


GO
CREATE TABLE [dbo].[MetaRule] (
    [RuleId]      INT   IDENTITY (1, 1) NOT NULL,
    [MetaClassId] INT   NOT NULL,
    [Data]        IMAGE NULL,
    CONSTRAINT [PK_MetaRule] PRIMARY KEY CLUSTERED ([RuleId] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogNode]...';


GO
CREATE TABLE [dbo].[CatalogNode] (
    [CatalogNodeId]   INT              IDENTITY (1, 1) NOT NULL,
    [CatalogId]       INT              NOT NULL,
    [StartDate]       DATETIME         NOT NULL,
    [EndDate]         DATETIME         NOT NULL,
    [Name]            NVARCHAR (100)   NOT NULL,
    [TemplateName]    NVARCHAR (50)    NULL,
    [Code]            NVARCHAR (100)   NOT NULL,
    [ParentNodeId]    INT              NOT NULL,
    [MetaClassId]     INT              NOT NULL,
    [IsActive]        BIT              NOT NULL,
    [SortOrder]       INT              NOT NULL,
    [ContentAssetsID] UNIQUEIDENTIFIER NULL,
    [ContentGuid]     UNIQUEIDENTIFIER NOT NULL,
    CONSTRAINT [PK_CatalogItem] PRIMARY KEY CLUSTERED ([CatalogNodeId] ASC),
    CONSTRAINT [IX_CatalogItem] UNIQUE NONCLUSTERED ([Code] ASC)
);


GO
PRINT N'Creating [dbo].[mcmd_MetaFieldMap]...';


GO
CREATE TABLE [dbo].[mcmd_MetaFieldMap] (
    [MetaFieldMapId]  INT           NOT NULL,
    [Name]            NVARCHAR (50) NOT NULL,
    [SrcMetaClassId]  INT           NOT NULL,
    [DestMetaClassId] INT           NOT NULL,
    [XSReferences]    NTEXT         NULL,
    [XSElements]      NTEXT         NULL,
    CONSTRAINT [PK_mcmd_MetaFieldMap] PRIMARY KEY CLUSTERED ([MetaFieldMapId] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogLanguageMap]...';


GO
CREATE TABLE [dbo].[CatalogLanguageMap] (
    [Language]  NVARCHAR (10) NOT NULL,
    [LCID]      INT           NULL,
    [Collation] NVARCHAR (50) NULL
);


GO
PRINT N'Creating [dbo].[CatalogLanguageMap].[IX_CatalogLanguageMap_Language]...';


GO
CREATE CLUSTERED INDEX [IX_CatalogLanguageMap_Language]
    ON [dbo].[CatalogLanguageMap]([Language] ASC);


GO
PRINT N'Creating [dbo].[MetaObjectValue]...';


GO
CREATE TABLE [dbo].[MetaObjectValue] (
    [MetaKey]      INT NOT NULL,
    [MetaClassId]  INT NOT NULL,
    [MetaObjectId] INT NOT NULL,
    CONSTRAINT [PK_MetaObjectValue] PRIMARY KEY CLUSTERED ([MetaKey] ASC)
);


GO
PRINT N'Creating [dbo].[mcmd_MetaClassDataSource]...';


GO
CREATE TABLE [dbo].[mcmd_MetaClassDataSource] (
    [MetaClassDataSourceId] INT           IDENTITY (1, 1) NOT NULL,
    [MetaClassId]           INT           NOT NULL,
    [PrimaryTable]          NVARCHAR (50) NOT NULL,
    [XSExtendedTables]      NTEXT         NULL,
    [XSConditions]          NTEXT         NULL,
    CONSTRAINT [PK_mcmd_MetaClassDataSource] PRIMARY KEY CLUSTERED ([MetaClassDataSourceId] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogLanguage]...';


GO
CREATE TABLE [dbo].[CatalogLanguage] (
    [CatalogId]    INT            NOT NULL,
    [LanguageCode] NVARCHAR (50)  NOT NULL,
    [UriSegment]   NVARCHAR (255) NULL,
    CONSTRAINT [PK_CatalogLanguage] PRIMARY KEY CLUSTERED ([CatalogId] ASC, [LanguageCode] ASC)
);


GO
PRINT N'Creating [dbo].[MetaMultiValueDictionary]...';


GO
CREATE TABLE [dbo].[MetaMultiValueDictionary] (
    [MetaKey]          INT NOT NULL,
    [MetaDictionaryId] INT NOT NULL,
    CONSTRAINT [PK_MetaMultiValueDictionary] PRIMARY KEY CLUSTERED ([MetaKey] ASC, [MetaDictionaryId] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogItemSeo]...';


GO
CREATE TABLE [dbo].[CatalogItemSeo] (
    [LanguageCode]   NVARCHAR (50)  NOT NULL,
    [CatalogNodeId]  INT            NULL,
    [CatalogEntryId] INT            NULL,
    [Uri]            NVARCHAR (255) NOT NULL,
    [Title]          NVARCHAR (150) NULL,
    [Description]    NVARCHAR (355) NULL,
    [Keywords]       NVARCHAR (355) NULL,
    [UriSegment]     NVARCHAR (255) NULL,
    CONSTRAINT [PK_CatalogItemSeo] PRIMARY KEY NONCLUSTERED ([Uri] ASC, [LanguageCode] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogItemSeo].[IX_CatalogItemSeo_CatalogEntryId]...';


GO
CREATE CLUSTERED INDEX [IX_CatalogItemSeo_CatalogEntryId]
    ON [dbo].[CatalogItemSeo]([CatalogEntryId] ASC);


GO
PRINT N'Creating [dbo].[CatalogItemSeo].[IX_CatalogItemSeo_CatalogNodeId]...';


GO
CREATE NONCLUSTERED INDEX [IX_CatalogItemSeo_CatalogNodeId]
    ON [dbo].[CatalogItemSeo]([CatalogNodeId] ASC);


GO
PRINT N'Creating [dbo].[CatalogItemSeo].[IX_CatalogItemSeo_UniqueSegment_CatalogEntry]...';


GO
CREATE NONCLUSTERED INDEX [IX_CatalogItemSeo_UniqueSegment_CatalogEntry]
    ON [dbo].[CatalogItemSeo]([UriSegment] ASC, [CatalogEntryId] ASC);


GO
PRINT N'Creating [dbo].[MetaKey]...';


GO
CREATE TABLE [dbo].[MetaKey] (
    [MetaKey]      INT           IDENTITY (1, 1) NOT NULL,
    [MetaObjectId] INT           NOT NULL,
    [WorkId]       INT           NULL,
    [MetaClassId]  INT           NOT NULL,
    [MetaFieldId]  INT           NOT NULL,
    [Language]     NVARCHAR (20) NULL,
    CONSTRAINT [PK_MetaKey] PRIMARY KEY CLUSTERED ([MetaKey] ASC)
);


GO
PRINT N'Creating [dbo].[MetaKey].[IX_MetaKey_MetaObjectIdMetaClassId]...';


GO
CREATE NONCLUSTERED INDEX [IX_MetaKey_MetaObjectIdMetaClassId]
    ON [dbo].[MetaKey]([MetaObjectId] ASC, [MetaClassId] ASC)
    INCLUDE([WorkId]);


GO
PRINT N'Creating [dbo].[MetaKey].[IX_MetaKey2]...';


GO
CREATE NONCLUSTERED INDEX [IX_MetaKey2]
    ON [dbo].[MetaKey]([MetaObjectId] ASC, [MetaClassId] ASC, [MetaFieldId] ASC);


GO
PRINT N'Creating [dbo].[mcmd_MetaFieldType]...';


GO
CREATE TABLE [dbo].[mcmd_MetaFieldType] (
    [MetaFieldTypeId] INT            IDENTITY (1, 1) NOT NULL,
    [Name]            NVARCHAR (50)  NOT NULL,
    [FriendlyName]    NVARCHAR (255) NOT NULL,
    [McDataType]      INT            NOT NULL,
    [XSViews]         NTEXT          NULL,
    [XSAttributes]    NTEXT          NULL,
    [Owner]           NVARCHAR (255) NOT NULL,
    [AccessLevel]     INT            NOT NULL,
    CONSTRAINT [PK_mcmd_MetaFieldType] PRIMARY KEY CLUSTERED ([MetaFieldTypeId] ASC),
    CONSTRAINT [IX_mcmd_MetaFieldType] UNIQUE NONCLUSTERED ([Name] ASC)
);


GO
PRINT N'Creating [dbo].[mcmd_Module]...';


GO
CREATE TABLE [dbo].[mcmd_Module] (
    [ModuleId]     INT           IDENTITY (1, 1) NOT NULL,
    [Name]         NVARCHAR (50) NOT NULL,
    [XSAttributes] NTEXT         NULL,
    CONSTRAINT [PK_mcmd_Module] PRIMARY KEY CLUSTERED ([ModuleId] ASC)
);


GO
PRINT N'Creating [dbo].[MetaFileValue]...';


GO
CREATE TABLE [dbo].[MetaFileValue] (
    [MetaKey]       INT            NOT NULL,
    [FileName]      NVARCHAR (256) NULL,
    [ContentType]   NVARCHAR (256) NULL,
    [Data]          IMAGE          NULL,
    [Size]          INT            NOT NULL,
    [CreationTime]  DATETIME       NOT NULL,
    [LastWriteTime] DATETIME       NOT NULL,
    [LastReadTime]  DATETIME       NOT NULL,
    CONSTRAINT [PK_MetaFileValue] PRIMARY KEY CLUSTERED ([MetaKey] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogEntrySearchResults_SingleSort]...';


GO
CREATE TABLE [dbo].[CatalogEntrySearchResults_SingleSort] (
    [SearchSetId]    UNIQUEIDENTIFIER NOT NULL,
    [ResultIndex]    INT              NOT NULL,
    [Created]        DATETIME         NOT NULL,
    [CatalogEntryId] INT              NOT NULL,
    CONSTRAINT [PK_CatalogEntrySearchResults_SingleSort] PRIMARY KEY CLUSTERED ([SearchSetId] ASC, [ResultIndex] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogEntrySearchResults_SingleSort].[IX_CatalogEntrySearchResults_SingleSort_Created]...';


GO
CREATE NONCLUSTERED INDEX [IX_CatalogEntrySearchResults_SingleSort_Created]
    ON [dbo].[CatalogEntrySearchResults_SingleSort]([Created] ASC);


GO
PRINT N'Creating [dbo].[ReturnReasonDictionary]...';


GO
CREATE TABLE [dbo].[ReturnReasonDictionary] (
    [ReturnReasonId]   INT           IDENTITY (1, 1) NOT NULL,
    [ReturnReasonText] NVARCHAR (50) NOT NULL,
    [Ordering]         INT           NOT NULL,
    [Visible]          BIT           NULL,
    CONSTRAINT [PK_ReturnReasonDictionary] PRIMARY KEY CLUSTERED ([ReturnReasonText] ASC)
);


GO
PRINT N'Creating [dbo].[aspnet_PersonalizationPerUser]...';


GO
CREATE TABLE [dbo].[aspnet_PersonalizationPerUser] (
    [Id]              UNIQUEIDENTIFIER NOT NULL,
    [PathId]          UNIQUEIDENTIFIER NULL,
    [UserId]          UNIQUEIDENTIFIER NULL,
    [PageSettings]    IMAGE            NOT NULL,
    [LastUpdatedDate] DATETIME         NOT NULL,
    PRIMARY KEY NONCLUSTERED ([Id] ASC)
);


GO
EXECUTE sp_tableoption @TableNamePattern = N'[dbo].[aspnet_PersonalizationPerUser]', @OptionName = N'text in row', @OptionValue = N'6000';


GO
PRINT N'Creating [dbo].[aspnet_PersonalizationPerUser].[aspnet_PersonalizationPerUser_index1]...';


GO
CREATE UNIQUE CLUSTERED INDEX [aspnet_PersonalizationPerUser_index1]
    ON [dbo].[aspnet_PersonalizationPerUser]([PathId] ASC, [UserId] ASC);


GO
PRINT N'Creating [dbo].[aspnet_PersonalizationPerUser].[aspnet_PersonalizationPerUser_ncindex2]...';


GO
CREATE UNIQUE NONCLUSTERED INDEX [aspnet_PersonalizationPerUser_ncindex2]
    ON [dbo].[aspnet_PersonalizationPerUser]([UserId] ASC, [PathId] ASC);


GO
PRINT N'Creating [dbo].[mcmd_MetaView]...';


GO
CREATE TABLE [dbo].[mcmd_MetaView] (
    [MetaViewId]        INT            IDENTITY (1, 1) NOT NULL,
    [MetaClassId]       INT            NOT NULL,
    [Card]              NVARCHAR (50)  NOT NULL,
    [Name]              NVARCHAR (50)  NOT NULL,
    [FriendlyName]      NVARCHAR (255) NOT NULL,
    [XSAttributes]      NTEXT          NULL,
    [XSFilters]         NTEXT          NULL,
    [XSSorts]           NTEXT          NULL,
    [XSGroups]          NTEXT          NULL,
    [XSAvailableFields] NTEXT          NULL,
    [Owner]             NVARCHAR (255) NOT NULL,
    [AccessLevel]       INT            NOT NULL,
    CONSTRAINT [PK_mcmd_MetaView] PRIMARY KEY CLUSTERED ([MetaViewId] ASC),
    CONSTRAINT [IX_mcmd_MetaView] UNIQUE NONCLUSTERED ([Name] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogEntrySearchResults]...';


GO
CREATE TABLE [dbo].[CatalogEntrySearchResults] (
    [SearchSetId]    UNIQUEIDENTIFIER NOT NULL,
    [CatalogEntryId] INT              NOT NULL,
    [Created]        DATETIME         NULL,
    [SortOrder]      INT              NULL
);


GO
PRINT N'Creating [dbo].[CatalogEntrySearchResults].[IX_CatalogEntrySearchResults_SearchSetId]...';


GO
CREATE CLUSTERED INDEX [IX_CatalogEntrySearchResults_SearchSetId]
    ON [dbo].[CatalogEntrySearchResults]([SearchSetId] ASC);


GO
PRINT N'Creating [dbo].[MetaDictionaryLocalization]...';


GO
CREATE TABLE [dbo].[MetaDictionaryLocalization] (
    [MetaDictionaryLocalizationId] INT             IDENTITY (1, 1) NOT NULL,
    [MetaDictionaryId]             INT             NOT NULL,
    [Language]                     NVARCHAR (20)   NOT NULL,
    [Value]                        NVARCHAR (2048) NOT NULL,
    [Tag]                          IMAGE           NULL,
    CONSTRAINT [PK_MetaDictionaryLocalization] PRIMARY KEY CLUSTERED ([MetaDictionaryLocalizationId] ASC),
    CONSTRAINT [IX_MetaDictionaryLocalization] UNIQUE NONCLUSTERED ([MetaDictionaryId] ASC, [Language] ASC)
);


GO
PRINT N'Creating [dbo].[JurisdictionRelation]...';


GO
CREATE TABLE [dbo].[JurisdictionRelation] (
    [JurisdictionId]      INT NOT NULL,
    [JurisdictionGroupId] INT NOT NULL,
    CONSTRAINT [PK_JurisdictionRelation] PRIMARY KEY CLUSTERED ([JurisdictionId] ASC, [JurisdictionGroupId] ASC)
);


GO
PRINT N'Creating [dbo].[PickList]...';


GO
CREATE TABLE [dbo].[PickList] (
    [PickListId]    INT           IDENTITY (1, 1) NOT NULL,
    [Name]          NVARCHAR (50) NOT NULL,
    [Created]       DATETIME      NOT NULL,
    [CreatedBy]     NVARCHAR (50) NULL,
    [WarehouseCode] NVARCHAR (50) NULL,
    CONSTRAINT [PK_PickList] PRIMARY KEY CLUSTERED ([PickListId] ASC)
);


GO
PRINT N'Creating [dbo].[PickList].[IX_PickList_WarehouseCode]...';


GO
CREATE NONCLUSTERED INDEX [IX_PickList_WarehouseCode]
    ON [dbo].[PickList]([WarehouseCode] ASC);


GO
PRINT N'Creating [dbo].[CatalogEntryRelation]...';


GO
CREATE TABLE [dbo].[CatalogEntryRelation] (
    [ParentEntryId]  INT             NOT NULL,
    [ChildEntryId]   INT             NOT NULL,
    [RelationTypeId] NVARCHAR (50)   NOT NULL,
    [Quantity]       DECIMAL (38, 9) NULL,
    [GroupName]      NVARCHAR (100)  NULL,
    [SortOrder]      INT             NOT NULL,
    CONSTRAINT [PK_CatalogEntryRelation] PRIMARY KEY CLUSTERED ([ParentEntryId] ASC, [ChildEntryId] ASC, [RelationTypeId] ASC),
    CONSTRAINT [IX_CatalogEntryRelation] UNIQUE NONCLUSTERED ([RelationTypeId] ASC, [ChildEntryId] ASC, [ParentEntryId] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogEntryRelation].[IX_CatalogEntryRelation_Indexed_ChildEntryId]...';


GO
CREATE NONCLUSTERED INDEX [IX_CatalogEntryRelation_Indexed_ChildEntryId]
    ON [dbo].[CatalogEntryRelation]([ChildEntryId] ASC)
    INCLUDE([ParentEntryId], [RelationTypeId], [Quantity], [GroupName], [SortOrder]);


GO
PRINT N'Creating [dbo].[MetaDictionary]...';


GO
CREATE TABLE [dbo].[MetaDictionary] (
    [MetaDictionaryId] INT             IDENTITY (1, 1) NOT NULL,
    [MetaFieldId]      INT             NOT NULL,
    [Value]            NVARCHAR (2048) NOT NULL,
    [Tag]              IMAGE           NULL,
    CONSTRAINT [PK_MetaDictionary] PRIMARY KEY CLUSTERED ([MetaDictionaryId] ASC)
);


GO
PRINT N'Creating [dbo].[mcmd_MetaEnum]...';


GO
CREATE TABLE [dbo].[mcmd_MetaEnum] (
    [MetaEnumId]   INT            IDENTITY (1, 1) NOT NULL,
    [Id]           INT            NOT NULL,
    [TypeName]     NVARCHAR (50)  NOT NULL,
    [FriendlyName] NVARCHAR (255) NOT NULL,
    [OrderId]      INT            NOT NULL,
    [Owner]        NVARCHAR (255) NOT NULL,
    [AccessLevel]  INT            NOT NULL,
    CONSTRAINT [PK_mcmd_MetaEnum] PRIMARY KEY CLUSTERED ([MetaEnumId] ASC),
    CONSTRAINT [IX_mcmd_MetaEnum] UNIQUE NONCLUSTERED ([Id] ASC, [TypeName] ASC)
);


GO
PRINT N'Creating [dbo].[aspnet_PersonalizationAllUsers]...';


GO
CREATE TABLE [dbo].[aspnet_PersonalizationAllUsers] (
    [PathId]          UNIQUEIDENTIFIER NOT NULL,
    [PageSettings]    IMAGE            NOT NULL,
    [LastUpdatedDate] DATETIME         NOT NULL,
    PRIMARY KEY CLUSTERED ([PathId] ASC)
);


GO
EXECUTE sp_tableoption @TableNamePattern = N'[dbo].[aspnet_PersonalizationAllUsers]', @OptionName = N'text in row', @OptionValue = N'6000';


GO
PRINT N'Creating [dbo].[OrderShipmentStatus]...';


GO
CREATE TABLE [dbo].[OrderShipmentStatus] (
    [OrderShipmentStatusId] INT           NOT NULL,
    [Name]                  NVARCHAR (50) NOT NULL,
    CONSTRAINT [PK_OrderShipmentStatus] PRIMARY KEY CLUSTERED ([OrderShipmentStatusId] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogEntryAssociation]...';


GO
CREATE TABLE [dbo].[CatalogEntryAssociation] (
    [CatalogAssociationId] INT           NOT NULL,
    [CatalogEntryId]       INT           NOT NULL,
    [SortOrder]            INT           NOT NULL,
    [AssociationTypeId]    NVARCHAR (50) NOT NULL,
    CONSTRAINT [PK_CatalogEntryAssociation] PRIMARY KEY CLUSTERED ([CatalogAssociationId] ASC, [CatalogEntryId] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogEntryAssociation].[IX_CatalogEntryAssociation_CatalogEntryId]...';


GO
CREATE NONCLUSTERED INDEX [IX_CatalogEntryAssociation_CatalogEntryId]
    ON [dbo].[CatalogEntryAssociation]([CatalogEntryId] ASC);


GO
PRINT N'Creating [dbo].[mcmd_MetaClass]...';


GO
CREATE TABLE [dbo].[mcmd_MetaClass] (
    [MetaClassId]    INT            IDENTITY (1, 1) NOT NULL,
    [Name]           NVARCHAR (50)  NOT NULL,
    [FriendlyName]   NVARCHAR (255) NOT NULL,
    [PluralName]     NVARCHAR (255) NOT NULL,
    [TitleFieldName] NVARCHAR (50)  NOT NULL,
    [XSValidators]   NTEXT          NULL,
    [XSAttributes]   NTEXT          NULL,
    [XSExtensions]   NTEXT          NULL,
    [Owner]          NVARCHAR (255) NOT NULL,
    [AccessLevel]    INT            NOT NULL,
    [XSModules]      NTEXT          NULL,
    CONSTRAINT [PK_mcmd_MetaClass] PRIMARY KEY CLUSTERED ([MetaClassId] ASC),
    CONSTRAINT [IX_mcmd_MetaClass] UNIQUE NONCLUSTERED ([Name] ASC)
);


GO
PRINT N'Creating [dbo].[ReturnFormStatus]...';


GO
CREATE TABLE [dbo].[ReturnFormStatus] (
    [ReturnFormStatusId] INT           NOT NULL,
    [Name]               NVARCHAR (50) NOT NULL,
    CONSTRAINT [PK_ReturnFormStatus] PRIMARY KEY CLUSTERED ([ReturnFormStatusId] ASC)
);


GO
PRINT N'Creating [dbo].[MetaClassMetaFieldRelation]...';


GO
CREATE TABLE [dbo].[MetaClassMetaFieldRelation] (
    [MetaClassId] INT NOT NULL,
    [MetaFieldId] INT NOT NULL,
    [Weight]      INT NOT NULL,
    [Enabled]     BIT NOT NULL,
    CONSTRAINT [PK_MetaClassMetaFieldRelation] PRIMARY KEY CLUSTERED ([MetaClassId] ASC, [MetaFieldId] ASC)
);


GO
PRINT N'Creating [dbo].[OrderNoteType]...';


GO
CREATE TABLE [dbo].[OrderNoteType] (
    [OrderNoteTypeId] INT           NOT NULL,
    [Name]            NVARCHAR (50) NOT NULL,
    CONSTRAINT [PK_OrderNoteType] PRIMARY KEY CLUSTERED ([OrderNoteTypeId] ASC)
);


GO
PRINT N'Creating [dbo].[ecfVersion]...';


GO
CREATE TABLE [dbo].[ecfVersion] (
    [WorkId]             INT            IDENTITY (1, 1) NOT NULL,
    [ObjectId]           INT            NOT NULL,
    [ObjectTypeId]       INT            NOT NULL,
    [CatalogId]          INT            NOT NULL,
    [Name]               NVARCHAR (100) NULL,
    [Code]               NVARCHAR (100) NULL,
    [LanguageName]       NVARCHAR (50)  NOT NULL,
    [MasterLanguageName] NVARCHAR (50)  NULL,
    [IsCommonDraft]      BIT            NOT NULL,
    [StartPublish]       DATETIME       NULL,
    [StopPublish]        DATETIME       NULL,
    [Status]             INT            NULL,
    [CreatedBy]          NVARCHAR (256) NOT NULL,
    [Created]            DATETIME       NOT NULL,
    [ModifiedBy]         NVARCHAR (256) NULL,
    [Modified]           DATETIME       NULL,
    [SeoUri]             NVARCHAR (255) NULL,
    [SeoTitle]           NVARCHAR (150) NULL,
    [SeoDescription]     NVARCHAR (355) NULL,
    [SeoKeywords]        NVARCHAR (355) NULL,
    [SeoUriSegment]      NVARCHAR (255) NULL,
    CONSTRAINT [PK_ecfVersion] PRIMARY KEY CLUSTERED ([WorkId] ASC)
);


GO
PRINT N'Creating [dbo].[ecfVersion].[IDX_ecfVersion_Indexed_ContentId]...';


GO
CREATE NONCLUSTERED INDEX [IDX_ecfVersion_Indexed_ContentId]
    ON [dbo].[ecfVersion]([ObjectId] ASC, [ObjectTypeId] ASC, [CatalogId] ASC)
    INCLUDE([LanguageName], [MasterLanguageName], [Status], [IsCommonDraft]);


GO
PRINT N'Creating [dbo].[ecfVersion].[IDX_ecfVersion_Indexed_SeoUriSegment]...';


GO
CREATE NONCLUSTERED INDEX [IDX_ecfVersion_Indexed_SeoUriSegment]
    ON [dbo].[ecfVersion]([SeoUriSegment] ASC);


GO
PRINT N'Creating [dbo].[ecfVersion].[IDX_ecfVersion_Status_Modified]...';


GO
CREATE NONCLUSTERED INDEX [IDX_ecfVersion_Status_Modified]
    ON [dbo].[ecfVersion]([Status] ASC, [Modified] DESC)
    INCLUDE([LanguageName], [CatalogId]);


GO
PRINT N'Creating [dbo].[ecfVersion].[IDX_ecfVersion_ModifiedBy_Modified]...';


GO
CREATE NONCLUSTERED INDEX [IDX_ecfVersion_ModifiedBy_Modified]
    ON [dbo].[ecfVersion]([ModifiedBy] ASC, [Modified] DESC)
    INCLUDE([LanguageName], [CatalogId], [Status]);


GO
PRINT N'Creating [dbo].[CatalogEntry]...';


GO
CREATE TABLE [dbo].[CatalogEntry] (
    [CatalogEntryId]  INT              IDENTITY (1, 1) NOT NULL,
    [CatalogId]       INT              NOT NULL,
    [StartDate]       DATETIME         NOT NULL,
    [EndDate]         DATETIME         NOT NULL,
    [Name]            NVARCHAR (100)   NOT NULL,
    [TemplateName]    NVARCHAR (50)    NULL,
    [Code]            NVARCHAR (100)   NOT NULL,
    [ClassTypeId]     NVARCHAR (50)    NOT NULL,
    [MetaClassId]     INT              NOT NULL,
    [IsActive]        BIT              NOT NULL,
    [ContentAssetsID] UNIQUEIDENTIFIER NULL,
    [ContentGuid]     UNIQUEIDENTIFIER NOT NULL,
    [IsPublished]     BIT              NOT NULL,
    CONSTRAINT [PK_CatalogEntity] PRIMARY KEY CLUSTERED ([CatalogEntryId] ASC),
    CONSTRAINT [IX_CatalogEntity] UNIQUE NONCLUSTERED ([Code] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogEntry].[IX_CatalogEntry_Indexed_ContentGuid]...';


GO
CREATE NONCLUSTERED INDEX [IX_CatalogEntry_Indexed_ContentGuid]
    ON [dbo].[CatalogEntry]([ContentGuid] ASC);


GO
PRINT N'Creating [dbo].[mcmd_TmpMetaFile]...';


GO
CREATE TABLE [dbo].[mcmd_TmpMetaFile] (
    [TmpFileId] INT              IDENTITY (1, 1) NOT NULL,
    [Created]   DATETIME         NOT NULL,
    [FileUID]   UNIQUEIDENTIFIER NOT NULL,
    [FileName]  NVARCHAR (255)   NOT NULL,
    [Body]      IMAGE            NULL,
    CONSTRAINT [PK_mcmd_TmpMetaFile] PRIMARY KEY CLUSTERED ([TmpFileId] ASC)
);


GO
PRINT N'Creating [dbo].[JurisdictionGroup]...';


GO
CREATE TABLE [dbo].[JurisdictionGroup] (
    [JurisdictionGroupId] INT            IDENTITY (1, 1) NOT NULL,
    [DisplayName]         NVARCHAR (250) NOT NULL,
    [JurisdictionType]    INT            NOT NULL,
    [Code]                NVARCHAR (50)  NOT NULL,
    CONSTRAINT [PK_JurisdictionGroup] PRIMARY KEY CLUSTERED ([JurisdictionGroupId] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogAssociation]...';


GO
CREATE TABLE [dbo].[CatalogAssociation] (
    [CatalogAssociationId]   INT            IDENTITY (1, 1) NOT NULL,
    [CatalogEntryId]         INT            NOT NULL,
    [AssociationName]        NVARCHAR (150) NOT NULL,
    [AssociationDescription] NVARCHAR (255) NULL,
    [SortOrder]              INT            NOT NULL,
    CONSTRAINT [PK_CatalogRelation] PRIMARY KEY CLUSTERED ([CatalogAssociationId] ASC),
    CONSTRAINT [IX_CatalogAssociation] UNIQUE NONCLUSTERED ([CatalogEntryId] ASC, [AssociationName] ASC)
);


GO
PRINT N'Creating [dbo].[aspnet_Paths]...';


GO
CREATE TABLE [dbo].[aspnet_Paths] (
    [ApplicationId] UNIQUEIDENTIFIER NOT NULL,
    [PathId]        UNIQUEIDENTIFIER NOT NULL,
    [Path]          NVARCHAR (256)   NOT NULL,
    [LoweredPath]   NVARCHAR (256)   NOT NULL,
    PRIMARY KEY NONCLUSTERED ([PathId] ASC)
);


GO
PRINT N'Creating [dbo].[aspnet_Paths].[aspnet_Paths_index]...';


GO
CREATE UNIQUE CLUSTERED INDEX [aspnet_Paths_index]
    ON [dbo].[aspnet_Paths]([ApplicationId] ASC, [LoweredPath] ASC);


GO
PRINT N'Creating [dbo].[Jurisdiction]...';


GO
CREATE TABLE [dbo].[Jurisdiction] (
    [JurisdictionId]     INT            IDENTITY (1, 1) NOT NULL,
    [DisplayName]        NVARCHAR (100) NOT NULL,
    [StateProvinceCode]  NVARCHAR (50)  NULL,
    [CountryCode]        NVARCHAR (50)  NOT NULL,
    [JurisdictionType]   INT            NOT NULL,
    [ZipPostalCodeStart] NVARCHAR (50)  NULL,
    [ZipPostalCodeEnd]   NVARCHAR (50)  NULL,
    [City]               NVARCHAR (50)  NULL,
    [District]           NVARCHAR (50)  NULL,
    [County]             NVARCHAR (50)  NULL,
    [GeoCode]            NVARCHAR (255) NULL,
    [Code]               NVARCHAR (50)  NOT NULL,
    CONSTRAINT [PK_TaxRegion] PRIMARY KEY CLUSTERED ([JurisdictionId] ASC)
);


GO
PRINT N'Creating [dbo].[Jurisdiction].[IDX_Jurisdiction_CountryCode]...';


GO
CREATE NONCLUSTERED INDEX [IDX_Jurisdiction_CountryCode]
    ON [dbo].[Jurisdiction]([CountryCode] ASC)
    ON [PRIMARY];


GO
PRINT N'Creating [dbo].[Catalog]...';


GO
CREATE TABLE [dbo].[Catalog] (
    [CatalogId]       INT              IDENTITY (1, 1) NOT NULL,
    [Name]            NVARCHAR (150)   NOT NULL,
    [StartDate]       DATETIME         NULL,
    [EndDate]         DATETIME         NULL,
    [DefaultCurrency] NVARCHAR (128)   NULL,
    [WeightBase]      NVARCHAR (128)   NULL,
    [DefaultLanguage] NVARCHAR (50)    NULL,
    [IsPrimary]       BIT              NOT NULL,
    [IsActive]        BIT              NOT NULL,
    [Created]         DATETIME         NOT NULL,
    [Modified]        DATETIME         NOT NULL,
    [CreatorId]       NVARCHAR (256)   NULL,
    [ModifierId]      NVARCHAR (256)   NULL,
    [SortOrder]       INT              NOT NULL,
    [Owner]           NVARCHAR (255)   NULL,
    [LengthBase]      NVARCHAR (128)   NULL,
    [ContentGuid]     UNIQUEIDENTIFIER NOT NULL,
    CONSTRAINT [PK_Catalog_1] PRIMARY KEY CLUSTERED ([CatalogId] ASC)
);


GO
PRINT N'Creating [dbo].[mcmd_MetaLink]...';


GO
CREATE TABLE [dbo].[mcmd_MetaLink] (
    [LinkId]        INT           IDENTITY (1, 1) NOT NULL,
    [MetaClassName] NVARCHAR (50) NULL,
    [MetaObjectId]  INT           NULL,
    [UID]           NTEXT         NULL,
    CONSTRAINT [PK_mcmd_MetaLink] PRIMARY KEY CLUSTERED ([LinkId] ASC)
);


GO
PRINT N'Creating [dbo].[TaxLanguage]...';


GO
CREATE TABLE [dbo].[TaxLanguage] (
    [TaxLanguageId] INT           IDENTITY (1, 1) NOT NULL,
    [DisplayName]   NVARCHAR (50) NOT NULL,
    [LanguageCode]  NVARCHAR (50) NOT NULL,
    [TaxId]         INT           NOT NULL,
    CONSTRAINT [PK_TaxLanguage] PRIMARY KEY CLUSTERED ([TaxLanguageId] ASC)
);


GO
PRINT N'Creating [dbo].[PriceDetail]...';


GO
CREATE TABLE [dbo].[PriceDetail] (
    [PriceValueId]     BIGINT          IDENTITY (1, 1) NOT NULL,
    [Created]          DATETIME2 (7)   NOT NULL,
    [Modified]         DATETIME2 (7)   NOT NULL,
    [CatalogEntryCode] NVARCHAR (100)  NOT NULL,
    [MarketId]         NVARCHAR (8)    NOT NULL,
    [CurrencyCode]     NVARCHAR (8)    NOT NULL,
    [PriceTypeId]      INT             NOT NULL,
    [PriceCode]        NVARCHAR (256)  NOT NULL,
    [ValidFrom]        DATETIME2 (7)   NOT NULL,
    [ValidUntil]       DATETIME2 (7)   NULL,
    [MinQuantity]      DECIMAL (38, 9) NOT NULL,
    [UnitPrice]        DECIMAL (38, 9) NOT NULL,
    CONSTRAINT [PK_PriceDetail] PRIMARY KEY NONCLUSTERED ([PriceValueId] ASC)
);


GO
PRINT N'Creating [dbo].[PriceDetail].[IX_PriceDetail_CatalogEntry]...';


GO
CREATE CLUSTERED INDEX [IX_PriceDetail_CatalogEntry]
    ON [dbo].[PriceDetail]([CatalogEntryCode] ASC);


GO
PRINT N'Creating [dbo].[AssociationType]...';


GO
CREATE TABLE [dbo].[AssociationType] (
    [AssociationTypeId] NVARCHAR (50)  NOT NULL,
    [Description]       NVARCHAR (250) NULL,
    CONSTRAINT [PK_AssociationType] PRIMARY KEY CLUSTERED ([AssociationTypeId] ASC)
);


GO
PRINT N'Creating [dbo].[Affiliate]...';


GO
CREATE TABLE [dbo].[Affiliate] (
    [AffiliateId] UNIQUEIDENTIFIER NOT NULL,
    [Name]        NVARCHAR (50)    NOT NULL,
    [IsActive]    BIT              NOT NULL
);


GO
PRINT N'Creating [dbo].[Affiliate].[IX_Affiliate_AffiliateId]...';


GO
CREATE CLUSTERED INDEX [IX_Affiliate_AffiliateId]
    ON [dbo].[Affiliate]([AffiliateId] ASC);


GO
PRINT N'Creating [dbo].[MetaField]...';


GO
CREATE TABLE [dbo].[MetaField] (
    [MetaFieldId]        INT             IDENTITY (1, 1) NOT NULL,
    [Name]               NVARCHAR (256)  NOT NULL,
    [Namespace]          NVARCHAR (1024) NOT NULL,
    [SystemMetaClassId]  INT             NOT NULL,
    [FriendlyName]       NVARCHAR (256)  NOT NULL,
    [Description]        NVARCHAR (MAX)  NULL,
    [DataTypeId]         INT             NOT NULL,
    [Length]             INT             NOT NULL,
    [AllowNulls]         BIT             NOT NULL,
    [MultiLanguageValue] BIT             NOT NULL,
    [AllowSearch]        BIT             NOT NULL,
    [Tag]                IMAGE           NULL,
    [IsEncrypted]        BIT             NOT NULL,
    [IsKeyField]         BIT             NOT NULL,
    CONSTRAINT [PK_MetaField] PRIMARY KEY CLUSTERED ([MetaFieldId] ASC),
    CONSTRAINT [IX_MetaField] UNIQUE NONCLUSTERED ([Name] ASC, [SystemMetaClassId] ASC)
);


GO
PRINT N'Creating [dbo].[Tax]...';


GO
CREATE TABLE [dbo].[Tax] (
    [TaxId]     INT           IDENTITY (1, 1) NOT NULL,
    [TaxType]   INT           NOT NULL,
    [Name]      NVARCHAR (50) NOT NULL,
    [SortOrder] INT           NOT NULL,
    CONSTRAINT [Tax_PK] PRIMARY KEY CLUSTERED ([TaxId] ASC),
    CONSTRAINT [IX_Tax] UNIQUE NONCLUSTERED ([Name] ASC)
);


GO
PRINT N'Creating [dbo].[PriceValue]...';


GO
CREATE TABLE [dbo].[PriceValue] (
    [PriceGroupId] INT             NOT NULL,
    [ValidFrom]    DATETIME        NOT NULL,
    [ValidUntil]   DATETIME        NULL,
    [MinQuantity]  DECIMAL (38, 9) NOT NULL,
    [MaxQuantity]  DECIMAL (38, 9) NULL,
    [UnitPrice]    DECIMAL (38, 9) NOT NULL,
    CONSTRAINT [PK_PriceValue] PRIMARY KEY CLUSTERED ([PriceGroupId] ASC, [ValidFrom] ASC, [MinQuantity] ASC)
);


GO
PRINT N'Creating [dbo].[mcmd_MetaIdentifier]...';


GO
CREATE TABLE [dbo].[mcmd_MetaIdentifier] (
    [IdentifierId]  INT            IDENTITY (1, 1) NOT NULL,
    [PeriodKey]     VARCHAR (10)   NOT NULL,
    [TypeName]      NVARCHAR (50)  NOT NULL,
    [MetaClassName] NVARCHAR (50)  NOT NULL,
    [MetaFieldName] NVARCHAR (50)  NOT NULL,
    [Id]            INT            NOT NULL,
    [Value]         NVARCHAR (255) NOT NULL,
    CONSTRAINT [PK_mcmd_MetaIdentifier] PRIMARY KEY CLUSTERED ([IdentifierId] ASC),
    CONSTRAINT [IX_mcmd_MetaIdentifier] UNIQUE NONCLUSTERED ([PeriodKey] ASC, [TypeName] ASC, [MetaClassName] ASC, [MetaFieldName] ASC, [Value] ASC)
);


GO
PRINT N'Creating [dbo].[TaxValue]...';


GO
CREATE TABLE [dbo].[TaxValue] (
    [TaxValueId]          INT              IDENTITY (1, 1) NOT NULL,
    [Percentage]          FLOAT (53)       NOT NULL,
    [TaxId]               INT              NOT NULL,
    [TaxCategory]         NVARCHAR (50)    NOT NULL,
    [JurisdictionGroupId] INT              NOT NULL,
    [SiteId]              UNIQUEIDENTIFIER NULL,
    [AffectiveDate]       DATETIME         NOT NULL,
    CONSTRAINT [TaxValue_PK] PRIMARY KEY CLUSTERED ([TaxValueId] ASC)
);


GO
PRINT N'Creating [dbo].[mcmd_MetaFileContentType]...';


GO
CREATE TABLE [dbo].[mcmd_MetaFileContentType] (
    [ContentTypeId]     INT            IDENTITY (1, 1) NOT NULL,
    [Extension]         NVARCHAR (10)  NULL,
    [ContentTypeString] NVARCHAR (255) NOT NULL,
    [FriendlyName]      NVARCHAR (50)  NULL,
    CONSTRAINT [PK_mcmd_MetaFileContentType] PRIMARY KEY CLUSTERED ([ContentTypeId] ASC)
);


GO
PRINT N'Creating [dbo].[TaxCategory]...';


GO
CREATE TABLE [dbo].[TaxCategory] (
    [TaxCategoryId] INT           IDENTITY (1, 1) NOT NULL,
    [Name]          NVARCHAR (50) NOT NULL,
    CONSTRAINT [TaxCategory_PK] PRIMARY KEY CLUSTERED ([TaxCategoryId] ASC)
);


GO
PRINT N'Creating [dbo].[mcmd_MetaFile]...';


GO
CREATE TABLE [dbo].[mcmd_MetaFile] (
    [FileId]   INT              IDENTITY (1, 1) NOT NULL,
    [FileUID]  UNIQUEIDENTIFIER NOT NULL,
    [FileName] NVARCHAR (255)   NOT NULL,
    [Body]     IMAGE            NULL,
    [Length]   AS               (datalength([Body])),
    CONSTRAINT [PK_mcmd_MetaFile] PRIMARY KEY CLUSTERED ([FileId] ASC)
);


GO
PRINT N'Creating [dbo].[mcmd_MetaFile].[IX_mcmd_MetaFile]...';


GO
CREATE UNIQUE NONCLUSTERED INDEX [IX_mcmd_MetaFile]
    ON [dbo].[mcmd_MetaFile]([FileUID] ASC);


GO
PRINT N'Creating [dbo].[StateProvince]...';


GO
CREATE TABLE [dbo].[StateProvince] (
    [StateProvinceId] INT           IDENTITY (1, 1) NOT NULL,
    [Name]            NVARCHAR (50) NOT NULL,
    [Ordering]        INT           NULL,
    [Visible]         BIT           NULL,
    [CountryId]       INT           NOT NULL,
    CONSTRAINT [StateProvince_PK] PRIMARY KEY CLUSTERED ([StateProvinceId] ASC)
);


GO
PRINT N'Creating [dbo].[ShippingRegion]...';


GO
CREATE TABLE [dbo].[ShippingRegion] (
    [ShippingRegionId] INT              IDENTITY (1, 1) NOT NULL,
    [ShippingMethodId] UNIQUEIDENTIFIER NOT NULL,
    [StateProvinceId]  INT              NULL,
    CONSTRAINT [ShippingRegion_PK] PRIMARY KEY NONCLUSTERED ([ShippingRegionId] ASC)
);


GO
PRINT N'Creating [dbo].[ShippingRegion].[IX_ShippingRegion_ShippingMethodId]...';


GO
CREATE CLUSTERED INDEX [IX_ShippingRegion_ShippingMethodId]
    ON [dbo].[ShippingRegion]([ShippingMethodId] ASC);


GO
PRINT N'Creating [dbo].[PriceGroup]...';


GO
CREATE TABLE [dbo].[PriceGroup] (
    [PriceGroupId]     INT            IDENTITY (1, 1) NOT NULL,
    [Created]          DATETIME       NOT NULL,
    [Modified]         DATETIME       NOT NULL,
    [CatalogEntryCode] NVARCHAR (100) NOT NULL,
    [MarketId]         NVARCHAR (8)   NOT NULL,
    [CurrencyCode]     NVARCHAR (8)   NOT NULL,
    [PriceTypeId]      INT            NOT NULL,
    [PriceCode]        NVARCHAR (256) NOT NULL,
    CONSTRAINT [PK_PriceGroup] PRIMARY KEY CLUSTERED ([CatalogEntryCode] ASC, [MarketId] ASC, [CurrencyCode] ASC, [PriceTypeId] ASC, [PriceCode] ASC),
    CONSTRAINT [AX_PriceGroup_PriceGroupId] UNIQUE NONCLUSTERED ([PriceGroupId] ASC)
);


GO
PRINT N'Creating [dbo].[MetaClass]...';


GO
CREATE TABLE [dbo].[MetaClass] (
    [MetaClassId]               INT             IDENTITY (1, 1) NOT NULL,
    [Namespace]                 NVARCHAR (1024) NOT NULL,
    [Name]                      NVARCHAR (256)  NOT NULL,
    [FriendlyName]              NVARCHAR (256)  NOT NULL,
    [IsSystem]                  BIT             NOT NULL,
    [IsAbstract]                BIT             NOT NULL,
    [ParentClassId]             INT             NOT NULL,
    [TableName]                 NVARCHAR (256)  NOT NULL,
    [PrimaryKeyName]            NVARCHAR (256)  NOT NULL,
    [Description]               NVARCHAR (MAX)  NULL,
    [FieldListChangedSqlScript] NVARCHAR (MAX)  NULL,
    [Tag]                       IMAGE           NULL,
    CONSTRAINT [PK_MetaClass] PRIMARY KEY CLUSTERED ([MetaClassId] ASC),
    CONSTRAINT [IX_MetaClass] UNIQUE NONCLUSTERED ([Name] ASC)
);


GO
PRINT N'Creating [dbo].[PriceType]...';


GO
CREATE TABLE [dbo].[PriceType] (
    [PriceTypeId]   INT            NOT NULL,
    [PriceTypeName] NVARCHAR (256) NOT NULL,
    CONSTRAINT [PK_PriceType] PRIMARY KEY CLUSTERED ([PriceTypeId] ASC)
);


GO
PRINT N'Creating [dbo].[ShippingPaymentRestriction]...';


GO
CREATE TABLE [dbo].[ShippingPaymentRestriction] (
    [ShippingPaymentRestrictionId] INT              IDENTITY (1, 1) NOT NULL,
    [ShippingMethodId]             UNIQUEIDENTIFIER NOT NULL,
    [PaymentMethodId]              UNIQUEIDENTIFIER NOT NULL,
    [RestrictShippingMethods]      BIT              NOT NULL,
    CONSTRAINT [PK_ShippingPaymentRestriction] PRIMARY KEY CLUSTERED ([ShippingPaymentRestrictionId] ASC)
);


GO
PRINT N'Creating [dbo].[aspnet_UsersInRoles]...';


GO
CREATE TABLE [dbo].[aspnet_UsersInRoles] (
    [UserId] UNIQUEIDENTIFIER NOT NULL,
    [RoleId] UNIQUEIDENTIFIER NOT NULL,
    PRIMARY KEY CLUSTERED ([UserId] ASC, [RoleId] ASC)
);


GO
PRINT N'Creating [dbo].[aspnet_UsersInRoles].[aspnet_UsersInRoles_index]...';


GO
CREATE NONCLUSTERED INDEX [aspnet_UsersInRoles_index]
    ON [dbo].[aspnet_UsersInRoles]([RoleId] ASC);


GO
PRINT N'Creating [dbo].[ShippingPackage]...';


GO
CREATE TABLE [dbo].[ShippingPackage] (
    [ShippingPackageId] INT              IDENTITY (1, 1) NOT NULL,
    [PackageId]         INT              NOT NULL,
    [ShippingOptionId]  UNIQUEIDENTIFIER NOT NULL,
    [PackageName]       NVARCHAR (100)   NOT NULL,
    CONSTRAINT [ShippingPackage_PK] PRIMARY KEY CLUSTERED ([ShippingPackageId] ASC)
);


GO
PRINT N'Creating [dbo].[ShippingMethodParameter]...';


GO
CREATE TABLE [dbo].[ShippingMethodParameter] (
    [ShippingMethodParamterId] INT              IDENTITY (1, 1) NOT NULL,
    [Parameter]                NVARCHAR (50)    NULL,
    [Value]                    NVARCHAR (512)   NULL,
    [ShippingMethodId]         UNIQUEIDENTIFIER NOT NULL,
    CONSTRAINT [PK_ShippingMethodParameter] PRIMARY KEY NONCLUSTERED ([ShippingMethodParamterId] ASC)
);


GO
PRINT N'Creating [dbo].[ShippingMethodParameter].[IX_ShippingMethodParameter_ShippingMethodId]...';


GO
CREATE CLUSTERED INDEX [IX_ShippingMethodParameter_ShippingMethodId]
    ON [dbo].[ShippingMethodParameter]([ShippingMethodId] ASC);


GO
PRINT N'Creating [dbo].[MetaDataType]...';


GO
CREATE TABLE [dbo].[MetaDataType] (
    [DataTypeId]      INT            NOT NULL,
    [Name]            NVARCHAR (256) NOT NULL,
    [FriendlyName]    NVARCHAR (256) NOT NULL,
    [Description]     NTEXT          NULL,
    [Length]          INT            NOT NULL,
    [SqlName]         NVARCHAR (256) NOT NULL,
    [AllowNulls]      BIT            NOT NULL,
    [Variable]        BIT            NOT NULL,
    [IsSQLCommonType] BIT            NOT NULL,
    [DefaultValue]    NVARCHAR (256) NOT NULL,
    CONSTRAINT [PK_MetaDataType] PRIMARY KEY CLUSTERED ([DataTypeId] ASC)
);


GO
PRINT N'Creating [dbo].[ShippingMethodCase]...';


GO
CREATE TABLE [dbo].[ShippingMethodCase] (
    [ShippingMethodCaseId] INT              IDENTITY (1, 1) NOT NULL,
    [Total]                FLOAT (53)       NOT NULL,
    [Charge]               DECIMAL (38, 9)  NOT NULL,
    [ShippingMethodId]     UNIQUEIDENTIFIER NOT NULL,
    [JurisdictionGroupId]  INT              NULL,
    [StartDate]            DATETIME         NULL,
    [EndDate]              DATETIME         NULL,
    CONSTRAINT [ShippingMethodCase_PK] PRIMARY KEY NONCLUSTERED ([ShippingMethodCaseId] ASC)
);


GO
PRINT N'Creating [dbo].[ShippingMethodCase].[IX_ShippingMethodCase_ShippingMethodId]...';


GO
CREATE CLUSTERED INDEX [IX_ShippingMethodCase_ShippingMethodId]
    ON [dbo].[ShippingMethodCase]([ShippingMethodId] ASC);


GO
PRINT N'Creating [dbo].[MetaAttribute]...';


GO
CREATE TABLE [dbo].[MetaAttribute] (
    [AttrOwnerId]   INT            NOT NULL,
    [AttrOwnerType] INT            NOT NULL,
    [Key]           NVARCHAR (256) NOT NULL,
    [Value]         NTEXT          NOT NULL,
    CONSTRAINT [PK_MetaAttribute] PRIMARY KEY CLUSTERED ([AttrOwnerId] ASC, [AttrOwnerType] ASC, [Key] ASC)
);


GO
PRINT N'Creating [dbo].[aspnet_Roles]...';


GO
CREATE TABLE [dbo].[aspnet_Roles] (
    [ApplicationId]   UNIQUEIDENTIFIER NOT NULL,
    [RoleId]          UNIQUEIDENTIFIER NOT NULL,
    [RoleName]        NVARCHAR (256)   NOT NULL,
    [LoweredRoleName] NVARCHAR (256)   NOT NULL,
    [Description]     NVARCHAR (256)   NULL,
    PRIMARY KEY NONCLUSTERED ([RoleId] ASC)
);


GO
PRINT N'Creating [dbo].[aspnet_Roles].[aspnet_Roles_index1]...';


GO
CREATE UNIQUE CLUSTERED INDEX [aspnet_Roles_index1]
    ON [dbo].[aspnet_Roles]([ApplicationId] ASC, [LoweredRoleName] ASC);


GO
PRINT N'Creating [dbo].[ShippingMethod]...';


GO
CREATE TABLE [dbo].[ShippingMethod] (
    [ShippingMethodId] UNIQUEIDENTIFIER NOT NULL,
    [ShippingOptionId] UNIQUEIDENTIFIER NOT NULL,
    [LanguageId]       NVARCHAR (10)    NOT NULL,
    [IsActive]         BIT              NOT NULL,
    [Name]             NVARCHAR (100)   NOT NULL,
    [Description]      NVARCHAR (255)   NULL,
    [BasePrice]        DECIMAL (38, 9)  NOT NULL,
    [Currency]         NVARCHAR (50)    NULL,
    [DisplayName]      NVARCHAR (200)   NOT NULL,
    [IsDefault]        BIT              NOT NULL,
    [Ordering]         INT              NULL,
    [Created]          DATETIME         NOT NULL,
    [Modified]         DATETIME         NOT NULL,
    CONSTRAINT [ShippingMethod_PK] PRIMARY KEY CLUSTERED ([ShippingMethodId] ASC),
    CONSTRAINT [IX_ShippingMethod] UNIQUE NONCLUSTERED ([LanguageId] ASC, [IsActive] DESC, [Name] ASC)
);


GO
PRINT N'Creating [dbo].[ShippingOptionParameter]...';


GO
CREATE TABLE [dbo].[ShippingOptionParameter] (
    [ShippingOptionParameterId] INT              IDENTITY (1, 1) NOT NULL,
    [ShippingOptionId]          UNIQUEIDENTIFIER NOT NULL,
    [Parameter]                 NVARCHAR (50)    NOT NULL,
    [Value]                     NVARCHAR (255)   NULL,
    CONSTRAINT [ShippingOptionParameter_PK] PRIMARY KEY CLUSTERED ([ShippingOptionParameterId] ASC)
);


GO
PRINT N'Creating [dbo].[ShippingOption]...';


GO
CREATE TABLE [dbo].[ShippingOption] (
    [ShippingOptionId] UNIQUEIDENTIFIER NOT NULL,
    [Name]             NVARCHAR (100)   NOT NULL,
    [Description]      NVARCHAR (600)   NULL,
    [SystemKeyword]    NVARCHAR (30)    NOT NULL,
    [ClassName]        NVARCHAR (500)   NOT NULL,
    [Created]          DATETIME         NOT NULL,
    [Modified]         DATETIME         NOT NULL,
    CONSTRAINT [ShippingOption_PK] PRIMARY KEY CLUSTERED ([ShippingOptionId] ASC),
    CONSTRAINT [IX_ShippingOption] UNIQUE NONCLUSTERED ([SystemKeyword] ASC)
);


GO
PRINT N'Creating [dbo].[ReportingDates]...';


GO
CREATE TABLE [dbo].[ReportingDates] (
    [DateKey]        INT          NOT NULL,
    [DateFull]       DATETIME     NULL,
    [CharacterDate]  VARCHAR (10) NULL,
    [FullYear]       CHAR (4)     NULL,
    [QuarterNumber]  TINYINT      NULL,
    [WeekNumber]     TINYINT      NULL,
    [WeekDayName]    VARCHAR (10) NULL,
    [MonthDay]       TINYINT      NULL,
    [MonthName]      VARCHAR (12) NULL,
    [YearDay]        SMALLINT     NULL,
    [DateDefinition] VARCHAR (50) NULL,
    [WeekDay]        TINYINT      NULL,
    [MonthNumber]    TINYINT      NULL,
    CONSTRAINT [PK__ReportingDates__7B712C3B] PRIMARY KEY CLUSTERED ([DateKey] ASC),
    CONSTRAINT [IX_ReportingDates] UNIQUE NONCLUSTERED ([DateFull] ASC)
);


GO
PRINT N'Creating [dbo].[ShipmentDiscount]...';


GO
CREATE TABLE [dbo].[ShipmentDiscount] (
    [ShipmentDiscountId] INT             IDENTITY (1, 1) NOT NULL,
    [OrderGroupId]       INT             NOT NULL,
    [ShipmentId]         INT             NOT NULL,
    [DiscountId]         INT             NOT NULL,
    [DiscountAmount]     DECIMAL (38, 9) NOT NULL,
    [DiscountCode]       NVARCHAR (50)   NULL,
    [DiscountName]       NVARCHAR (50)   NULL,
    [DisplayMessage]     NVARCHAR (100)  NULL,
    [DiscountValue]      DECIMAL (38, 9) NOT NULL,
    CONSTRAINT [PK_ShipmentDiscount] PRIMARY KEY CLUSTERED ([ShipmentDiscountId] ASC),
    CONSTRAINT [IX_ShipmentDiscount] UNIQUE NONCLUSTERED ([DiscountId] ASC, [ShipmentId] ASC)
);


GO
PRINT N'Creating [dbo].[ShipmentDiscount].[IX_ShipmentDiscountOrderGroupId]...';


GO
CREATE NONCLUSTERED INDEX [IX_ShipmentDiscountOrderGroupId]
    ON [dbo].[ShipmentDiscount]([OrderGroupId] ASC);


GO
PRINT N'Creating [dbo].[ShipmentDiscount].[IX_ShipmentDiscount_ShipmentId]...';


GO
CREATE NONCLUSTERED INDEX [IX_ShipmentDiscount_ShipmentId]
    ON [dbo].[ShipmentDiscount]([ShipmentId] ASC);


GO
PRINT N'Creating [dbo].[ShippingCountry]...';


GO
CREATE TABLE [dbo].[ShippingCountry] (
    [ShippingCountryId] INT              IDENTITY (1, 1) NOT NULL,
    [ShippingMethodId]  UNIQUEIDENTIFIER NOT NULL,
    [CountryId]         INT              NULL,
    CONSTRAINT [PK_ShippingCountry] PRIMARY KEY NONCLUSTERED ([ShippingCountryId] ASC)
);


GO
PRINT N'Creating [dbo].[ShippingCountry].[IX_ShippingCountry_ShippingMethodId]...';


GO
CREATE CLUSTERED INDEX [IX_ShippingCountry_ShippingMethodId]
    ON [dbo].[ShippingCountry]([ShippingMethodId] ASC);


GO
PRINT N'Creating [dbo].[aspnet_Profile]...';


GO
CREATE TABLE [dbo].[aspnet_Profile] (
    [UserId]               UNIQUEIDENTIFIER NOT NULL,
    [PropertyNames]        NTEXT            NOT NULL,
    [PropertyValuesString] NTEXT            NOT NULL,
    [PropertyValuesBinary] IMAGE            NOT NULL,
    [LastUpdatedDate]      DATETIME         NOT NULL,
    PRIMARY KEY CLUSTERED ([UserId] ASC)
);


GO
EXECUTE sp_tableoption @TableNamePattern = N'[dbo].[aspnet_Profile]', @OptionName = N'text in row', @OptionValue = N'6000';


GO
PRINT N'Creating [dbo].[Shipment]...';


GO
CREATE TABLE [dbo].[Shipment] (
    [ShipmentId]             INT              IDENTITY (1, 1) NOT NULL,
    [OrderFormId]            INT              NOT NULL,
    [OrderGroupId]           INT              NOT NULL,
    [ShippingMethodId]       UNIQUEIDENTIFIER NOT NULL,
    [ShippingAddressId]      NVARCHAR (64)    NULL,
    [ShipmentTrackingNumber] NVARCHAR (128)   NULL,
    [ShipmentTotal]          DECIMAL (38, 9)  NOT NULL,
    [ShippingDiscountAmount] DECIMAL (38, 9)  NOT NULL,
    [ShippingMethodName]     NVARCHAR (128)   NULL,
    [Epi_ShippingCost]       DECIMAL (38, 9)  NULL,
    [Epi_ShippingTax]        DECIMAL (38, 9)  NULL,
    [Status]                 NVARCHAR (64)    NULL,
    [LineItemIds]            NVARCHAR (MAX)   NULL,
    [WarehouseCode]          NVARCHAR (50)    NULL,
    [PickListId]             INT              NULL,
    [SubTotal]               DECIMAL (38, 9)  NOT NULL,
    [OperationKeys]          NVARCHAR (MAX)   NULL,
    CONSTRAINT [PK_Shipment] PRIMARY KEY CLUSTERED ([ShipmentId] ASC)
);


GO
PRINT N'Creating [dbo].[Shipment].[IX_Shipment_OrderFormId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Shipment_OrderFormId]
    ON [dbo].[Shipment]([OrderFormId] ASC);


GO
PRINT N'Creating [dbo].[Shipment].[IX_Shipment_OrderGroupId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Shipment_OrderGroupId]
    ON [dbo].[Shipment]([OrderGroupId] ASC);


GO
PRINT N'Creating [dbo].[PaymentMethodParameter]...';


GO
CREATE TABLE [dbo].[PaymentMethodParameter] (
    [ParameterId]     INT              IDENTITY (1, 1) NOT NULL,
    [PaymentMethodId] UNIQUEIDENTIFIER NOT NULL,
    [Parameter]       NVARCHAR (50)    NOT NULL,
    [Value]           NVARCHAR (4000)  NULL,
    CONSTRAINT [PaymentMethodParameter_PK] PRIMARY KEY CLUSTERED ([ParameterId] ASC),
    CONSTRAINT [IX_PaymentMethodParameter] UNIQUE NONCLUSTERED ([PaymentMethodId] ASC, [Parameter] ASC)
);


GO
PRINT N'Creating [dbo].[MarketPaymentMethods]...';


GO
CREATE TABLE [dbo].[MarketPaymentMethods] (
    [MarketId]        NVARCHAR (8)     NOT NULL,
    [PaymentMethodId] UNIQUEIDENTIFIER NOT NULL,
    CONSTRAINT [PK_MarketPaymentMethods] PRIMARY KEY CLUSTERED ([MarketId] ASC, [PaymentMethodId] ASC)
);


GO
PRINT N'Creating [dbo].[Security_SsoTickets]...';


GO
CREATE TABLE [dbo].[Security_SsoTickets] (
    [SsoTicket]       NVARCHAR (64)  NOT NULL,
    [UserName]        NVARCHAR (256) NOT NULL,
    [ApplicationName] NVARCHAR (200) NULL,
    [ExpirationUtc]   DATETIME       NOT NULL,
    [Valid]           BIT            NOT NULL,
    CONSTRAINT [PK_Security_SsoTickets] PRIMARY KEY CLUSTERED ([SsoTicket] ASC)
);


GO
PRINT N'Creating [dbo].[PaymentMethod]...';


GO
CREATE TABLE [dbo].[PaymentMethod] (
    [PaymentMethodId]                UNIQUEIDENTIFIER NOT NULL,
    [Name]                           NVARCHAR (128)   NOT NULL,
    [Description]                    NVARCHAR (255)   NULL,
    [LanguageId]                     NVARCHAR (128)   NOT NULL,
    [SystemKeyword]                  NVARCHAR (30)    NOT NULL,
    [IsActive]                       BIT              NOT NULL,
    [IsDefault]                      BIT              NOT NULL,
    [ClassName]                      NVARCHAR (500)   NOT NULL,
    [PaymentImplementationClassName] NVARCHAR (255)   NULL,
    [SupportsRecurring]              BIT              NOT NULL,
    [Ordering]                       INT              NULL,
    [Created]                        DATETIME         NOT NULL,
    [Modified]                       DATETIME         NOT NULL,
    CONSTRAINT [PK_PaymentOption] PRIMARY KEY CLUSTERED ([PaymentMethodId] ASC),
    CONSTRAINT [IX_PaymentMethod] UNIQUE NONCLUSTERED ([LanguageId] ASC, [SystemKeyword] ASC)
);


GO
PRINT N'Creating [dbo].[Package]...';


GO
CREATE TABLE [dbo].[Package] (
    [PackageId]   INT            IDENTITY (1, 1) NOT NULL,
    [Name]        NVARCHAR (100) NOT NULL,
    [Description] NVARCHAR (600) NULL,
    [Width]       FLOAT (53)     NULL,
    [Height]      FLOAT (53)     NULL,
    [Length]      FLOAT (53)     NULL,
    CONSTRAINT [Package_PK] PRIMARY KEY CLUSTERED ([PackageId] ASC)
);


GO
PRINT N'Creating [dbo].[Security_RoleAssignment]...';


GO
CREATE TABLE [dbo].[Security_RoleAssignment] (
    [SecurityRoleAssignmentId] UNIQUEIDENTIFIER NOT NULL,
    [RoleParticipant]          UNIQUEIDENTIFIER NOT NULL,
    [Role]                     NVARCHAR (255)   NOT NULL,
    [Scope]                    NVARCHAR (MAX)   NULL,
    [CheckMode]                INT              NULL,
    [IsOnlyForOwner]           BIT              NOT NULL,
    CONSTRAINT [PK_Security_RoleAssignment] PRIMARY KEY CLUSTERED ([SecurityRoleAssignmentId] ASC)
);


GO
PRINT N'Creating [dbo].[OrderStatus]...';


GO
CREATE TABLE [dbo].[OrderStatus] (
    [OrderStatusId] INT           NOT NULL,
    [Name]          NVARCHAR (50) NOT NULL,
    CONSTRAINT [PK_OrderStatus] PRIMARY KEY CLUSTERED ([OrderStatusId] ASC)
);


GO
PRINT N'Creating [dbo].[OrderSearchResults]...';


GO
CREATE TABLE [dbo].[OrderSearchResults] (
    [SearchSetId]  UNIQUEIDENTIFIER NOT NULL,
    [OrderGroupId] INT              NOT NULL,
    [Created]      DATETIME         NULL
);


GO
PRINT N'Creating [dbo].[OrderSearchResults].[IX_OrderSearchResults_SearchSetId]...';


GO
CREATE CLUSTERED INDEX [IX_OrderSearchResults_SearchSetId]
    ON [dbo].[OrderSearchResults]([SearchSetId] ASC);


GO
PRINT N'Creating [dbo].[RolePermission]...';


GO
CREATE TABLE [dbo].[RolePermission] (
    [RolePermissionId] INT            IDENTITY (1, 1) NOT NULL,
    [RoleName]         NVARCHAR (256) NOT NULL,
    [Permission]       NVARCHAR (256) NOT NULL,
    CONSTRAINT [PK_RolePermission] PRIMARY KEY CLUSTERED ([RolePermissionId] ASC)
);


GO
PRINT N'Creating [dbo].[OrderGroupAddress]...';


GO
CREATE TABLE [dbo].[OrderGroupAddress] (
    [OrderGroupAddressId] INT           IDENTITY (1, 1) NOT NULL,
    [OrderGroupId]        INT           NOT NULL,
    [Name]                NVARCHAR (64) NULL,
    [FirstName]           NVARCHAR (64) NULL,
    [LastName]            NVARCHAR (64) NULL,
    [Organization]        NVARCHAR (64) NULL,
    [Line1]               NVARCHAR (80) NULL,
    [Line2]               NVARCHAR (80) NULL,
    [City]                NVARCHAR (64) NULL,
    [State]               NVARCHAR (64) NULL,
    [CountryCode]         NVARCHAR (50) NULL,
    [CountryName]         NVARCHAR (50) NULL,
    [PostalCode]          NVARCHAR (20) NULL,
    [RegionCode]          NVARCHAR (50) NULL,
    [RegionName]          NVARCHAR (64) NULL,
    [DaytimePhoneNumber]  NVARCHAR (32) NULL,
    [EveningPhoneNumber]  NVARCHAR (32) NULL,
    [FaxNumber]           NVARCHAR (32) NULL,
    [Email]               NVARCHAR (64) NULL,
    CONSTRAINT [PK_OrderGroupAddress] PRIMARY KEY CLUSTERED ([OrderGroupAddressId] ASC)
);


GO
PRINT N'Creating [dbo].[OrderGroupAddress].[IX_OrderGroupAddress_OrderGroupId]...';


GO
CREATE NONCLUSTERED INDEX [IX_OrderGroupAddress_OrderGroupId]
    ON [dbo].[OrderGroupAddress]([OrderGroupId] ASC);


GO
PRINT N'Creating [dbo].[OrderGroupAddress].[IX_OrderGroupAddress_Email]...';


GO
CREATE NONCLUSTERED INDEX [IX_OrderGroupAddress_Email]
    ON [dbo].[OrderGroupAddress]([Email] ASC);


GO
PRINT N'Creating [dbo].[OrderGroup]...';


GO
CREATE TABLE [dbo].[OrderGroup] (
    [OrderGroupId]         INT              IDENTITY (1, 1) NOT NULL,
    [InstanceId]           UNIQUEIDENTIFIER NOT NULL,
    [AffiliateId]          UNIQUEIDENTIFIER NULL,
    [Name]                 NVARCHAR (64)    NULL,
    [CustomerId]           UNIQUEIDENTIFIER NOT NULL,
    [CustomerName]         NVARCHAR (64)    NULL,
    [AddressId]            NVARCHAR (50)    NULL,
    [ShippingTotal]        DECIMAL (38, 9)  NOT NULL,
    [HandlingTotal]        DECIMAL (38, 9)  NOT NULL,
    [TaxTotal]             DECIMAL (38, 9)  NOT NULL,
    [SubTotal]             DECIMAL (38, 9)  NOT NULL,
    [Total]                DECIMAL (38, 9)  NOT NULL,
    [BillingCurrency]      NVARCHAR (64)    NULL,
    [Status]               NVARCHAR (64)    NULL,
    [ProviderId]           NVARCHAR (255)   NULL,
    [SiteId]               NVARCHAR (255)   NULL,
    [OwnerOrg]             NVARCHAR (255)   NULL,
    [Owner]                NVARCHAR (255)   NULL,
    [MarketId]             NVARCHAR (8)     NOT NULL,
    [Epi_MarketName]       NVARCHAR (50)    NOT NULL,
    [Epi_PricesIncludeTax] BIT              NOT NULL,
    CONSTRAINT [PK_PurchaseOrders] PRIMARY KEY CLUSTERED ([OrderGroupId] ASC)
);


GO
PRINT N'Creating [dbo].[OrderGroup].[IX_OrderGroup]...';


GO
CREATE UNIQUE NONCLUSTERED INDEX [IX_OrderGroup]
    ON [dbo].[OrderGroup]([InstanceId] ASC);


GO
PRINT N'Creating [dbo].[OrderGroup].[IX_OrderGroup_CustomerIdName]...';


GO
CREATE NONCLUSTERED INDEX [IX_OrderGroup_CustomerIdName]
    ON [dbo].[OrderGroup]([CustomerId] ASC, [Name] ASC);


GO
PRINT N'Creating [dbo].[OrderGroup].[IX_OrderGroup_CustomerName]...';


GO
CREATE NONCLUSTERED INDEX [IX_OrderGroup_CustomerName]
    ON [dbo].[OrderGroup]([CustomerName] ASC);


GO
PRINT N'Creating [dbo].[OrderFormPayment]...';


GO
CREATE TABLE [dbo].[OrderFormPayment] (
    [PaymentId]             INT              IDENTITY (1, 1) NOT NULL,
    [OrderFormId]           INT              NOT NULL,
    [OrderGroupId]          INT              NOT NULL,
    [BillingAddressId]      NVARCHAR (64)    NULL,
    [PaymentMethodId]       UNIQUEIDENTIFIER NOT NULL,
    [PaymentMethodName]     NVARCHAR (128)   NULL,
    [CustomerName]          NVARCHAR (64)    NULL,
    [Amount]                DECIMAL (38, 9)  NOT NULL,
    [PaymentType]           INT              NOT NULL,
    [ValidationCode]        NVARCHAR (64)    NULL,
    [AuthorizationCode]     NVARCHAR (255)   NULL,
    [TransactionType]       NVARCHAR (255)   NULL,
    [TransactionID]         NVARCHAR (255)   NULL,
    [Status]                NVARCHAR (64)    NULL,
    [ImplementationClass]   NVARCHAR (255)   NOT NULL,
    [ProviderTransactionID] NVARCHAR (255)   NULL,
    CONSTRAINT [PK_OrderFormPayment] PRIMARY KEY CLUSTERED ([PaymentId] ASC)
);


GO
PRINT N'Creating [dbo].[OrderFormPayment].[IX_OrderFormPayment_OrderFormId]...';


GO
CREATE NONCLUSTERED INDEX [IX_OrderFormPayment_OrderFormId]
    ON [dbo].[OrderFormPayment]([OrderFormId] ASC);


GO
PRINT N'Creating [dbo].[OrderFormPayment].[IX_OrderFormPayment_OrderGroupId]...';


GO
CREATE NONCLUSTERED INDEX [IX_OrderFormPayment_OrderGroupId]
    ON [dbo].[OrderFormPayment]([OrderGroupId] ASC);


GO
PRINT N'Creating [dbo].[aspnet_Membership]...';


GO
CREATE TABLE [dbo].[aspnet_Membership] (
    [ApplicationId]                          UNIQUEIDENTIFIER NOT NULL,
    [UserId]                                 UNIQUEIDENTIFIER NOT NULL,
    [Password]                               NVARCHAR (128)   NOT NULL,
    [PasswordFormat]                         INT              NOT NULL,
    [PasswordSalt]                           NVARCHAR (128)   NOT NULL,
    [MobilePIN]                              NVARCHAR (16)    NULL,
    [Email]                                  NVARCHAR (256)   NULL,
    [LoweredEmail]                           NVARCHAR (256)   NULL,
    [PasswordQuestion]                       NVARCHAR (256)   NULL,
    [PasswordAnswer]                         NVARCHAR (128)   NULL,
    [IsApproved]                             BIT              NOT NULL,
    [IsLockedOut]                            BIT              NOT NULL,
    [CreateDate]                             DATETIME         NOT NULL,
    [LastLoginDate]                          DATETIME         NOT NULL,
    [LastPasswordChangedDate]                DATETIME         NOT NULL,
    [LastLockoutDate]                        DATETIME         NOT NULL,
    [FailedPasswordAttemptCount]             INT              NOT NULL,
    [FailedPasswordAttemptWindowStart]       DATETIME         NOT NULL,
    [FailedPasswordAnswerAttemptCount]       INT              NOT NULL,
    [FailedPasswordAnswerAttemptWindowStart] DATETIME         NOT NULL,
    [Comment]                                NTEXT            NULL,
    PRIMARY KEY NONCLUSTERED ([UserId] ASC)
);


GO
EXECUTE sp_tableoption @TableNamePattern = N'[dbo].[aspnet_Membership]', @OptionName = N'text in row', @OptionValue = N'3000';


GO
PRINT N'Creating [dbo].[aspnet_Membership].[aspnet_Membership_index]...';


GO
CREATE CLUSTERED INDEX [aspnet_Membership_index]
    ON [dbo].[aspnet_Membership]([ApplicationId] ASC, [LoweredEmail] ASC);


GO
PRINT N'Creating [dbo].[OrderFormDiscount]...';


GO
CREATE TABLE [dbo].[OrderFormDiscount] (
    [OrderFormDiscountId] INT             IDENTITY (1, 1) NOT NULL,
    [OrderGroupId]        INT             NOT NULL,
    [OrderFormId]         INT             NOT NULL,
    [DiscountId]          INT             NOT NULL,
    [DiscountAmount]      DECIMAL (38, 9) NOT NULL,
    [DiscountCode]        NVARCHAR (50)   NULL,
    [DiscountName]        NVARCHAR (50)   NULL,
    [DisplayMessage]      NVARCHAR (100)  NULL,
    [DiscountValue]       DECIMAL (38, 9) NOT NULL,
    CONSTRAINT [PK_OrderFormDiscount] PRIMARY KEY CLUSTERED ([OrderFormDiscountId] ASC),
    CONSTRAINT [IX_OrderFormDiscount] UNIQUE NONCLUSTERED ([DiscountId] ASC, [OrderFormId] ASC)
);


GO
PRINT N'Creating [dbo].[OrderFormDiscount].[IX_OrderFormDiscount_OrderGroupId]...';


GO
CREATE NONCLUSTERED INDEX [IX_OrderFormDiscount_OrderGroupId]
    ON [dbo].[OrderFormDiscount]([OrderGroupId] ASC);


GO
PRINT N'Creating [dbo].[OrderForm]...';


GO
CREATE TABLE [dbo].[OrderForm] (
    [OrderFormId]            INT             IDENTITY (1, 1) NOT NULL,
    [OrderGroupId]           INT             NOT NULL,
    [Name]                   NVARCHAR (64)   NULL,
    [BillingAddressId]       NVARCHAR (64)   NULL,
    [DiscountAmount]         DECIMAL (38, 9) NOT NULL,
    [SubTotal]               DECIMAL (38, 9) NOT NULL,
    [ShippingTotal]          DECIMAL (38, 9) NOT NULL,
    [HandlingTotal]          DECIMAL (38, 9) NOT NULL,
    [TaxTotal]               DECIMAL (38, 9) NOT NULL,
    [Total]                  DECIMAL (38, 9) NOT NULL,
    [Status]                 NVARCHAR (64)   NULL,
    [ProviderId]             NVARCHAR (255)  NULL,
    [ReturnComment]          NVARCHAR (1024) NULL,
    [ReturnType]             NVARCHAR (50)   NULL,
    [ReturnAuthCode]         NVARCHAR (255)  NULL,
    [OrigOrderFormId]        INT             NULL,
    [ExchangeOrderGroupId]   INT             NULL,
    [AuthorizedPaymentTotal] DECIMAL (38, 9) NOT NULL,
    [CapturedPaymentTotal]   DECIMAL (38, 9) NOT NULL,
    CONSTRAINT [PK_OrderInfo] PRIMARY KEY CLUSTERED ([OrderFormId] ASC)
);


GO
PRINT N'Creating [dbo].[OrderForm].[IX_OrderForm_OrderGroupId]...';


GO
CREATE NONCLUSTERED INDEX [IX_OrderForm_OrderGroupId]
    ON [dbo].[OrderForm]([OrderGroupId] ASC);


GO
PRINT N'Creating [dbo].[LineItemDiscount]...';


GO
CREATE TABLE [dbo].[LineItemDiscount] (
    [LineItemDiscountId] INT             IDENTITY (1, 1) NOT NULL,
    [OrderGroupId]       INT             NOT NULL,
    [LineItemId]         INT             NOT NULL,
    [DiscountId]         INT             NOT NULL,
    [DiscountAmount]     DECIMAL (38, 9) NOT NULL,
    [DiscountCode]       NVARCHAR (50)   NULL,
    [DiscountName]       NVARCHAR (50)   NULL,
    [DisplayMessage]     NVARCHAR (100)  NULL,
    [DiscountValue]      DECIMAL (38, 9) NOT NULL,
    CONSTRAINT [PK_LineItemDiscount] PRIMARY KEY NONCLUSTERED ([LineItemDiscountId] ASC),
    CONSTRAINT [IX_LineItemDiscount] UNIQUE NONCLUSTERED ([DiscountId] ASC, [LineItemId] ASC)
);


GO
PRINT N'Creating [dbo].[LineItemDiscount].[IX_LineItem_OrderGroupId]...';


GO
CREATE CLUSTERED INDEX [IX_LineItem_OrderGroupId]
    ON [dbo].[LineItemDiscount]([OrderGroupId] ASC);


GO
PRINT N'Creating [dbo].[LineItemDiscount].[IX_LineItemDiscount_LineItem]...';


GO
CREATE NONCLUSTERED INDEX [IX_LineItemDiscount_LineItem]
    ON [dbo].[LineItemDiscount]([LineItemId] ASC);


GO
PRINT N'Creating [dbo].[LineItem]...';


GO
CREATE TABLE [dbo].[LineItem] (
    [LineItemId]                  INT              IDENTITY (1, 1) NOT NULL,
    [OrderFormId]                 INT              NOT NULL,
    [OrderGroupId]                INT              NOT NULL,
    [Catalog]                     NVARCHAR (255)   NOT NULL,
    [CatalogNode]                 NVARCHAR (255)   NOT NULL,
    [ParentCatalogEntryId]        NVARCHAR (255)   NULL,
    [CatalogEntryId]              NVARCHAR (255)   NOT NULL,
    [Quantity]                    DECIMAL (38, 9)  NOT NULL,
    [PlacedPrice]                 DECIMAL (38, 9)  NOT NULL,
    [ListPrice]                   DECIMAL (38, 9)  NOT NULL,
    [LineItemDiscountAmount]      DECIMAL (38, 9)  NOT NULL,
    [OrderLevelDiscountAmount]    DECIMAL (38, 9)  NOT NULL,
    [ShippingAddressId]           NVARCHAR (64)    NOT NULL,
    [ShippingMethodName]          NVARCHAR (128)   NULL,
    [ShippingMethodId]            UNIQUEIDENTIFIER NOT NULL,
    [ExtendedPrice]               DECIMAL (38, 9)  NOT NULL,
    [Description]                 NVARCHAR (255)   NULL,
    [Status]                      NVARCHAR (64)    NULL,
    [DisplayName]                 NVARCHAR (255)   NULL,
    [AllowBackordersAndPreorders] BIT              NOT NULL,
    [InStockQuantity]             DECIMAL (38, 9)  NOT NULL,
    [PreorderQuantity]            DECIMAL (38, 9)  NOT NULL,
    [BackorderQuantity]           DECIMAL (38, 9)  NOT NULL,
    [InventoryStatus]             INT              NOT NULL,
    [LineItemOrdering]            DATETIME         NULL,
    [ConfigurationId]             NVARCHAR (255)   NULL,
    [MinQuantity]                 DECIMAL (38, 9)  NOT NULL,
    [MaxQuantity]                 DECIMAL (38, 9)  NOT NULL,
    [ProviderId]                  NVARCHAR (255)   NULL,
    [ReturnReason]                NVARCHAR (255)   NULL,
    [OrigLineItemId]              INT              NULL,
    [ReturnQuantity]              DECIMAL (38, 9)  NOT NULL,
    [WarehouseCode]               NVARCHAR (50)    NULL,
    [IsInventoryAllocated]        BIT              NOT NULL,
    [Epi_SalesTax]                DECIMAL (38, 9)  NULL,
    [Epi_TaxCategoryId]           INT              NULL,
    CONSTRAINT [PK_OrderItem] PRIMARY KEY CLUSTERED ([LineItemId] ASC)
);


GO
PRINT N'Creating [dbo].[LineItem].[IX_LineItem_OrderFormId]...';


GO
CREATE NONCLUSTERED INDEX [IX_LineItem_OrderFormId]
    ON [dbo].[LineItem]([OrderFormId] ASC);


GO
PRINT N'Creating [dbo].[LineItem].[IX_LineItem_OrderGroupId]...';


GO
CREATE NONCLUSTERED INDEX [IX_LineItem_OrderGroupId]
    ON [dbo].[LineItem]([OrderGroupId] ASC);


GO
PRINT N'Creating [dbo].[aspnet_SchemaVersions]...';


GO
CREATE TABLE [dbo].[aspnet_SchemaVersions] (
    [Feature]                 NVARCHAR (128) NOT NULL,
    [CompatibleSchemaVersion] NVARCHAR (128) NOT NULL,
    [IsCurrentVersion]        BIT            NOT NULL,
    PRIMARY KEY CLUSTERED ([Feature] ASC, [CompatibleSchemaVersion] ASC)
);


GO
PRINT N'Creating [dbo].[Country]...';


GO
CREATE TABLE [dbo].[Country] (
    [CountryId] INT            IDENTITY (1, 1) NOT NULL,
    [Name]      NVARCHAR (100) NULL,
    [Ordering]  INT            NULL,
    [Visible]   BIT            NULL,
    [Code]      NVARCHAR (3)   NULL,
    CONSTRAINT [Country_PK] PRIMARY KEY NONCLUSTERED ([CountryId] ASC)
);


GO
PRINT N'Creating [dbo].[Country].[IX_Country_Code]...';


GO
CREATE CLUSTERED INDEX [IX_Country_Code]
    ON [dbo].[Country]([Code] ASC);


GO
PRINT N'Creating [dbo].[SchemaVersion]...';


GO
CREATE TABLE [dbo].[SchemaVersion] (
    [Major]       INT      NOT NULL,
    [Minor]       INT      NOT NULL,
    [Patch]       INT      NOT NULL,
    [InstallDate] DATETIME NOT NULL
);


GO
PRINT N'Creating [dbo].[SchemaVersion].[IX_SchemaVersion_Major]...';


GO
CREATE CLUSTERED INDEX [IX_SchemaVersion_Major]
    ON [dbo].[SchemaVersion]([Major] ASC);


GO
PRINT N'Creating [dbo].[OrderGroupLock]...';


GO
CREATE TABLE [dbo].[OrderGroupLock] (
    [OrderLockId]  INT              IDENTITY (1, 1) NOT NULL,
    [CustomerId]   UNIQUEIDENTIFIER NOT NULL,
    [Created]      DATETIME         NOT NULL,
    [OrderGroupId] INT              NOT NULL,
    CONSTRAINT [PK_OrderGroupLock] PRIMARY KEY CLUSTERED ([OrderLockId] ASC)
);


GO
PRINT N'Creating [dbo].[CatalogLog]...';


GO
CREATE TABLE [dbo].[CatalogLog] (
    [LogId]      INT            IDENTITY (1, 1) NOT NULL,
    [Operation]  NVARCHAR (50)  NOT NULL,
    [ObjectKey]  NVARCHAR (100) NOT NULL,
    [ObjectType] NVARCHAR (50)  NOT NULL,
    [Username]   NVARCHAR (50)  NOT NULL,
    [Created]    DATETIME       NOT NULL,
    [Succeeded]  BIT            NOT NULL,
    [Notes]      NVARCHAR (255) NULL,
    CONSTRAINT [PK_CatalogLog] PRIMARY KEY CLUSTERED ([LogId] ASC)
);


GO
PRINT N'Creating [dbo].[OrderGroupNote]...';


GO
CREATE TABLE [dbo].[OrderGroupNote] (
    [OrderNoteId]  INT              IDENTITY (1, 1) NOT NULL,
    [OrderGroupId] INT              NOT NULL,
    [CustomerId]   UNIQUEIDENTIFIER NOT NULL,
    [Title]        NVARCHAR (255)   NULL,
    [Type]         NVARCHAR (50)    NULL,
    [Detail]       NTEXT            NULL,
    [Created]      DATETIME         NOT NULL,
    [LineItemId]   INT              NULL,
    [Channel]      NVARCHAR (50)    NULL,
    [EventType]    NVARCHAR (50)    NULL,
    CONSTRAINT [PK_OrderGroupNote] PRIMARY KEY NONCLUSTERED ([OrderNoteId] ASC)
);


GO
PRINT N'Creating [dbo].[OrderGroupNote].[IX_OrderGroupNote_OrderGroupId]...';


GO
CREATE CLUSTERED INDEX [IX_OrderGroupNote_OrderGroupId]
    ON [dbo].[OrderGroupNote]([OrderGroupId] ASC);


GO
PRINT N'Creating [dbo].[aspnet_Users]...';


GO
CREATE TABLE [dbo].[aspnet_Users] (
    [ApplicationId]    UNIQUEIDENTIFIER NOT NULL,
    [UserId]           UNIQUEIDENTIFIER NOT NULL,
    [UserName]         NVARCHAR (256)   NOT NULL,
    [LoweredUserName]  NVARCHAR (256)   NOT NULL,
    [MobileAlias]      NVARCHAR (16)    NULL,
    [IsAnonymous]      BIT              NOT NULL,
    [LastActivityDate] DATETIME         NOT NULL,
    PRIMARY KEY NONCLUSTERED ([UserId] ASC)
);


GO
PRINT N'Creating [dbo].[aspnet_Users].[aspnet_Users_Index]...';


GO
CREATE UNIQUE CLUSTERED INDEX [aspnet_Users_Index]
    ON [dbo].[aspnet_Users]([ApplicationId] ASC, [LoweredUserName] ASC);


GO
PRINT N'Creating [dbo].[aspnet_Users].[aspnet_Users_Index2]...';


GO
CREATE NONCLUSTERED INDEX [aspnet_Users_Index2]
    ON [dbo].[aspnet_Users]([ApplicationId] ASC, [LastActivityDate] ASC);


GO
PRINT N'Creating [dbo].[Warehouse]...';


GO
CREATE TABLE [dbo].[Warehouse] (
    [WarehouseId]         INT            IDENTITY (1, 1) NOT NULL,
    [Name]                NVARCHAR (255) NOT NULL,
    [CreatorId]           NVARCHAR (256) NULL,
    [Created]             DATETIME       NOT NULL,
    [ModifierId]          NVARCHAR (256) NULL,
    [Modified]            DATETIME       NOT NULL,
    [IsActive]            BIT            NOT NULL,
    [IsPrimary]           BIT            NOT NULL,
    [SortOrder]           INT            NOT NULL,
    [Code]                NVARCHAR (50)  NOT NULL,
    [IsFulfillmentCenter] BIT            NOT NULL,
    [IsPickupLocation]    BIT            NOT NULL,
    [IsDeliveryLocation]  BIT            NOT NULL,
    [FirstName]           NVARCHAR (64)  NULL,
    [LastName]            NVARCHAR (64)  NULL,
    [Organization]        NVARCHAR (64)  NULL,
    [Line1]               NVARCHAR (80)  NULL,
    [Line2]               NVARCHAR (80)  NULL,
    [City]                NVARCHAR (64)  NULL,
    [State]               NVARCHAR (64)  NULL,
    [CountryCode]         NVARCHAR (50)  NULL,
    [CountryName]         NVARCHAR (50)  NULL,
    [PostalCode]          NVARCHAR (20)  NULL,
    [RegionCode]          NVARCHAR (50)  NULL,
    [RegionName]          NVARCHAR (64)  NULL,
    [DaytimePhoneNumber]  NVARCHAR (32)  NULL,
    [EveningPhoneNumber]  NVARCHAR (32)  NULL,
    [FaxNumber]           NVARCHAR (32)  NULL,
    [Email]               NVARCHAR (64)  NULL,
    CONSTRAINT [PK_Warehouse] PRIMARY KEY CLUSTERED ([WarehouseId] ASC),
    CONSTRAINT [IX_Warehouse] UNIQUE NONCLUSTERED ([Code] ASC)
);


GO
PRINT N'Creating [dbo].[Variation]...';


GO
CREATE TABLE [dbo].[Variation] (
    [CatalogEntryId] INT              NOT NULL,
    [ListPrice]      DECIMAL (38, 9)  NULL,
    [TaxCategoryId]  INT              NOT NULL,
    [TrackInventory] BIT              NOT NULL,
    [MerchantId]     UNIQUEIDENTIFIER NULL,
    [WarehouseId]    INT              NOT NULL,
    [Weight]         FLOAT (53)       NOT NULL,
    [PackageId]      INT              NOT NULL,
    [MinQuantity]    DECIMAL (38, 9)  NULL,
    [MaxQuantity]    DECIMAL (38, 9)  NULL,
    [Length]         FLOAT (53)       NOT NULL,
    [Height]         FLOAT (53)       NOT NULL,
    [Width]          FLOAT (53)       NOT NULL,
    CONSTRAINT [PK_ProductVariation] PRIMARY KEY CLUSTERED ([CatalogEntryId] ASC)
);


GO
PRINT N'Creating [dbo].[SiteCatalog]...';


GO
CREATE TABLE [dbo].[SiteCatalog] (
    [CatalogId] INT              NOT NULL,
    [SiteId]    UNIQUEIDENTIFIER NOT NULL
);


GO
PRINT N'Creating [dbo].[SiteCatalog].[IX_SiteCatalog_CatalogId]...';


GO
CREATE CLUSTERED INDEX [IX_SiteCatalog_CatalogId]
    ON [dbo].[SiteCatalog]([CatalogId] ASC);


GO
PRINT N'Creating [dbo].[SiteCatalog].[IX_SiteCatalog]...';


GO
CREATE UNIQUE NONCLUSTERED INDEX [IX_SiteCatalog]
    ON [dbo].[SiteCatalog]([CatalogId] ASC, [SiteId] ASC);


GO
PRINT N'Creating [dbo].[SalePrice]...';


GO
CREATE TABLE [dbo].[SalePrice] (
    [SalePriceId] INT             IDENTITY (1, 1) NOT NULL,
    [ItemCode]    NVARCHAR (100)  NULL,
    [SaleType]    INT             NOT NULL,
    [SaleCode]    NVARCHAR (100)  NULL,
    [StartDate]   DATETIME        NOT NULL,
    [Currency]    VARCHAR (128)   NOT NULL,
    [MinQuantity] DECIMAL (38, 9) NOT NULL,
    [UnitPrice]   DECIMAL (38, 9) NOT NULL,
    [EndDate]     DATETIME        NULL,
    CONSTRAINT [PK_SalePrice] PRIMARY KEY CLUSTERED ([SalePriceId] ASC)
);


GO
PRINT N'Creating [dbo].[SalePrice].[IX_SalePrice_ItemCode]...';


GO
CREATE NONCLUSTERED INDEX [IX_SalePrice_ItemCode]
    ON [dbo].[SalePrice]([ItemCode] ASC);


GO
PRINT N'Creating [dbo].[mcweb_FormDocument]...';


GO
CREATE TABLE [dbo].[mcweb_FormDocument] (
    [FormDocumentId]   INT           IDENTITY (1, 1) NOT NULL,
    [MetaClassName]    NVARCHAR (50) NOT NULL,
    [FormDocumentName] NVARCHAR (50) NOT NULL,
    [FormDocumentXml]  NTEXT         NOT NULL,
    [MetaUITypeId]     NVARCHAR (50) NOT NULL,
    CONSTRAINT [PK_mcweb_FormDocuments] PRIMARY KEY CLUSTERED ([FormDocumentId] ASC)
);


GO
PRINT N'Creating [dbo].[aspnet_Applications]...';


GO
CREATE TABLE [dbo].[aspnet_Applications] (
    [ApplicationName]        NVARCHAR (256)   NOT NULL,
    [LoweredApplicationName] NVARCHAR (256)   NOT NULL,
    [ApplicationId]          UNIQUEIDENTIFIER NOT NULL,
    [Description]            NVARCHAR (256)   NULL,
    PRIMARY KEY NONCLUSTERED ([ApplicationId] ASC),
    UNIQUE NONCLUSTERED ([ApplicationName] ASC),
    UNIQUE NONCLUSTERED ([LoweredApplicationName] ASC)
);


GO
PRINT N'Creating [dbo].[aspnet_Applications].[aspnet_Applications_Index]...';


GO
CREATE CLUSTERED INDEX [aspnet_Applications_Index]
    ON [dbo].[aspnet_Applications]([LoweredApplicationName] ASC);


GO
PRINT N'Creating [dbo].[NodeEntryRelation]...';


GO
CREATE TABLE [dbo].[NodeEntryRelation] (
    [CatalogId]      INT      NOT NULL,
    [CatalogEntryId] INT      NOT NULL,
    [CatalogNodeId]  INT      NOT NULL,
    [SortOrder]      INT      NOT NULL,
    [IsPrimary]      BIT      NOT NULL,
    [Modified]       DATETIME NOT NULL,
    CONSTRAINT [PK_NodeEntryRelation] PRIMARY KEY CLUSTERED ([CatalogId] ASC, [CatalogEntryId] ASC, [CatalogNodeId] ASC)
);


GO
PRINT N'Creating [dbo].[NodeEntryRelation].[IX_NodeEntryRelation_Indexed_CatalogEntryId]...';


GO
CREATE NONCLUSTERED INDEX [IX_NodeEntryRelation_Indexed_CatalogEntryId]
    ON [dbo].[NodeEntryRelation]([CatalogEntryId] ASC)
    INCLUDE([CatalogId], [CatalogNodeId], [SortOrder], [IsPrimary]);


GO
PRINT N'Creating [dbo].[NodeEntryRelation].[IX_NodeEntryRelation_PrimaryRelation]...';


GO
CREATE UNIQUE NONCLUSTERED INDEX [IX_NodeEntryRelation_PrimaryRelation]
    ON [dbo].[NodeEntryRelation]([CatalogEntryId] ASC) WHERE [IsPrimary] = 1;


GO
PRINT N'Creating [dbo].[NodeEntryRelation].[IX_NodeEntryRelation_Indexed_CatalogNodeId]...';


GO
CREATE NONCLUSTERED INDEX [IX_NodeEntryRelation_Indexed_CatalogNodeId]
    ON [dbo].[NodeEntryRelation]([CatalogNodeId] ASC, [SortOrder] ASC)
    INCLUDE([IsPrimary]);


GO
PRINT N'Creating unnamed constraint on [dbo].[CatalogContentAccess]...';


GO
ALTER TABLE [dbo].[CatalogContentAccess]
    ADD DEFAULT 1 FOR [IsRole];


GO
PRINT N'Creating unnamed constraint on [dbo].[CatalogItemChange]...';


GO
ALTER TABLE [dbo].[CatalogItemChange]
    ADD DEFAULT (0) FOR [IsBeingIndexed];


GO
PRINT N'Creating [dbo].[DF_SerializableCart_MarketId]...';


GO
ALTER TABLE [dbo].[SerializableCart]
    ADD CONSTRAINT [DF_SerializableCart_MarketId] DEFAULT ('DEFAULT') FOR [MarketId];


GO
PRINT N'Creating unnamed constraint on [dbo].[PromotionInformation]...';


GO
ALTER TABLE [dbo].[PromotionInformation]
    ADD DEFAULT (1) FOR [IsRedeemed];


GO
PRINT N'Creating unnamed constraint on [dbo].[PromotionInformation]...';


GO
ALTER TABLE [dbo].[PromotionInformation]
    ADD DEFAULT (0) FOR [IsReturnOrderForm];


GO
PRINT N'Creating [dbo].[DF_CatalogItemAsset_CatalogNodeId]...';


GO
ALTER TABLE [dbo].[CatalogItemAsset]
    ADD CONSTRAINT [DF_CatalogItemAsset_CatalogNodeId] DEFAULT ((0)) FOR [CatalogNodeId];


GO
PRINT N'Creating [dbo].[DF_CatalogItemAsset_CatalogEntryId]...';


GO
ALTER TABLE [dbo].[CatalogItemAsset]
    ADD CONSTRAINT [DF_CatalogItemAsset_CatalogEntryId] DEFAULT ((0)) FOR [CatalogEntryId];


GO
PRINT N'Creating [dbo].[DF_McBlobStorage_created]...';


GO
ALTER TABLE [dbo].[McBlobStorage]
    ADD CONSTRAINT [DF_McBlobStorage_created] DEFAULT (getutcdate()) FOR [created];


GO
PRINT N'Creating [dbo].[DF_McBlobStorage_isTemporary]...';


GO
ALTER TABLE [dbo].[McBlobStorage]
    ADD CONSTRAINT [DF_McBlobStorage_isTemporary] DEFAULT ((1)) FOR [isTemporary];


GO
PRINT N'Creating [dbo].[DF_mcweb_ListViewProfile_PlaceName]...';


GO
ALTER TABLE [dbo].[mcweb_ListViewProfile]
    ADD CONSTRAINT [DF_mcweb_ListViewProfile_PlaceName] DEFAULT (N'') FOR [PlaceName];


GO
PRINT N'Creating [dbo].[DF_mcweb_ListViewProfile_IsSystem]...';


GO
ALTER TABLE [dbo].[mcweb_ListViewProfile]
    ADD CONSTRAINT [DF_mcweb_ListViewProfile_IsSystem] DEFAULT ((0)) FOR [IsSystem];


GO
PRINT N'Creating unnamed constraint on [dbo].[CatalogNodeSearchResults]...';


GO
ALTER TABLE [dbo].[CatalogNodeSearchResults]
    ADD DEFAULT (getutcdate()) FOR [Created];


GO
PRINT N'Creating unnamed constraint on [dbo].[Market]...';


GO
ALTER TABLE [dbo].[Market]
    ADD DEFAULT 0 FOR [PricesIncludeTax];


GO
PRINT N'Creating unnamed constraint on [dbo].[CatalogNode]...';


GO
ALTER TABLE [dbo].[CatalogNode]
    ADD DEFAULT NEWID() FOR [ContentGuid];


GO
PRINT N'Creating [dbo].[DF_mcmd_MetaFieldType_Owner]...';


GO
ALTER TABLE [dbo].[mcmd_MetaFieldType]
    ADD CONSTRAINT [DF_mcmd_MetaFieldType_Owner] DEFAULT (N'System') FOR [Owner];


GO
PRINT N'Creating [dbo].[DF_mcmd_MetaFieldType_AccessLevel]...';


GO
ALTER TABLE [dbo].[mcmd_MetaFieldType]
    ADD CONSTRAINT [DF_mcmd_MetaFieldType_AccessLevel] DEFAULT ((1)) FOR [AccessLevel];


GO
PRINT N'Creating [dbo].[DF_MetaFileValue_Size]...';


GO
ALTER TABLE [dbo].[MetaFileValue]
    ADD CONSTRAINT [DF_MetaFileValue_Size] DEFAULT ((0)) FOR [Size];


GO
PRINT N'Creating [dbo].[DF_MetaFileValue_CreationTime]...';


GO
ALTER TABLE [dbo].[MetaFileValue]
    ADD CONSTRAINT [DF_MetaFileValue_CreationTime] DEFAULT (getutcdate()) FOR [CreationTime];


GO
PRINT N'Creating [dbo].[DF_MetaFileValue_LastWriteTime]...';


GO
ALTER TABLE [dbo].[MetaFileValue]
    ADD CONSTRAINT [DF_MetaFileValue_LastWriteTime] DEFAULT (getutcdate()) FOR [LastWriteTime];


GO
PRINT N'Creating [dbo].[DF_MetaFileValue_LastReadTime]...';


GO
ALTER TABLE [dbo].[MetaFileValue]
    ADD CONSTRAINT [DF_MetaFileValue_LastReadTime] DEFAULT (getutcdate()) FOR [LastReadTime];


GO
PRINT N'Creating [dbo].[DF_CatalogEntrySearchResults_SingleSort_Created]...';


GO
ALTER TABLE [dbo].[CatalogEntrySearchResults_SingleSort]
    ADD CONSTRAINT [DF_CatalogEntrySearchResults_SingleSort_Created] DEFAULT (getutcdate()) FOR [Created];


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_PersonalizationPerUser]...';


GO
ALTER TABLE [dbo].[aspnet_PersonalizationPerUser]
    ADD DEFAULT (newid()) FOR [Id];


GO
PRINT N'Creating [dbo].[DF_mcmd_MetaView_Card]...';


GO
ALTER TABLE [dbo].[mcmd_MetaView]
    ADD CONSTRAINT [DF_mcmd_MetaView_Card] DEFAULT (N'') FOR [Card];


GO
PRINT N'Creating [dbo].[DF__CatalogEn__Creat__0EF836A4]...';


GO
ALTER TABLE [dbo].[CatalogEntrySearchResults]
    ADD CONSTRAINT [DF__CatalogEn__Creat__0EF836A4] DEFAULT (getutcdate()) FOR [Created];


GO
PRINT N'Creating [dbo].[DF_MetaDictionary_Value]...';


GO
ALTER TABLE [dbo].[MetaDictionary]
    ADD CONSTRAINT [DF_MetaDictionary_Value] DEFAULT (N'') FOR [Value];


GO
PRINT N'Creating [dbo].[DF_mcmd_MetaEnum_OrderId]...';


GO
ALTER TABLE [dbo].[mcmd_MetaEnum]
    ADD CONSTRAINT [DF_mcmd_MetaEnum_OrderId] DEFAULT ((0)) FOR [OrderId];


GO
PRINT N'Creating [dbo].[DF_MetaClassMetaFieldRelation_Weight]...';


GO
ALTER TABLE [dbo].[MetaClassMetaFieldRelation]
    ADD CONSTRAINT [DF_MetaClassMetaFieldRelation_Weight] DEFAULT ((0)) FOR [Weight];


GO
PRINT N'Creating [dbo].[DF_MetaClassMetaFieldRelation_Enabled]...';


GO
ALTER TABLE [dbo].[MetaClassMetaFieldRelation]
    ADD CONSTRAINT [DF_MetaClassMetaFieldRelation_Enabled] DEFAULT ((1)) FOR [Enabled];


GO
PRINT N'Creating unnamed constraint on [dbo].[ecfVersion]...';


GO
ALTER TABLE [dbo].[ecfVersion]
    ADD DEFAULT 0 FOR [IsCommonDraft];


GO
PRINT N'Creating unnamed constraint on [dbo].[CatalogEntry]...';


GO
ALTER TABLE [dbo].[CatalogEntry]
    ADD DEFAULT NEWID() FOR [ContentGuid];


GO
PRINT N'Creating unnamed constraint on [dbo].[CatalogEntry]...';


GO
ALTER TABLE [dbo].[CatalogEntry]
    ADD DEFAULT 0 FOR [IsPublished];


GO
PRINT N'Creating [dbo].[DF_mcmd_TmpMetaFile_Created]...';


GO
ALTER TABLE [dbo].[mcmd_TmpMetaFile]
    ADD CONSTRAINT [DF_mcmd_TmpMetaFile_Created] DEFAULT (getutcdate()) FOR [Created];


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_Paths]...';


GO
ALTER TABLE [dbo].[aspnet_Paths]
    ADD DEFAULT (newid()) FOR [PathId];


GO
PRINT N'Creating unnamed constraint on [dbo].[Catalog]...';


GO
ALTER TABLE [dbo].[Catalog]
    ADD DEFAULT NEWID() FOR [ContentGuid];


GO
PRINT N'Creating [dbo].[DF_PriceDetail_PriceCode]...';


GO
ALTER TABLE [dbo].[PriceDetail]
    ADD CONSTRAINT [DF_PriceDetail_PriceCode] DEFAULT ('') FOR [PriceCode];


GO
PRINT N'Creating [dbo].[DF_MetaField_Namespace]...';


GO
ALTER TABLE [dbo].[MetaField]
    ADD CONSTRAINT [DF_MetaField_Namespace] DEFAULT ('') FOR [Namespace];


GO
PRINT N'Creating [dbo].[DF_MetaField_SystemMetaClassId]...';


GO
ALTER TABLE [dbo].[MetaField]
    ADD CONSTRAINT [DF_MetaField_SystemMetaClassId] DEFAULT ((0)) FOR [SystemMetaClassId];


GO
PRINT N'Creating [dbo].[DF_MetaField_Length]...';


GO
ALTER TABLE [dbo].[MetaField]
    ADD CONSTRAINT [DF_MetaField_Length] DEFAULT ((0)) FOR [Length];


GO
PRINT N'Creating [dbo].[DF_MetaField_AllowNulls]...';


GO
ALTER TABLE [dbo].[MetaField]
    ADD CONSTRAINT [DF_MetaField_AllowNulls] DEFAULT ((1)) FOR [AllowNulls];


GO
PRINT N'Creating [dbo].[DF_MetaField_MultiLanguageValue]...';


GO
ALTER TABLE [dbo].[MetaField]
    ADD CONSTRAINT [DF_MetaField_MultiLanguageValue] DEFAULT ((0)) FOR [MultiLanguageValue];


GO
PRINT N'Creating [dbo].[DF_MetaField_Encrypt]...';


GO
ALTER TABLE [dbo].[MetaField]
    ADD CONSTRAINT [DF_MetaField_Encrypt] DEFAULT ((0)) FOR [IsEncrypted];


GO
PRINT N'Creating unnamed constraint on [dbo].[MetaField]...';


GO
ALTER TABLE [dbo].[MetaField]
    ADD DEFAULT ((0)) FOR [IsKeyField];


GO
PRINT N'Creating [dbo].[DF_mcmd_MetaIdentifier_PeriodKey]...';


GO
ALTER TABLE [dbo].[mcmd_MetaIdentifier]
    ADD CONSTRAINT [DF_mcmd_MetaIdentifier_PeriodKey] DEFAULT ('') FOR [PeriodKey];


GO
PRINT N'Creating [dbo].[DF_mcmd_MetaFileContentType_FriendlyName]...';


GO
ALTER TABLE [dbo].[mcmd_MetaFileContentType]
    ADD CONSTRAINT [DF_mcmd_MetaFileContentType_FriendlyName] DEFAULT ('') FOR [FriendlyName];


GO
PRINT N'Creating [dbo].[DF_PriceGroup_PriceCode]...';


GO
ALTER TABLE [dbo].[PriceGroup]
    ADD CONSTRAINT [DF_PriceGroup_PriceCode] DEFAULT ('') FOR [PriceCode];


GO
PRINT N'Creating [dbo].[DF_MetaClass_Namespace]...';


GO
ALTER TABLE [dbo].[MetaClass]
    ADD CONSTRAINT [DF_MetaClass_Namespace] DEFAULT (N'') FOR [Namespace];


GO
PRINT N'Creating [dbo].[DF_MetaClass_FriendlyName]...';


GO
ALTER TABLE [dbo].[MetaClass]
    ADD CONSTRAINT [DF_MetaClass_FriendlyName] DEFAULT (N'') FOR [FriendlyName];


GO
PRINT N'Creating [dbo].[DF_MetaClass_IsSystem]...';


GO
ALTER TABLE [dbo].[MetaClass]
    ADD CONSTRAINT [DF_MetaClass_IsSystem] DEFAULT ((0)) FOR [IsSystem];


GO
PRINT N'Creating [dbo].[DF_MetaClass_IsAbstract]...';


GO
ALTER TABLE [dbo].[MetaClass]
    ADD CONSTRAINT [DF_MetaClass_IsAbstract] DEFAULT ((0)) FOR [IsAbstract];


GO
PRINT N'Creating [dbo].[DF_MetaClass_ParentClassId]...';


GO
ALTER TABLE [dbo].[MetaClass]
    ADD CONSTRAINT [DF_MetaClass_ParentClassId] DEFAULT ((0)) FOR [ParentClassId];


GO
PRINT N'Creating [dbo].[DF_MetaClass_PrimaryKeyName]...';


GO
ALTER TABLE [dbo].[MetaClass]
    ADD CONSTRAINT [DF_MetaClass_PrimaryKeyName] DEFAULT (N'') FOR [PrimaryKeyName];


GO
PRINT N'Creating [dbo].[DF_ShippingPaymentRestriction_RestrictShippingMethods]...';


GO
ALTER TABLE [dbo].[ShippingPaymentRestriction]
    ADD CONSTRAINT [DF_ShippingPaymentRestriction_RestrictShippingMethods] DEFAULT ((0)) FOR [RestrictShippingMethods];


GO
PRINT N'Creating [dbo].[DF_MetaDataType_Length]...';


GO
ALTER TABLE [dbo].[MetaDataType]
    ADD CONSTRAINT [DF_MetaDataType_Length] DEFAULT ((0)) FOR [Length];


GO
PRINT N'Creating [dbo].[DF_MetaDataType_AllowNulls]...';


GO
ALTER TABLE [dbo].[MetaDataType]
    ADD CONSTRAINT [DF_MetaDataType_AllowNulls] DEFAULT ((1)) FOR [AllowNulls];


GO
PRINT N'Creating [dbo].[DF_MetaDataType_Variable]...';


GO
ALTER TABLE [dbo].[MetaDataType]
    ADD CONSTRAINT [DF_MetaDataType_Variable] DEFAULT ((0)) FOR [Variable];


GO
PRINT N'Creating [dbo].[DF_MetaDataType_IsSQLCommonType]...';


GO
ALTER TABLE [dbo].[MetaDataType]
    ADD CONSTRAINT [DF_MetaDataType_IsSQLCommonType] DEFAULT ((1)) FOR [IsSQLCommonType];


GO
PRINT N'Creating [dbo].[DF_MetaDataType_DefaultValue]...';


GO
ALTER TABLE [dbo].[MetaDataType]
    ADD CONSTRAINT [DF_MetaDataType_DefaultValue] DEFAULT (N'') FOR [DefaultValue];


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_Roles]...';


GO
ALTER TABLE [dbo].[aspnet_Roles]
    ADD DEFAULT (newid()) FOR [RoleId];


GO
PRINT N'Creating [dbo].[DF_Security_RoleAssignment_SecurityRoleAssignmentId]...';


GO
ALTER TABLE [dbo].[Security_RoleAssignment]
    ADD CONSTRAINT [DF_Security_RoleAssignment_SecurityRoleAssignmentId] DEFAULT (newid()) FOR [SecurityRoleAssignmentId];


GO
PRINT N'Creating [dbo].[DF_Security_RoleAssignment_IsOnlyForOwner]...';


GO
ALTER TABLE [dbo].[Security_RoleAssignment]
    ADD CONSTRAINT [DF_Security_RoleAssignment_IsOnlyForOwner] DEFAULT ((0)) FOR [IsOnlyForOwner];


GO
PRINT N'Creating unnamed constraint on [dbo].[OrderSearchResults]...';


GO
ALTER TABLE [dbo].[OrderSearchResults]
    ADD DEFAULT (getutcdate()) FOR [Created];


GO
PRINT N'Creating [dbo].[DF_OrderGroup_MarketId]...';


GO
ALTER TABLE [dbo].[OrderGroup]
    ADD CONSTRAINT [DF_OrderGroup_MarketId] DEFAULT ('DEFAULT') FOR [MarketId];


GO
PRINT N'Creating unnamed constraint on [dbo].[OrderGroup]...';


GO
ALTER TABLE [dbo].[OrderGroup]
    ADD DEFAULT ('Default Market') FOR [Epi_MarketName];


GO
PRINT N'Creating unnamed constraint on [dbo].[OrderGroup]...';


GO
ALTER TABLE [dbo].[OrderGroup]
    ADD DEFAULT 0 FOR [Epi_PricesIncludeTax];


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_Membership]...';


GO
ALTER TABLE [dbo].[aspnet_Membership]
    ADD DEFAULT ((0)) FOR [PasswordFormat];


GO
PRINT N'Creating unnamed constraint on [dbo].[LineItem]...';


GO
ALTER TABLE [dbo].[LineItem]
    ADD DEFAULT ((0)) FOR [ReturnQuantity];


GO
PRINT N'Creating [dbo].[DF_LineItem_IsInventoryAllocated]...';


GO
ALTER TABLE [dbo].[LineItem]
    ADD CONSTRAINT [DF_LineItem_IsInventoryAllocated] DEFAULT ((0)) FOR [IsInventoryAllocated];


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_Users]...';


GO
ALTER TABLE [dbo].[aspnet_Users]
    ADD DEFAULT (newid()) FOR [UserId];


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_Users]...';


GO
ALTER TABLE [dbo].[aspnet_Users]
    ADD DEFAULT (NULL) FOR [MobileAlias];


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_Users]...';


GO
ALTER TABLE [dbo].[aspnet_Users]
    ADD DEFAULT ((0)) FOR [IsAnonymous];


GO
PRINT N'Creating [dbo].[DF_Warehouse_Created]...';


GO
ALTER TABLE [dbo].[Warehouse]
    ADD CONSTRAINT [DF_Warehouse_Created] DEFAULT (getutcdate()) FOR [Created];


GO
PRINT N'Creating [dbo].[DF_Warehouse_Modified]...';


GO
ALTER TABLE [dbo].[Warehouse]
    ADD CONSTRAINT [DF_Warehouse_Modified] DEFAULT (getutcdate()) FOR [Modified];


GO
PRINT N'Creating unnamed constraint on [dbo].[Variation]...';


GO
ALTER TABLE [dbo].[Variation]
    ADD DEFAULT (0) FOR [Length];


GO
PRINT N'Creating unnamed constraint on [dbo].[Variation]...';


GO
ALTER TABLE [dbo].[Variation]
    ADD DEFAULT (0) FOR [Height];


GO
PRINT N'Creating unnamed constraint on [dbo].[Variation]...';


GO
ALTER TABLE [dbo].[Variation]
    ADD DEFAULT (0) FOR [Width];


GO
PRINT N'Creating [dbo].[DF_mcweb_FormDocument_MetaUITypeId]...';


GO
ALTER TABLE [dbo].[mcweb_FormDocument]
    ADD CONSTRAINT [DF_mcweb_FormDocument_MetaUITypeId] DEFAULT (N'') FOR [MetaUITypeId];


GO
PRINT N'Creating unnamed constraint on [dbo].[aspnet_Applications]...';


GO
ALTER TABLE [dbo].[aspnet_Applications]
    ADD DEFAULT (newid()) FOR [ApplicationId];


GO
PRINT N'Creating unnamed constraint on [dbo].[NodeEntryRelation]...';


GO
ALTER TABLE [dbo].[NodeEntryRelation]
    ADD DEFAULT (getutcdate()) FOR [Modified];


GO
PRINT N'Creating [dbo].[FK_PromotionInformationShipment_PromotionInformationId]...';


GO
ALTER TABLE [dbo].[PromotionInformationShipment]
    ADD CONSTRAINT [FK_PromotionInformationShipment_PromotionInformationId] FOREIGN KEY ([PromotionInformationId]) REFERENCES [dbo].[PromotionInformation] ([PromotionInformationId]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_Catalog_ecfVersion]...';


GO
ALTER TABLE [dbo].[ecfVersionCatalog]
    ADD CONSTRAINT [FK_Catalog_ecfVersion] FOREIGN KEY ([WorkId]) REFERENCES [dbo].[ecfVersion] ([WorkId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_Variation_ecfVersion]...';


GO
ALTER TABLE [dbo].[ecfVersionVariation]
    ADD CONSTRAINT [FK_Variation_ecfVersion] FOREIGN KEY ([WorkId]) REFERENCES [dbo].[ecfVersion] ([WorkId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_ecfVersionAsset_ecfVersion]...';


GO
ALTER TABLE [dbo].[ecfVersionAsset]
    ADD CONSTRAINT [FK_ecfVersionAsset_ecfVersion] FOREIGN KEY ([WorkId]) REFERENCES [dbo].[ecfVersion] ([WorkId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_CatalogContentProperty_MetaField]...';


GO
ALTER TABLE [dbo].[CatalogContentProperty]
    ADD CONSTRAINT [FK_CatalogContentProperty_MetaField] FOREIGN KEY ([MetaFieldId]) REFERENCES [dbo].[MetaField] ([MetaFieldId]);


GO
PRINT N'Creating [dbo].[FK_CatalogContentProperty_MetaClass]...';


GO
ALTER TABLE [dbo].[CatalogContentProperty]
    ADD CONSTRAINT [FK_CatalogContentProperty_MetaClass] FOREIGN KEY ([MetaClassId]) REFERENCES [dbo].[MetaClass] ([MetaClassId]);


GO
PRINT N'Creating [dbo].[FK_ecfVersionProperty_ecfVersion]...';


GO
ALTER TABLE [dbo].[ecfVersionProperty]
    ADD CONSTRAINT [FK_ecfVersionProperty_ecfVersion] FOREIGN KEY ([WorkId]) REFERENCES [dbo].[ecfVersion] ([WorkId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_ecfVersionProperty_MetaField]...';


GO
ALTER TABLE [dbo].[ecfVersionProperty]
    ADD CONSTRAINT [FK_ecfVersionProperty_MetaField] FOREIGN KEY ([MetaFieldId]) REFERENCES [dbo].[MetaField] ([MetaFieldId]);


GO
PRINT N'Creating [dbo].[FK_ecfVersionProperty_MetaClass]...';


GO
ALTER TABLE [dbo].[ecfVersionProperty]
    ADD CONSTRAINT [FK_ecfVersionProperty_MetaClass] FOREIGN KEY ([MetaClassId]) REFERENCES [dbo].[MetaClass] ([MetaClassId]);


GO
PRINT N'Creating [dbo].[FK_PromotionInformation_OrderFormId]...';


GO
ALTER TABLE [dbo].[PromotionInformation]
    ADD CONSTRAINT [FK_PromotionInformation_OrderFormId] FOREIGN KEY ([OrderFormId]) REFERENCES [dbo].[OrderForm] ([OrderFormId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_MarketShippingMethods_Market]...';


GO
ALTER TABLE [dbo].[MarketShippingMethods]
    ADD CONSTRAINT [FK_MarketShippingMethods_Market] FOREIGN KEY ([MarketId]) REFERENCES [dbo].[Market] ([MarketId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_MarketShippingMethods_ShippingMethod]...';


GO
ALTER TABLE [dbo].[MarketShippingMethods]
    ADD CONSTRAINT [FK_MarketShippingMethods_ShippingMethod] FOREIGN KEY ([ShippingMethodId]) REFERENCES [dbo].[ShippingMethod] ([ShippingMethodId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_ManagedInventory_CatalogEntry]...';


GO
ALTER TABLE [dbo].[InventoryService]
    ADD CONSTRAINT [FK_ManagedInventory_CatalogEntry] FOREIGN KEY ([CatalogEntryCode]) REFERENCES [dbo].[CatalogEntry] ([Code]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_ManagedInventory_Warehouse]...';


GO
ALTER TABLE [dbo].[InventoryService]
    ADD CONSTRAINT [FK_ManagedInventory_Warehouse] FOREIGN KEY ([WarehouseCode]) REFERENCES [dbo].[Warehouse] ([Code]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_PromotionInformationEntry_PromotionInformationId]...';


GO
ALTER TABLE [dbo].[PromotionInformationEntry]
    ADD CONSTRAINT [FK_PromotionInformationEntry_PromotionInformationId] FOREIGN KEY ([PromotionInformationId]) REFERENCES [dbo].[PromotionInformation] ([PromotionInformationId]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_MarketCountries_Market]...';


GO
ALTER TABLE [dbo].[MarketCountries]
    ADD CONSTRAINT [FK_MarketCountries_Market] FOREIGN KEY ([MarketId]) REFERENCES [dbo].[Market] ([MarketId]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_MarketLanguages_Market]...';


GO
ALTER TABLE [dbo].[MarketLanguages]
    ADD CONSTRAINT [FK_MarketLanguages_Market] FOREIGN KEY ([MarketId]) REFERENCES [dbo].[Market] ([MarketId]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_CurrencyRate_Currency]...';


GO
ALTER TABLE [dbo].[CurrencyRate]
    ADD CONSTRAINT [FK_CurrencyRate_Currency] FOREIGN KEY ([FromCurrencyId]) REFERENCES [dbo].[Currency] ([CompatCurrencyId]);


GO
PRINT N'Creating [dbo].[FK_CurrencyRate_Currency1]...';


GO
ALTER TABLE [dbo].[CurrencyRate]
    ADD CONSTRAINT [FK_CurrencyRate_Currency1] FOREIGN KEY ([ToCurrencyId]) REFERENCES [dbo].[Currency] ([CompatCurrencyId]);


GO
PRINT N'Creating [dbo].[FK_MarketCurrencies_Market]...';


GO
ALTER TABLE [dbo].[MarketCurrencies]
    ADD CONSTRAINT [FK_MarketCurrencies_Market] FOREIGN KEY ([MarketId]) REFERENCES [dbo].[Market] ([MarketId]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_CatalogSecurity_Catalog]...';


GO
ALTER TABLE [dbo].[CatalogSecurity]
    ADD CONSTRAINT [FK_CatalogSecurity_Catalog] FOREIGN KEY ([CatalogId]) REFERENCES [dbo].[Catalog] ([CatalogId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_CatalogNodeSearchResults_CatalogNode]...';


GO
ALTER TABLE [dbo].[CatalogNodeSearchResults]
    ADD CONSTRAINT [FK_CatalogNodeSearchResults_CatalogNode] FOREIGN KEY ([CatalogNodeId]) REFERENCES [dbo].[CatalogNode] ([CatalogNodeId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_Market_Currency]...';


GO
ALTER TABLE [dbo].[Market]
    ADD CONSTRAINT [FK_Market_Currency] FOREIGN KEY ([DefaultCurrencyCode]) REFERENCES [dbo].[Currency] ([CurrencyCode]);


GO
PRINT N'Creating [dbo].[FK_mcmd_SelectedEnumValue_mcmd_MetaEnum]...';


GO
ALTER TABLE [dbo].[mcmd_SelectedEnumValue]
    ADD CONSTRAINT [FK_mcmd_SelectedEnumValue_mcmd_MetaEnum] FOREIGN KEY ([Id], [TypeName]) REFERENCES [dbo].[mcmd_MetaEnum] ([Id], [TypeName]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_CatalogItemCategory_Catalog]...';


GO
ALTER TABLE [dbo].[CatalogNodeRelation]
    ADD CONSTRAINT [FK_CatalogItemCategory_Catalog] FOREIGN KEY ([CatalogId]) REFERENCES [dbo].[Catalog] ([CatalogId]);


GO
PRINT N'Creating [dbo].[FK_CatalogItemCategory_CatalogItem]...';


GO
ALTER TABLE [dbo].[CatalogNodeRelation]
    ADD CONSTRAINT [FK_CatalogItemCategory_CatalogItem] FOREIGN KEY ([ChildNodeId]) REFERENCES [dbo].[CatalogNode] ([CatalogNodeId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_mcmd_MetaField_mcmd_MetaClass]...';


GO
ALTER TABLE [dbo].[mcmd_MetaField]
    ADD CONSTRAINT [FK_mcmd_MetaField_mcmd_MetaClass] FOREIGN KEY ([MetaClassId]) REFERENCES [dbo].[mcmd_MetaClass] ([MetaClassId]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_CatalogItem_Catalog]...';


GO
ALTER TABLE [dbo].[CatalogNode]
    ADD CONSTRAINT [FK_CatalogItem_Catalog] FOREIGN KEY ([CatalogId]) REFERENCES [dbo].[Catalog] ([CatalogId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_mcmd_MetaFieldMap_mcmd_MetaClass]...';


GO
ALTER TABLE [dbo].[mcmd_MetaFieldMap]
    ADD CONSTRAINT [FK_mcmd_MetaFieldMap_mcmd_MetaClass] FOREIGN KEY ([SrcMetaClassId]) REFERENCES [dbo].[mcmd_MetaClass] ([MetaClassId]);


GO
PRINT N'Creating [dbo].[FK_mcmd_MetaFieldMap_mcmd_MetaClass1]...';


GO
ALTER TABLE [dbo].[mcmd_MetaFieldMap]
    ADD CONSTRAINT [FK_mcmd_MetaFieldMap_mcmd_MetaClass1] FOREIGN KEY ([DestMetaClassId]) REFERENCES [dbo].[mcmd_MetaClass] ([MetaClassId]);


GO
PRINT N'Creating [dbo].[FK_mcmd_MetaClassDataSource_mcmd_MetaClass]...';


GO
ALTER TABLE [dbo].[mcmd_MetaClassDataSource]
    ADD CONSTRAINT [FK_mcmd_MetaClassDataSource_mcmd_MetaClass] FOREIGN KEY ([MetaClassId]) REFERENCES [dbo].[mcmd_MetaClass] ([MetaClassId]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_CatalogLanguage_Catalog]...';


GO
ALTER TABLE [dbo].[CatalogLanguage]
    ADD CONSTRAINT [FK_CatalogLanguage_Catalog] FOREIGN KEY ([CatalogId]) REFERENCES [dbo].[Catalog] ([CatalogId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_MetaMultiValueDictionary_MetaKey]...';


GO
ALTER TABLE [dbo].[MetaMultiValueDictionary]
    ADD CONSTRAINT [FK_MetaMultiValueDictionary_MetaKey] FOREIGN KEY ([MetaKey]) REFERENCES [dbo].[MetaKey] ([MetaKey]);


GO
PRINT N'Creating [dbo].[FK_MetaFileValue_MetaKey]...';


GO
ALTER TABLE [dbo].[MetaFileValue]
    ADD CONSTRAINT [FK_MetaFileValue_MetaKey] FOREIGN KEY ([MetaKey]) REFERENCES [dbo].[MetaKey] ([MetaKey]);


GO
PRINT N'Creating [dbo].[FK_PersPerUser_Paths]...';


GO
ALTER TABLE [dbo].[aspnet_PersonalizationPerUser]
    ADD CONSTRAINT [FK_PersPerUser_Paths] FOREIGN KEY ([PathId]) REFERENCES [dbo].[aspnet_Paths] ([PathId]);


GO
PRINT N'Creating [dbo].[FK_PersPerUser_Users]...';


GO
ALTER TABLE [dbo].[aspnet_PersonalizationPerUser]
    ADD CONSTRAINT [FK_PersPerUser_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_CatalogEntrySearchResults_CatalogEntry]...';


GO
ALTER TABLE [dbo].[CatalogEntrySearchResults]
    ADD CONSTRAINT [FK_CatalogEntrySearchResults_CatalogEntry] FOREIGN KEY ([CatalogEntryId]) REFERENCES [dbo].[CatalogEntry] ([CatalogEntryId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_MetaDictionaryLocalization_MetaDictionary]...';


GO
ALTER TABLE [dbo].[MetaDictionaryLocalization]
    ADD CONSTRAINT [FK_MetaDictionaryLocalization_MetaDictionary] FOREIGN KEY ([MetaDictionaryId]) REFERENCES [dbo].[MetaDictionary] ([MetaDictionaryId]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_JurisdictionRelation_Jurisdiction]...';


GO
ALTER TABLE [dbo].[JurisdictionRelation]
    ADD CONSTRAINT [FK_JurisdictionRelation_Jurisdiction] FOREIGN KEY ([JurisdictionId]) REFERENCES [dbo].[Jurisdiction] ([JurisdictionId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_JurisdictionRelation_JurisdictionGroup]...';


GO
ALTER TABLE [dbo].[JurisdictionRelation]
    ADD CONSTRAINT [FK_JurisdictionRelation_JurisdictionGroup] FOREIGN KEY ([JurisdictionGroupId]) REFERENCES [dbo].[JurisdictionGroup] ([JurisdictionGroupId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_CatalogEntryRelation_CatalogEntry]...';


GO
ALTER TABLE [dbo].[CatalogEntryRelation]
    ADD CONSTRAINT [FK_CatalogEntryRelation_CatalogEntry] FOREIGN KEY ([ChildEntryId]) REFERENCES [dbo].[CatalogEntry] ([CatalogEntryId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_CatalogEntryRelation_CatalogEntry1]...';


GO
ALTER TABLE [dbo].[CatalogEntryRelation]
    ADD CONSTRAINT [FK_CatalogEntryRelation_CatalogEntry1] FOREIGN KEY ([ParentEntryId]) REFERENCES [dbo].[CatalogEntry] ([CatalogEntryId]);


GO
PRINT N'Creating [dbo].[FK_MetaDictionary_MetaField]...';


GO
ALTER TABLE [dbo].[MetaDictionary]
    ADD CONSTRAINT [FK_MetaDictionary_MetaField] FOREIGN KEY ([MetaFieldId]) REFERENCES [dbo].[MetaField] ([MetaFieldId]);


GO
PRINT N'Creating [dbo].[FK_PersAllUser_Paths]...';


GO
ALTER TABLE [dbo].[aspnet_PersonalizationAllUsers]
    ADD CONSTRAINT [FK_PersAllUser_Paths] FOREIGN KEY ([PathId]) REFERENCES [dbo].[aspnet_Paths] ([PathId]);


GO
PRINT N'Creating [dbo].[FK_CatalogEntryAssociation_AssociationType]...';


GO
ALTER TABLE [dbo].[CatalogEntryAssociation]
    ADD CONSTRAINT [FK_CatalogEntryAssociation_AssociationType] FOREIGN KEY ([AssociationTypeId]) REFERENCES [dbo].[AssociationType] ([AssociationTypeId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_CatalogEntryAssociation_CatalogAssociation]...';


GO
ALTER TABLE [dbo].[CatalogEntryAssociation]
    ADD CONSTRAINT [FK_CatalogEntryAssociation_CatalogAssociation] FOREIGN KEY ([CatalogAssociationId]) REFERENCES [dbo].[CatalogAssociation] ([CatalogAssociationId]);


GO
PRINT N'Creating [dbo].[FK_CatalogEntryAssociation_CatalogEntry]...';


GO
ALTER TABLE [dbo].[CatalogEntryAssociation]
    ADD CONSTRAINT [FK_CatalogEntryAssociation_CatalogEntry] FOREIGN KEY ([CatalogEntryId]) REFERENCES [dbo].[CatalogEntry] ([CatalogEntryId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_MetaClassMetaFieldRelation_MetaClass]...';


GO
ALTER TABLE [dbo].[MetaClassMetaFieldRelation]
    ADD CONSTRAINT [FK_MetaClassMetaFieldRelation_MetaClass] FOREIGN KEY ([MetaClassId]) REFERENCES [dbo].[MetaClass] ([MetaClassId]);


GO
PRINT N'Creating [dbo].[FK_MetaClassMetaFieldRelation_MetaField]...';


GO
ALTER TABLE [dbo].[MetaClassMetaFieldRelation]
    ADD CONSTRAINT [FK_MetaClassMetaFieldRelation_MetaField] FOREIGN KEY ([MetaFieldId]) REFERENCES [dbo].[MetaField] ([MetaFieldId]);


GO
PRINT N'Creating [dbo].[FK_CatalogEntity_Catalog]...';


GO
ALTER TABLE [dbo].[CatalogEntry]
    ADD CONSTRAINT [FK_CatalogEntity_Catalog] FOREIGN KEY ([CatalogId]) REFERENCES [dbo].[Catalog] ([CatalogId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_CatalogAssociation_CatalogEntry]...';


GO
ALTER TABLE [dbo].[CatalogAssociation]
    ADD CONSTRAINT [FK_CatalogAssociation_CatalogEntry] FOREIGN KEY ([CatalogEntryId]) REFERENCES [dbo].[CatalogEntry] ([CatalogEntryId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_Paths_Application]...';


GO
ALTER TABLE [dbo].[aspnet_Paths]
    ADD CONSTRAINT [FK_Paths_Application] FOREIGN KEY ([ApplicationId]) REFERENCES [dbo].[aspnet_Applications] ([ApplicationId]);


GO
PRINT N'Creating [dbo].[FK_TaxLanguage_Tax]...';


GO
ALTER TABLE [dbo].[TaxLanguage]
    ADD CONSTRAINT [FK_TaxLanguage_Tax] FOREIGN KEY ([TaxId]) REFERENCES [dbo].[Tax] ([TaxId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_PriceDetail_CatalogEntry]...';


GO
ALTER TABLE [dbo].[PriceDetail]
    ADD CONSTRAINT [FK_PriceDetail_CatalogEntry] FOREIGN KEY ([CatalogEntryCode]) REFERENCES [dbo].[CatalogEntry] ([Code]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_PriceDetail_Currency]...';


GO
ALTER TABLE [dbo].[PriceDetail]
    ADD CONSTRAINT [FK_PriceDetail_Currency] FOREIGN KEY ([CurrencyCode]) REFERENCES [dbo].[Currency] ([CurrencyCode]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_PriceDetail_Market]...';


GO
ALTER TABLE [dbo].[PriceDetail]
    ADD CONSTRAINT [FK_PriceDetail_Market] FOREIGN KEY ([MarketId]) REFERENCES [dbo].[Market] ([MarketId]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_PriceDetail_PriceType]...';


GO
ALTER TABLE [dbo].[PriceDetail]
    ADD CONSTRAINT [FK_PriceDetail_PriceType] FOREIGN KEY ([PriceTypeId]) REFERENCES [dbo].[PriceType] ([PriceTypeId]);


GO
PRINT N'Creating [dbo].[FK_MetaField_MetaDataType]...';


GO
ALTER TABLE [dbo].[MetaField]
    ADD CONSTRAINT [FK_MetaField_MetaDataType] FOREIGN KEY ([DataTypeId]) REFERENCES [dbo].[MetaDataType] ([DataTypeId]);


GO
PRINT N'Creating [dbo].[FK_PriceValue_PriceGroup]...';


GO
ALTER TABLE [dbo].[PriceValue]
    ADD CONSTRAINT [FK_PriceValue_PriceGroup] FOREIGN KEY ([PriceGroupId]) REFERENCES [dbo].[PriceGroup] ([PriceGroupId]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_TaxValue_JurisdictionGroup]...';


GO
ALTER TABLE [dbo].[TaxValue]
    ADD CONSTRAINT [FK_TaxValue_JurisdictionGroup] FOREIGN KEY ([JurisdictionGroupId]) REFERENCES [dbo].[JurisdictionGroup] ([JurisdictionGroupId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[Tax_TaxValue_FK1]...';


GO
ALTER TABLE [dbo].[TaxValue]
    ADD CONSTRAINT [Tax_TaxValue_FK1] FOREIGN KEY ([TaxId]) REFERENCES [dbo].[Tax] ([TaxId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_StateProvince_Country]...';


GO
ALTER TABLE [dbo].[StateProvince]
    ADD CONSTRAINT [FK_StateProvince_Country] FOREIGN KEY ([CountryId]) REFERENCES [dbo].[Country] ([CountryId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_ShippingRegion_ShippingMethod]...';


GO
ALTER TABLE [dbo].[ShippingRegion]
    ADD CONSTRAINT [FK_ShippingRegion_ShippingMethod] FOREIGN KEY ([ShippingMethodId]) REFERENCES [dbo].[ShippingMethod] ([ShippingMethodId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[StateProvince_ShippingRegion_FK1]...';


GO
ALTER TABLE [dbo].[ShippingRegion]
    ADD CONSTRAINT [StateProvince_ShippingRegion_FK1] FOREIGN KEY ([StateProvinceId]) REFERENCES [dbo].[StateProvince] ([StateProvinceId]);


GO
PRINT N'Creating [dbo].[FK_PriceGroup_CatalogEntry]...';


GO
ALTER TABLE [dbo].[PriceGroup]
    ADD CONSTRAINT [FK_PriceGroup_CatalogEntry] FOREIGN KEY ([CatalogEntryCode]) REFERENCES [dbo].[CatalogEntry] ([Code]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_PriceGroup_Currency]...';


GO
ALTER TABLE [dbo].[PriceGroup]
    ADD CONSTRAINT [FK_PriceGroup_Currency] FOREIGN KEY ([CurrencyCode]) REFERENCES [dbo].[Currency] ([CurrencyCode]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_PriceGroup_Market]...';


GO
ALTER TABLE [dbo].[PriceGroup]
    ADD CONSTRAINT [FK_PriceGroup_Market] FOREIGN KEY ([MarketId]) REFERENCES [dbo].[Market] ([MarketId]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_PriceGroup_PriceType]...';


GO
ALTER TABLE [dbo].[PriceGroup]
    ADD CONSTRAINT [FK_PriceGroup_PriceType] FOREIGN KEY ([PriceTypeId]) REFERENCES [dbo].[PriceType] ([PriceTypeId]);


GO
PRINT N'Creating [dbo].[FK_ShippingPaymentRestriction_PaymentMethod]...';


GO
ALTER TABLE [dbo].[ShippingPaymentRestriction]
    ADD CONSTRAINT [FK_ShippingPaymentRestriction_PaymentMethod] FOREIGN KEY ([PaymentMethodId]) REFERENCES [dbo].[PaymentMethod] ([PaymentMethodId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_ShippingPaymentRestriction_ShippingMethod]...';


GO
ALTER TABLE [dbo].[ShippingPaymentRestriction]
    ADD CONSTRAINT [FK_ShippingPaymentRestriction_ShippingMethod] FOREIGN KEY ([ShippingMethodId]) REFERENCES [dbo].[ShippingMethod] ([ShippingMethodId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_UsersInRoles_Roles]...';


GO
ALTER TABLE [dbo].[aspnet_UsersInRoles]
    ADD CONSTRAINT [FK_UsersInRoles_Roles] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[aspnet_Roles] ([RoleId]);


GO
PRINT N'Creating [dbo].[FK_UsersInRoles_Users]...';


GO
ALTER TABLE [dbo].[aspnet_UsersInRoles]
    ADD CONSTRAINT [FK_UsersInRoles_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_ShippingPackage_Package]...';


GO
ALTER TABLE [dbo].[ShippingPackage]
    ADD CONSTRAINT [FK_ShippingPackage_Package] FOREIGN KEY ([PackageId]) REFERENCES [dbo].[Package] ([PackageId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_ShippingPackage_ShippingOption]...';


GO
ALTER TABLE [dbo].[ShippingPackage]
    ADD CONSTRAINT [FK_ShippingPackage_ShippingOption] FOREIGN KEY ([ShippingOptionId]) REFERENCES [dbo].[ShippingOption] ([ShippingOptionId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_ShippingMethodParameter_ShippingMethod]...';


GO
ALTER TABLE [dbo].[ShippingMethodParameter]
    ADD CONSTRAINT [FK_ShippingMethodParameter_ShippingMethod] FOREIGN KEY ([ShippingMethodId]) REFERENCES [dbo].[ShippingMethod] ([ShippingMethodId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_ShippingMethodCase_JurisdictionGroup]...';


GO
ALTER TABLE [dbo].[ShippingMethodCase]
    ADD CONSTRAINT [FK_ShippingMethodCase_JurisdictionGroup] FOREIGN KEY ([JurisdictionGroupId]) REFERENCES [dbo].[JurisdictionGroup] ([JurisdictionGroupId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[ShippingMethod_ShippingMethodCase_FK1]...';


GO
ALTER TABLE [dbo].[ShippingMethodCase]
    ADD CONSTRAINT [ShippingMethod_ShippingMethodCase_FK1] FOREIGN KEY ([ShippingMethodId]) REFERENCES [dbo].[ShippingMethod] ([ShippingMethodId]);


GO
PRINT N'Creating [dbo].[FK_Roles_Application]...';


GO
ALTER TABLE [dbo].[aspnet_Roles]
    ADD CONSTRAINT [FK_Roles_Application] FOREIGN KEY ([ApplicationId]) REFERENCES [dbo].[aspnet_Applications] ([ApplicationId]);


GO
PRINT N'Creating [dbo].[FK_ShippingMethod_ShippingOption]...';


GO
ALTER TABLE [dbo].[ShippingMethod]
    ADD CONSTRAINT [FK_ShippingMethod_ShippingOption] FOREIGN KEY ([ShippingOptionId]) REFERENCES [dbo].[ShippingOption] ([ShippingOptionId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_ShippingOptionParameter_ShippingOption]...';


GO
ALTER TABLE [dbo].[ShippingOptionParameter]
    ADD CONSTRAINT [FK_ShippingOptionParameter_ShippingOption] FOREIGN KEY ([ShippingOptionId]) REFERENCES [dbo].[ShippingOption] ([ShippingOptionId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_ShipmentDiscount_Shipment]...';


GO
ALTER TABLE [dbo].[ShipmentDiscount]
    ADD CONSTRAINT [FK_ShipmentDiscount_Shipment] FOREIGN KEY ([ShipmentId]) REFERENCES [dbo].[Shipment] ([ShipmentId]);


GO
PRINT N'Creating [dbo].[FK_ShippingCountry_Country]...';


GO
ALTER TABLE [dbo].[ShippingCountry]
    ADD CONSTRAINT [FK_ShippingCountry_Country] FOREIGN KEY ([CountryId]) REFERENCES [dbo].[Country] ([CountryId]);


GO
PRINT N'Creating [dbo].[FK_ShippingCountry_ShippingMethod]...';


GO
ALTER TABLE [dbo].[ShippingCountry]
    ADD CONSTRAINT [FK_ShippingCountry_ShippingMethod] FOREIGN KEY ([ShippingMethodId]) REFERENCES [dbo].[ShippingMethod] ([ShippingMethodId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_Profile_Users]...';


GO
ALTER TABLE [dbo].[aspnet_Profile]
    ADD CONSTRAINT [FK_Profile_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_Shipment_OrderForm]...';


GO
ALTER TABLE [dbo].[Shipment]
    ADD CONSTRAINT [FK_Shipment_OrderForm] FOREIGN KEY ([OrderFormId]) REFERENCES [dbo].[OrderForm] ([OrderFormId]);


GO
PRINT N'Creating [dbo].[PaymentMethod_PaymentMethodParameter_FK1]...';


GO
ALTER TABLE [dbo].[PaymentMethodParameter]
    ADD CONSTRAINT [PaymentMethod_PaymentMethodParameter_FK1] FOREIGN KEY ([PaymentMethodId]) REFERENCES [dbo].[PaymentMethod] ([PaymentMethodId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_MarketPaymentMethods_Market]...';


GO
ALTER TABLE [dbo].[MarketPaymentMethods]
    ADD CONSTRAINT [FK_MarketPaymentMethods_Market] FOREIGN KEY ([MarketId]) REFERENCES [dbo].[Market] ([MarketId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_MarketPaymentMethods_PaymentMethod]...';


GO
ALTER TABLE [dbo].[MarketPaymentMethods]
    ADD CONSTRAINT [FK_MarketPaymentMethods_PaymentMethod] FOREIGN KEY ([PaymentMethodId]) REFERENCES [dbo].[PaymentMethod] ([PaymentMethodId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_OrderSearchResults_OrderGroup]...';


GO
ALTER TABLE [dbo].[OrderSearchResults]
    ADD CONSTRAINT [FK_OrderSearchResults_OrderGroup] FOREIGN KEY ([OrderGroupId]) REFERENCES [dbo].[OrderGroup] ([OrderGroupId]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_OrderGroupAddress_OrderGroup]...';


GO
ALTER TABLE [dbo].[OrderGroupAddress]
    ADD CONSTRAINT [FK_OrderGroupAddress_OrderGroup] FOREIGN KEY ([OrderGroupId]) REFERENCES [dbo].[OrderGroup] ([OrderGroupId]);


GO
PRINT N'Creating [dbo].[FK_OrderFormPayment_OrderForm]...';


GO
ALTER TABLE [dbo].[OrderFormPayment]
    ADD CONSTRAINT [FK_OrderFormPayment_OrderForm] FOREIGN KEY ([OrderFormId]) REFERENCES [dbo].[OrderForm] ([OrderFormId]);


GO
PRINT N'Creating [dbo].[FK_Membership_Applications]...';


GO
ALTER TABLE [dbo].[aspnet_Membership]
    ADD CONSTRAINT [FK_Membership_Applications] FOREIGN KEY ([ApplicationId]) REFERENCES [dbo].[aspnet_Applications] ([ApplicationId]);


GO
PRINT N'Creating [dbo].[FK_Membership_Users]...';


GO
ALTER TABLE [dbo].[aspnet_Membership]
    ADD CONSTRAINT [FK_Membership_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId]);


GO
PRINT N'Creating [dbo].[FK_OrderFormDiscount_OrderForm]...';


GO
ALTER TABLE [dbo].[OrderFormDiscount]
    ADD CONSTRAINT [FK_OrderFormDiscount_OrderForm] FOREIGN KEY ([OrderFormId]) REFERENCES [dbo].[OrderForm] ([OrderFormId]);


GO
PRINT N'Creating [dbo].[FK_OrderForm_OrderGroup]...';


GO
ALTER TABLE [dbo].[OrderForm]
    ADD CONSTRAINT [FK_OrderForm_OrderGroup] FOREIGN KEY ([OrderGroupId]) REFERENCES [dbo].[OrderGroup] ([OrderGroupId]);


GO
PRINT N'Creating [dbo].[FK_LineItemDiscount_LineItem]...';


GO
ALTER TABLE [dbo].[LineItemDiscount]
    ADD CONSTRAINT [FK_LineItemDiscount_LineItem] FOREIGN KEY ([LineItemId]) REFERENCES [dbo].[LineItem] ([LineItemId]);


GO
PRINT N'Creating [dbo].[FK_LineItem_OrderForm]...';


GO
ALTER TABLE [dbo].[LineItem]
    ADD CONSTRAINT [FK_LineItem_OrderForm] FOREIGN KEY ([OrderFormId]) REFERENCES [dbo].[OrderForm] ([OrderFormId]);


GO
PRINT N'Creating [dbo].[FK_OrderGroupNote_OrderGroup]...';


GO
ALTER TABLE [dbo].[OrderGroupNote]
    ADD CONSTRAINT [FK_OrderGroupNote_OrderGroup] FOREIGN KEY ([OrderGroupId]) REFERENCES [dbo].[OrderGroup] ([OrderGroupId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_Users_Applications]...';


GO
ALTER TABLE [dbo].[aspnet_Users]
    ADD CONSTRAINT [FK_Users_Applications] FOREIGN KEY ([ApplicationId]) REFERENCES [dbo].[aspnet_Applications] ([ApplicationId]);


GO
PRINT N'Creating [dbo].[FK_Variation_CatalogEntry]...';


GO
ALTER TABLE [dbo].[Variation]
    ADD CONSTRAINT [FK_Variation_CatalogEntry] FOREIGN KEY ([CatalogEntryId]) REFERENCES [dbo].[CatalogEntry] ([CatalogEntryId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_Variation_Merchant]...';


GO
ALTER TABLE [dbo].[Variation]
    ADD CONSTRAINT [FK_Variation_Merchant] FOREIGN KEY ([MerchantId]) REFERENCES [dbo].[Merchant] ([MerchantId]) ON DELETE SET NULL ON UPDATE SET NULL;


GO
PRINT N'Creating [dbo].[FK_SiteCatalog_Catalog]...';


GO
ALTER TABLE [dbo].[SiteCatalog]
    ADD CONSTRAINT [FK_SiteCatalog_Catalog] FOREIGN KEY ([CatalogId]) REFERENCES [dbo].[Catalog] ([CatalogId]);


GO
PRINT N'Creating [dbo].[FK_NodeEntryRelation_Catalog]...';


GO
ALTER TABLE [dbo].[NodeEntryRelation]
    ADD CONSTRAINT [FK_NodeEntryRelation_Catalog] FOREIGN KEY ([CatalogId]) REFERENCES [dbo].[Catalog] ([CatalogId]);


GO
PRINT N'Creating [dbo].[FK_NodeEntryRelation_CatalogEntry]...';


GO
ALTER TABLE [dbo].[NodeEntryRelation]
    ADD CONSTRAINT [FK_NodeEntryRelation_CatalogEntry] FOREIGN KEY ([CatalogEntryId]) REFERENCES [dbo].[CatalogEntry] ([CatalogEntryId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_NodeEntryRelation_CatalogNode]...';


GO
ALTER TABLE [dbo].[NodeEntryRelation]
    ADD CONSTRAINT [FK_NodeEntryRelation_CatalogNode] FOREIGN KEY ([CatalogNodeId]) REFERENCES [dbo].[CatalogNode] ([CatalogNodeId]);


GO
PRINT N'Creating [dbo].[CK_CurrencyRate_NoSelfRate]...';


GO
ALTER TABLE [dbo].[CurrencyRate]
    ADD CONSTRAINT [CK_CurrencyRate_NoSelfRate] CHECK ([FromCurrencyId]<>[ToCurrencyId]);


GO
PRINT N'Creating [dbo].[CategoryDeleteTrigger]...';


GO
CREATE TRIGGER [CategoryDeleteTrigger] ON [dbo].[CatalogNode] 
FOR DELETE 
AS
BEGIN
	DELETE [CatalogNodeRelation] WHERE ParentNodeId IN (SELECT CatalogNodeId FROM [deleted])
END
GO
PRINT N'Creating [dbo].[ecfVersion_Insert_Update]...';


GO
CREATE TRIGGER [ecfVersion_Insert_Update]
ON [dbo].[ecfVersion]
FOR INSERT, UPDATE
as BEGIN
declare @isPublished bit
    -- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	
	
	SELECT  @isPublished = IsPublished
	FROM CatalogEntry
	    INNER JOIN inserted ON CatalogEntry.CatalogEntryId = inserted.ObjectId
							and inserted.ObjectTypeId = 0
	IF(@isPublished = 0)
	UPDATE CatalogEntry
    SET  CatalogEntry.IsPublished = CASE inserted.Status
										 WHEN 4 THEN 1
										 WHEN 5 THEN 1
										 ELSE 0
									END
	FROM CatalogEntry
	    INNER JOIN inserted ON CatalogEntry.CatalogEntryId = inserted.ObjectId
							and inserted.ObjectTypeId = 0
END
GO
PRINT N'Creating [dbo].[Catalog_Delete]...';


GO
CREATE TRIGGER [dbo].[Catalog_Delete] ON [Catalog] FOR DELETE
AS
	--Delete all draft of deleted catalog
	DELETE d FROM ecfVersion d
	INNER JOIN deleted ON d.ObjectId = deleted.CatalogId AND d.ObjectTypeId = 2
GO
PRINT N'Creating [dbo].[mdptr_sys_MetaField_IsKeyField]...';


GO


create trigger dbo.mdptr_sys_MetaField_IsKeyField
on MetaField after insert, update
as
begin
    set nocount on
    if update(SystemMetaClassId)
    begin
        update dst
		set IsKeyField = cast(case when exists(
                select 1
	            from MetaClass mc
	            join INFORMATION_SCHEMA.KEY_COLUMN_USAGE kcu on kcu.CONSTRAINT_NAME COLLATE DATABASE_DEFAULT = mc.PrimaryKeyName COLLATE DATABASE_DEFAULT and kcu.CONSTRAINT_SCHEMA COLLATE DATABASE_DEFAULT = 'dbo'
	            where mc.MetaClassId = dst.SystemMetaClassId
	              and kcu.COLUMN_NAME COLLATE DATABASE_DEFAULT = dst.Name COLLATE DATABASE_DEFAULT)
	        then 1 else 0 end as bit)
		from MetaField dst
        where dst.MetaFieldId in (select i.MetaFieldId from inserted i)
        -- do not check for actual value change. updates to MetaClass.PrimaryKeyName will fire this
		-- trigger with "update MetaField set SystemMetaClassId=SystemMetaClassId".
    end
end
GO
PRINT N'Creating [dbo].[mdptr_sys_MetaClass_PrimaryKeyName]...';


GO


create trigger dbo.mdptr_sys_MetaClass_PrimaryKeyName
on MetaClass after insert, update
as
begin
    if update(PrimaryKeyName)
    begin
        update MetaField
        set SystemMetaClassId = SystemMetaClassId -- cause mdptr_sys_MetaField_IsKeyField to fire.
        where SystemMetaClassId in (
            select i.MetaClassId
            from inserted i
            left outer join deleted d on i.MetaClassId = d.MetaClassId
            where (d.MetaClassId is null or i.PrimaryKeyName != d.PrimaryKeyName))
    end
end
GO
PRINT N'Creating [dbo].[NodeEntryRelation_UpsertTrigger]...';


GO
CREATE trigger [dbo].[NodeEntryRelation_UpsertTrigger]
	on [dbo].[NodeEntryRelation]
	after update, insert
	as
	begin
		set nocount on
    
		update [dbo].[NodeEntryRelation]
		set [Modified] = GETUTCDATE()
		from [dbo].[NodeEntryRelation] ner
		join inserted
			on ner.[CatalogId] = inserted.[CatalogId]
			and ner.[CatalogEntryId] = inserted.[CatalogEntryId]
			and ner.[CatalogNodeId] = inserted.[CatalogNodeId]
	end
GO
PRINT N'Creating [dbo].[NodeEntryRelation_DeleteTrigger]...';


GO
CREATE trigger [dbo].[NodeEntryRelation_DeleteTrigger]
	on [dbo].[NodeEntryRelation]
	after delete
	as
	begin
		set nocount on
    
		insert into ApplicationLog ([Source], [Operation], [ObjectKey], [ObjectType], [Username], [Created], [Succeeded])
		select 'catalog', 'Modified', deleted.CatalogEntryId, 'relation', 'database-trigger', GETUTCDATE(), 1
		from deleted
	end
GO
PRINT N'Creating [dbo].[vw_aspnet_WebPartState_User]...';


GO

  CREATE VIEW [dbo].[vw_aspnet_WebPartState_User]
  AS SELECT [dbo].[aspnet_PersonalizationPerUser].[PathId], [dbo].[aspnet_PersonalizationPerUser].[UserId], [DataSize]=DATALENGTH([dbo].[aspnet_PersonalizationPerUser].[PageSettings]), [dbo].[aspnet_PersonalizationPerUser].[LastUpdatedDate]
  FROM [dbo].[aspnet_PersonalizationPerUser]
GO
PRINT N'Creating [dbo].[vw_aspnet_WebPartState_Shared]...';


GO

  CREATE VIEW [dbo].[vw_aspnet_WebPartState_Shared]
  AS SELECT [dbo].[aspnet_PersonalizationAllUsers].[PathId], [DataSize]=DATALENGTH([dbo].[aspnet_PersonalizationAllUsers].[PageSettings]), [dbo].[aspnet_PersonalizationAllUsers].[LastUpdatedDate]
  FROM [dbo].[aspnet_PersonalizationAllUsers]
GO
PRINT N'Creating [dbo].[vw_aspnet_WebPartState_Paths]...';


GO

  CREATE VIEW [dbo].[vw_aspnet_WebPartState_Paths]
  AS SELECT [dbo].[aspnet_Paths].[ApplicationId], [dbo].[aspnet_Paths].[PathId], [dbo].[aspnet_Paths].[Path], [dbo].[aspnet_Paths].[LoweredPath]
  FROM [dbo].[aspnet_Paths]
GO
PRINT N'Creating [dbo].[vw_aspnet_UsersInRoles]...';


GO

  CREATE VIEW [dbo].[vw_aspnet_UsersInRoles]
  AS SELECT [dbo].[aspnet_UsersInRoles].[UserId], [dbo].[aspnet_UsersInRoles].[RoleId]
  FROM [dbo].[aspnet_UsersInRoles]
GO
PRINT N'Creating [dbo].[vw_aspnet_Roles]...';


GO

  CREATE VIEW [dbo].[vw_aspnet_Roles]
  AS SELECT [dbo].[aspnet_Roles].[ApplicationId], [dbo].[aspnet_Roles].[RoleId], [dbo].[aspnet_Roles].[RoleName], [dbo].[aspnet_Roles].[LoweredRoleName], [dbo].[aspnet_Roles].[Description]
  FROM [dbo].[aspnet_Roles]
GO
PRINT N'Creating [dbo].[vw_aspnet_Profiles]...';


GO

  CREATE VIEW [dbo].[vw_aspnet_Profiles]
  AS SELECT [dbo].[aspnet_Profile].[UserId], [dbo].[aspnet_Profile].[LastUpdatedDate],
      [DataSize]=  DATALENGTH([dbo].[aspnet_Profile].[PropertyNames])
                 + DATALENGTH([dbo].[aspnet_Profile].[PropertyValuesString])
                 + DATALENGTH([dbo].[aspnet_Profile].[PropertyValuesBinary])
  FROM [dbo].[aspnet_Profile]
GO
PRINT N'Creating [dbo].[vw_aspnet_MembershipUsers]...';


GO

  CREATE VIEW [dbo].[vw_aspnet_MembershipUsers]
  AS SELECT [dbo].[aspnet_Membership].[UserId],
            [dbo].[aspnet_Membership].[PasswordFormat],
            [dbo].[aspnet_Membership].[MobilePIN],
            [dbo].[aspnet_Membership].[Email],
            [dbo].[aspnet_Membership].[LoweredEmail],
            [dbo].[aspnet_Membership].[PasswordQuestion],
            [dbo].[aspnet_Membership].[PasswordAnswer],
            [dbo].[aspnet_Membership].[IsApproved],
            [dbo].[aspnet_Membership].[IsLockedOut],
            [dbo].[aspnet_Membership].[CreateDate],
            [dbo].[aspnet_Membership].[LastLoginDate],
            [dbo].[aspnet_Membership].[LastPasswordChangedDate],
            [dbo].[aspnet_Membership].[LastLockoutDate],
            [dbo].[aspnet_Membership].[FailedPasswordAttemptCount],
            [dbo].[aspnet_Membership].[FailedPasswordAttemptWindowStart],
            [dbo].[aspnet_Membership].[FailedPasswordAnswerAttemptCount],
            [dbo].[aspnet_Membership].[FailedPasswordAnswerAttemptWindowStart],
            [dbo].[aspnet_Membership].[Comment],
            [dbo].[aspnet_Users].[ApplicationId],
            [dbo].[aspnet_Users].[UserName],
            [dbo].[aspnet_Users].[MobileAlias],
            [dbo].[aspnet_Users].[IsAnonymous],
            [dbo].[aspnet_Users].[LastActivityDate]
  FROM [dbo].[aspnet_Membership] INNER JOIN [dbo].[aspnet_Users]
      ON [dbo].[aspnet_Membership].[UserId] = [dbo].[aspnet_Users].[UserId]
GO
PRINT N'Creating [dbo].[vw_aspnet_Users]...';


GO

  CREATE VIEW [dbo].[vw_aspnet_Users]
  AS SELECT [dbo].[aspnet_Users].[ApplicationId], [dbo].[aspnet_Users].[UserId], [dbo].[aspnet_Users].[UserName], [dbo].[aspnet_Users].[LoweredUserName], [dbo].[aspnet_Users].[MobileAlias], [dbo].[aspnet_Users].[IsAnonymous], [dbo].[aspnet_Users].[LastActivityDate]
  FROM [dbo].[aspnet_Users]
GO
PRINT N'Creating [dbo].[vw_aspnet_Applications]...';


GO

  CREATE VIEW [dbo].[vw_aspnet_Applications]
  AS SELECT [dbo].[aspnet_Applications].[ApplicationName], [dbo].[aspnet_Applications].[LoweredApplicationName], [dbo].[aspnet_Applications].[ApplicationId], [dbo].[aspnet_Applications].[Description]
  FROM [dbo].[aspnet_Applications]
GO
PRINT N'Creating [dbo].[fn_UriSegmentExistsOnSiblingNodeOrEntry]...';


GO
CREATE FUNCTION [dbo].[fn_UriSegmentExistsOnSiblingNodeOrEntry]
(
    @entityId int,
    @type bit, -- 0 = Node, 1 = Entry
    @UriSegment nvarchar(255),
    @LanguageCode nvarchar(50)
)
RETURNS bit
AS
BEGIN
    DECLARE @RetVal bit
    DECLARE @parentId int
	DECLARE @CatalogId int
    
    -- get the parentId and CatalogId, based on entityId and the entity type
    IF @type = 0
	BEGIN
		SELECT @parentId = ParentNodeId, @CatalogId = CatalogId FROM CatalogNode WHERE CatalogNodeId = @entityId
		--no validation should be done until parent id is properly set
		IF(@parentId < 0)
			RETURN 0;
	END
    ELSE
	BEGIN
        SET @parentId = (SELECT TOP 1 CatalogNodeId FROM NodeEntryRelation WHERE CatalogEntryId = @entityId ORDER BY IsPrimary DESC)
		SET @CatalogId = (SELECT CatalogId FROM CatalogEntry WHERE CatalogEntryId = @entityId)
	END

    SET @RetVal = 0

               
    IF NOT EXISTS( SELECT S.CatalogNodeId
                    FROM CatalogItemSeo S WITH (NOLOCK) 
                    INNER JOIN CatalogNode N on N.CatalogNodeId = S.CatalogNodeId
                    LEFT JOIN CatalogNodeRelation NR ON N.CatalogNodeId = NR.ChildNodeId 
                    WHERE LanguageCode = @LanguageCode COLLATE DATABASE_DEFAULT 
                        AND S.CatalogNodeId <> @entityId
                        AND ((@parentId = 0 AND N.CatalogId = @CatalogId AND N.ParentNodeId = 0) OR (@parentId <> 0 AND (N.ParentNodeId = @parentId OR NR.ParentNodeId = @parentId)))
                        AND UriSegment = @UriSegment COLLATE DATABASE_DEFAULT 
                        AND N.IsActive = 1) 
    BEGIN
    	-- check against sibling entry if only UriSegment does not exist on sibling node	
		IF EXISTS(
					SELECT S.CatalogEntryId
					FROM CatalogItemSeo S WITH (NOLOCK)
					INNER JOIN CatalogEntry N ON N.CatalogEntryId = S.CatalogEntryId
					LEFT JOIN NodeEntryRelation R ON R.CatalogEntryId = N.CatalogEntryId
					WHERE 
						S.LanguageCode = @LanguageCode COLLATE DATABASE_DEFAULT 
						AND S.CatalogEntryId <> @entityId 
						AND R.CatalogNodeId = @parentId
						AND R.CatalogId = @CatalogId
						AND UriSegment = @UriSegment COLLATE DATABASE_DEFAULT 
						AND N.IsActive = 1
						)
		BEGIN
			SET @RetVal = 1
		END
	END
	ELSE
	BEGIN
		SET @RetVal = 1
	END

    RETURN @RetVal;
END
GO
PRINT N'Creating [dbo].[fn_AreSiblings]...';


GO
CREATE FUNCTION [dbo].[fn_AreSiblings]
(
    @entryId1 int,
    @entryId2 int
)
RETURNS bit
AS
BEGIN
    DECLARE @RetVal bit
	IF EXISTS(
		SELECT R.CatalogNodeId
		FROM NodeEntryRelation R WHERE R.CatalogEntryId = @entryId1

		INTERSECT

		SELECT R.CatalogNodeId
		FROM NodeEntryRelation R WHERE R.CatalogEntryId = @entryId2
		)

		BEGIN
			SET @RetVal = 1
		END
	ELSE
		BEGIN
			SET @RetVal = 0
		END

    RETURN @RetVal;
END
GO
PRINT N'Creating [dbo].[mdpfn_sys_IsInheritedFromMetaClass]...';


GO
CREATE FUNCTION [dbo].[mdpfn_sys_IsInheritedFromMetaClass]
(
	@MetaClassId INT,
	@ParentClassName NVARCHAR(256)
)
RETURNS BIT
AS
BEGIN
    DECLARE @ParentClassId INT
	DECLARE @IsCatalogMetaClass Bit
    IF EXISTS(SELECT MetaClassId FROM MetaClass WHERE ParentClassId = (SELECT MetaClassId FROM MetaClass WHERE Name = @ParentClassName) AND MetaClassId = @MetaClassId)
    	RETURN 1
    ELSE
    BEGIN
	    SET @ParentClassId = ( SELECT ParentClassId FROM MetaClass WHERE MetaClassId = @MetaClassId )
	    IF @ParentClassId = 0
	    	RETURN 0
	    SET @IsCatalogMetaClass = (SELECT [dbo].[mdpfn_sys_IsInheritedFromMetaClass](@ParentClassId, @ParentClassName))
	END
	RETURN @IsCatalogMetaClass
END
GO
PRINT N'Creating [dbo].[mdpfn_sys_IsAzureCompatible]...';


GO
CREATE FUNCTION [dbo].[mdpfn_sys_IsAzureCompatible]()
RETURNS BIT
AS
BEGIN
	DECLARE @RetVal BIT
	SET @RetVal = ISNULL((SELECT AzureCompatible FROM dbo.AzureCompatible), 0)
	RETURN @RetVal;
END
GO
PRINT N'Creating [dbo].[mdpfn_sys_IsLongStringMetaField]...';


GO
CREATE FUNCTION [dbo].[mdpfn_sys_IsLongStringMetaField]
(
	@dataTypeId INT
)
RETURNS BIT
AS
BEGIN
    DECLARE @RetVal BIT

	IF @dataTypeId IN (31, --ShortString
					   32, --LongString
					   33 --LongHtmlString 
					  )
		SET @RetVal = 1
	ELSE
		SET @RetVal = 0

	RETURN @RetVal;
END
GO
PRINT N'Creating [dbo].[fn_JoinCatalogLanguages]...';


GO
CREATE FUNCTION [dbo].[fn_JoinCatalogLanguages]
(
    @catalogId int
)
RETURNS nvarchar(4000)
AS
BEGIN
    DECLARE @RetVal nvarchar(4000)
    SELECT @RetVal = COALESCE(@RetVal + ';', '') + LanguageCode FROM CatalogLanguage cl
	INNER JOIN [Catalog] c ON cl.CatalogId = c.CatalogId
	WHERE cl.CatalogId = @catalogId

    RETURN @RetVal;
END
GO
PRINT N'Creating [dbo].[fn_GetDaylightSavingsTime]...';


GO
CREATE FUNCTION [dbo].[fn_GetDaylightSavingsTime]
(
 @UTC_Date DATETIME,
 @ST_Offset INT, -- CST = -6, EST = -5
 @DT_Offset INT  -- CDT = -5, EDT = -4
)
RETURNS DATETIME
AS
BEGIN


RETURN 
DATEADD(hh, 
   CASE WHEN YEAR(@UTC_Date) <= 2006 THEN  
                CASE WHEN 
                      @UTC_Date >=  '4/' + CAST(ABS(8 - DATEPART(WEEKDAY,'4/1/' 
    + CAST(YEAR(@UTC_Date) AS VARCHAR))) % 7 + 1 AS VARCHAR) +  '/' 
    + CAST(YEAR(@UTC_Date) AS VARCHAR) + ' 2:00' AND 
                      @UTC_Date < '10/' + CAST(32 - DATEPART(WEEKDAY,'10/31/' 
    + CAST(YEAR(@UTC_Date) AS VARCHAR)) AS VARCHAR) +  '/' 
    + CAST(YEAR(@UTC_Date) AS VARCHAR) + ' 2:00' 
                THEN @DT_Offset ELSE @ST_Offset END
              ELSE
                CASE WHEN 
                      @UTC_Date >= '3/' + CAST(ABS(8 - DATEPART(WEEKDAY,'3/1/' 
    + CAST(YEAR(@UTC_Date) AS VARCHAR))) % 7 + 8 AS VARCHAR) +  '/' 
    + CAST(YEAR(@UTC_Date) AS VARCHAR) + ' 2:00' AND 
                      @UTC_Date < 
                        '11/' + CAST(ABS(8 - DATEPART(WEEKDAY,'11/1/' 
    + CAST(YEAR(@UTC_Date) AS VARCHAR))) % 7 + 1 AS VARCHAR) +  '/' 
    + CAST(YEAR(@UTC_Date) AS VARCHAR) + ' 2:00' 
                THEN @DT_Offset ELSE @ST_Offset END
              END
   , @UTC_Date
   )
END
GO
PRINT N'Creating [dbo].[mdpfn_sys_EncryptDecryptString2]...';


GO
CREATE FUNCTION [dbo].[mdpfn_sys_EncryptDecryptString2]
(
	
	@input varbinary(4000), 
	@encrypt bit
)
RETURNS varbinary(4000)
AS
BEGIN
	-- encryption is disabled by default. To enable encryption, execute EncryptionSupport.sql file of EPiServer.Commerce.Core package.
	RETURN @input;
END
GO
PRINT N'Creating [dbo].[mdpfn_sys_EncryptDecryptString]...';


GO
CREATE FUNCTION [dbo].[mdpfn_sys_EncryptDecryptString]
(
	@input nvarchar(4000),
	@encrypt bit
)
RETURNS nvarchar(4000)
AS
BEGIN
	-- encryption is disabled by default. To enable encryption, execute EncryptionSupport.sql file of EPiServer.Commerce.Core package.
	RETURN @input;
END
GO
PRINT N'Creating [dbo].[mdpfn_sys_IsCatalogMetaClass]...';


GO
CREATE FUNCTION [dbo].[mdpfn_sys_IsCatalogMetaClass]
(
	@MetaClassId INT
)
RETURNS BIT
AS
BEGIN
	DECLARE @IsCatalogMetaClass BIT
    SET @IsCatalogMetaClass = (SELECT [dbo].[mdpfn_sys_IsInheritedFromMetaClass](@MetaClassId, 'CatalogEntry'))
	IF @IsCatalogMetaClass = 0
	    SET @IsCatalogMetaClass = (SELECT [dbo].[mdpfn_sys_IsInheritedFromMetaClass](@MetaClassId, 'CatalogNode'))
    RETURN @IsCatalogMetaClass
END
GO
PRINT N'Creating [dbo].[mdpfn_sys_IsCatalogMetaDataTable]...';


GO
CREATE FUNCTION [dbo].[mdpfn_sys_IsCatalogMetaDataTable]
(
	@tableName nvarchar(256)
)
RETURNS BIT
AS
BEGIN
	DECLARE @IsCatalogMetaClass BIT
    DECLARE @MetaClassId INT
    SET @MetaClassId = (SELECT MetaClassId FROM MetaClass WHERE TableName = @tableName)
    SET @IsCatalogMetaClass = (SELECT [dbo].[mdpfn_sys_IsCatalogMetaClass](@MetaClassId))
    RETURN @IsCatalogMetaClass
END
GO
PRINT N'Creating [dbo].[ecf_splitlist_with_rowid]...';


GO
CREATE FUNCTION [dbo].[ecf_splitlist_with_rowid]
(
	@List nvarchar(max)
)
RETURNS 
@ParsedList table
(
	Item nvarchar(100),
	RowId int
)
AS
BEGIN
	DECLARE @Item nvarchar(100), @Pos int, @RowId int
	SET @RowId = 0

	SET @List = LTRIM(RTRIM(@List))+ ','
	SET @Pos = CHARINDEX(',', @List, 1)

	IF REPLACE(@List, ',', '') <> ''
	BEGIN
		WHILE @Pos > 0
		BEGIN
			SET @Item = LTRIM(RTRIM(LEFT(@List, @Pos - 1)))
			IF @Item <> ''
			BEGIN
				SET @RowId = @RowId + 1
				INSERT INTO @ParsedList (Item, RowId) 
				VALUES (CAST(@Item AS nvarchar(100)), @RowId) --Use Appropriate conversion
			END
			SET @List = RIGHT(@List, LEN(@List) - @Pos)
			SET @Pos = CHARINDEX(',', @List, 1)
		END
	END	
	RETURN
END
GO
PRINT N'Creating [dbo].[cms_splitlist]...';


GO
CREATE FUNCTION [dbo].[cms_splitlist]
(
	@List nvarchar(max)
)
RETURNS 
@ParsedList table
(
	Item nvarchar(100)
)
AS
BEGIN
	DECLARE @Item nvarchar(100), @Pos int

	SET @List = LTRIM(RTRIM(@List))+ ','
	SET @Pos = CHARINDEX(',', @List, 1)

	IF REPLACE(@List, ',', '') <> ''
	BEGIN
		WHILE @Pos > 0
		BEGIN
			SET @Item = LTRIM(RTRIM(LEFT(@List, @Pos - 1)))
			IF @Item <> ''
			BEGIN
				INSERT INTO @ParsedList (Item) 
				VALUES (CAST(@Item AS nvarchar(100))) --Use Appropriate conversion
			END
			SET @List = RIGHT(@List, LEN(@List) - @Pos)
			SET @Pos = CHARINDEX(',', @List, 1)

		END
	END	
	RETURN
END
GO
PRINT N'Creating [dbo].[ecf_splitlist]...';


GO
CREATE FUNCTION [dbo].[ecf_splitlist]
(
	@List nvarchar(max)
)
RETURNS 
@ParsedList table
(
	Item nvarchar(100)
)
AS
BEGIN
	DECLARE @Item nvarchar(100), @Pos int

	SET @List = LTRIM(RTRIM(@List))+ ','
	SET @Pos = CHARINDEX(',', @List, 1)

	IF REPLACE(@List, ',', '') <> ''
	BEGIN
		WHILE @Pos > 0
		BEGIN
			SET @Item = LTRIM(RTRIM(LEFT(@List, @Pos - 1)))
			IF @Item <> ''
			BEGIN
				INSERT INTO @ParsedList (Item) 
				VALUES (CAST(@Item AS nvarchar(100))) --Use Appropriate conversion
			END
			SET @List = RIGHT(@List, LEN(@List) - @Pos)
			SET @Pos = CHARINDEX(',', @List, 1)

		END
	END	
	RETURN
END
GO
PRINT N'Creating [dbo].[ecf_GetCatalogEntryIdsByContentGuids]...';


GO
CREATE PROCEDURE [dbo].[ecf_GetCatalogEntryIdsByContentGuids]
	@CatalogGuids udttContentGuidList READONLY
AS
BEGIN
	SELECT e.ContentGuid, e.CatalogEntryId from [CatalogEntry] e
	INNER JOIN @CatalogGuids k ON e.ContentGuid = k.ContentGuid
END
GO
PRINT N'Creating [dbo].[ecfVersion_UpdateVersionsMasterLanguage]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_UpdateVersionsMasterLanguage]
	@Objects dbo.udttObjectWorkId READONLY
AS
BEGIN
	DECLARE @temp TABLE(ObjectId INT, ObjectTypeId INT, CatalogId INT, MasterLanguage NVARCHAR(40))

	INSERT INTO @temp (ObjectId, ObjectTypeId, CatalogId, MasterLanguage)
	SELECT e.CatalogEntryId ObjectId, o.ObjectTypeId, e.CatalogId, c.DefaultLanguage FROM CatalogEntry e
	INNER JOIN @Objects o ON e.CatalogEntryId = o.ObjectId and o.ObjectTypeId = 0
	INNER JOIN Catalog c ON c.CatalogId = e.CatalogId
	UNION ALL
	SELECT n.CatalogNodeId ObjectId, o.ObjectTypeId, n.CatalogId, c.DefaultLanguage FROM CatalogNode n
	INNER JOIN @Objects o ON n.CatalogNodeId = o.ObjectId and o.ObjectTypeId = 1
	INNER JOIN Catalog c ON c.CatalogId = n.CatalogId
	
	UPDATE v
	SET
		MasterLanguageName = t.MasterLanguage,
		CatalogId = t.CatalogId
	FROM ecfVersion v
	INNER JOIN @temp t ON t.ObjectId = v.ObjectId AND t.ObjectTypeId = v.ObjectTypeId

	MERGE ecfVersionAsset AS TARGET
	USING
	(SELECT v.WorkId, a.AssetType, a.AssetKey, a.GroupName, a.SortOrder
	FROM ecfVersion v
		INNER JOIN @Objects o ON o.ObjectId = v.ObjectId and v.ObjectTypeId = 0
		INNER JOIN CatalogItemAsset a ON v.ObjectId = a.CatalogEntryId
	WHERE v.LanguageName = v.MasterLanguageName COLLATE DATABASE_DEFAULT
		AND (v.Status = 4 OR v.IsCommonDraft = 1)) AS SOURCE (WorkId, AssetType, AssetKey, GroupName, SortOrder)
	ON 
	    TARGET.WorkId = SOURCE.WorkId
		AND TARGET.AssetType = SOURCE.AssetType
		AND TARGET.AssetKey = SOURCE.AssetKey
	WHEN MATCHED THEN
		UPDATE SET GroupName = SOURCE.GroupName, SortOrder = SOURCE.SortOrder
	WHEN NOT MATCHED BY TARGET THEN
	INSERT (WorkId, AssetType, AssetKey, GroupName, SortOrder) VALUES (WorkId, AssetType, AssetKey, GroupName, SortOrder);

	MERGE ecfVersionAsset AS TARGET
	USING
	(SELECT v.WorkId, a.AssetType, a.AssetKey, a.GroupName, a.SortOrder
	FROM ecfVersion v
		INNER JOIN @Objects o ON o.ObjectId = v.ObjectId and v.ObjectTypeId = 1
		INNER JOIN CatalogItemAsset a ON v.ObjectId = a.CatalogNodeId
	WHERE v.LanguageName = v.MasterLanguageName COLLATE DATABASE_DEFAULT
		AND a.CatalogNodeId > 0
		AND (v.Status = 4 OR v.IsCommonDraft = 1)) AS SOURCE (WorkId, AssetType, AssetKey, GroupName, SortOrder)
	ON 
	    TARGET.WorkId = SOURCE.WorkId
		AND TARGET.AssetType = SOURCE.AssetType
		AND TARGET.AssetKey = SOURCE.AssetKey
	WHEN MATCHED THEN
		UPDATE SET GroupName = SOURCE.GroupName, SortOrder = SOURCE.SortOrder
	WHEN NOT MATCHED BY TARGET THEN
	INSERT (WorkId, AssetType, AssetKey, GroupName, SortOrder) VALUES (WorkId, AssetType, AssetKey, GroupName, SortOrder);
END
GO
PRINT N'Creating [dbo].[ecf_LineItemReportSubscriptionData_Get]...';


GO
CREATE PROCEDURE [dbo].[ecf_LineItemReportSubscriptionData_Get]
	@FromDate DateTime,
	@ToDate DateTime
AS
BEGIN
	SELECT OOP.TotalRevenue, L.LineItemId, L.CatalogEntryId AS LineItemCode, L.DisplayName, L.PlacedPrice, L.Quantity, L.ExtendedPrice, 
		L.LineItemDiscountAmount AS EntryDiscountAmount, L.Epi_SalesTax AS SalesTax, 
		O.BillingCurrency AS Currency, O.OrderGroupId, O.[Status], O.CustomerId, O.CustomerName, O.MarketId, 
		PP.PlanCycleMode, PP.PlanCycleLength , PP.PlanMaxCyclesCount , PP.PlanCompletedCyclesCount, 
		PP.PlanStartDate, PP.PlanEndDate, PP.LastTransactionDate, PP.PlanIsActive
	FROM LineItem L
	INNER JOIN OrderGroup O ON O.OrderGroupId = L.OrderGroupId
	INNER JOIN OrderGroup_PaymentPlan PP ON PP.ObjectId = L.OrderGroupId
	LEFT JOIN (
		SELECT SUM(O.Total) AS TotalRevenue, PO.ParentOrderGroupId FROM OrderGroup_PaymentPlan PP 
		INNER JOIN OrderGroup_PurchaseOrder PO ON PO.ParentOrderGroupId = PP.ObjectId
		INNER JOIN OrderGroup O ON PO.ObjectId = O.OrderGroupId
		WHERE PO.ParentOrderGroupId > 0 AND O.Status = 'Completed'
		GROUP BY ParentOrderGroupId
	) OOP ON OOP.ParentOrderGroupId = L.OrderGroupId
	WHERE PP.Created BETWEEN @FromDate AND @ToDate
	ORDER BY O.OrderGroupId ASC
END
GO
PRINT N'Creating [dbo].[ecf_SerializableCart_FindCartsByCustomerName]...';


GO
CREATE PROCEDURE [dbo].[ecf_SerializableCart_FindCartsByCustomerName]
	@CustomerName NVARCHAR (200),
    @StartingRecord INT,
	@RecordsToRetrieve INT,
	@ReturnTotalCount BIT,
	@ExcludeNames NVARCHAR (1024) = NULL,
	@TotalRecords INT OUTPUT
AS
BEGIN
	-- Execute for record count.
	IF (@ReturnTotalCount = 1)
	BEGIN
		SET @TotalRecords = (SELECT COUNT(1) FROM SerializableCart SC
							INNER JOIN cls_Contact CC ON SC.CustomerId = CC.ContactId
							WHERE CC.FullName LIKE @CustomerName + '%'
								  AND (@ExcludeNames IS NULL OR SC.[Name] NOT IN(SELECT Item FROM ecf_splitlist(@ExcludeNames))))
	END
	ELSE 
	BEGIN
		SET @TotalRecords = 0
	END

	-- Execute for get carts.
	SELECT SC.CartId, SC.Created, SC.Modified, SC.[Data]
	FROM SerializableCart SC
	INNER JOIN cls_Contact CC ON SC.CustomerId = CC.ContactId
	WHERE CC.FullName LIKE @CustomerName + '%'
		  AND (@ExcludeNames IS NULL OR SC.[Name] NOT IN(SELECT Item FROM ecf_splitlist(@ExcludeNames)))
	ORDER BY SC.Modified DESC
	OFFSET @StartingRecord ROWS
	FETCH NEXT @RecordsToRetrieve ROWS ONLY
END
GO
PRINT N'Creating [dbo].[ecf_SerializableCart_FindCartsByCustomerEmail]...';


GO
CREATE PROCEDURE [dbo].[ecf_SerializableCart_FindCartsByCustomerEmail]
	@CustomerEmail NVARCHAR (254),
    @StartingRecord INT,
	@RecordsToRetrieve INT,
	@ReturnTotalCount BIT,
	@ExcludeNames NVARCHAR (1024) = NULL,
	@TotalRecords INT OUTPUT
AS
BEGIN
	-- Execute for record count.
	IF (@ReturnTotalCount = 1)
	BEGIN
		SET @TotalRecords = (SELECT COUNT(1) FROM SerializableCart SC
							INNER JOIN cls_Contact CC ON SC.CustomerId = CC.ContactId
							WHERE CC.Email = @CustomerEmail
								  AND (@ExcludeNames IS NULL OR SC.[Name] NOT IN(SELECT Item FROM ecf_splitlist(@ExcludeNames))))
	END
	ELSE 
	BEGIN
		SET @TotalRecords = 0
	END

	-- Execute for get carts.
	SELECT SC.CartId, SC.Created, SC.Modified, SC.[Data]
	FROM SerializableCart SC
	INNER JOIN cls_Contact CC ON SC.CustomerId = CC.ContactId
	WHERE CC.Email = @CustomerEmail
		  AND (@ExcludeNames IS NULL OR SC.[Name] NOT IN(SELECT Item FROM ecf_splitlist(@ExcludeNames)))
	ORDER BY SC.Modified DESC
	OFFSET @StartingRecord ROWS
	FETCH NEXT @RecordsToRetrieve ROWS ONLY
END
GO
PRINT N'Creating [dbo].[OrderPerPromotionReportData_Load]...';


GO
CREATE PROCEDURE [dbo].[OrderPerPromotionReportData_Load]
	@ContentGuidList [dbo].[udttContentGuidList] READONLY
AS
BEGIN
	SELECT P.PromotionGuid, P.OrderCount
	FROM dbo.OrderPerPromotionReportData P
	INNER JOIN @ContentGuidList C on C.ContentGuid = P.PromotionGuid
END
GO
PRINT N'Creating [dbo].[OrderPerPromotionReportData_Upsert]...';


GO
CREATE PROCEDURE [dbo].[OrderPerPromotionReportData_Upsert]
	@PromotionGuids [dbo].[udttContentGuidList] READONLY,
	@CampaignGuid UNIQUEIDENTIFIER
AS
BEGIN
	;WITH CTE1 AS
		(SELECT P.PromotionGuid AS PromotionGuid, COUNT(DISTINCT(F.OrderGroupId)) AS OrderGroupCount
		FROM PromotionInformation P
			INNER JOIN OrderForm F ON F.OrderFormId = P.OrderFormId 
			INNER JOIN @PromotionGuids C ON C.ContentGuid = P.PromotionGuid
		WHERE P.IsRedeemed = 1 AND P.IsReturnOrderForm = 0
		GROUP BY P.PromotionGuid
		)
	,CTE2 AS
		(SELECT p.ContentGuid as PromotionGuid, COALESCE(CTE1.OrderGroupCount, 0) as OrderGroupCount 
		FROM @PromotionGuids p
		LEFT JOIN CTE1 ON p.ContentGuid = CTE1.PromotionGuid

		UNION

		SELECT @CampaignGuid AS PromotionGuid, COUNT(DISTINCT(F.OrderGroupId)) AS OrderGroupCount
		FROM PromotionInformation P
			INNER JOIN OrderForm F ON F.OrderFormId = P.OrderFormId
			INNER JOIN @PromotionGuids C ON C.ContentGuid = P.PromotionGuid
		WHERE P.IsRedeemed = 1 AND P.IsReturnOrderForm = 0
		)	

	MERGE dbo.OrderPerPromotionReportData t
	USING
		CTE2 s
	ON t.PromotionGuid = s.PromotionGuid
	WHEN MATCHED
    THEN UPDATE SET 
    	t.OrderCount = s.OrderGroupCount
	WHEN NOT MATCHED BY TARGET
    THEN INSERT (PromotionGuid, OrderCount)
        VALUES (s.PromotionGuid, s.OrderGroupCount);
END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntryAssocations_Delete]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntryAssocations_Delete]
    @CatalogEntries dbo.udttEntityList readonly
AS
BEGIN
	DELETE CEA FROM [CatalogEntryAssociation] CEA
	INNER JOIN [CatalogAssociation] CA ON CEA.CatalogAssociationId = CA.CatalogAssociationId
	INNER JOIN @CatalogEntries CE ON CA.CatalogEntryId = CE.EntityId

	DELETE CA FROM [CatalogAssociation] CA
	INNER JOIN @CatalogEntries CE ON CA.CatalogEntryId = CE.EntityId
END
GO
PRINT N'Creating [dbo].[ecf_NodeEntryRelations_Delete]...';


GO
CREATE PROCEDURE [dbo].[ecf_NodeEntryRelations_Delete]
    @CatalogEntries dbo.udttEntityList readonly,
    @CatalogNodes dbo.udttEntityList readonly
AS
BEGIN
	DELETE CER
	FROM CatalogEntryRelation CER 
	INNER JOIN @CatalogEntries CE ON CE.EntityId = CER.ParentEntryId

	DELETE CER
	FROM CatalogEntryRelation CER 
	INNER JOIN @CatalogEntries CE ON CE.EntityId = CER.ChildEntryId

	DELETE NER
	FROM NodeEntryRelation NER
	INNER JOIN @CatalogEntries CE ON CE.EntityId = NER.CatalogEntryId

	DELETE NER
	FROM NodeEntryRelation NER
	INNER JOIN @CatalogNodes CN on CN.EntityId = NER.CatalogNodeId
END
GO
PRINT N'Creating [dbo].[ecf_GetCatalogEntryCodesByGuids]...';


GO
CREATE PROCEDURE [dbo].[ecf_GetCatalogEntryCodesByGuids]
	@ContentGuids udttContentGuidList READONLY
AS
BEGIN
	SELECT e.ContentGuid CatalogEntryGuid, e.Code Code from [CatalogEntry] e
	INNER JOIN @ContentGuids k  ON e.ContentGuid = k.ContentGuid
END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntry_Delete]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntry_Delete]
    @CatalogEntries dbo.udttEntityList READONLY
AS
BEGIN
	DELETE CE
	FROM dbo.CatalogEntry CE
	INNER JOIN @CatalogEntries Ids
	ON CE.CatalogEntryId = Ids.EntityId

	DELETE CE
	FROM dbo.CatalogItemAsset CE
	INNER JOIN @CatalogEntries Ids
	ON CE.CatalogEntryId = Ids.EntityId

	DELETE CE
	FROM dbo.CatalogItemSeo CE
	INNER JOIN @CatalogEntries Ids
	ON CE.CatalogEntryId = Ids.EntityId
END
GO
PRINT N'Creating [dbo].[ecf_NodeEntryRelation_GetMaxSortOrder]...';


GO
CREATE PROCEDURE [dbo].[ecf_NodeEntryRelation_GetMaxSortOrder]
	@CatalogNodeId INT
AS
BEGIN
	SELECT Max(SortOrder) FROM NodeEntryRelation WHERE CatalogNodeId = @CatalogNodeId
END
GO
PRINT N'Creating [dbo].[ecf_SerializableCart_InsertBatch]...';


GO
CREATE PROCEDURE [dbo].[ecf_SerializableCart_InsertBatch] 
	@CartData [dbo].[udttSerializableCart] READONLY
AS
BEGIN
	INSERT INTO SerializableCart(
		[CustomerId],
		[Name],
		[MarketId],
		[Created],
		[Modified],
		[Data]
	)
	SELECT 
		t1.[CustomerId],
		t1.[Name],
		t1.[MarketId],
		t1.[Created],
		t1.[Modified],
		t1.[Data]
	FROM @CartData t1
END
GO
PRINT N'Creating [dbo].[ecf_SerializableCart_SaveBatch]...';


GO
CREATE PROCEDURE [dbo].[ecf_SerializableCart_SaveBatch] 
	@CartData [dbo].[udttSerializableCart] READONLY
AS
BEGIN
  UPDATE SerializableCart
  SET 			
		[CustomerId] = t2.CustomerId,
		[Name] = t2.Name,
		[MarketId] = t2.MarketId,
		[Created] = t2.Created,
		[Modified] = t2.Modified,
		[Data] = t2.Data
 FROM SerializableCart t1
 INNER JOIN @CartData t2 ON t1.CartId = t2.CartId
END
GO
PRINT N'Creating [dbo].[ecfVersion_ListObsolete]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_ListObsolete]
(
	@MaxVersions INT,
    @MaxCount INT = 100
)
AS
BEGIN
	DECLARE @PreviouslyPublished TABLE
    (
        ObjectId INT, 
        LanguageName NVARCHAR(50),
        PreviouslyPublishedCount INT,
		RowNumber INT
    )

	DECLARE @ObsoleteVersions TABLE
    (
	    WorkId INT,
        ObjectId INT,
		ObjectTypeId INT,
        Name NVARCHAR(100),
        Status INT,
        StartPublish DATETIME,
		Modified DATETIME,
        ModifiedBy NVARCHAR(256),
		LanguageName NVARCHAR(50),
		MasterLanguageName NVARCHAR(50),
        IsCommonDraft BIT
    )

	INSERT INTO @PreviouslyPublished 
		SELECT ObjectId, LanguageName, COUNT(WorkId),
			ROW_NUMBER() OVER(ORDER BY ObjectId DESC) AS ROW
        FROM ecfVersion WHERE Status = 5
        GROUP BY ObjectId, LanguageName 
        HAVING COUNT(WorkId) > @MaxVersions

	DECLARE @COUNTER INT = (SELECT MAX(RowNumber) FROM @PreviouslyPublished);
	DECLARE @CURRENTVERSIONS INT;
    DECLARE @CURRENTCONTENT INT;
    DECLARE @CURRENTLANGUAGE NVARCHAR(50);

	WHILE (@COUNTER != 0 AND (SELECT COUNT(*) FROM @ObsoleteVersions) < @MaxCount)
	BEGIN
		SELECT @CURRENTVERSIONS = PreviouslyPublishedCount,
            @CURRENTCONTENT = ObjectId,
            @CURRENTLANGUAGE = LanguageName
        FROM @PreviouslyPublished WHERE RowNumber = @COUNTER

		INSERT INTO @ObsoleteVersions
		SELECT TOP(@CURRENTVERSIONS - @MaxVersions) 
            WorkId,
            ObjectId,
			ObjectTypeId,
            Name,
            Status, 
            StartPublish,
            Modified,
            ModifiedBy,
            LanguageName,
            MasterLanguageName, 
            IsCommonDraft
		FROM ecfVersion
		WHERE ObjectId = @CURRENTCONTENT AND Status = 5 AND LanguageName = @CURRENTLANGUAGE COLLATE DATABASE_DEFAULT
		ORDER BY WorkId ASC

		SET @COUNTER = @COUNTER -1
	END
	
	SELECT * FROM @ObsoleteVersions

    SELECT SUM(PreviouslyPublishedCount - @MaxVersions) AS TotalCount FROM @PreviouslyPublished
END
GO
PRINT N'Creating [dbo].[CatalogContentProperty_EnsureCultureSpecific]...';


GO
CREATE PROCEDURE [dbo].[CatalogContentProperty_EnsureCultureSpecific]
	@MetaFieldId INT,
	@CultureSpecific BIT
AS
BEGIN
	UPDATE [CatalogContentProperty]
	SET [CatalogContentProperty].CultureSpecific = @CultureSpecific
	WHERE MetaFieldId = @MetaFieldId AND CultureSpecific <> @CultureSpecific
END
GO
PRINT N'Creating [dbo].[ecfVersionProperty_EnsureCultureSpecific]...';


GO
CREATE PROCEDURE [dbo].[ecfVersionProperty_EnsureCultureSpecific]
	@MetaFieldId INT,
	@CultureSpecific BIT
AS
BEGIN
	UPDATE [ecfVersionProperty]
	SET [ecfVersionProperty].CultureSpecific = @CultureSpecific
	WHERE MetaFieldId = @MetaFieldId AND CultureSpecific <> @CultureSpecific
END
GO
PRINT N'Creating [dbo].[ecfVersionAsset_InsertForMasterLanguage]...';


GO
CREATE PROCEDURE [dbo].[ecfVersionAsset_InsertForMasterLanguage]
	@CatalogId INT
AS
BEGIN
	DELETE a
	FROM ecfVersionAsset a
		INNER JOIN ecfVersion v on a.WorkId = v.WorkId
	WHERE v.LanguageName <> v.MasterLanguageName AND v.CatalogId = @CatalogId

	MERGE ecfVersionAsset AS TARGET
	USING
	(SELECT v.WorkId, a.AssetType, a.AssetKey, a.GroupName, a.SortOrder
	FROM ecfVersion v
		INNER JOIN CatalogItemAsset a ON (v.ObjectId = a.CatalogEntryId AND v.ObjectTypeId = 0)
	WHERE v.LanguageName = v.MasterLanguageName COLLATE DATABASE_DEFAULT AND v.CatalogId = @CatalogId
		AND (v.Status = 4 OR v.IsCommonDraft = 1)) AS SOURCE (WorkId, AssetType, AssetKey, GroupName, SortOrder)
	ON 
	TARGET.WorkId = SOURCE.WorkId
		AND TARGET.AssetType = SOURCE.AssetType
		AND TARGET.AssetKey = SOURCE.AssetKey
	WHEN MATCHED THEN
		UPDATE SET GroupName = SOURCE.GroupName, SortOrder = SOURCE.SortOrder
	WHEN NOT MATCHED BY TARGET THEN
	INSERT (WorkId, AssetType, AssetKey, GroupName, SortOrder) VALUES (WorkId, AssetType, AssetKey, GroupName, SortOrder);

	MERGE ecfVersionAsset AS TARGET
	USING
	(SELECT v.WorkId, a.AssetType, a.AssetKey, a.GroupName, a.SortOrder
	FROM ecfVersion v
		INNER JOIN CatalogItemAsset a ON (v.ObjectId = a.CatalogNodeId AND v.ObjectTypeId = 1)
	WHERE v.LanguageName = v.MasterLanguageName COLLATE DATABASE_DEFAULT AND v.CatalogId = @CatalogId
		AND (v.Status = 4 OR v.IsCommonDraft = 1)) AS SOURCE (WorkId, AssetType, AssetKey, GroupName, SortOrder)
	ON 
	TARGET.WorkId = SOURCE.WorkId
		AND TARGET.AssetType = SOURCE.AssetType
		AND TARGET.AssetKey = SOURCE.AssetKey
	WHEN MATCHED THEN
		UPDATE SET GroupName = SOURCE.GroupName, SortOrder = SOURCE.SortOrder
	WHEN NOT MATCHED BY TARGET THEN
	INSERT (WorkId, AssetType, AssetKey, GroupName, SortOrder) VALUES (WorkId, AssetType, AssetKey, GroupName, SortOrder);
END
GO
PRINT N'Creating [dbo].[ecf_ReportingSalesData_Sync]...';


GO
CREATE PROCEDURE [dbo].[ecf_ReportingSalesData_Sync]
	@OrderGroupId INT,
	@OrderData [dbo].[udttOrderReportData] READONLY,
	@LineItemData [dbo].[udttLineItemReportData] READONLY
AS
BEGIN
	--Update or Insert for OrderReportData table
	MERGE INTO [dbo].[OrderReportData] AS T
	USING @OrderData AS S
	ON T.[OrderGroupId] = S.[OrderGroupId]
	WHEN MATCHED THEN
		UPDATE SET
			[OrderNumber] = S.[OrderNumber],
			[Currency] = S.[Currency],
			[CustomerId] = S.[CustomerId],
			[CustomerName] = S.[CustomerName],
			[Status] = S.[Status],
			[OrderCreated] = S.[OrderCreated],
			[MarketId] = S.[MarketId],
			[TotalQuantity] = S.[TotalQuantity],
			[TotalDiscountAmount] = S.[TotalDiscountAmount],
			[ShippingTotal] = S.[ShippingTotal],
			[HandlingTotal] =  S.[HandlingTotal],
			[TaxTotal] = S.[TaxTotal],
			[SubTotal] = S.[SubTotal],
			[Total] = S.[Total]
	WHEN NOT MATCHED BY TARGET THEN
		INSERT([OrderGroupId], [OrderNumber], [Currency], [CustomerId], [CustomerName],
			[Status], [OrderCreated], [MarketId], [TotalQuantity], [TotalDiscountAmount],
			[ShippingTotal], [HandlingTotal], [TaxTotal], [SubTotal], [Total])
		VALUES(S.[OrderGroupId], S.[OrderNumber], S.[Currency], S.[CustomerId], S.[CustomerName],
			S.[Status], S.[OrderCreated], S.[MarketId], S.[TotalQuantity], S.[TotalDiscountAmount],
			S.[ShippingTotal], S.[HandlingTotal], S.[TaxTotal], S.[SubTotal], S.[Total]);

	--Update, Insert or Delete for LineItemReportData table
	;WITH ExistingLineItems ([LineItemId], [OrderGroupId], [LineItemCode], [DisplayName], [PlacedPrice], [Quantity],
			[EntryDiscountAmount], [OrderDiscountAmount], [ExtendedPrice], [SalesTax], [OrderCreated])
			AS
			(
			SELECT [LineItemId], [OrderGroupId], [LineItemCode], [DisplayName], [PlacedPrice], [Quantity],
			[EntryDiscountAmount], [OrderDiscountAmount], [ExtendedPrice], [SalesTax], [OrderCreated]
			FROM [dbo].[LineItemReportData]
			WHERE OrderGroupId = @OrderGroupId
			)

    MERGE INTO ExistingLineItems AS T
	USING @LineItemData AS S
	ON T.[LineItemId] = S.[LineItemId]
	WHEN MATCHED THEN
		UPDATE SET
			[LineItemCode] = S.[LineItemCode],
			[DisplayName] = S.[DisplayName],
			[PlacedPrice] = S.[PlacedPrice],
			[Quantity] = S.[Quantity],
			[EntryDiscountAmount] = S.[EntryDiscountAmount],
			[OrderDiscountAmount] = S.[OrderDiscountAmount],
			[ExtendedPrice] = S.[ExtendedPrice],
			[SalesTax] = S.[SalesTax]
	WHEN NOT MATCHED BY TARGET THEN 
		INSERT([LineItemId], [OrderGroupId], [LineItemCode], [DisplayName], [PlacedPrice], [Quantity],
			[EntryDiscountAmount], [OrderDiscountAmount], [ExtendedPrice], [SalesTax], [OrderCreated])
		VALUES( S.[LineItemId], S.[OrderGroupId], S.[LineItemCode], S.[DisplayName], S.[PlacedPrice], S.[Quantity],
			S.[EntryDiscountAmount], S.[OrderDiscountAmount], S.[ExtendedPrice], S.[SalesTax], S.[OrderCreated])
	WHEN NOT MATCHED BY SOURCE
	THEN DELETE;

	RETURN 0
END
GO
PRINT N'Creating [dbo].[ecf_ReportingSalesData_DeleteByOrderGroupId]...';


GO
CREATE PROCEDURE [dbo].[ecf_ReportingSalesData_DeleteByOrderGroupId]
	@OrderGroupId int
AS
	DELETE OrderReportData
	WHERE OrderGroupId = @OrderGroupId

	DELETE LineItemReportData
	WHERE OrderGroupId = @OrderGroupId
RETURN 0
GO
PRINT N'Creating [dbo].[ecf_OrderReportData_Purge]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderReportData_Purge]	
    @FromDate DATETIME,
	@ToDate   DATETIME
AS
BEGIN
	-- Purge LineItemReportData table before insert new data.
	DELETE FROM LineItemReportData
	WHERE OrderCreated BETWEEN @FromDate AND @ToDate

    -- Purge OrderReportData table before insert new data.
	DELETE FROM OrderReportData
	WHERE OrderCreated BETWEEN @FromDate AND @ToDate
END
GO
PRINT N'Creating [dbo].[ecf_LineItemReportData_Get]...';


GO
CREATE PROCEDURE [dbo].[ecf_LineItemReportData_Get]
	@FromDate DateTime,
	@ToDate DateTime
AS
BEGIN	
	SELECT L.LineItemId, L.LineItemCode, L.DisplayName, L.PlacedPrice, L.Quantity, L.ExtendedPrice,
		L.EntryDiscountAmount, L.SalesTax, O.Currency, L.OrderGroupId, O.OrderCreated, O.OrderNumber, 
		O.CustomerId, O.CustomerName, O.MarketId
	FROM LineItemReportData L
	INNER JOIN OrderReportData O ON L.OrderGroupId = O.OrderGroupId
	WHERE L.OrderCreated BETWEEN @FromDate AND @ToDate
END
GO
PRINT N'Creating [dbo].[ecf_OrderReportData_AggregateByDay]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderReportData_AggregateByDay]
	@TimeZoneOffset DECIMAL(38, 9) = 0
AS
BEGIN
	SELECT 
		CONVERT(DATE, DATEADD(minute, @TimeZoneOffset, OrderCreated)) AS OrderCreated,
		MarketId,
		Currency,
		COUNT(OrderGroupId) AS NumOfOrders,
		SUM(TotalQuantity) AS NumOfItems,
		SUM(TaxTotal) AS TaxTotal,
		SUM(ShippingTotal) as ShippingTotal,
		SUM(HandlingTotal) as HandlingTotal,
		SUM(TotalDiscountAmount) AS DiscountsTotal,
		SUM(SubTotal) AS SubTotal,
		SUM(Total) AS Total
	FROM OrderReportData
	GROUP BY CONVERT(DATE, DATEADD(minute, @TimeZoneOffset, OrderCreated)), MarketId, Currency
	ORDER BY OrderCreated, MarketId, Currency
END
GO
PRINT N'Creating [dbo].[ecf_Inventory_DeleteInventory]...';


GO
CREATE PROCEDURE [dbo].[ecf_Inventory_DeleteInventory]
    @partialKeys [dbo].[udttInventory] READONLY
AS
BEGIN
	if (not exists (select 1 from @partialKeys k where WarehouseCode is not null))
	begin
	    delete mi
		from [dbo].[InventoryService] mi
		INNER JOIN @partialKeys k
		ON mi.CatalogEntryCode = k.CatalogEntryCode
	end
	else 
	begin
	    delete mi
	    from [dbo].[InventoryService] mi
	    where exists (
	        select 1 
	        from @partialKeys keys 
	        where mi.[CatalogEntryCode] = isnull(keys.[CatalogEntryCode], mi.[CatalogEntryCode])
	          and mi.[WarehouseCode] = isnull(keys.[WarehouseCode], mi.[WarehouseCode]))
	end
END
GO
PRINT N'Creating [dbo].[ecf_CatalogItemSeo_FindUriSegmentConflicts]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogItemSeo_FindUriSegmentConflicts]
AS
	;WITH
	GlobalDuplicates AS(
		SELECT S.*
		FROM
		CatalogItemSeo S
		INNER JOIN
			(SELECT UriSegment, LanguageCode
			FROM CatalogItemSeo
			GROUP BY UriSegment, LanguageCode COLLATE DATABASE_DEFAULT 
			HAVING COUNT(*) > 1) D
		ON D.UriSegment = S.UriSegment and D.LanguageCode = S.LanguageCode COLLATE DATABASE_DEFAULT),
	GlobalDuplicatesWithParents AS(
			SELECT
				G.*,
				COALESCE(NR.ParentNodeId, N.ParentNodeId) AS ParentNodeId,
				COALESCE(NR.CatalogId, N.CatalogId) AS CatalogId
			FROM GlobalDuplicates G
			INNER JOIN
			CatalogNode N
			ON G.CatalogNodeId = N.CatalogNodeId
			LEFT OUTER JOIN CatalogNodeRelation NR
			ON NR.ChildNodeId = N.CatalogNodeId
		UNION ALL
			SELECT
				G.*,
				NER.CatalogNodeId AS ParentNodeId,
				NER.CatalogId as CatalogId
			FROM GlobalDuplicates G
			INNER JOIN CatalogEntry E
			ON G.CatalogEntryId = E.CatalogEntryId
			LEFT OUTER JOIN NodeEntryRelation NER
			ON NER.CatalogEntryId = E.CatalogEntryId)

	SELECT GP.UriSegment, GP.LanguageCode, GP.CatalogEntryId, GP.CatalogNodeId, GP.ParentNodeId, GP.CatalogId
	FROM GlobalDuplicatesWithParents GP
	INNER JOIN
		(SELECT ParentNodeId, CatalogId, UriSegment, LanguageCode
		FROM GlobalDuplicatesWithParents
		GROUP BY ParentNodeId, CatalogId, UriSegment, LanguageCode COLLATE DATABASE_DEFAULT 
		HAVING COUNT(*) > 1) C
		ON
			GP.ParentNodeId = C.ParentNodeId AND GP.CatalogId = C.CatalogId AND
			GP.UriSegment = C.UriSegment AND GP.LanguageCode = C.LanguageCode COLLATE DATABASE_DEFAULT
GO
PRINT N'Creating [dbo].[ecf_CatalogNodeItemSeo_ValidateUriSegment]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogNodeItemSeo_ValidateUriSegment]
	@CatalogItemSeo dbo.udttCatalogItemSeo readonly
AS
	-- validate Uri segment and return invalid record
	SELECT t.[LanguageCode], t.[CatalogNodeId], t.[CatalogEntryId], t.[Uri], NULL AS [UriSegment] 
	FROM @CatalogItemSeo t
	WHERE
		t.CatalogNodeId > 0 AND dbo.fn_UriSegmentExistsOnSiblingNodeOrEntry(t.CatalogNodeId, 0, t.UriSegment, t.LanguageCode) = 1
GO
PRINT N'Creating [dbo].[CatalogContentAccess_MergeChildPermissions]...';


GO
CREATE PROCEDURE dbo.CatalogContentAccess_MergeChildPermissions
(
	@ObjectId INT,
	@ObjectTypeId INT,
	@AccessEntities dbo.[udttCatalogContentAccess] READONLY
)
AS
BEGIN
	SET NOCOUNT ON

	CREATE TABLE #ignorecontents(ObjectId INT PRIMARY KEY)
	
	IF @ObjectTypeId = 2 --in case the parent is a catalog
	BEGIN
		-- in case of MergeChildPermissions, we update ACEs only for child nodes which are set permissions (present in CatalogContentAccess table)
		INSERT INTO #ignorecontents(ObjectId)
		SELECT CatalogNodeId
		FROM CatalogNode
		WHERE CatalogId = @ObjectId AND NOT EXISTS(SELECT * FROM CatalogContentAccess WHERE ObjectId = CatalogNode.CatalogNodeId AND ObjectTypeId = 1)
		
		--delete all ACEs of all child nodes
		DELETE FROM CatalogContentAccess
		WHERE EXISTS(SELECT * FROM CatalogNode WHERE CatalogNodeId = CatalogContentAccess.ObjectId AND CatalogId = @ObjectId)
		AND ObjectTypeId = 1

		-- create new ACEs for all child nodes of @ObjectId
		INSERT INTO CatalogContentAccess(ObjectId, ObjectTypeId, Name, IsRole, AccessMask)
		SELECT node.CatalogNodeId, 1, ace.Name, ace.IsRole, ace.AccessMask
		FROM @AccessEntities ace
		INNER JOIN CatalogNode node ON node.CatalogId = @ObjectId
		WHERE NOT EXISTS(SELECT * FROM #ignorecontents WHERE ObjectId = node.CatalogNodeId)
	END
	ELSE IF @ObjectTypeId = 1 --in case the parent is a node
	BEGIN
		INSERT INTO #ignorecontents(ObjectId)
		SELECT CatalogNodeId
		FROM CatalogNode
		WHERE ParentNodeId = @ObjectId AND NOT EXISTS(SELECT * FROM CatalogContentAccess WHERE ObjectId = CatalogNode.CatalogNodeId AND ObjectTypeId = 1)

		--delete all ACEs of all child nodes
		DELETE FROM CatalogContentAccess
		WHERE EXISTS(SELECT * FROM CatalogNode WHERE CatalogNodeId = CatalogContentAccess.ObjectId AND ParentNodeId = @ObjectId)
		AND ObjectTypeId = 1

		-- create new ACEs for all child nodes of @ObjectId
		INSERT INTO CatalogContentAccess(ObjectId, ObjectTypeId, Name, IsRole, AccessMask)
		SELECT node.CatalogNodeId, 1, ace.Name, ace.IsRole, ace.AccessMask
		FROM @AccessEntities ace
		INNER JOIN CatalogNode node ON node.ParentNodeId = @ObjectId
		WHERE NOT EXISTS(SELECT * FROM #ignorecontents WHERE ObjectId = node.CatalogNodeId)
	END
END
GO
PRINT N'Creating [dbo].[CatalogContentAccess_Delete]...';


GO
CREATE PROCEDURE dbo.CatalogContentAccess_Delete
(
	@ObjectId INT,
	@ObjectTypeId INT,
	@Recursive BIT
)
AS
BEGIN
	SET NOCOUNT ON
	
	IF (@Recursive = 1)
    BEGIN
        /* Remove all old ACEs for catalog content and below */
		IF @ObjectTypeId = 2
		BEGIN
			DELETE FROM CatalogContentAccess
			WHERE ObjectId = @ObjectId AND ObjectTypeId = 2

			DELETE cca
			FROM CatalogContentAccess cca
			INNER JOIN CatalogNode node ON node.CatalogNodeId = cca.ObjectId AND node.CatalogId = @ObjectId
			WHERE cca.ObjectTypeId = 1
		END
		ELSE IF @ObjectTypeId = 1
		BEGIN
			DELETE FROM CatalogContentAccess
			WHERE ObjectId = @ObjectId AND ObjectTypeId = 1

			DELETE cca
			FROM CatalogContentAccess cca
			INNER JOIN CatalogNode node ON node.CatalogNodeId = cca.ObjectId AND node.ParentNodeId = @ObjectId
			WHERE cca.ObjectTypeId = 1
		END
    END
	ELSE
	BEGIN
		DELETE FROM CatalogContentAccess
		WHERE ObjectId = @ObjectId AND ObjectTypeId = @ObjectTypeId
	END
END
GO
PRINT N'Creating [dbo].[CatalogContentAccess_ReplaceChildPermissions]...';


GO
CREATE PROCEDURE dbo.CatalogContentAccess_ReplaceChildPermissions
(
	@ObjectId INT,
	@ObjectTypeId INT,
	@AccessEntities dbo.[udttCatalogContentAccess] READONLY
)
AS
BEGIN
	SET NOCOUNT ON

	IF @ObjectTypeId = 2 --in case the parent is a catalog
	BEGIN
		--delete all ACEs of all child nodes
		DELETE FROM CatalogContentAccess
		WHERE EXISTS(SELECT * FROM CatalogNode WHERE CatalogNodeId = CatalogContentAccess.ObjectId AND CatalogId = @ObjectId)
		AND ObjectTypeId = 1

		-- create new ACEs for all child nodes of @ObjectId
		INSERT INTO CatalogContentAccess(ObjectId, ObjectTypeId, Name, IsRole, AccessMask)
		SELECT node.CatalogNodeId, 1, ace.Name, ace.IsRole, ace.AccessMask
		FROM @AccessEntities ace
		INNER JOIN CatalogNode node ON node.CatalogId = @ObjectId
	END
	ELSE IF @ObjectTypeId = 1 --in case the parent is a node
	BEGIN
		--delete all ACEs of all child nodes
		DELETE FROM CatalogContentAccess
		WHERE EXISTS(SELECT * FROM CatalogNode WHERE CatalogNodeId = CatalogContentAccess.ObjectId AND ParentNodeId = @ObjectId)
		AND ObjectTypeId = 1

		-- create new ACEs for all child nodes of @ObjectId
		INSERT INTO CatalogContentAccess(ObjectId, ObjectTypeId, Name, IsRole, AccessMask)
		SELECT node.CatalogNodeId, 1, ace.Name, ace.IsRole, ace.AccessMask
		FROM @AccessEntities ace
		INNER JOIN CatalogNode node ON node.ParentNodeId = @ObjectId
	END
END
GO
PRINT N'Creating [dbo].[CatalogContentAccess_DeleteByUserOrRole]...';


GO
CREATE PROCEDURE dbo.CatalogContentAccess_DeleteByUserOrRole
(
	@Name NVARCHAR(255),
	@IsRole INT
)
AS
BEGIN
	SET NOCOUNT ON
	
	DELETE FROM CatalogContentAccess WHERE Name = @Name AND IsRole = @IsRole
END
GO
PRINT N'Creating [dbo].[CatalogContentAccess_Update]...';


GO
CREATE PROCEDURE dbo.CatalogContentAccess_Update
(
	@ObjectId INT,
	@ObjectTypeId INT,
	@AccessEntities dbo.[udttCatalogContentAccess] readonly
)
AS
BEGIN
	MERGE dbo.CatalogContentAccess AS TARGET
	USING @AccessEntities AS SOURCE
	ON (TARGET.ObjectId = @ObjectId AND TARGET.ObjectTypeId = @ObjectTypeId AND TARGET.Name = SOURCE.Name)
	WHEN MATCHED THEN 
		UPDATE SET IsRole = SOURCE.IsRole,
				   AccessMask = SOURCE.AccessMask
	WHEN NOT MATCHED BY TARGET THEN
		INSERT (ObjectId, ObjectTypeId, Name, IsRole, AccessMask)
		VALUES (@ObjectId, @ObjectTypeId, SOURCE.Name, SOURCE.IsRole, SOURCE.AccessMask)
	WHEN NOT MATCHED BY SOURCE 
		AND TARGET.ObjectId = @ObjectId 
		AND TARGET.ObjectTypeId = @ObjectTypeId 
	THEN DELETE;
END
GO
PRINT N'Creating [dbo].[CatalogContentAccess_Load]...';


GO
CREATE PROCEDURE dbo.CatalogContentAccess_Load
(
	@Contents [dbo].[udttObjectWorkId] READONLY
)
AS
BEGIN
	SET NOCOUNT ON

	SELECT cca.*
	FROM CatalogContentAccess cca
	INNER JOIN @Contents content ON cca.ObjectId = content.ObjectId AND cca.ObjectTypeId = content.ObjectTypeId
	ORDER BY
		cca.ObjectTypeId,
		cca.IsRole DESC,
		cca.Name
END
GO
PRINT N'Creating [dbo].[CatalogItemChange_Delete]...';


GO
CREATE PROCEDURE [dbo].[CatalogItemChange_Delete]
@Ids udttIdTable READONLY
AS
BEGIN
	DELETE CI FROM CatalogItemChange CI
	INNER JOIN @Ids IDS ON CI.CatalogEntryId = IDS.ID
	WHERE CI.IsBeingIndexed = 1
END
GO
PRINT N'Creating [dbo].[CatalogItemChange_Clear]...';


GO
CREATE PROCEDURE [dbo].[CatalogItemChange_Clear]
AS
BEGIN
	TRUNCATE TABLE CatalogItemChange
END
GO
PRINT N'Creating [dbo].[CatalogItemChange_Count]...';


GO
CREATE PROCEDURE [dbo].[CatalogItemChange_Count]
@CatalogId INT
AS
BEGIN
	DELETE ci FROM CatalogItemChange ci 
  	LEFT JOIN CatalogEntry ce ON ce.CatalogEntryId = ci.CatalogEntryId
      	WHERE ce.CatalogEntryId IS NULL

	SELECT COUNT(CatalogEntryId) FROM CatalogItemChange WHERE CatalogId = @CatalogId
END
GO
PRINT N'Creating [dbo].[CatalogItemChange_Load]...';


GO
CREATE PROCEDURE [dbo].[CatalogItemChange_Load]
@CatalogId INT
AS
BEGIN
	DECLARE @EntryIds [udttIdTable]
	UPDATE TOP (10000) CatalogItemChange SET IsBeingIndexed = 1
	OUTPUT inserted.CatalogEntryId INTO @EntryIds WHERE CatalogId = @CatalogId
	SELECT ID FROM @EntryIds
END
GO
PRINT N'Creating [dbo].[CatalogItemChange_Insert]...';


GO
CREATE PROCEDURE [dbo].[CatalogItemChange_Insert]
@EntryIds [udttIdTable]  READONLY
AS
BEGIN
	MERGE INTO CatalogItemChange AS TARGET  
	USING (SELECT
		C.ID, CE.CatalogId
	FROM @EntryIds C
	INNER JOIN CatalogEntry CE ON C.ID = CE.CatalogEntryId)
		   AS SOURCE (CatalogEntryId, CatalogId)  
	ON 
		TARGET.CatalogEntryId = SOURCE.CatalogEntryId 
		AND TARGET.CatalogId = SOURCE.CatalogId
		AND TARGET.IsBeingIndexed = 0

	WHEN NOT MATCHED BY TARGET THEN  
		INSERT (CatalogEntryId, CatalogId, IsBeingIndexed) VALUES (CatalogEntryId, CatalogId, 0);
END
GO
PRINT N'Creating [dbo].[ecf_Search_Payment]...';


GO
CREATE PROCEDURE [dbo].[ecf_Search_Payment]
    @results udttOrderGroupId readonly
AS
BEGIN

DECLARE @search_condition nvarchar(max)

-- Return Order Form Payment Collection

CREATE TABLE #OrderSearchResults (PaymentId int)
insert into #OrderSearchResults (PaymentId) select PaymentId from OrderFormPayment P INNER JOIN @results R ON R.OrderGroupId = P.OrderGroupId

SET @search_condition = N'''INNER JOIN OrderFormPayment O ON O.PaymentId = T.ObjectId INNER JOIN #OrderSearchResults R ON O.PaymentId = R.PaymentId '''

DECLARE @parentmetaclassid int
DECLARE @rowNum int
DECLARE @maxrows int
DECLARE @tablename nvarchar(120)
DECLARE @procedurefull nvarchar(max)

SET @parentmetaclassid = (SELECT MetaClassId from [MetaClass] WHERE [Name] = N'OrderFormPayment' and TableName = N'OrderFormPayment')

DECLARE @PaymentClasses TABLE
(
  query nvarchar(max),
  RowIndex int
)

INSERT INTO @PaymentClasses 
SELECT query = N'mdpsp_avto_' + TableName + N'_Search NULL, ' + N'''''''' + TableName + N''''''+  ' TableName, [O].*'' ,'  + @search_condition,
ROW_NUMBER() OVER (ORDER BY MetaClassId)
FROM [MetaClass] 
WHERE ParentClassId = @parentmetaclassid

SET @rowNum = 1
SET @maxrows = (SELECT COUNT(RowIndex) FROM @PaymentClasses)

WHILE @rowNum <= @maxrows
BEGIN 
	SELECT @procedurefull = query FROM @PaymentClasses WHERE RowIndex = @rowNum
	EXEC (@procedurefull)
	SET @rowNum = @rowNum + 1
END


DROP TABLE #OrderSearchResults

END
GO
PRINT N'Creating [dbo].[ecfVersion_UpdateSeoByObjectIds]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_UpdateSeoByObjectIds]
	@ObjectIds udttObjectWorkId readonly
AS
BEGIN
	DECLARE @WorkIds TABLE (WorkId INT)
	INSERT INTO @WorkIds (WorkId)
		SELECT ver.WorkId
		FROM ecfVersion ver
		INNER JOIN @ObjectIds c ON ver.ObjectId = c.ObjectId AND ver.ObjectTypeId = c.ObjectTypeId
		WHERE (ver.Status = 4)
	UNION
		SELECT ver.WorkId
		FROM ecfVersion ver
		INNER JOIN @ObjectIds c ON ver.ObjectId = c.ObjectId AND ver.ObjectTypeId = c.ObjectTypeId
		WHERE (ver.IsCommonDraft = 1 AND 
		NOT EXISTS(SELECT 1 FROM ecfVersion ev WHERE ev.ObjectId = c.ObjectId AND ev.ObjectTypeId = c.ObjectTypeId AND ev.Status = 4 ))
	
	--update entry versions
	UPDATE ver 
	SET ver.SeoUri = s.Uri,
	    ver.SeoUriSegment = s.UriSegment
	FROM ecfVersion ver
	INNER JOIN @WorkIds ids ON ver.WorkId = ids.WorkId
	INNER JOIN CatalogItemSeo s ON (s.CatalogEntryId = ver.ObjectId AND ver.ObjectTypeId = 0)
	WHERE s.LanguageCode = ver.LanguageName COLLATE DATABASE_DEFAULT
	
	--update node versions
	UPDATE ver 
	SET ver.SeoUri = s.Uri,
	    ver.SeoUriSegment = s.UriSegment
	FROM ecfVersion ver
	INNER JOIN @WorkIds ids on ver.WorkId = ids.WorkId
	INNER JOIN CatalogItemSeo s ON (s.CatalogNodeId = ver.ObjectId AND ver.ObjectTypeId = 1)
	WHERE s.LanguageCode = ver.LanguageName COLLATE DATABASE_DEFAULT
END
GO
PRINT N'Creating [dbo].[ecfVersion_IsNonPublishedContent]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_IsNonPublishedContent]
(
	@WorkId INT,
    @ObjectId INT,
	@ObjectTypeId INT,
	@LanguageName NVARCHAR(50) = NULL,
	@Result BIT OUTPUT
)
AS
BEGIN	
	SET NOCOUNT ON

	DECLARE @TempResult TABLE(WorkId INT, [Status] INT, IsCommonDraft BIT)
	INSERT INTO @TempResult (WorkId, [Status], IsCommonDraft)
	SELECT WorkId, [Status], IsCommonDraft 
	FROM dbo.ecfVersion vn
	INNER JOIN CatalogLanguage cl ON vn.CatalogId = cl.CatalogId AND vn.LanguageName = cl.LanguageCode COLLATE DATABASE_DEFAULT
	WHERE ObjectId = @ObjectId
	  AND ObjectTypeId = @ObjectTypeId
	  AND (@LanguageName IS NULL OR (LanguageName = @LanguageName COLLATE DATABASE_DEFAULT))

	IF NOT EXISTS (SELECT 1 FROM @TempResult WHERE [Status] = 4)
	   AND EXISTS (SELECT 1 FROM @TempResult WHERE IsCommonDraft = 1 AND WorkId = @WorkId)
	BEGIN
		SET @Result = 1
	END
	ELSE
	BEGIN
		SET @Result = 0
	END
END
GO
PRINT N'Creating [dbo].[ecfVersion_ListByContentId]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_ListByContentId]
	@ObjectId int,
	@ObjectTypeId int
AS
BEGIN
	SELECT WorkId, ObjectId, ObjectTypeId, Name, LanguageName, MasterLanguageName, IsCommonDraft, StartPublish, ModifiedBy, Modified, [Status]
	FROM dbo.ecfVersion v
	INNER JOIN CatalogLanguage cl ON v.CatalogId = cl.CatalogId AND v.LanguageName = cl.LanguageCode COLLATE DATABASE_DEFAULT
	WHERE v.ObjectId = @ObjectId 
	AND v.ObjectTypeId = @ObjectTypeId 
END
GO
PRINT N'Creating [dbo].[ecf_ApplicationLog_DeletedEntries]...';


GO
CREATE PROCEDURE [dbo].[ecf_ApplicationLog_DeletedEntries]
	@lastBuild datetime  
AS
BEGIN

SELECT [ObjectKey]
	  ,[ObjectType]
	  ,[Username]
	  ,[Created]
  FROM [dbo].[ApplicationLog]
  WHERE 
  ObjectType = 'entry' 
  AND Source = 'catalog'
  AND Operation = 'Deleted'
  AND Created > @lastBuild

END
GO
PRINT N'Creating [dbo].[PromotionInformationGetOrders]...';


GO
CREATE PROCEDURE [dbo].[PromotionInformationGetOrders]
	@ContentGuidList [dbo].[udttContentGuidList] READONLY
AS
BEGIN
	SELECT P.PromotionGuid, COUNT(F.OrderGroupId) AS OrderGroupCount
	FROM PromotionInformation P
		INNER JOIN OrderForm F ON F.OrderFormId = P.OrderFormId 
		INNER JOIN @ContentGuidList C ON C.ContentGuid = P.PromotionGuid
	WHERE P.IsRedeemed = 1 AND P.IsReturnOrderForm = 0
	GROUP BY P.PromotionGuid
	UNION
	SELECT NULL, COUNT(DISTINCT(F.OrderGroupId)) AS OrderGroupCount
	FROM PromotionInformation P
		INNER JOIN OrderForm F ON F.OrderFormId = P.OrderFormId
		INNER JOIN @ContentGuidList C ON C.ContentGuid = P.PromotionGuid
	WHERE P.IsRedeemed = 1 AND P.IsReturnOrderForm = 0
END
GO
PRINT N'Creating [dbo].[ecf_SerializableCart_Save]...';


GO
CREATE PROCEDURE [dbo].[ecf_SerializableCart_Save]
	@CartId INT,
	@CustomerId UNIQUEIDENTIFIER,
	@Name NVARCHAR(128),
    @MarketId NVARCHAR(16),
	@Created DATETIME,
	@Modified DATETIME,
	@Data NVARCHAR(MAX)
AS
BEGIN
	IF(@CartId <= 0)
	BEGIN
		IF NOT EXISTS ( SELECT 1 FROM SerializableCart WHERE  
			Name = @Name COLLATE DATABASE_DEFAULT AND 
			CustomerId = @CustomerId AND 
			MarketId = @MarketId COLLATE DATABASE_DEFAULT)
			BEGIN
				INSERT INTO SerializableCart(CustomerId, Name, MarketId, Created, Modified, [Data])
				VALUES (@CustomerId, @Name, @MarketId, @Created, @Modified, @Data)

				SET @CartId = SCOPE_IDENTITY();
			END
		ELSE
			SET @CartId = -1;
	END
	ELSE
	BEGIN
		UPDATE SerializableCart
		SET 			
			CustomerId = @CustomerId,
			Name = @Name,
            MarketId = @MarketId,
			Created = @Created,
			Modified = @Modified,
			[Data] = @Data
		WHERE CartId = @CartId
	END

	SELECT @CartId
END
GO
PRINT N'Creating [dbo].[ecf_SerializableCart_Delete]...';


GO
CREATE PROCEDURE [dbo].[ecf_SerializableCart_Delete]
	@CartId INT
AS
BEGIN
	DELETE FROM SerializableCart WHERE CartId = @CartId
END
GO
PRINT N'Creating [dbo].[ecf_SerializableCart_FindCarts]...';


GO
CREATE PROCEDURE [dbo].[ecf_SerializableCart_FindCarts]
	@CartId INT = NULL,
	@CustomerId UNIQUEIDENTIFIER = NULL,
	@Name NVARCHAR (128) = NULL,
    @MarketId NVARCHAR (16) = NULL,
	@CreatedFrom DateTime = NULL,
	@CreatedTo DateTime = NULL,
	@ModifiedFrom DateTime = NULL,
	@ModifiedTo DateTime = NULL,
	@StartingRecord INT = NULL,
	@RecordsToRetrieve INT = NULL,
	@TotalRecords INT OUTPUT,
	@ExcludeName NVARCHAR (1024) = NULL,
	@ReturnTotalCount BIT
AS
BEGIN
	DECLARE @CountQuery nvarchar(4000);
	DECLARE @query nvarchar(4000);
	SET @query = 'SELECT CartId, Created, Modified, [Data] FROM SerializableCart WHERE 1 = 1 '

	IF (@CartId IS NOT NULL)
	BEGIN
	SET @query = @query + ' AND CartId = @CartId '
	END
	IF (@CustomerId IS NOT NULL)
	BEGIN
	SET @query = @query + ' AND CustomerId = @CustomerId '
	END
	IF (@Name IS NOT NULL)
	BEGIN
	SET @query = @query + ' AND Name = @Name '
	END
	IF (@ExcludeName IS NOT NULL)
	BEGIN
	SET @query = @query + ' AND Name NOT IN (' + @ExcludeName + ') '
	END
	IF (@MarketId IS NOT NULL)
	BEGIN
	SET @query = @query + ' AND MarketId = @MarketId '
	END
	IF (@CreatedFrom IS NOT NULL)
	BEGIN
	SET @query = @query + ' AND Created >= @CreatedFrom '
	END
	IF (@CreatedTo IS NOT NULL)
	BEGIN
	SET @query = @query + ' AND Created <= @CreatedTo '
	END
	IF (@ModifiedFrom IS NOT NULL)
	BEGIN
	SET @query = @query + ' AND Modified >= @ModifiedFrom '
	END
	IF (@ModifiedTo IS NOT NULL)
	BEGIN
	SET @query = @query + ' AND Modified <= @ModifiedTo '
	END

	SET @CountQuery = N'SET @TotalRecords = (Select COUNT(1) FROM (' + @query + ') AS CountTable)'

	SET @query = @query +
	' ORDER BY Modified DESC
        OFFSET '  + CAST(@StartingRecord AS NVARCHAR(50)) + '  ROWS 
        FETCH NEXT ' + CAST(@RecordsToRetrieve AS NVARCHAR(50)) + ' ROWS ONLY'

	exec sp_executesql @query, 
	N'@CartId INT,
	@CustomerId UNIQUEIDENTIFIER,
	@Name nvarchar(128),
	@ExcludeName nvarchar(128),
    @MarketId nvarchar(16),
	@CreatedFrom DateTime,
	@CreatedTo DateTime,
	@ModifiedFrom DateTime,
	@ModifiedTo DateTime,
	@StartingRecord INT,
	@RecordsToRetrieve INT',
	@CartId = @CartId, @CustomerId= @CustomerId, @Name=@Name, @ExcludeName = @ExcludeName, @MarketId = @MarketId,
	@CreatedFrom = @CreatedFrom, @CreatedTo=@CreatedTo, @ModifiedFrom=@ModifiedFrom, @ModifiedTo=@ModifiedTo, 
	@StartingRecord = @StartingRecord, @RecordsToRetrieve =@RecordsToRetrieve

	-- Execute for record count
	IF (@ReturnTotalCount = 1)
	BEGIN
		exec sp_executesql @CountQuery,
		N'@CartId INT,
		@CustomerId UNIQUEIDENTIFIER,
		@Name nvarchar(128),
		@ExcludeName nvarchar(128),
	    @MarketId nvarchar(16),
		@CreatedFrom DateTime,
		@CreatedTo DateTime,
		@ModifiedFrom DateTime,
		@ModifiedTo DateTime,
		@TotalRecords INT OUTPUT',
		@CartId = @CartId, @CustomerId= @CustomerId, @Name=@Name, @ExcludeName = @ExcludeName, @MarketId = @MarketId,
		@CreatedFrom = @CreatedFrom, @CreatedTo=@CreatedTo, @ModifiedFrom=@ModifiedFrom, @ModifiedTo=@ModifiedTo,
		@TotalRecords = @TotalRecords OUTPUT
	END
	ELSE 
	BEGIN
		SET @TotalRecords = 0
	END
END
GO
PRINT N'Creating [dbo].[ecf_SerializableCart_Load]...';


GO
CREATE PROCEDURE [dbo].[ecf_SerializableCart_Load]
	@CartId INT = NULL,
	@CustomerId UNIQUEIDENTIFIER = NULL,
	@Name NVARCHAR (128) = NULL
AS
BEGIN
	if (@CartId IS NOT NULL AND @CartId > 0)
	BEGIN
		SELECT CartId, Created, Modified, [Data]
		FROM SerializableCart
		WHERE CartId = @CartId
	END
	ELSE
	BEGIN
		SELECT CartId, Created, Modified, [Data]
		FROM SerializableCart
		WHERE
			CustomerId = @CustomerId
			AND (@Name IS NULL OR Name = @Name)
	END
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_MetaFieldAllowNulls]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_MetaFieldAllowNulls]
    @MetaFieldId int,
    @AllowNulls bit
as
begin
    set nocount on

    if not exists (select 1 from MetaField where MetaFieldId = @MetaFieldId)
    begin
        raiserror('The specified meta field does not exists or is a system field.', 16, 1)
    end
    else
    begin
		if @AllowNulls = 0 and
			exists (select 1 from MetaField f where f.MetaFieldId = @MetaFieldId AND f.AllowNulls = 1) and
			exists (select 1 from MetaClassMetaFieldRelation r where r.MetaFieldId = @MetaFieldId and [dbo].[mdpfn_sys_IsCatalogMetaClass](r.MetaClassId) = 0)
		begin
			raiserror('Switching AllowNulls to 0 is only supported for catalog meta fields.', 16, 1)
		end
		else
		begin
			update MetaField
			set AllowNulls = @AllowNulls
			where MetaFieldId = @MetaFieldId
		end
    end
end
GO
PRINT N'Creating [dbo].[ecfVersion_ListFiltered]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_ListFiltered]
(
    @ObjectId INT = NULL,
    @ObjectTypeId INT = NULL,
    @ModifiedBy NVARCHAR(255) = NULL,
    @Languages [udttLanguageCode] READONLY,
    @Statuses [udttIdTable] READONLY,
    @StartIndex INT,
    @MaxRows INT
)
AS

BEGIN    
    SET NOCOUNT ON

    DECLARE @StatusCount INT
    SELECT @StatusCount = COUNT(*) FROM @Statuses

    DECLARE @LanguageCount INT
    SELECT @LanguageCount = COUNT(*) FROM @Languages

    DECLARE @query NVARCHAR(2000)

    SET @query = ''
 
    -- Build WHERE clause, only add the condition if specified
    DECLARE @Where NVARCHAR(1000) = ' FROM ecfVersion vn INNER JOIN CatalogLanguage cl ON vn.CatalogId = cl.CatalogId AND vn.LanguageName = cl.LanguageCode COLLATE DATABASE_DEFAULT WHERE 1 = 1 '
    IF @ObjectId IS NOT NULL
    SET @Where = @Where + ' AND ObjectId  = @ObjectId '
    IF @ObjectTypeId IS NOT NULL
    SET @Where = @Where + ' AND ObjectTypeId = @ObjectTypeId '
    IF @ModifiedBy IS NOT NULL
    SET @Where = @Where + ' AND ModifiedBy = @ModifiedBy '

    -- Optimized for case where only one Status or LanguageName is specified
    -- Otherwise SQL Server will use join even if we are querying for only one Status or Language (most common cases), which is ineffecient
    IF @StatusCount > 1
    BEGIN
    SET @Where = @Where + ' AND [Status] IN (SELECT ID FROM @Statuses) '
    END
    ELSE IF @StatusCount = 1
    BEGIN
    SET @Where = @Where + ' AND [Status] = (SELECT TOP (1) ID FROM @Statuses) '
    END
    IF @LanguageCount > 1
    BEGIN
    SET @Where = @Where + ' AND [LanguageName] IN (SELECT LanguageCode FROM @Languages) '
    END
    ELSE IF @LanguageCount = 1
    BEGIN
    SET @Where = @Where + ' AND [LanguageName] IN (SELECT TOP (1) LanguageCode FROM @Languages) '
    END

    SET @query = @Where

    DECLARE @filter NVARCHAR(2000)

    SET @filter = 'SELECT COUNT(WorkId) AS TotalRows ' + @query

    IF (@MaxRows > 0)
    BEGIN
        SET @filter = @filter + 
        ';SELECT WorkId, ObjectId, ObjectTypeId, Name, LanguageName, MasterLanguageName, IsCommonDraft, StartPublish, ModifiedBy, Modified, [Status] '
        + @query +
        ' ORDER BY  Modified DESC
        OFFSET '  + CAST(@StartIndex AS NVARCHAR(50)) + '  ROWS 
        FETCH NEXT ' + CAST(@MaxRows AS NVARCHAR(50)) + ' ROWS ONLY';
    END

    EXEC sp_executesql @filter,
    N'@ObjectId int, @ObjectTypeId int, @ModifiedBy nvarchar(255), @Statuses [udttIdTable] READONLY, @Languages [udttLanguageCode] READONLY',
    @ObjectId = @ObjectId, @ObjectTypeId = @ObjectTypeId, @ModifiedBy = @ModifiedBy, @Statuses = @Statuses, @Languages = @Languages
     
END
GO
PRINT N'Creating [dbo].[PromotionInformationLoad]...';


GO
CREATE PROCEDURE [dbo].[PromotionInformationLoad]
    @OrderGroupIds udttOrderGroupId readonly
AS
BEGIN
	DECLARE @PromotionInformation [udttPromotionInformation];
	
	INSERT INTO @PromotionInformation
			(PromotionInformationId,
			 OrderFormId,
			 PromotionGuid,
			 Description,
			 RewardType,
			 Name,
			 DiscountType,
			 CouponCode,
			 AdditionalInformation,
			 VisitorGroup,
			 CustomerId,
			 OrderLevelSavedAmount,
			 IsRedeemed)
	SELECT 
		   PromotionInformationId,
		   p.OrderFormId,
		   PromotionGuid,
		   Description,
		   RewardType,
		   p.Name,
		   DiscountType,
		   CouponCode,
		   AdditionalInformation,
		   VisitorGroup,
		   CustomerId,
		   OrderLevelSavedAmount,
		   IsRedeemed
	FROM dbo.PromotionInformation p
	INNER JOIN dbo.OrderForm f ON p.OrderFormId = f.OrderFormId
	INNER JOIN @OrderGroupIds r on f.OrderGroupId = r.OrderGroupId
	
	SELECT 'PromotionInformation' TableName, p.* FROM @PromotionInformation p

	SELECT 'PromotionInformationEntry' TableName,
		i.PromotionInformationId,
		e.EntryCode,
		e.SavedAmount
	FROM PromotionInformationEntry e
	INNER JOIN @PromotionInformation i ON e.PromotionInformationId = i.PromotionInformationId

	SELECT 'PromotionInformationShipment' TableName,
		i.PromotionInformationId,
		s.ShippingMethodId,
		s.OrderAddressName,
		s.ShippingMethodName,
		s.SavedAmount
	FROM PromotionInformationShipment s
	INNER JOIN @PromotionInformation i ON s.PromotionInformationId = i.PromotionInformationId
END
GO
PRINT N'Creating [dbo].[ecf_OrderGroup_InsertForShoppingCart]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderGroup_InsertForShoppingCart]
(
	@OrderGroupId int OUT,
	@InstanceId UNIQUEIDENTIFIER,
	@AffiliateId UNIQUEIDENTIFIER,
	@Name nvarchar(64) = NULL,
	@CustomerId UNIQUEIDENTIFIER,
	@CustomerName nvarchar(64) = NULL,
	@AddressId nvarchar(50) = NULL,
	@ShippingTotal DECIMAL (38, 9),
	@HandlingTotal DECIMAL (38, 9),
	@TaxTotal DECIMAL (38, 9),
	@SubTotal DECIMAL (38, 9),
	@Total DECIMAL (38, 9),
	@BillingCurrency nvarchar(64) = NULL,
	@Status nvarchar(64) = NULL,
	@ProviderId nvarchar(255) = NULL,
	@SiteId nvarchar(255) = NULL,
	@OwnerOrg nvarchar(255) = NULL,
	@Owner nvarchar(255) = NULL,
	@MarketId nvarchar(8),
	@Epi_MarketName nvarchar(50),
	@Epi_PricesIncludeTax bit = 0
)
AS
BEGIN

	SET NOCOUNT OFF
	DECLARE @Err int
	set transaction isolation level serializable
	begin transaction
		IF NOT EXISTS (SELECT 1 
			from [OrderGroup_ShoppingCart] with (updlock)
			join [OrderGroup] with (updlock) on OrderGroupId = ObjectId 
			where [CustomerId] = @CustomerId 
				and Name = @Name COLLATE DATABASE_DEFAULT 
				and MarketId = @MarketId COLLATE DATABASE_DEFAULT ) 
				and @OrderGroupId is null
			begin
				INSERT
				INTO [OrderGroup]
				(
					[InstanceId],
					[AffiliateId],
					[Name],
					[CustomerId],
					[CustomerName],
					[AddressId],
					[ShippingTotal],
					[HandlingTotal],
					[TaxTotal],
					[SubTotal],
					[Total],
					[BillingCurrency],
					[Status],
					[ProviderId],
					[SiteId],
					[OwnerOrg],
					[Owner],
					[MarketId],
					[Epi_MarketName],
					[Epi_PricesIncludeTax]
				)
				VALUES
				(
					@InstanceId,
					@AffiliateId,
					@Name,
					@CustomerId,
					@CustomerName,
					@AddressId,
					@ShippingTotal,
					@HandlingTotal,
					@TaxTotal,
					@SubTotal,
					@Total,
					@BillingCurrency,
					@Status,
					@ProviderId,
					@SiteId,
					@OwnerOrg,
					@Owner,
					@MarketId,
					@Epi_MarketName,
					@Epi_PricesIncludeTax
				)
				SELECT @OrderGroupId = SCOPE_IDENTITY()
			end
	commit
	SET @Err = @@Error

	RETURN @Err
END
GO
PRINT N'Creating [dbo].[PromotionInformationGetRedemptions]...';


GO
CREATE PROCEDURE [dbo].[PromotionInformationGetRedemptions]
	@PromotionGuids [dbo].[udttContentGuidList] READONLY,
	@CustomerId UNIQUEIDENTIFIER = NULL,
	@ExcludeOrderFormId INT = NULL
AS
BEGIN

	IF @CustomerId IS NULL
		BEGIN
			SELECT p.PromotionGuid, COUNT(*) AS TotalRedemptions, 0 AS CustomerRedemptions 
			FROM PromotionInformation p
			INNER JOIN @PromotionGuids g on p.PromotionGuid = g.ContentGuid
			WHERE IsRedeemed = 1 AND IsReturnOrderForm = 0
			GROUP BY p.PromotionGuid;
		END
	ELSE
		BEGIN
			WITH CTE (PromotionGuid, TotalRedemptions)
				AS
				(SELECT p.PromotionGuid, COUNT(*) AS TotalRedemptions
				FROM PromotionInformation p
				INNER JOIN @PromotionGuids g on p.PromotionGuid = g.ContentGuid
				AND (p.OrderFormId != @ExcludeOrderFormId OR @ExcludeOrderFormId IS NULL) 
				AND IsRedeemed = 1 AND IsReturnOrderForm = 0
				GROUP BY p.PromotionGuid)

			SELECT PromotionLevel.PromotionGuid AS PromotionGuid, TotalRedemptions = PromotionLevel.TotalRedemptions, COUNT(CustomerId) AS CustomerRedemptions
			FROM dbo.PromotionInformation AS CustomerLevel 
			RIGHT JOIN CTE AS PromotionLevel 
			ON CustomerLevel.PromotionGuid = PromotionLevel.PromotionGuid AND CustomerLevel.CustomerId = @CustomerId
			AND IsRedeemed = 1 AND IsReturnOrderForm = 0
			AND CustomerLevel.OrderFormId != @ExcludeOrderFormId
			GROUP BY PromotionLevel.PromotionGuid, PromotionLevel.TotalRedemptions;

		END
END
GO
PRINT N'Creating [dbo].[ecf_GetCatalogNodeIdsByCodes]...';


GO
CREATE PROCEDURE [dbo].[ecf_GetCatalogNodeIdsByCodes]
	@CatalogCodes udttCatalogCodeId READONLY
AS
BEGIN
	SELECT n.Code, n.CatalogNodeId from [CatalogNode] n
	INNER JOIN @CatalogCodes k ON n.Code = k.Code
END
GO
PRINT N'Creating [dbo].[ecf_GetCatalogNodeCodesByIds]...';


GO
CREATE PROCEDURE [dbo].[ecf_GetCatalogNodeCodesByIds]
	@CatalogIds udttCatalogCodeId READONLY
AS
BEGIN
	SELECT n.Code, n.CatalogNodeId from [CatalogNode] n
	INNER JOIN @CatalogIds k ON n.CatalogNodeId = k.ObjectId
END
GO
PRINT N'Creating [dbo].[ecf_GetCatalogEntryIdsByCodes]...';


GO
CREATE PROCEDURE [dbo].[ecf_GetCatalogEntryIdsByCodes]
	@CatalogCodes udttCatalogCodeId READONLY
AS
BEGIN
	SELECT e.Code, e.CatalogEntryId from [CatalogEntry] e
	INNER JOIN @CatalogCodes k ON e.Code = k.Code
END
GO
PRINT N'Creating [dbo].[ecf_GetCatalogEntryCodesByIds]...';


GO
CREATE PROCEDURE [dbo].[ecf_GetCatalogEntryCodesByIds]
	@CatalogIds udttCatalogCodeId READONLY
AS
BEGIN
	SELECT e.Code, e.CatalogEntryId from [CatalogEntry] e
	INNER JOIN @CatalogIds k  ON e.CatalogEntryId = k.ObjectId
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_SaveMultiValueDictionary]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_SaveMultiValueDictionary]
	@MetaKey INT,
	@DictionaryValues dbo.[udttIdTable] READONLY
AS
	SET NOCOUNT ON

	MERGE INTO MetaMultiValueDictionary AS TARGET
	USING (SELECT @MetaKey AS MetaKey, V.ID AS MetaDictionaryId FROM @DictionaryValues V) AS SOURCE
	ON (TARGET.MetaKey = SOURCE.MetaKey AND TARGET.MetaDictionaryId = SOURCE.MetaDictionaryId)
	WHEN NOT MATCHED THEN
		INSERT (MetaKey, MetaDictionaryId) VALUES (SOURCE.MetaKey, SOURCE.MetaDictionaryId);

	DELETE TARGET
	FROM MetaMultiValueDictionary TARGET
	WHERE TARGET.MetaKey = @MetaKey AND NOT EXISTS (SELECT 1 FROM @DictionaryValues WHERE ID = TARGET.MetaDictionaryId)
GO
PRINT N'Creating [dbo].[mdpsp_sys_SaveMetaStringDictionary]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_SaveMetaStringDictionary]
	@MetaKey INT,
	@DictionaryValues dbo.[udttMetaStringDictionaryValues] READONLY
AS
	SET NOCOUNT ON
	
	MERGE INTO MetaStringDictionaryValue AS TARGET
	USING (SELECT @MetaKey as MetaKey, V.[Key], V.Value FROM @DictionaryValues V) AS SOURCE
	ON (TARGET.MetaKey = SOURCE.MetaKey AND TARGET.[Key] = SOURCE.[Key])
	WHEN MATCHED
		THEN UPDATE SET TARGET.Value = SOURCE.Value
	WHEN NOT MATCHED THEN
		INSERT (MetaKey, [Key], Value) VALUES (SOURCE.MetaKey, SOURCE.[Key], SOURCE.Value);

	DELETE TARGET
	FROM MetaStringDictionaryValue TARGET
	WHERE TARGET.MetaKey = @MetaKey AND NOT EXISTS (SELECT 1 FROM @DictionaryValues WHERE [Key] = TARGET.[Key])
GO
PRINT N'Creating [dbo].[ecf_CatalogContentTypeGetUsage]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogContentTypeGetUsage]
	@MetaClassName nvarchar(256),
	@OnlyPublished	BIT = 0
AS
BEGIN
	IF (@MetaClassName = 'CatalogContent')
	BEGIN
		SELECT c.Name, c.CatalogId ObjectId, 2 ObjectTypeId, l.LanguageCode LanguageName FROM Catalog c
		INNER JOIN CatalogLanguage l ON l.CatalogId = c.CatalogId
		WHERE @OnlyPublished = 0 OR c.IsActive = 1
	END
	ELSE 
	BEGIN
		DECLARE @MetaClassTemp TABLE (MetaClassId INT)
		INSERT INTO @MetaClassTemp 
		SELECT MetaClassId FROM MetaClass
		WHERE Name = @MetaClassName
			
		SELECT n.Name, CatalogNodeId ObjectId, 1 ObjectTypeId, l.LanguageCode LanguageName FROM CatalogNode n
		INNER JOIN CatalogLanguage l ON l.CatalogId = n.CatalogId
		INNER JOIN @MetaClassTemp  mc ON n.MetaClassId = mc.MetaClassId
		LEFT JOIN CatalogContentProperty p ON p.ObjectId = n.CatalogNodeId AND p.ObjectTypeId = 1
		WHERE @OnlyPublished = 0 OR (n.IsActive = 1  AND (p.Boolean = 1 OR p.Boolean is null)) AND p.MetaFieldName = 'Epi_IsPublished'
		UNION ALL
		SELECT e.Name, CatalogEntryId ObjectId, 0 ObjectTypeId, l.LanguageCode LanguageName FROM CatalogEntry e
		INNER JOIN CatalogLanguage l ON l.CatalogId = e.CatalogId
		INNER JOIN @MetaClassTemp  mc ON e.MetaClassId = mc.MetaClassId
		LEFT JOIN CatalogContentProperty p ON p.ObjectId = e.CatalogEntryId AND p.ObjectTypeId = 0
		WHERE @OnlyPublished = 0 OR (e.IsActive = 1  AND (p.Boolean = 1 OR p.Boolean is null)) AND p.MetaFieldName = 'Epi_IsPublished'
	END
END
GO
PRINT N'Creating [dbo].[ecf_CatalogContentTypeIsUsed]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogContentTypeIsUsed]
	@MetaClassName nvarchar(256)
AS
BEGIN
	DECLARE @CatalogUsed INT, @NodeUsed INT, @EntryUsed INT

	IF (@MetaClassName = 'CatalogContent')
	BEGIN
		SELECT @CatalogUsed = COUNT(*) FROM Catalog c 
		RETURN @CatalogUsed
	END
	ELSE 
	BEGIN
		DECLARE @MetaClassTemp TABLE (MetaClassId INT)
		INSERT INTO @MetaClassTemp 
		SELECT MetaClassId FROM MetaClass
		WHERE Name = @MetaClassName
			
		SELECT @NodeUsed = COUNT(*) FROM CatalogNode n
		INNER JOIN @MetaClassTemp  mc ON n.MetaClassId = mc.MetaClassId
				
		SELECT @EntryUsed = COUNT(*) FROM CatalogEntry e
		INNER JOIN @MetaClassTemp  mc ON e.MetaClassId = mc.MetaClassId
		
		RETURN @NodeUsed + @EntryUsed
	END
END
GO
PRINT N'Creating [dbo].[ecf_PropertyDefinitionIsUsed]...';


GO
CREATE PROCEDURE [dbo].[ecf_PropertyDefinitionIsUsed]
	@PropertyName nvarchar(256)
AS
BEGIN
	DECLARE @MetaClassTemp TABLE (MetaClassId INT)    
	INSERT INTO @MetaClassTemp
	SELECT DISTINCT r.MetaClassId 
	FROM MetaField mf 
			INNER JOIN MetaClassMetaFieldRelation r ON mf.MetaFieldId = r.MetaFieldId
			WHERE mf.Name = @PropertyName

	DECLARE @NodeUsed INT, @EntryUsed INT
	
	SELECT @NodeUsed = COUNT(*) FROM CatalogNode n INNER JOIN @MetaClassTemp mc ON n.MetaClassId = mc.MetaClassId	
	SELECT @EntryUsed = COUNT(*) FROM CatalogEntry e INNER JOIN @MetaClassTemp mc ON e.MetaClassId = mc.MetaClassId

	RETURN @NodeUsed + @EntryUsed
END
GO
PRINT N'Creating [dbo].[ecf_PropertyDefinitionGetUsage]...';


GO
CREATE PROCEDURE [dbo].[ecf_PropertyDefinitionGetUsage]
	@PropertyName nvarchar(256),
	@OnlyNoneMasterLanguage	BIT = 0,
	@OnlyPublished	BIT = 0
AS
BEGIN
	DECLARE @MetaClassTemp TABLE (MetaClassId INT)    
	INSERT INTO @MetaClassTemp
	SELECT DISTINCT r.MetaClassId 
	FROM MetaField mf 
			INNER JOIN MetaClassMetaFieldRelation r ON mf.MetaFieldId = r.MetaFieldId
			WHERE mf.Name = @PropertyName

	DECLARE @Languages TABLE (CatalogId INT, LanguageName NVARCHAR(100))
	INSERT INTO @Languages
	SELECT c.CatalogId, l.LanguageCode LanguageName FROM Catalog c
				INNER JOIN CatalogLanguage l ON c.CatalogId = l.CatalogId
				WHERE (@OnlyNoneMasterLanguage = 0 OR l.LanguageCode <> c.DefaultLanguage)

	IF (@OnlyPublished = 0)
		BEGIN	
			SELECT n.Name, CatalogNodeId ObjectId, 1 ObjectTypeId, l.LanguageName FROM CatalogNode n
			INNER JOIN @Languages l ON n.CatalogId = l.CatalogId
			INNER JOIN @MetaClassTemp mc ON n.MetaClassId = mc.MetaClassId
			UNION ALL
			SELECT e.Name, CatalogEntryId ObjectId, 0 ObjectTypeId, l.LanguageName FROM CatalogEntry e
			INNER JOIN @Languages l ON e.CatalogId = l.CatalogId
			INNER JOIN @MetaClassTemp mc ON e.MetaClassId = mc.MetaClassId
		END
	ELSE
		BEGIN
			SELECT n.Name, CatalogNodeId ObjectId, 1 ObjectTypeId, l.LanguageName FROM CatalogNode n
			INNER JOIN @Languages l ON n.CatalogId = l.CatalogId
			INNER JOIN @MetaClassTemp mc ON n.MetaClassId = mc.MetaClassId
			LEFT JOIN CatalogContentProperty p ON n.CatalogNodeId = p.ObjectId AND p.ObjectTypeId = 1 
			WHERE (n.IsActive = 1  AND ((p.Boolean = 1 AND p.MetaFieldName = 'Epi_IsPublished') OR (p.MetaFieldName is null AND p.Boolean is null))) 
			UNION ALL
			SELECT e.Name, CatalogEntryId ObjectId, 0 ObjectTypeId, l.LanguageName FROM CatalogEntry e
			INNER JOIN @Languages l ON e.CatalogId = l.CatalogId
			INNER JOIN @MetaClassTemp mc ON e.MetaClassId = mc.MetaClassId
			LEFT JOIN CatalogContentProperty p ON e.CatalogEntryId = p.ObjectId AND p.ObjectTypeId = 1
			WHERE (e.IsActive = 1  AND ((p.Boolean = 1 AND p.MetaFieldName = 'Epi_IsPublished') OR (p.MetaFieldName is null AND p.Boolean is null))) 
		END
END
GO
PRINT N'Creating [dbo].[mc_OrderGroupNotesUpdate]...';


GO
CREATE PROCEDURE [dbo].[mc_OrderGroupNotesUpdate]
@OrderGroupId int,
@OrderGroupNotes udttOrderGroupNote readonly
AS
BEGIN
SET NOCOUNT ON;

;WITH CTE AS
(SELECT * FROM dbo.OrderGroupNote 
WHERE OrderGroupId = @OrderGroupId)

MERGE CTE AS T
USING @OrderGroupNotes AS S
ON T.OrderNoteId = S.OrderNoteId

WHEN NOT MATCHED BY TARGET
	THEN INSERT (
		[OrderGroupId],
		[CustomerId],
		[Title],
		[Type],
		[Detail],
		[Created],
		[LineItemId],
		[Channel],
		[EventType])
	VALUES(S.OrderGroupId,
		S.CustomerId,
		S.Title,
		S.Type,
		S.Detail,
		S.Created,
		S.LineItemId,
		S.Channel,
		S.EventType)
WHEN NOT MATCHED BY SOURCE
	THEN DELETE
WHEN MATCHED AND (S.IsModified = 1) THEN 
UPDATE SET
	[OrderGroupId] = S.OrderGroupId,
	[CustomerId] = S.CustomerId,
	[Title] = S.Title,
	[Type] = S.Type,
	[Detail] = S.Detail,
	[Created] = S.Created,
	[LineItemId] = S.LineItemId,
	[Channel] = S.Channel,
	[EventType] = S.EventType;
END
GO
PRINT N'Creating [dbo].[ecf_CatalogNode_ChildEntryCount]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogNode_ChildEntryCount]
	@CatalogId int = 0
AS
SELECT ParentNodeId, COUNT(*) AS ChildCount
FROM
	(SELECT
		R.CatalogNodeId AS ParentNodeId, R.CatalogEntryId
	FROM
		NodeEntryRelation R
		INNER JOIN CatalogNode N on N.CatalogNodeId = R.CatalogNodeId
	WHERE
		N.CatalogId = @CatalogId

	UNION ALL

	SELECT
		0 AS ParentNodeId, E.CatalogEntryId
	FROM
		CatalogEntry E
	WHERE
		NOT EXISTS (SELECT 1 FROM NodeEntryRelation R WHERE R.CatalogEntryId = E.CatalogEntryId)
		AND E.CatalogId = @CatalogId
	) temp
GROUP BY ParentNodeId
GO
PRINT N'Creating [dbo].[ecf_CatalogNode_ChildNodeCount]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogNode_ChildNodeCount]
	@CatalogId int = 0
AS
SELECT temp.ParentNodeId, COUNT(*) AS ChildCount FROM
	(SELECT ParentNodeId, CatalogNodeId as ChildNodeId FROM CatalogNode WHERE CatalogId = @CatalogId
		UNION
	SELECT ParentNodeId, ChildNodeId FROM CatalogNodeRelation WHERE CatalogId = @CatalogId) AS temp
GROUP BY ParentNodeId
GO
PRINT N'Creating [dbo].[CatalogContent_GetDefaultIndividualPublishStatus]...';


GO
CREATE PROCEDURE [dbo].[CatalogContent_GetDefaultIndividualPublishStatus]
	@ObjectId int,
	@ObjectTypeId int
AS
BEGIN
	IF @ObjectTypeId = 0
		SELECT IsActive Epi_IsPublished, StartDate Epi_StartPublish, EndDate Epi_StopPublish FROM CatalogEntry WHERE CatalogEntryId = @ObjectId
	ELSE IF @ObjectTypeId = 1
		SELECT IsActive Epi_IsPublished, StartDate Epi_StartPublish, EndDate Epi_StopPublish FROM CatalogNode WHERE CatalogNodeId = @ObjectId
END
GO
PRINT N'Creating [dbo].[ecfVersion_ListMatchingSegments]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_ListMatchingSegments]
	@ParentId INT,
	@CatalogId INT,
	@SeoUriSegment NVARCHAR(255)
AS
BEGIN
	SELECT v.ObjectId, v.ObjectTypeId, v.WorkId, v.LanguageName, v.CatalogId
	FROM ecfVersion v
		INNER JOIN CatalogEntry e on e.CatalogEntryId = v.ObjectId
		LEFT OUTER JOIN NodeEntryRelation r ON v.ObjectId = r.CatalogEntryId
		INNER JOIN CatalogLanguage cl ON v.CatalogId = cl.CatalogId AND v.LanguageName = cl.LanguageCode COLLATE DATABASE_DEFAULT
	WHERE
		v.SeoUriSegment = @SeoUriSegment AND v.ObjectTypeId = 0 
		AND
			((r.CatalogNodeId = @ParentId AND (r.CatalogId = @CatalogId OR @CatalogId = 0))
			OR
			(@ParentId = 0 AND r.CatalogNodeId IS NULL AND (e.CatalogId = @CatalogId OR @CatalogId = 0)))

	UNION ALL

	SELECT v.ObjectId, v.ObjectTypeId, v.WorkId, v.LanguageName, v.CatalogId
	FROM ecfVersion v
		INNER JOIN CatalogNode n ON v.ObjectId = n.CatalogNodeId
		INNER JOIN CatalogLanguage cl ON v.CatalogId = cl.CatalogId AND v.LanguageName = cl.LanguageCode COLLATE DATABASE_DEFAULT
		LEFT OUTER JOIN CatalogNodeRelation nr on v.ObjectId = nr.ChildNodeId
	WHERE
		v.SeoUriSegment = @SeoUriSegment AND v.ObjectTypeId = 1
		AND
			((n.ParentNodeId = @ParentId AND (n.CatalogId = @CatalogId OR @CatalogId = 0))
			OR
			(nr.ParentNodeId = @ParentId AND (nr.CatalogId = @CatalogId OR @CatalogId = 0)))
END
GO
PRINT N'Creating [dbo].[ecf_Shipment_Get]...';


GO
CREATE PROCEDURE [dbo].[ecf_Shipment_Get]
(
	@SqlWhereClause				nvarchar(max),
	@OrderByClause 				nvarchar(max),
	@StartingRec				int,
	@NumRecords					int,
	@RecordCount				int OUTPUT
)
AS
BEGIN
	Declare @FullQuery nvarchar(max)

	if (LEN(@OrderByClause) = 0)
	begin
		set @OrderByClause = ' [Shipment].ShipmentId DESC '
	end

	SET @FullQuery = N'SELECT ShipmentId, OrderGroupId, COUNT(ShipmentId) OVER() TotalRecords, ROW_NUMBER() OVER(ORDER BY ' + @OrderByClause + N') RowNumber
	FROM dbo.Shipment'

	if (LEN(@SqlWhereClause) > 0)
	begin
		set @FullQuery = @FullQuery + N' WHERE ' + @SqlWhereClause
	end

	SET @FullQuery = N'WITH SearchedResults AS (' + @FullQuery +') 
	INSERT INTO @Page_temp
	SELECT TOP(' + CAST(@NumRecords AS NVARCHAR(50)) + ')
		ShipmentId, OrderGroupId, TotalRecords 
	FROM SearchedResults
	WHERE RowNumber > ' + CAST(@StartingRec AS NVARCHAR(50)) + ' '

	SET @FullQuery = N'DECLARE @Page_temp table (ShipmentId int, OrderGroupId int, TotalRecords int);
	' + @FullQuery + ';
	SELECT @RecordCount = TotalRecords FROM @Page_temp;
	SELECT ShipmentId, OrderGroupId FROM @Page_temp'

	EXEC sp_executesql @FullQuery, N'@RecordCount int output', @RecordCount = @RecordCount OUTPUT

END
GO
PRINT N'Creating [dbo].[ecfVersion_DeleteByObjectIds]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_DeleteByObjectIds]
	@ObjectIds udttObjectWorkId readonly,
	@DeleteOnlyPublishedVersions BIT
AS
BEGIN
	-- Get affected meta keys, this needs to be done before deleting rows in ecfVersion
	DECLARE @AffectedMetaKeys TABLE (MetaClassId INT, MetaObjectId INT, WorkId INT)
	
	INSERT INTO @AffectedMetaKeys
	SELECT T.MetaClassId, V.ObjectId, V.WorkId
	FROM ecfVersion V
		INNER JOIN
		(SELECT CatalogEntryId AS ObjectId, 0 AS ObjectTypeId, MetaClassId FROM CatalogEntry
			UNION ALL
		SELECT CatalogNodeId AS ObjectId, 1 AS ObjectTypeId, MetaClassId FROM CatalogNode) T
		ON V.ObjectId = T.ObjectId AND V.ObjectTypeId = T.ObjectTypeId
		INNER JOIN @ObjectIds I
		ON I.ObjectId = V.ObjectId AND I.ObjectTypeId = V.ObjectTypeId
	WHERE (@DeleteOnlyPublishedVersions = 1 AND V.Status = 4) OR (@DeleteOnlyPublishedVersions = 0)

	--When deleting content draft, it will delete automatically Asset, SEO, Property, Variation, Catalog draft by Cascade
	DELETE v FROM ecfVersion v
	INNER JOIN @ObjectIds i
		ON i.ObjectId = v.ObjectId AND i.ObjectTypeId = v.ObjectTypeId
	WHERE (@DeleteOnlyPublishedVersions = 1 AND v.Status = 4) OR (@DeleteOnlyPublishedVersions = 0)

	-- Delete data for all reference type meta fields (dictionaries etc)
	CREATE TABLE #MetaKeysToRemove (MetaKey INT)
	INSERT INTO #MetaKeysToRemove (MetaKey)
		SELECT MK.MetaKey FROM  @AffectedMetaKeys A
		INNER JOIN MetaKey MK
		ON 
		MK.MetaObjectId = A.MetaObjectId AND
		MK.MetaClassId = A.MetaClassId AND
		MK.WorkId = A.WorkId

	IF EXISTS (SELECT 1 FROM #MetaKeysToRemove)
	BEGIN
		-- Delete MetaObjectValue
		DELETE MO FROM MetaObjectValue MO INNER JOIN #MetaKeysToRemove M ON MO.MetaKey = M.MetaKey
		
		-- Delete MetaStringDictionaryValue
		DELETE MSD FROM MetaStringDictionaryValue MSD INNER JOIN #MetaKeysToRemove M ON MSD.MetaKey = M.MetaKey 
		
		--Delete MetaMultiValueDictionary
		DELETE MV FROM MetaMultiValueDictionary MV INNER JOIN #MetaKeysToRemove M ON MV.MetaKey = M.MetaKey
		
		--Delete MetaFileValue
		DELETE MF FROM MetaFileValue MF INNER JOIN #MetaKeysToRemove M ON MF.MetaKey = M.MetaKey
		
		--Delete MetaKey
		DELETE MK FROM MetaKey MK INNER JOIN #MetaKeysToRemove M ON MK.MetaKey = M.MetaKey		
	END
END
GO
PRINT N'Creating [dbo].[ecf_CheckExistEntryNodeByCode]...';


GO
CREATE PROCEDURE [dbo].[ecf_CheckExistEntryNodeByCode]
	@EntryNodeCode nvarchar(100)
AS
BEGIN
	DECLARE @exist BIT
	SET @exist = 0
	IF EXISTS (SELECT * FROM [CatalogEntry] WHERE Code = @EntryNodeCode COLLATE DATABASE_DEFAULT)
	BEGIN
		SET @exist = 1
	END
	
	IF @exist = 0 AND EXISTS (SELECT * FROM [CatalogNode] WHERE Code = @EntryNodeCode COLLATE DATABASE_DEFAULT)
	BEGIN
		SET @exist = 1
	END

	SELECT @exist
END
GO
PRINT N'Creating [dbo].[ecfVersion_Create]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_Create]
	@Versions dbo.udttVersion READONLY
AS
BEGIN
	DECLARE @WorkIds dbo.udttObjectWorkId

	INSERT	INTO ecfVersion(
		ObjectId,
		LanguageName,
		MasterLanguageName,
		[Status],
		StartPublish,
		Name,
		Code,
		IsCommonDraft,
		CreatedBy,
		Created,
		Modified,
		ModifiedBy,
		ObjectTypeId,
		CatalogId,
		StopPublish,
		SeoUri,
		SeoTitle,
		SeoDescription,
		SeoKeywords,
		SeoUriSegment)
		OUTPUT NULL, NULL, inserted.WorkId, NULL INTO @WorkIds
	SELECT	
		ObjectId, 
		LanguageName, 
		MasterLanguageName,
		[Status], 
		StartPublish, 
		Name, 
		Code, 
		IsCommonDraft,
		CreatedBy,
		Created,
		Modified, 
		ModifiedBy, 
		ObjectTypeId,
		CatalogId,
		StopPublish,
		SeoUri,
		SeoTitle,
		SeoDescription,
		SeoKeywords,
		SeoUriSegment
	FROM	@Versions AS d

	SELECT * FROM @WorkIds
END
GO
PRINT N'Creating [dbo].[CatalogNode_FindParentId]...';


GO
CREATE PROCEDURE [dbo].[CatalogNode_FindParentId]
	@NodeIds	[dbo].[udttIdTable] READONLY
AS
BEGIN
	SELECT n.CatalogNodeId, n.ParentNodeId FROM CatalogNode n INNER JOIN @NodeIds i ON n.CatalogNodeId = i.ID
END
GO
PRINT N'Creating [dbo].[CatalogContentEx_Save]...';


GO
CREATE PROCEDURE [dbo].[CatalogContentEx_Save]
	@Data dbo.[udttCatalogContentEx] readonly
AS
BEGIN
	MERGE dbo.CatalogContentEx AS TARGET
	USING @Data AS SOURCE
	On (TARGET.ObjectId = SOURCE.ObjectId AND TARGET.ObjectTypeId = SOURCE.ObjectTypeId)
	WHEN MATCHED THEN 
		UPDATE SET CreatedBy = SOURCE.CreatedBy,
				   Created = SOURCE.Created,
				   ModifiedBy = SOURCE.ModifiedBy,
				   Modified = SOURCE.Modified
	WHEN NOT MATCHED THEN
		INSERT (ObjectId, ObjectTypeId, CreatedBy, Created, ModifiedBy, Modified)
		VALUES (SOURCE.ObjectId, SOURCE.ObjectTypeId, SOURCE.CreatedBy, SOURCE.Created, SOURCE.ModifiedBy, SOURCE.Modified);
END
GO
PRINT N'Creating [dbo].[CatalogContentEx_Load]...';


GO
CREATE PROCEDURE [dbo].[CatalogContentEx_Load]
	@ObjectId int,
	@ObjectTypeId int
AS
BEGIN
	SELECT * FROM dbo.CatalogContentEx 
	WHERE ObjectId = @ObjectId AND ObjectTypeId = @ObjectTypeId
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_CreateMetaClassView]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_CreateMetaClassView]
	@ViewName NVARCHAR(256),
	@MetaClassId INT,
	@ColumnMappings dbo.[udttMetaFieldMapping] readonly
AS
BEGIN
	-- Create meta class view only if the meta class table does not exist
	-- If the table does exist, it means that it still has data that was not migrated.

	IF EXISTS (SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'dbo' AND TABLE_TYPE = 'BASE TABLE' AND TABLE_NAME = @ViewName)
			OR EXISTS (SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'dbo' AND TABLE_TYPE = 'BASE TABLE' AND TABLE_NAME = @ViewName + '_Localization')
	BEGIN
		RETURN
	END

	DECLARE @Script NVARCHAR(MAX)
	DECLARE @ScriptLocalization NVARCHAR(MAX)
	DECLARE @MetaFieldName NVARCHAR(256)
	DECLARE @DataTypeName NVARCHAR(256)
	DECLARE @ColumnExpression NVARCHAR(MAX)
	
	SET @Script = 'IF EXISTS (SELECT * FROM sys.views WHERE name =''' + @ViewName + ''') DROP VIEW [dbo].[' + @ViewName + ']'
	SET @ScriptLocalization = 'IF EXISTS (SELECT * FROM sys.views WHERE name =''' + @ViewName + '_Localization'') DROP VIEW [dbo].[' + @ViewName + '_Localization]'
	
	EXEC (@Script)
	EXEC (@ScriptLocalization)

	SET @Script = 'CREATE VIEW [dbo].[' + @ViewName + '] AS '
	SET @ScriptLocalization = 'CREATE VIEW [dbo].[' + @ViewName + '_Localization] AS '
	
	SET @Script = @Script + ' SELECT C.ObjectId, E.CreatedBy as CreatorId, E.Created, E.ModifiedBy as ModifierId, E.Modified '
	SET @ScriptLocalization = @ScriptLocalization + ' SELECT C.ObjectId, E.CreatedBy as CreatorId, E.Created, E.ModifiedBy as ModifierId, E.Modified, C.LanguageName as [Language] '
	
	DECLARE columns_cursor CURSOR LOCAL FAST_FORWARD FOR
		SELECT MetaFieldName, DataTypeName FROM @ColumnMappings

	OPEN columns_cursor
	FETCH NEXT FROM columns_cursor INTO @MetaFieldName, @DataTypeName

	WHILE @@FETCH_STATUS = 0
	BEGIN
		SET @ColumnExpression = CASE WHEN @DataTypeName = 'Boolean' THEN 'CONVERT(INT,[' + @DataTypeName + '])' ELSE '[' + @DataTypeName + ']' END
		SET @Script = @Script + ', MAX(CASE WHEN MetaFieldName = ''' + @MetaFieldName + ''' THEN ' + @ColumnExpression + ' ELSE NULL END) as [' + @MetaFieldName + '] '
		SET @ScriptLocalization = @ScriptLocalization + ', MAX(CASE WHEN MetaFieldName = ''' + @MetaFieldName + ''' THEN ' + @ColumnExpression + ' ELSE NULL END) as [' + @MetaFieldName + '] '

	FETCH NEXT FROM columns_cursor INTO @MetaFieldName, @DataTypeName
	END

	CLOSE columns_cursor
	DEALLOCATE columns_cursor

	SET @Script = @Script + ' FROM [dbo].[CatalogContentProperty] C INNER JOIN [dbo].[CatalogContentEx] E ON C.ObjectId = E.ObjectId AND C.ObjectTypeId = E.ObjectTypeId '
	SET @ScriptLocalization = @ScriptLocalization + ' FROM [dbo].[CatalogContentProperty] C INNER JOIN [dbo].[CatalogContentEx] E ON C.ObjectId = E.ObjectId AND C.ObjectTypeId = E.ObjectTypeId '
	
	SET @Script = @Script + ' GROUP BY C.ObjectId, C.MetaClassId, E.CreatedBy, E.Created, E.ModifiedBy, E.Modified HAVING C.MetaClassId = ' + CAST(@MetaClassId AS VARCHAR)
	SET @ScriptLocalization = @ScriptLocalization + ' GROUP BY C.ObjectId, C.MetaClassId, E.CreatedBy, E.Created, E.ModifiedBy, E.Modified, C.LanguageName HAVING C.MetaClassId = ' + CAST(@MetaClassId AS VARCHAR)
	
	EXEC (@Script)
	EXEC (@ScriptLocalization)
END
GO
PRINT N'Creating [dbo].[ecfVersionCatalog_ListByWorkIds]...';


GO
CREATE PROCEDURE [dbo].[ecfVersionCatalog_ListByWorkIds]
	@ContentLinks dbo.udttObjectWorkId readonly
AS
BEGIN
	-- master language version should load catalog info directly from ecfVersionCatalog table
	SELECT 
		c.WorkId,
		c.DefaultCurrency,
		c.WeightBase,
		c.LengthBase,
		c.DefaultLanguage,
		c.Languages,
		c.IsPrimary,
		c.[Owner]		 
	FROM ecfVersionCatalog c
	INNER JOIN @ContentLinks l 	ON l.WorkId = c.WorkId
	INNER JOIN ecfVersion v ON v.WorkId = l.WorkId
	WHERE v.LanguageName = v.MasterLanguageName COLLATE DATABASE_DEFAULT

	UNION ALL

	-- non-master language version should fall-back to published-master content
	SELECT 
		v.WorkId,
		c.DefaultCurrency,
		c.WeightBase,
		c.LengthBase,
		c.DefaultLanguage,
		[dbo].fn_JoinCatalogLanguages(c.CatalogId) AS Languages,
		c.IsPrimary,
		c.[Owner]		 
	FROM [Catalog] c
	INNER JOIN @ContentLinks l ON c.CatalogId = l.ObjectId AND l.ObjectTypeId = 2
	INNER JOIN ecfVersion v ON v.WorkId = l.WorkId
	INNER JOIN CatalogLanguage cl ON cl.CatalogId = c.CatalogId AND cl.LanguageCode = v.LanguageName COLLATE DATABASE_DEFAULT
	WHERE v.LanguageName <> v.MasterLanguageName COLLATE DATABASE_DEFAULT
	ORDER BY WorkId
END
GO
PRINT N'Creating [dbo].[ecfVersionCatalog_Save]...';


GO
CREATE PROCEDURE [dbo].[ecfVersionCatalog_Save]
	@VersionCatalogs dbo.[udttVersionCatalog] readonly,
	@PublishAction bit
AS
BEGIN
	MERGE dbo.ecfVersionCatalog AS TARGET
	USING @VersionCatalogs AS SOURCE
	ON (TARGET.WorkId = SOURCE.WorkId)
	WHEN MATCHED THEN 
		UPDATE SET DefaultCurrency = SOURCE.DefaultCurrency,
				   WeightBase = SOURCE.WeightBase,
				   LengthBase = SOURCE.LengthBase,
				   DefaultLanguage = SOURCE.DefaultLanguage,
				   Languages = SOURCE.Languages,
				   IsPrimary = SOURCE.IsPrimary,
				   [Owner] = SOURCE.[Owner]
	WHEN NOT MATCHED THEN
		INSERT (WorkId, DefaultCurrency, WeightBase, LengthBase, DefaultLanguage, Languages, IsPrimary, [Owner])
		VALUES (SOURCE.WorkId, SOURCE.DefaultCurrency, SOURCE.WeightBase, SOURCE.LengthBase, SOURCE.DefaultLanguage, SOURCE.Languages, SOURCE.IsPrimary, SOURCE.[Owner])
	;

	IF @PublishAction = 1
	BEGIN
		-- Gets versions which had updated on DefaultLanguage or Languages, that will be used to update versions related to them when publishing a catalog.
		DECLARE @WorkIds TABLE (WorkId INT, DefaultLanguage NVARCHAR(20), Languages NVARCHAR(4000))
		INSERT INTO @WorkIds(WorkId, DefaultLanguage, Languages)
		SELECT v.WorkId, v.DefaultLanguage, v.Languages
		FROM @VersionCatalogs v

		DECLARE @NumberVersions INT, @CatalogId INT, @MasterLanguageName NVARCHAR(20), @Languages NVARCHAR(4000)
		SELECT @NumberVersions = COUNT(*) FROM @WorkIds

		IF @NumberVersions = 1 -- This is the most regular case, so we can do in different way without cursor so that can gain performance
		BEGIN
			DECLARE @WorkId INT
			
			SELECT TOP 1 @WorkId = WorkId, @MasterLanguageName = DefaultLanguage, @Languages = Languages FROM @WorkIds
			SELECT @CatalogId = ObjectId FROM ecfVersion WHERE WorkId = @WorkId

			UPDATE d SET 
				d.DefaultLanguage = @MasterLanguageName
			FROM ecfVersionCatalog d
			INNER JOIN ecfVersion v ON d.WorkId = v.WorkId
			WHERE v.ObjectTypeId = 2 AND v.ObjectId = @CatalogId AND d.DefaultLanguage <> @MasterLanguageName

			UPDATE ecfVersion SET 
				MasterLanguageName = @MasterLanguageName
			WHERE CatalogId = @CatalogId AND MasterLanguageName <> @MasterLanguageName
		END
		ELSE
		BEGIN
			DECLARE @Catalogs udttObjectWorkId

			INSERT INTO @Catalogs(ObjectId, ObjectTypeId, LanguageName, WorkId)
			SELECT c.ObjectId, c.ObjectTypeId, w.DefaultLanguage, c.WorkId
			FROM ecfVersion c 
			INNER JOIN @WorkIds w ON c.WorkId = w.WorkId
			WHERE c.ObjectTypeId = 2
			-- Note that @Catalogs.LanguageName is @WorkIds.DefaultLanguage
			
			DECLARE @ObjectIdsTemp TABLE(ObjectId INT)
			DECLARE catalogCursor CURSOR FOR SELECT DISTINCT ObjectId FROM @Catalogs
		
			OPEN catalogCursor  
			FETCH NEXT FROM catalogCursor INTO @CatalogId
		
			WHILE @@FETCH_STATUS = 0  
			BEGIN
				SELECT @MasterLanguageName = v.DefaultLanguage
				FROM @VersionCatalogs v
				INNER JOIN @Catalogs c ON c.WorkId = v.WorkId
				WHERE c.ObjectId = @CatalogId
						
				-- when publishing a Catalog, we need to update all drafts to have the same DefaultLanguage as the published one.
				UPDATE d SET 
					d.DefaultLanguage = @MasterLanguageName
				FROM ecfVersionCatalog d
				INNER JOIN ecfVersion v ON d.WorkId = v.WorkId
				WHERE v.ObjectTypeId = 2 AND v.ObjectId = @CatalogId AND d.DefaultLanguage <> @MasterLanguageName
			
				-- and also update MasterLanguageName of contents that's related to Catalog
				-- catalogs
				UPDATE ecfVersion SET 
					MasterLanguageName = @MasterLanguageName
				WHERE CatalogId = @CatalogId AND MasterLanguageName <> @MasterLanguageName
				
				FETCH NEXT FROM catalogCursor INTO @CatalogId
			END
		
			CLOSE catalogCursor  
			DEALLOCATE catalogCursor;  
		END
	END
END
GO
PRINT N'Creating [dbo].[ecfVersionVariation_ListByWorkIds]...';


GO
CREATE PROCEDURE [dbo].[ecfVersionVariation_ListByWorkIds]
	@ContentLinks dbo.udttObjectWorkId readonly
AS
BEGIN
	
	-- master language version should load variation info directly from ecfVersionVariation table
	SELECT
		va.WorkId,
		va.TaxCategoryId,
		va.TrackInventory,
		va.[Weight],
		va.MinQuantity,
		va.MaxQuantity,
		va.[Length],
		va.Height,
		va.Width,
		va.PackageId 
	FROM ecfVersionVariation va
	INNER JOIN @ContentLinks links ON va.WorkId = links.WorkId
	INNER JOIN ecfVersion ve ON ve.WorkId = links.WorkId
	WHERE ve.LanguageName = ve.MasterLanguageName COLLATE DATABASE_DEFAULT

	UNION ALL

	-- non-master language version should fall-back to published-master content
	SELECT 
		v.WorkId,
		va.TaxCategoryId,
		va.TrackInventory,
		va.[Weight],
		va.MinQuantity,
		va.MaxQuantity,
		va.[Length],
		va.Height,
		va.Width,
		va.PackageId  
	FROM Variation AS va
	INNER JOIN @ContentLinks links ON va.CatalogEntryId = links.ObjectId AND links.ObjectTypeId = 0
	INNER JOIN ecfVersion v ON v.WorkId = links.WorkId
	WHERE v.LanguageName <> v.MasterLanguageName COLLATE DATABASE_DEFAULT
	ORDER BY WorkId
	
END
GO
PRINT N'Creating [dbo].[ecfVersionVariation_Save]...';


GO
CREATE PROCEDURE [dbo].[ecfVersionVariation_Save]
	@Variants dbo.[udttVariantDraft] readonly
AS
BEGIN
	MERGE dbo.ecfVersionVariation AS target
	USING @Variants as source
	On (target.WorkId = source.WorkId)
	WHEN MATCHED THEN 
		UPDATE SET 
			TaxCategoryId = source.TaxCategoryId, 
			TrackInventory = source.TrackInventory,
			[Weight] = source.[Weight], 
			MinQuantity = source.MinQuantity, 
			MaxQuantity = source.MaxQuantity,
			[Length] = source.[Length], 
			Height = source.Height, 
			Width = source.Width,
			PackageId = source.PackageId
	WHEN NOT MATCHED THEN
		INSERT (WorkId, TaxCategoryId, TrackInventory, [Weight], MinQuantity, MaxQuantity, [Length], Height, Width, PackageId)
		VALUES (source.WorkId, source.TaxCategoryId, source.TrackInventory, source.[Weight], source.MinQuantity, source.MaxQuantity, source.[Length], source.Height, source.Width, source.PackageId);
END
GO
PRINT N'Creating [dbo].[ecfVersion_DeleteByObjectId]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_DeleteByObjectId]
	@ObjectId [int],
	@ObjectTypeId [int]
AS
BEGIN
	-- Get affected meta keys, this needs to be done before deleting rows in ecfVersion
	DECLARE @AffectedMetaKeys TABLE (MetaClassId INT, MetaObjectId INT, WorkId INT)

	INSERT INTO @AffectedMetaKeys
	SELECT T.MetaClassId, V.ObjectId, V.WorkId
	FROM ecfVersion V
		INNER JOIN
		(SELECT CatalogEntryId AS ObjectId, 0 AS ObjectTypeId, MetaClassId FROM CatalogEntry
			UNION ALL
		SELECT CatalogNodeId AS ObjectId, 1 AS ObjectTypeId, MetaClassId FROM CatalogNode) T
		ON V.ObjectId = T.ObjectId AND V.ObjectTypeId = T.ObjectTypeId
	 WHERE V.ObjectId = @ObjectId AND V.ObjectTypeId = @ObjectTypeId

	--When deleting content draft, it will delete automatically Asset, SEO, Property, Variation, Catalog draft by Cascade
	DELETE FROM ecfVersion
	WHERE ObjectId = @ObjectId AND ObjectTypeId = @ObjectTypeId

	CREATE TABLE #MetaKeysToRemove (MetaKey INT)
	INSERT INTO #MetaKeysToRemove (MetaKey)
		SELECT MK.MetaKey FROM  @AffectedMetaKeys A
		INNER JOIN MetaKey MK
		ON 
		MK.MetaObjectId = A.MetaObjectId AND
		MK.MetaClassId = A.MetaClassId AND
		MK.WorkId = A.WorkId

	IF EXISTS (SELECT 1 FROM #MetaKeysToRemove)
	BEGIN
		-- Delete MetaObjectValue
		DELETE MO FROM MetaObjectValue MO INNER JOIN #MetaKeysToRemove M ON MO.MetaKey = M.MetaKey
		
		-- Delete MetaStringDictionaryValue
		DELETE MSD FROM MetaStringDictionaryValue MSD INNER JOIN #MetaKeysToRemove M ON MSD.MetaKey = M.MetaKey 
		
		--Delete MetaMultiValueDictionary
		DELETE MV FROM MetaMultiValueDictionary MV INNER JOIN #MetaKeysToRemove M ON MV.MetaKey = M.MetaKey
		
		--Delete MetaFileValue
		DELETE MF FROM MetaFileValue MF INNER JOIN #MetaKeysToRemove M ON MF.MetaKey = M.MetaKey
		
		--Delete MetaKey
		DELETE MK FROM MetaKey MK INNER JOIN #MetaKeysToRemove M ON MK.MetaKey = M.MetaKey		
	END
END
GO
PRINT N'Creating [dbo].[ecfVersionAsset_Save]...';


GO
CREATE PROCEDURE [dbo].[ecfVersionAsset_Save]
	@WorkIds dbo.[udttObjectWorkId] readonly,
	@ContentDraftAsset dbo.[udttCatalogContentAsset] readonly
AS
BEGIN
	DELETE A
	FROM ecfVersionAsset A
	INNER JOIN @WorkIds W on W.WorkId = A.WorkId

	INSERT INTO ecfVersionAsset 
	SELECT * FROM @ContentDraftAsset
END
GO
PRINT N'Creating [dbo].[ecfVersionAsset_ListByWorkIds]...';


GO
CREATE PROCEDURE [dbo].[ecfVersionAsset_ListByWorkIds]
	@ContentLinks dbo.udttObjectWorkId readonly
AS
BEGIN
	-- master language version should load asset directly from ecfVersionAsset table
	SELECT Asset.WorkId, Asset.AssetType, Asset.AssetKey, Asset.GroupName, Asset.SortOrder 
	FROM ecfVersionAsset AS Asset
		INNER JOIN @ContentLinks links ON Asset.WorkId = links.WorkId
		INNER JOIN ecfVersion v ON v.WorkId = links.WorkId
	WHERE v.LanguageName = v.MasterLanguageName COLLATE DATABASE_DEFAULT

	UNION ALL

	-- non-master language version should fall-back to published-master content
	SELECT links.WorkId, Asset.AssetType, Asset.AssetKey, Asset.GroupName, Asset.SortOrder 
	FROM CatalogItemAsset AS Asset
		INNER JOIN @ContentLinks links ON Asset.CatalogEntryId = links.ObjectId AND links.ObjectTypeId = 0
		INNER JOIN ecfVersion v ON v.WorkId = links.WorkId
	WHERE v.LanguageName <> v.MasterLanguageName COLLATE DATABASE_DEFAULT
	UNION ALL
	SELECT links.WorkId, Asset.AssetType, Asset.AssetKey, Asset.GroupName, Asset.SortOrder 
	FROM CatalogItemAsset AS Asset
		INNER JOIN @ContentLinks links ON Asset.CatalogNodeId = links.ObjectId AND links.ObjectTypeId = 1
		INNER JOIN ecfVersion v ON v.WorkId = links.WorkId
	WHERE v.LanguageName <> v.MasterLanguageName COLLATE DATABASE_DEFAULT
		AND Asset.CatalogNodeId > 0

	ORDER BY WorkId, SortOrder
END
GO
PRINT N'Creating [dbo].[ecfVersion_List]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_List]
	@ObjectIds [dbo].[udttContentList] READONLY,
	@ObjectTypeId int
AS
BEGIN
	SELECT vn.*
	FROM dbo.ecfVersion vn
	INNER JOIN @ObjectIds i ON vn.ObjectId = i.ContentId AND vn.ObjectTypeId = @ObjectTypeId
	INNER JOIN CatalogLanguage cl ON vn.CatalogId = cl.CatalogId AND vn.LanguageName = cl.LanguageCode COLLATE DATABASE_DEFAULT
END
GO
PRINT N'Creating [dbo].[ecfVersion_SetCommonDraft]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_SetCommonDraft]
	@WorkId INT,
	@Force BIT
AS
BEGIN
	DECLARE @LanguageName NVARCHAR(50)
	DECLARE @ObjectId INT
	DECLARE @ObjectTypeId INT

	-- Find the Language, ObjectId, ObjectType for the Content Work ID 
	SELECT @LanguageName = LanguageName, @ObjectId = ObjectId, @ObjectTypeId = ObjectTypeId FROM ecfVersion WHERE WorkId = @WorkId

	-- If @Force = 1, we turn all other drafts to be not common draft, and the @WorkId must be common draft
	-- Else, if there is not any common draft, set @WorkId as common draft
	--			Else, if the common draft is not Published, then exit
	--					Else, we turn all other drafts to be not common draft, and the @WorkId must be common draft

	IF @Force = 1
	BEGIN
		UPDATE ecfVersion SET IsCommonDraft = CASE WHEN WorkId = @WorkId THEN 1 ELSE 0 END FROM ecfVersion
		WHERE ObjectId = @ObjectId AND ObjectTypeId = @ObjectTypeId AND LanguageName = @LanguageName COLLATE DATABASE_DEFAULT
	END
	ELSE
	BEGIN
		DECLARE @Status INT
		SET @Status = -1
		SELECT @Status = [Status] FROM ecfVersion WHERE @ObjectId = ObjectId AND @ObjectTypeId = ObjectTypeId AND IsCommonDraft = 1 AND LanguageName = @LanguageName COLLATE DATABASE_DEFAULT
		IF @Status = -1 -- there is no common draft
		BEGIN
			UPDATE ecfVersion SET IsCommonDraft = 1 WHERE WorkId = @WorkId
		END
		ELSE
		BEGIN
			IF @Status = 4 -- Published
			BEGIN
				UPDATE ecfVersion SET IsCommonDraft = CASE WHEN WorkId = @WorkId THEN 1 ELSE 0 END FROM ecfVersion
				WHERE ObjectId = @ObjectId AND ObjectTypeId = @ObjectTypeId AND LanguageName = @LanguageName COLLATE DATABASE_DEFAULT
			END
		END
	END
END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntry_Components]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntry_Components]
	@CatalogEntryIds udttContentList readonly,
	@ResponseGroup INT = NULL
AS
BEGIN
	DECLARE @CatalogEntryFull INT
	DECLARE @Associations INT
	DECLARE @Assets INT
	DECLARE @Variations INT

	SET @CatalogEntryFull = 4
	SET @Associations = 8
	SET @Assets = 32
	SET @Variations = 128

	IF ((@ResponseGroup & @Variations = @Variations)
		OR (@ResponseGroup & @CatalogEntryFull = @CatalogEntryFull))
	BEGIN
		SELECT v.*
		FROM Variation v
		INNER JOIN @CatalogEntryIds N ON N.ContentId = v.CatalogEntryId
	
		SELECT m.*
		FROM Merchant m
		INNER JOIN Variation v ON m.MerchantId = v.MerchantId
		INNER JOIN @CatalogEntryIds N ON N.ContentId = v.CatalogEntryId
    END

	IF ((@ResponseGroup & @Associations = @Associations)
		OR (@ResponseGroup & @CatalogEntryFull = @CatalogEntryFull))
	BEGIN
		SELECT a.*
		FROM CatalogAssociation a
		INNER JOIN @CatalogEntryIds N ON N.ContentId = a.CatalogEntryId

	END

	IF ((@ResponseGroup & @Assets = @Assets)
		OR (@ResponseGroup & @CatalogEntryFull = @CatalogEntryFull))
	BEGIN
		SELECT a.*
		FROM CatalogItemAsset a
		INNER JOIN @CatalogEntryIds N ON N.ContentId = a.CatalogEntryId
	END

END
GO
PRINT N'Creating [dbo].[ecf_Load_OrderGroup]...';


GO
CREATE PROCEDURE [dbo].[ecf_Load_OrderGroup]
    @OrderGroupId int
AS
BEGIN

DECLARE @search_condition nvarchar(max)

-- Return GroupIds.
SELECT @OrderGroupId AS [OrderGroupId]

-- Prevent any queries if order group doesn't exist
IF NOT EXISTS(SELECT OrderGroupId from OrderGroup G WHERE G.OrderGroupId = @OrderGroupId)
	RETURN;

-- Return Order Form Collection
SELECT 'OrderForm' TableName, OE.*, O.*
	FROM [OrderFormEx] OE 
		INNER JOIN OrderForm O ON O.OrderFormId = OE.ObjectId 
		WHERE O.OrderGroupId = @OrderGroupId

if(@@ROWCOUNT = 0)
	RETURN;

-- Return Order Form Collection
SELECT 'OrderGroupAddress' TableName, OE.*, O.*
	FROM [OrderGroupAddressEx] OE 
		INNER JOIN OrderGroupAddress O ON O.OrderGroupAddressId = OE.ObjectId  
		WHERE O.OrderGroupId = @OrderGroupId

-- Return Shipment Collection
SELECT 'Shipment' TableName, SE.*, S.*
	FROM [ShipmentEx] SE 
		INNER JOIN Shipment S ON S.ShipmentId = SE.ObjectId 
		WHERE S.OrderGroupId = @OrderGroupId

-- Return Line Item Collection
SELECT 'LineItem' TableName, LE.*, L.*
	FROM [LineItemEx] LE 
		INNER JOIN LineItem L ON L.LineItemId = LE.ObjectId 
		WHERE L.OrderGroupId = @OrderGroupId

-- Return Order Form Payment Collection
DECLARE @ids udttOrderGroupId
INSERT INTO @ids VALUES(@OrderGroupId)
EXEC dbo.ecf_Search_Payment @ids

-- Return Order Form Discount Collection
SELECT 'OrderFormDiscount' TableName, D.* 
	FROM [OrderFormDiscount] D 
		WHERE D.OrderGroupId = @OrderGroupId

-- Return Line Item Discount Collection
SELECT 'LineItemDiscount' TableName, D.* 
	FROM [LineItemDiscount] D 
		WHERE D.OrderGroupId = @OrderGroupId

-- Return Shipment Discount Collection
SELECT 'ShipmentDiscount' TableName, D.* 
	FROM [ShipmentDiscount] D 
		WHERE D.OrderGroupId = @OrderGroupId
		
-- Return OrderGroupNote Collection
SELECT 'OrderGroupNote' TableName, 
		G.OrderNoteId, 
		G.CustomerId, 
		G.Created, 
		G.OrderGroupId, 
		G.Detail,
		G.LineItemId,
		G.Title,
		G.Type,
		G.Channel,
		G.EventType
	FROM [OrderGroupNote] G
	WHERE G.OrderGroupId = @OrderGroupId

DECLARE @OrderGroupIds as udttOrderGroupId
INSERT INTO @OrderGroupIds(OrderGroupId) VALUES(@OrderGroupId)

EXEC dbo.PromotionInformationLoad @OrderGroupIds

-- assign random local variable to set @@rowcount attribute to 1
declare @temp as int
set @temp = 1

END
GO
PRINT N'Creating [dbo].[ecf_Load_ShoppingCart_OrderGroupId]...';


GO
CREATE PROCEDURE [dbo].[ecf_Load_ShoppingCart_OrderGroupId]
    @OrderGroupId int
AS
BEGIN
	IF(EXISTS(SELECT OrderGroupId from OrderGroup where OrderGroupId = @OrderGroupId))
	BEGIN
		exec [dbo].[ecf_Load_OrderGroup] @OrderGroupId
	
		-- Return Purchase Order Details
		DECLARE @search_condition nvarchar(max)

		SET @search_condition = N'INNER JOIN OrderGroup OG ON OG.OrderGroupId = T.ObjectId WHERE [T].[ObjectId] = ' + CAST(@OrderGroupId AS VARCHAR)
		exec mdpsp_avto_OrderGroup_ShoppingCart_Search NULL, '''OrderGroup'' TableName, [OG].*', @search_condition
	END
END
GO
PRINT N'Creating [dbo].[ecf_Load_PaymentPlan_OrderGroupId]...';


GO
CREATE PROCEDURE [dbo].[ecf_Load_PaymentPlan_OrderGroupId]
    @OrderGroupId int
AS
BEGIN
	IF(EXISTS(SELECT OrderGroupId from OrderGroup where OrderGroupId = @OrderGroupId))
	BEGIN
		exec [dbo].[ecf_Load_OrderGroup] @OrderGroupId

		-- Return Purchase Order Details
		DECLARE @search_condition nvarchar(max)

		SET @search_condition = N'INNER JOIN OrderGroup OG ON OG.OrderGroupId = T.ObjectId WHERE [T].[ObjectId] = ' + CAST(@OrderGroupId AS VARCHAR)
		exec mdpsp_avto_OrderGroup_PaymentPlan_Search NULL, '''OrderGroup'' TableName, [OG].*', @search_condition
	END
END
GO
PRINT N'Creating [dbo].[ecf_Load_PurchaseOrder_OrderGroupId]...';


GO
CREATE PROCEDURE [dbo].[ecf_Load_PurchaseOrder_OrderGroupId]
    @OrderGroupId int
AS
BEGIN
	IF(EXISTS(SELECT OrderGroupId from OrderGroup where OrderGroupId = @OrderGroupId))
		BEGIN
		exec [dbo].[ecf_Load_OrderGroup] @OrderGroupId

		-- Return Purchase Order Details
		DECLARE @search_condition nvarchar(max)

		SET @search_condition = N'INNER JOIN OrderGroup OG ON OG.OrderGroupId = T.ObjectId WHERE [T].[ObjectId] = ' + CAST(@OrderGroupId AS VARCHAR)
		exec mdpsp_avto_OrderGroup_PurchaseOrder_Search NULL, '''OrderGroup'' TableName, [OG].*', @search_condition
	END
END
GO
PRINT N'Creating [dbo].[PromotionInformationList]...';


GO
CREATE PROCEDURE [dbo].[PromotionInformationList]
	@OrderFormId INT
AS
BEGIN
	DECLARE @PromotionInformation [udttPromotionInformation];
	
	INSERT INTO @PromotionInformation
			(PromotionInformationId,
			 OrderFormId,
			 PromotionGuid,
			 Description,
			 RewardType,
			 Name,
			 DiscountType,
			 CouponCode,
			 AdditionalInformation,
			 VisitorGroup,
			 CustomerId,
			 OrderLevelSavedAmount,
			 IsRedeemed)
	SELECT 
		   PromotionInformationId,
		   OrderFormId,
		   PromotionGuid,
		   Description,
		   RewardType,
		   Name,
		   DiscountType,
		   CouponCode,
		   AdditionalInformation,
		   VisitorGroup,
		   CustomerId,
		   OrderLevelSavedAmount,
		   IsRedeemed
	FROM dbo.PromotionInformation
	WHERE OrderFormId = @OrderFormId
	
	SELECT 'PromotionInformation' TableName, p.* FROM @PromotionInformation p

	SELECT 'PromotionInformationEntry' TableName,
		i.PromotionInformationId,
		e.EntryCode,
		e.SavedAmount
	FROM PromotionInformationEntry e
	INNER JOIN @PromotionInformation i ON e.PromotionInformationId = i.PromotionInformationId

	SELECT 'PromotionInformationShipment' TableName,
		i.PromotionInformationId,
		s.ShippingMethodId,
		s.OrderAddressName,
		s.ShippingMethodName,
		s.SavedAmount
	FROM PromotionInformationShipment s
	INNER JOIN @PromotionInformation i ON s.PromotionInformationId = i.PromotionInformationId
END
GO
PRINT N'Creating [dbo].[PromotionInformationDelete]...';


GO
CREATE PROCEDURE [dbo].[PromotionInformationDelete]
	@OrderFormId INT
AS
BEGIN
	DELETE FROM PromotionInformation
	WHERE OrderFormId = @OrderFormId;
END
GO
PRINT N'Creating [dbo].[PromotionInformationSave]...';


GO
CREATE PROCEDURE [dbo].[PromotionInformationSave]
	@PromotionInformation dbo.udttPromotionInformation READONLY,
	@PromotionInformationEntry dbo.udttPromotionInformationEntry READONLY,
	@PromotionInformationShipment dbo.udttPromotionInformationShipment READONLY
AS
BEGIN
	DELETE i FROM PromotionInformation i
	INNER JOIN @PromotionInformation p ON i.OrderFormId = p.OrderFormId

	DECLARE @IdMap TABLE (TempId INT, Id INT)

	-- Use merge that never matches to do the insert and get the map between temporary and inserted
	MERGE INTO PromotionInformation
	USING @PromotionInformation AS input
	ON 1 = 0
	WHEN NOT MATCHED THEN
		INSERT (OrderFormId, PromotionGuid, RewardType, [Name], [Description], DiscountType, CouponCode, AdditionalInformation, VisitorGroup, CustomerId, OrderLevelSavedAmount, IsRedeemed, IsReturnOrderForm)
		VALUES (input.OrderFormId, input.PromotionGuid, input.RewardType, input.[Name], input.[Description], input.DiscountType, input.CouponCode, input.AdditionalInformation, input.VisitorGroup, input.CustomerId, input.OrderLevelSavedAmount, input.IsRedeemed, input.IsReturnOrderForm)
	OUTPUT input.PromotionInformationId, inserted.PromotionInformationId
	INTO @IdMap;

	-- Create updated versions of input tables with inserted identities from PromotionInformation table
	-- Separate operation to avoid deadlock under high concurrency on the following inserts
	DECLARE @PromotionInformationEntryUpdated dbo.udttPromotionInformationEntry
	INSERT INTO @PromotionInformationEntryUpdated (PromotionInformationId, EntryCode, SavedAmount)
	SELECT m.Id, e.EntryCode, e.SavedAmount
	FROM @PromotionInformationEntry e
	INNER JOIN @IdMap m ON m.TempId = e.PromotionInformationId

	DECLARE @PromotionInformationShipmentUpdated dbo.udttPromotionInformationShipment
	INSERT INTO @PromotionInformationShipmentUpdated (PromotionInformationId, ShippingMethodId, OrderAddressName, ShippingMethodName, SavedAmount)
	SELECT m.Id, s.ShippingMethodId, s.OrderAddressName, s.ShippingMethodName, s.SavedAmount
	FROM @PromotionInformationShipment s
	INNER JOIN @IdMap m ON m.TempId = s.PromotionInformationId

	INSERT INTO PromotionInformationEntry (PromotionInformationId, EntryCode, SavedAmount)
	SELECT e.PromotionInformationId, e.EntryCode, e.SavedAmount
	FROM @PromotionInformationEntryUpdated e

	INSERT INTO PromotionInformationShipment (PromotionInformationId, ShippingMethodId, OrderAddressName, ShippingMethodName, SavedAmount)
	SELECT s.PromotionInformationId, s.ShippingMethodId, s.OrderAddressName, s.ShippingMethodName, s.SavedAmount
	FROM @PromotionInformationShipmentUpdated s
END
GO
PRINT N'Creating [dbo].[ecf_CatalogNodeItemSeo_ValidateUri]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogNodeItemSeo_ValidateUri]
	@CatalogItemSeo dbo.udttCatalogItemSeo readonly
AS
BEGIN
	-- validate Node Uri and return invalid record
	SELECT t.[LanguageCode], t.[CatalogNodeId], t.[CatalogEntryId], '' AS [Uri], t.[UriSegment] 
	FROM @CatalogItemSeo t
	INNER JOIN CatalogItemSeo c ON
		t.LanguageCode = c.LanguageCode COLLATE DATABASE_DEFAULT
		AND t.Uri = c.Uri COLLATE DATABASE_DEFAULT
	-- check against both entry and node
	WHERE c.CatalogEntryId > 0 OR t.CatalogNodeId <> c.CatalogNodeId
END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntryItemSeo_ValidateUriSegment]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntryItemSeo_ValidateUriSegment]
	@CatalogItemSeo dbo.udttCatalogItemSeo readonly,
	@UseLessStrictUriSegmentValidation bit
AS
BEGIN
	DECLARE @query nvarchar(4000);

	-- validate Entry Uri Segment and return invalid record
	SET @query =
	'SELECT t.[LanguageCode], t.[CatalogNodeId], t.[CatalogEntryId], t.[Uri], NULL AS [UriSegment]
	FROM @CatalogItemSeo t
	INNER JOIN CatalogItemSeo c ON
		t.LanguageCode = c.LanguageCode COLLATE DATABASE_DEFAULT
		AND t.CatalogEntryId <> c.CatalogEntryId -- check against entry only
		AND t.UriSegment = c.UriSegment COLLATE DATABASE_DEFAULT'

	IF (@UseLessStrictUriSegmentValidation = 1)
	BEGIN
		SET @query = @query + '
		WHERE dbo.fn_UriSegmentExistsOnSiblingNodeOrEntry(t.CatalogEntryId, 1, t.UriSegment, t.LanguageCode) = 1

		UNION 

		SELECT t.[LanguageCode], t.[CatalogNodeId], t.[CatalogEntryId], t.[Uri], NULL AS [UriSegment]
		FROM @CatalogItemSeo t
		INNER JOIN @CatalogItemSeo s ON 
			t.LanguageCode = s.LanguageCode COLLATE DATABASE_DEFAULT
			AND t.CatalogEntryId <> s.CatalogEntryId -- check against entry only
			AND t.UriSegment = s.UriSegment COLLATE DATABASE_DEFAULT
			AND dbo.fn_AreSiblings(t.CatalogEntryId, s.CatalogEntryId) =  1'
	END

	exec sp_executesql @query, N'@CatalogItemSeo dbo.udttCatalogItemSeo readonly', @CatalogItemSeo = @CatalogItemSeo
END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntryItemSeo_ValidateUri]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntryItemSeo_ValidateUri]
	@CatalogItemSeo dbo.udttCatalogItemSeo readonly
AS
BEGIN
	-- validate Entry Uri and return invalid record
	SELECT t.[LanguageCode], t.[CatalogNodeId], t.[CatalogEntryId], '' AS [Uri], t.[UriSegment] 
	FROM @CatalogItemSeo t
	INNER JOIN CatalogItemSeo c ON
		t.LanguageCode = c.LanguageCode COLLATE DATABASE_DEFAULT
		AND t.Uri = c.Uri COLLATE DATABASE_DEFAULT
	-- check against both entry and node
	WHERE c.CatalogNodeId > 0 OR t.CatalogEntryId <> c.CatalogEntryId
END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntryItemSeo_ValidateUriAndUriSegment]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntryItemSeo_ValidateUriAndUriSegment]
	@CatalogItemSeo dbo.udttCatalogItemSeo readonly,
	@UseLessStrictUriSegmentValidation bit
AS
BEGIN
	-- validate Entry Uri and Uri Segment, then return invalid record
	DECLARE @InvalidSeoUri dbo.udttCatalogItemSeo
	DECLARE @InvalidUriSegment dbo.udttCatalogItemSeo
	
	INSERT INTO @InvalidSeoUri ([LanguageCode], [CatalogNodeId], [CatalogEntryId], [Uri], [UriSegment]) 
		EXEC [ecf_CatalogEntryItemSeo_ValidateUri] @CatalogItemSeo

	INSERT INTO @InvalidUriSegment ([LanguageCode], [CatalogNodeId], [CatalogEntryId], [Uri], [UriSegment]) 
		EXEC [ecf_CatalogEntryItemSeo_ValidateUriSegment] @CatalogItemSeo, @UseLessStrictUriSegmentValidation

	MERGE @InvalidSeoUri as U
	USING @InvalidUriSegment as S
	ON 
		U.LanguageCode = S.LanguageCode COLLATE DATABASE_DEFAULT AND 
		U.CatalogEntryId = S.CatalogEntryId
	WHEN MATCHED -- update the UriSegment for existing row in #ValidSeoUri
		THEN UPDATE SET U.UriSegment = S.UriSegment
	WHEN NOT MATCHED BY TARGET -- insert new record if the record is does not exist in #ValidSeoUri table (source table)
		THEN INSERT VALUES(S.LanguageCode, S.CatalogNodeId, S.CatalogEntryId, S.Uri, S.UriSegment)
	;

	SELECT * FROM @InvalidSeoUri
END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntry_ListSimple]...';


GO
create procedure dbo.ecf_CatalogEntry_ListSimple
    @CatalogEntries dbo.udttEntityList readonly
as
begin
    select n.*
	from CatalogEntry n
	join @CatalogEntries r on n.CatalogEntryId = r.EntityId
	order by r.SortOrder
end
GO
PRINT N'Creating [dbo].[ecf_GenerateReportingDates]...';


GO
CREATE PROCEDURE ecf_GenerateReportingDates
@EndDate DATE
AS
BEGIN
	DECLARE @StartDate DATE
	SET @StartDate = (SELECT MAX(DateFull) FROM [dbo].[ReportingDates])

	--If there is no reporting date yet, make sure to add the current date.
	IF (@StartDate IS NULL)
		SET @StartDate = GETDATE()
	ELSE
	--We will add the start date as the day after the max date in ReportingDates
		SET @StartDate = DATEADD(day, 1, @StartDate)

	IF (@EndDate > @StartDate)
	BEGIN
		CREATE TABLE #ReportingDates (ReportingDate Datetime2);
		WITH ReportingDates_CTE(Date) AS		
		( 
			SELECT @StartDate 
			UNION ALL
			SELECT DateAdd(day,1,ReportingDates_CTE.Date) FROM ReportingDates_CTE WHERE ReportingDates_CTE.Date <= @EndDate
		)
		
		INSERT INTO #ReportingDates
		SELECT * FROM ReportingDates_CTE OPTION (MAXRECURSION 32767);


		INSERT INTO [dbo].[ReportingDates] 
		(DateKey, DateFull, CharacterDate, FullYear, QuarterNumber, WeekNumber, WeekDayName, MonthDay, MonthName, YearDay, 
		DateDefinition, WeekDay, MonthNumber)

		SELECT cast (REPLACE(convert(varchar, ReportingDate, 102), '.', '') as int), 
				 ReportingDate,
				 convert(varchar, ReportingDate, 101),
				 YEAR(ReportingDate),
				 MONTH(ReportingDate) / 3,
				 DATEPART(wk, ReportingDate),
				 DATENAME(dw, ReportingDate),
				 DAY(ReportingDate),
				 DATENAME(month, ReportingDate),
				 DATEPART(dy, ReportingDate),
				 DATENAME(month, ReportingDate) + CAST(DAY(ReportingDate) AS varchar) + ',   
		           ' + CAST(YEAR(ReportingDate) AS varchar),
				 DATEPART(dw, ReportingDate),
				 MONTH(ReportingDate)
				 FROM #ReportingDates

		DROP TABLE #ReportingDates
	END
END
GO
PRINT N'Creating [dbo].[ecf_NodeEntryRelations]...';


GO
CREATE PROCEDURE [dbo].[ecf_NodeEntryRelations]
	@ContentList udttContentList readonly
AS
BEGIN
	Select NodeEntryRelation.CatalogId, CatalogEntryId, CatalogNodeId, SortOrder, IsPrimary
	FROM NodeEntryRelation
	INNER JOIN @ContentList as idTable on idTable.ContentId = NodeEntryRelation.CatalogEntryId
END
GO
PRINT N'Creating [dbo].[ecf_GuidNode_Find]...';


GO
CREATE PROCEDURE [dbo].[ecf_GuidNode_Find]
	@ContentList udttContentList readonly
AS
BEGIN
	SELECT n.CatalogNodeId AS Id, ContentGuid
	FROM CatalogNode n
	INNER JOIN @ContentList AS idTable ON idTable.ContentId = n.CatalogNodeId
END
GO
PRINT N'Creating [dbo].[ecf_GuidEntry_Find]...';


GO
CREATE PROCEDURE [dbo].[ecf_GuidEntry_Find]
	@ContentList udttContentList readonly
AS
BEGIN
	SELECT c.CatalogEntryId AS Id, ContentGuid
	FROM dbo.CatalogEntry c
	INNER JOIN @ContentList AS idTable ON idTable.ContentId = c.CatalogEntryId	
END
GO
PRINT N'Creating [dbo].[ecf_GuidCatalog_Find]...';


GO
CREATE PROCEDURE [dbo].[ecf_GuidCatalog_Find]
	@ContentList udttCatalogList readonly
AS
BEGIN
	SELECT c.CatalogId as Id, ContentGuid
	FROM [Catalog] c
	INNER JOIN @ContentList as idTable on idTable.CatalogId = c.CatalogId
END
GO
PRINT N'Creating [dbo].[ecf_CatalogNode_GetChildrenEntries]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogNode_GetChildrenEntries]
	@CatalogNodeId int
AS
BEGIN
    SELECT ce.MetaClassId, ce.CatalogEntryId, ce.ClassTypeId, ner.SortOrder
	FROM [dbo].NodeEntryRelation ner
	INNER JOIN [dbo].CatalogEntry ce
	ON ner.CatalogEntryId = ce.CatalogEntryId
	WHERE ner.CatalogNodeId = @CatalogNodeId
	ORDER BY ner.SortOrder, ce.Name

END
GO
PRINT N'Creating [dbo].[ecf_Catalog_GetChildrenEntries]...';


GO
CREATE PROCEDURE [dbo].[ecf_Catalog_GetChildrenEntries]
	@CatalogId int
AS
BEGIN
	SELECT CE.CatalogId, CE.MetaClassId, CE.CatalogEntryId, ClassTypeId, 0 as CatalogNodeId, 0 as SortOrder
	FROM [dbo].CatalogEntry CE
	WHERE CE.CatalogId = @CatalogId
		AND NOT EXISTS(SELECT 1 FROM NodeEntryRelation R WHERE CE.CatalogEntryId = R.CatalogEntryId AND R.IsPrimary = 1)
	ORDER BY CE.Name
END
GO
PRINT N'Creating [dbo].[ecf_CatalogItem_AssetKey]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogItem_AssetKey]
	@AssetKey nvarchar(254)
AS
BEGIN
	SELECT A.* from [CatalogItemAsset] A
		LEFT OUTER JOIN [CatalogEntry] CE ON CE.CatalogEntryId = A.CatalogEntryId
		LEFT OUTER JOIN [CatalogNode] CN ON CN.CatalogNodeId = A.CatalogNodeId
	WHERE
		A.AssetKey = @AssetKey
END
GO
PRINT N'Creating [dbo].[ecf_GuidNode_Get]...';


GO
CREATE PROCEDURE [dbo].[ecf_GuidNode_Get]
    @CatalogEntityId int
AS
BEGIN
	SELECT ContentGuid
		FROM CatalogNode
	WHERE CatalogNodeId = @CatalogEntityId
	
END
GO
PRINT N'Creating [dbo].[ecf_GuidEntry_Get]...';


GO
CREATE PROCEDURE [dbo].[ecf_GuidEntry_Get]
    @CatalogEntityId int
AS
BEGIN
	SELECT ContentGuid
		FROM [CatalogEntry]
	WHERE CatalogEntryId = @CatalogEntityId
END
GO
PRINT N'Creating [dbo].[ecf_GuidCatalog_Get]...';


GO
CREATE PROCEDURE [dbo].[ecf_GuidCatalog_Get]
   @CatalogEntityId int
AS
BEGIN
	SELECT ContentGuid
		FROM [Catalog] c
	WHERE c.CatalogId = @CatalogEntityId	
END
GO
PRINT N'Creating [dbo].[ecf_Guid_FindEntity]...';


GO
CREATE PROCEDURE [dbo].[ecf_Guid_FindEntity]
    @ContentGuid uniqueidentifier
AS
BEGIN
	DECLARE @Id INT

	SET @Id = (SELECT CatalogEntryId FROM [CatalogEntry] WHERE ContentGuid = @ContentGuid)
	IF @Id != 0
	BEGIN
		SELECT @Id, 0
		RETURN;
	END

	SET @Id = (SELECT CatalogNodeId FROM [CatalogNode] WHERE ContentGuid = @ContentGuid)
	IF @Id != 0
	BEGIN
		SELECT @Id, 1
		RETURN;
	END

	SET @Id = (SELECT CatalogId FROM [Catalog] WHERE ContentGuid = @ContentGuid)
	IF @Id != 0
	BEGIN
		SELECT @Id, 2
		RETURN;
	END

END
GO
PRINT N'Creating [dbo].[ecf_AllCatalogEntry_CatalogId]...';


GO
CREATE PROCEDURE [dbo].[ecf_AllCatalogEntry_CatalogId]
    @CatalogId int
AS
BEGIN
	
	SELECT N.* from [CatalogEntry] N
	WHERE
		N.CatalogId = @CatalogId 

END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadDictionarySingleItemUsages]...';


GO
CREATE PROCEDURE dbo.[mdpsp_sys_LoadDictionarySingleItemUsages]
	@MetaFieldId int,
	@MetaDictionaryId int
as
begin

DECLARE @metaClassTableName nvarchar(256)
DECLARE @sqlQuery nvarchar(max)
DECLARE @metaFieldName nvarchar(256)
DECLARE @multipleLanguage bit
DECLARE @rowcount int

SET @metaFieldName = (SELECT top 1 Name from dbo.MetaField where MetaFieldId = @MetaFieldId)
SET @multipleLanguage = (SELECT top 1 MultiLanguageValue from dbo.MetaField where MetaFieldId = @MetaFieldId)

DECLARE metaclass_table CURSOR FOR 
SELECT TableName
FROM dbo.MetaClass m
INNER JOIN dbo.MetaClassMetaFieldRelation r
ON m.MetaClassId = r.MetaClassId
WHERE r.MetaFieldId = @MetaFieldId

SET @sqlQuery = ''
SET @rowcount = 0

OPEN metaclass_table

FETCH NEXT FROM metaclass_table 
INTO @metaClassTableName


WHILE @@FETCH_STATUS = 0
BEGIN
	IF dbo.mdpfn_sys_IsCatalogMetaDataTable(@MetaClassTableName) = 1
	BEGIN
		SELECT @rowcount = COUNT(ObjectId) FROM CatalogContentProperty WHERE MetaFieldId = @MetaFieldId and [Number] = @MetaDictionaryId
	END
	ELSE
	BEGIN
		IF (@multipleLanguage = 1)
			SET @metaClassTableName = @metaClassTableName + '_Localization'
		SET @sqlQuery = 'SELECT @rowcount = Count(ObjectId) FROM ' + @metaClassTableName + ' where [' +  @metaFieldName +  '] =  ''' + cast(@MetaDictionaryId as varchar(20)) + ''''
		EXEC sp_executesql @sqlQuery, N'@rowcount int output', @rowcount output
		
		IF (@rowcount > 0)
			BREAK
	END

FETCH NEXT FROM metaclass_table 
    INTO @metaClassTableName
	
END 
CLOSE metaclass_table;
DEALLOCATE metaclass_table;

SELECT @rowcount

END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadDictionaryMultiItemUsages]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadDictionaryMultiItemUsages]
(
	@MetaDictionaryId	int
)
AS
BEGIN
  SELECT COUNT(MetaObjectId) from MetaKey mk 
  join MetaMultiValueDictionary d on mk.MetaKey = d.MetaKey
  where d.MetaDictionaryId = @MetaDictionaryId
END
GO
PRINT N'Creating [dbo].[ecf_Inventory_AdjustInventory]...';


GO
CREATE PROCEDURE [dbo].[ecf_Inventory_AdjustInventory]
    @changes [dbo].[udttInventory] READONLY
AS
BEGIN
    if exists (
        select 1 from @changes src 
        where not exists (select 1 from [dbo].[InventoryService] dst where dst.[CatalogEntryCode] = src.[CatalogEntryCode] and dst.[WarehouseCode] = src.[WarehouseCode]))
    begin
        raiserror('unmatched key found in update set', 16, 1)
    end
    else
    begin
        update dst
        set      
            [PurchaseAvailableQuantity] = dst.[PurchaseAvailableQuantity] + src.[PurchaseAvailableQuantity],
            [PreorderAvailableQuantity] = dst.[PreorderAvailableQuantity] + src.[PreorderAvailableQuantity],
            [BackorderAvailableQuantity] = dst.[BackorderAvailableQuantity] + src.[BackorderAvailableQuantity],
            [PurchaseRequestedQuantity] = dst.[PurchaseRequestedQuantity] + src.[PurchaseRequestedQuantity],
            [PreorderRequestedQuantity] = dst.[PreorderRequestedQuantity] + src.[PreorderRequestedQuantity],
            [BackorderRequestedQuantity] = dst.[BackorderRequestedQuantity] + src.[BackorderRequestedQuantity]
        from [dbo].[InventoryService] dst
        join (
            select 
                [CatalogEntryCode], [WarehouseCode],
                SUM([PurchaseAvailableQuantity]) as [PurchaseAvailableQuantity],
                SUM([PreorderAvailableQuantity]) as [PreorderAvailableQuantity],
                SUM([BackorderAvailableQuantity]) as [BackorderAvailableQuantity],
                SUM([PurchaseRequestedQuantity]) as [PurchaseRequestedQuantity],
                SUM([PreorderRequestedQuantity]) as [PreorderRequestedQuantity],
                SUM([BackorderRequestedQuantity]) as [BackorderRequestedQuantity]
            from @changes
            group by [CatalogEntryCode], [WarehouseCode]) src 
          on dst.[CatalogEntryCode] = src.[CatalogEntryCode] and dst.[WarehouseCode] = src.[WarehouseCode]

        select
        mi.[CatalogEntryCode], 
        mi.[WarehouseCode], 
        mi.[IsTracked], 
        mi.[PurchaseAvailableQuantity], 
        mi.[PreorderAvailableQuantity], 
        mi.[BackorderAvailableQuantity], 
        mi.[PurchaseRequestedQuantity], 
        mi.[PreorderRequestedQuantity], 
        mi.[BackorderRequestedQuantity], 
        mi.[PurchaseAvailableUtc],
        mi.[PreorderAvailableUtc],
        mi.[BackorderAvailableUtc],
        mi.[AdditionalQuantity],
        mi.[ReorderMinQuantity]
        from [dbo].[InventoryService] mi
        inner join @changes c on
             mi.[CatalogEntryCode] = c.[CatalogEntryCode]
              and mi.[WarehouseCode] = c.[WarehouseCode]
        order by [CatalogEntryCode], [WarehouseCode]
    end
END
GO
PRINT N'Creating [dbo].[ecf_Inventory_DeleteInventoryByKeys]...';


GO
CREATE PROCEDURE [dbo].[ecf_Inventory_DeleteInventoryByKeys]
    @inventoryKeys [dbo].[udttInventory] READONLY
AS
BEGIN
    delete mi
    from [dbo].[InventoryService] mi
    INNER JOIN @inventoryKeys k
    ON mi.CatalogEntryCode = k.CatalogEntryCode
    AND mi.WarehouseCode = k.WarehouseCode
END
GO
PRINT N'Creating [dbo].[ecf_Inventory_DeleteWarehouse]...';


GO
CREATE PROCEDURE [dbo].[ecf_Inventory_DeleteWarehouse]
    @Code NVARCHAR(50)
AS
BEGIN    
    delete from [dbo].[Warehouse]
    where [Code] = @Code
END
GO
PRINT N'Creating [dbo].[ecf_Inventory_UpdateInventory]...';


GO
CREATE PROCEDURE [dbo].[ecf_Inventory_UpdateInventory]
    @inventory [dbo].[udttInventory] READONLY
AS
BEGIN
    if exists (
        select 1 from @inventory 
        group by [CatalogEntryCode], [WarehouseCode] 
        having COUNT(*) > 1)
    begin
        raiserror('duplicate key found in update set', 16, 1)
    end
    else if exists (
        select 1 from @inventory src 
        where not exists (select 1 from [dbo].[InventoryService] dst where dst.[CatalogEntryCode] = src.[CatalogEntryCode] and dst.[WarehouseCode] = src.[WarehouseCode]))
    begin
        raiserror('unmatched key found in update set', 16, 1)
    end
    else
    begin
        update dst
        set      
            [IsTracked] = src.[IsTracked],
            [PurchaseAvailableQuantity] = src.[PurchaseAvailableQuantity],
            [PreorderAvailableQuantity] = src.[PreorderAvailableQuantity],
            [BackorderAvailableQuantity] = src.[BackorderAvailableQuantity],
            [PurchaseRequestedQuantity] = src.[PurchaseRequestedQuantity],
            [PreorderRequestedQuantity] = src.[PreorderRequestedQuantity],
            [BackorderRequestedQuantity] = src.[BackorderRequestedQuantity],
            [PurchaseAvailableUtc] = src.[PurchaseAvailableUtc],
            [PreorderAvailableUtc] = src.[PreorderAvailableUtc],
            [BackorderAvailableUtc] = src.[BackorderAvailableUtc],
            [AdditionalQuantity] = src.[AdditionalQuantity],
            [ReorderMinQuantity] = src.[ReorderMinQuantity]
        from [dbo].[InventoryService] dst
        join @inventory src on dst.[CatalogEntryCode] = src.[CatalogEntryCode] and dst.[WarehouseCode] = src.[WarehouseCode]
    end
END
GO
PRINT N'Creating [dbo].[ecf_Inventory_InsertInventory]...';


GO
CREATE PROCEDURE [dbo].[ecf_Inventory_InsertInventory]
    @inventory [dbo].[udttInventory] READONLY
AS
BEGIN
    insert into [dbo].[InventoryService]
    (          
        [CatalogEntryCode],
        [WarehouseCode],
        [IsTracked],
        [PurchaseAvailableQuantity],
        [PreorderAvailableQuantity],
        [BackorderAvailableQuantity],
        [PurchaseRequestedQuantity],
        [PreorderRequestedQuantity],
        [BackorderRequestedQuantity],
        [PurchaseAvailableUtc],
        [PreorderAvailableUtc],
        [BackorderAvailableUtc],
        [AdditionalQuantity],
        [ReorderMinQuantity]
    )
    select
        src.[CatalogEntryCode],
        src.[WarehouseCode],
        src.[IsTracked],
        src.[PurchaseAvailableQuantity],
        src.[PreorderAvailableQuantity],
        src.[BackorderAvailableQuantity],
        src.[PurchaseRequestedQuantity],
        src.[PreorderRequestedQuantity],
        src.[BackorderRequestedQuantity],
        src.[PurchaseAvailableUtc],
        src.[PreorderAvailableUtc],
        src.[BackorderAvailableUtc],
        src.[AdditionalQuantity],
        src.[ReorderMinQuantity]
    from @inventory src
END
GO
PRINT N'Creating [dbo].[ecf_Inventory_SaveInventory]...';


GO
CREATE PROCEDURE [dbo].[ecf_Inventory_SaveInventory]
    @inventory [dbo].[udttInventory] READONLY
AS
BEGIN
    merge into [dbo].[InventoryService] dst
    using @inventory src
    on (dst.[CatalogEntryCode] = src.[CatalogEntryCode] and dst.[WarehouseCode] = src.[WarehouseCode])
    when matched then
        update set      
            [IsTracked] = src.[IsTracked],
            [PurchaseAvailableQuantity] = src.[PurchaseAvailableQuantity],
            [PreorderAvailableQuantity] = src.[PreorderAvailableQuantity],
            [BackorderAvailableQuantity] = src.[BackorderAvailableQuantity],
            [PurchaseRequestedQuantity] = src.[PurchaseRequestedQuantity],
            [PreorderRequestedQuantity] = src.[PreorderRequestedQuantity],
            [BackorderRequestedQuantity] = src.[BackorderRequestedQuantity],
            [PurchaseAvailableUtc] = src.[PurchaseAvailableUtc],
            [PreorderAvailableUtc] = src.[PreorderAvailableUtc],
            [BackorderAvailableUtc] = src.[BackorderAvailableUtc],
            [AdditionalQuantity] = src.[AdditionalQuantity],
            [ReorderMinQuantity] = src.[ReorderMinQuantity]
    when not matched then 
        insert (
            [CatalogEntryCode],
            [WarehouseCode],
            [IsTracked],
            [PurchaseAvailableQuantity],
            [PreorderAvailableQuantity],
            [BackorderAvailableQuantity],
            [PurchaseRequestedQuantity],
            [PreorderRequestedQuantity],
            [BackorderRequestedQuantity],
            [PurchaseAvailableUtc],
            [PreorderAvailableUtc],
            [BackorderAvailableUtc],
            [AdditionalQuantity],
            [ReorderMinQuantity]
        ) values (
            src.[CatalogEntryCode],
            src.[WarehouseCode],
            src.[IsTracked],
            src.[PurchaseAvailableQuantity],
            src.[PreorderAvailableQuantity],
            src.[BackorderAvailableQuantity],
            src.[PurchaseRequestedQuantity],
            src.[PreorderRequestedQuantity],
            src.[BackorderRequestedQuantity],
            src.[PurchaseAvailableUtc],
            src.[PreorderAvailableUtc],
            src.[BackorderAvailableUtc],
            src.[AdditionalQuantity],
            src.[ReorderMinQuantity]
        );
END
GO
PRINT N'Creating [dbo].[ecf_Inventory_QueryInventoryPaged]...';


GO
CREATE PROCEDURE [dbo].[ecf_Inventory_QueryInventoryPaged]
    @offset int,
    @count int,
    @partialKeys [dbo].[udttInventory] READONLY
AS
BEGIN
    declare @results table (
        [CatalogEntryCode] nvarchar(100),
        [WarehouseCode] nvarchar(50),
        [IsTracked] bit,
        [PurchaseAvailableQuantity] decimal(38, 9),
        [PreorderAvailableQuantity] decimal(38, 9),
        [BackorderAvailableQuantity] decimal(38, 9),
        [PurchaseRequestedQuantity] decimal(38, 9),
        [PreorderRequestedQuantity] decimal(38, 9),
        [BackorderRequestedQuantity] decimal(38, 9),
        [PurchaseAvailableUtc] datetime2,
        [PreorderAvailableUtc] datetime2,
        [BackorderAvailableUtc] datetime2,
        [AdditionalQuantity] decimal(38, 9),
        [ReorderMinQuantity] decimal(38, 9),
        [RowNumber] int,
        [TotalCount] int
    )

    insert into @results (
        [CatalogEntryCode],
        [WarehouseCode],
        [IsTracked],
        [PurchaseAvailableQuantity],
        [PreorderAvailableQuantity],
        [BackorderAvailableQuantity],
        [PurchaseRequestedQuantity],
        [PreorderRequestedQuantity],
        [BackorderRequestedQuantity],
        [PurchaseAvailableUtc],
        [PreorderAvailableUtc],
        [BackorderAvailableUtc],
        [AdditionalQuantity],
        [ReorderMinQuantity],
        [RowNumber],
        [TotalCount]
    )
    select
        [CatalogEntryCode], 
        [WarehouseCode], 
        [IsTracked], 
        [PurchaseAvailableQuantity], 
        [PreorderAvailableQuantity], 
        [BackorderAvailableQuantity], 
        [PurchaseRequestedQuantity], 
        [PreorderRequestedQuantity], 
        [BackorderRequestedQuantity], 
        [PurchaseAvailableUtc],
        [PreorderAvailableUtc],
        [BackorderAvailableUtc],
        [AdditionalQuantity],
        [ReorderMinQuantity],
        [RowNumber],
        [RowNumber] + [ReverseRowNumber] - 1 as [TotalCount]
    from (
        select 
            ROW_NUMBER() over (order by [CatalogEntryCode], [WarehouseCode]) as [RowNumber],
            ROW_NUMBER() over (order by [CatalogEntryCode] desc, [WarehouseCode] desc) as [ReverseRowNumber],
            [CatalogEntryCode], 
            [WarehouseCode], 
            [IsTracked], 
            [PurchaseAvailableQuantity], 
            [PreorderAvailableQuantity], 
            [BackorderAvailableQuantity], 
            [PurchaseRequestedQuantity], 
            [PreorderRequestedQuantity], 
            [BackorderRequestedQuantity], 
            [PurchaseAvailableUtc],
            [PreorderAvailableUtc],
            [BackorderAvailableUtc],
            [AdditionalQuantity],
            [ReorderMinQuantity]
        from [dbo].[InventoryService] mi
        where exists (
            select 1 
            from @partialKeys keys 
            where mi.[CatalogEntryCode] = isnull(keys.[CatalogEntryCode], mi.[CatalogEntryCode])
              and mi.[WarehouseCode] = isnull(keys.[WarehouseCode], mi.[WarehouseCode]))
    ) paged
    where @offset < [RowNumber] and [RowNumber] <= (@offset + @count)

    if not exists (select 1 from @results)
    begin
        select COUNT(*) as TotalCount
        from [dbo].[InventoryService] mi
        where exists (
            select 1 
            from @partialKeys keys 
            where mi.[CatalogEntryCode] = isnull(keys.[CatalogEntryCode], mi.[CatalogEntryCode])
              and mi.[WarehouseCode] = isnull(keys.[WarehouseCode], mi.[WarehouseCode]))
    end
    else
    begin
        select top 1 [TotalCount] from @results
    end
       
    select 
        [CatalogEntryCode], 
        [WarehouseCode], 
        [IsTracked], 
        [PurchaseAvailableQuantity], 
        [PreorderAvailableQuantity], 
        [BackorderAvailableQuantity], 
        [PurchaseRequestedQuantity], 
        [PreorderRequestedQuantity], 
        [BackorderRequestedQuantity], 
        [PurchaseAvailableUtc],
        [PreorderAvailableUtc],
        [BackorderAvailableUtc],
        [AdditionalQuantity],
        [ReorderMinQuantity]
    from @results
    order by [RowNumber]
END
GO
PRINT N'Creating [dbo].[ecf_Inventory_QueryInventory]...';


GO
CREATE PROCEDURE [dbo].[ecf_Inventory_QueryInventory]
    @entryKeys [dbo].[udttInventoryCode] READONLY,
	@warehouseKeys [dbo].[udttInventoryCode] READONLY,
	@partialKeys [dbo].[udttInventory] READONLY
AS
BEGIN
    select
        [CatalogEntryCode], 
        [WarehouseCode], 
        [IsTracked], 
        [PurchaseAvailableQuantity], 
        [PreorderAvailableQuantity], 
        [BackorderAvailableQuantity], 
        [PurchaseRequestedQuantity], 
        [PreorderRequestedQuantity], 
        [BackorderRequestedQuantity], 
        [PurchaseAvailableUtc],
        [PreorderAvailableUtc],
        [BackorderAvailableUtc],
        [AdditionalQuantity],
        [ReorderMinQuantity]
    from [dbo].[InventoryService] mi
    where exists (
        select 1 
        from @entryKeys keys1 
        where mi.[CatalogEntryCode] = keys1.[Code])
    union
	select
        [CatalogEntryCode], 
        [WarehouseCode], 
        [IsTracked], 
        [PurchaseAvailableQuantity], 
        [PreorderAvailableQuantity], 
        [BackorderAvailableQuantity], 
        [PurchaseRequestedQuantity], 
        [PreorderRequestedQuantity], 
        [BackorderRequestedQuantity], 
        [PurchaseAvailableUtc],
        [PreorderAvailableUtc],
        [BackorderAvailableUtc],
        [AdditionalQuantity],
        [ReorderMinQuantity]
    from [dbo].[InventoryService] mi
    where exists (
        select 1 
        from @warehouseKeys keys2 
        where mi.[WarehouseCode] = keys2.[Code])
    union
	select
        [CatalogEntryCode], 
        [WarehouseCode], 
        [IsTracked], 
        [PurchaseAvailableQuantity], 
        [PreorderAvailableQuantity], 
        [BackorderAvailableQuantity], 
        [PurchaseRequestedQuantity], 
        [PreorderRequestedQuantity], 
        [BackorderRequestedQuantity], 
        [PurchaseAvailableUtc],
        [PreorderAvailableUtc],
        [BackorderAvailableUtc],
        [AdditionalQuantity],
        [ReorderMinQuantity]
    from [dbo].[InventoryService] mi
    where exists (
        select 1 
        from @partialKeys keys3 
        where mi.[CatalogEntryCode] = keys3.[CatalogEntryCode]
          and mi.[WarehouseCode] = keys3.[WarehouseCode])
    order by [CatalogEntryCode], [WarehouseCode]


END
GO
PRINT N'Creating [dbo].[ecf_Inventory_ListInventory]...';


GO
CREATE PROCEDURE [dbo].[ecf_Inventory_ListInventory]
AS
BEGIN
    select
        [CatalogEntryCode], 
        [WarehouseCode], 
        [IsTracked], 
        [PurchaseAvailableQuantity], 
        [PreorderAvailableQuantity], 
        [BackorderAvailableQuantity], 
        [PurchaseRequestedQuantity], 
        [PreorderRequestedQuantity], 
        [BackorderRequestedQuantity], 
        [PurchaseAvailableUtc],
        [PreorderAvailableUtc],
        [BackorderAvailableUtc],
        [AdditionalQuantity],
        [ReorderMinQuantity]
    from [dbo].[InventoryService]
    order by [CatalogEntryCode], [WarehouseCode]
END
GO
PRINT N'Creating [dbo].[ecf_Inventory_GetInventory]...';


GO
CREATE PROCEDURE [dbo].[ecf_Inventory_GetInventory]
    @CatalogKeys udttCatalogKey readonly
AS
BEGIN
    select
        i.[CatalogEntryCode], 
        i.[WarehouseCode], 
        i.[IsTracked], 
        i.[PurchaseAvailableQuantity], 
        i.[PreorderAvailableQuantity], 
        i.[BackorderAvailableQuantity], 
        i.[PurchaseRequestedQuantity], 
        i.[PreorderRequestedQuantity], 
        i.[BackorderRequestedQuantity], 
        i.[PurchaseAvailableUtc],
        i.[PreorderAvailableUtc],
        i.[BackorderAvailableUtc],
        i.[AdditionalQuantity],
        i.[ReorderMinQuantity]
    from [dbo].[InventoryService] i
    inner join @CatalogKeys k
    on i.[CatalogEntryCode] = k.CatalogEntryCode
END
GO
PRINT N'Creating [dbo].[ecf_Inventory_UpdateWarehouse]...';


GO
CREATE PROCEDURE [dbo].[ecf_Inventory_UpdateWarehouse]
    @Name NVARCHAR(255),
    @CreatorId NVARCHAR(100),
    @Created DATETIME,
    @ModifierId NVARCHAR(100),
    @Modified DATETIME,
    @IsActive BIT,
    @IsPrimary BIT,
    @SortOrder INT,
    @Code NVARCHAR(50),
    @IsFulfillmentCenter BIT,
    @IsPickupLocation BIT,
    @IsDeliveryLocation BIT,
    @FirstName NVARCHAR(64),
    @LastName NVARCHAR(64),
    @Organization NVARCHAR(64),
    @Line1 NVARCHAR(80),
    @Line2 NVARCHAR(80),
    @City NVARCHAR(64),
    @State NVARCHAR(64),
    @CountryCode NVARCHAR(50),
    @CountryName NVARCHAR(50),
    @PostalCode NVARCHAR(20),
    @RegionCode NVARCHAR(50),
    @RegionName NVARCHAR(64),
    @DaytimePhoneNumber NVARCHAR(32),
    @EveningPhoneNumber NVARCHAR(32),
    @FaxNumber NVARCHAR(32),
    @Email NVARCHAR(64)
AS
BEGIN    
    update dbo.Warehouse
    set 
        [Name] = @Name,
        [CreatorId] = @CreatorId,
        [Created] = @Created,
        [ModifierId] = @ModifierId,
        [Modified] = @Modified,
        [IsActive] = @IsActive,
        [IsPrimary] = @IsPrimary,
        [SortOrder] = @SortOrder,
        [Code] = @Code,
        [IsFulfillmentCenter] = @IsFulfillmentCenter,
        [IsPickupLocation] = @IsPickupLocation,
        [IsDeliveryLocation] = @IsDeliveryLocation,
        [FirstName] = @FirstName,
        [LastName] = @LastName,
        [Organization] = @Organization,
        [Line1] = @Line1,
        [Line2] = @Line2,
        [City] = @City,
        [State] = @State,
        [CountryCode] = @CountryCode,
        [CountryName] = @CountryName,
        [PostalCode] = @PostalCode,
        [RegionCode] = @RegionCode,
        [RegionName] = @RegionName,
        [DaytimePhoneNumber] = @DaytimePhoneNumber,
        [EveningPhoneNumber] = @EveningPhoneNumber,
        [FaxNumber] = @FaxNumber,
        [Email] = @Email
    where [Code] = @Code    
END
GO
PRINT N'Creating [dbo].[ecf_Inventory_InsertWarehouse]...';


GO
CREATE PROCEDURE [dbo].[ecf_Inventory_InsertWarehouse]
    @Name NVARCHAR(255),
    @CreatorId NVARCHAR(100),
    @Created DATETIME,
    @ModifierId NVARCHAR(100),
    @Modified DATETIME,
    @IsActive BIT,
    @IsPrimary BIT,
    @SortOrder INT,
    @Code NVARCHAR(50),
    @IsFulfillmentCenter BIT,
    @IsPickupLocation BIT,
    @IsDeliveryLocation BIT,
    @FirstName NVARCHAR(64),
    @LastName NVARCHAR(64),
    @Organization NVARCHAR(64),
    @Line1 NVARCHAR(80),
    @Line2 NVARCHAR(80),
    @City NVARCHAR(64),
    @State NVARCHAR(64),
    @CountryCode NVARCHAR(50),
    @CountryName NVARCHAR(50),
    @PostalCode NVARCHAR(20),
    @RegionCode NVARCHAR(50),
    @RegionName NVARCHAR(64),
    @DaytimePhoneNumber NVARCHAR(32),
    @EveningPhoneNumber NVARCHAR(32),
    @FaxNumber NVARCHAR(32),
    @Email NVARCHAR(64)
AS
BEGIN    
    insert into [dbo].[Warehouse] (
        [Name],
        [CreatorId],
        [Created],
        [ModifierId],
        [Modified],
        [IsActive],
        [IsPrimary],
        [SortOrder],
        [Code],
        [IsFulfillmentCenter],
        [IsPickupLocation],
        [IsDeliveryLocation],
        [FirstName],
        [LastName],
        [Organization],
        [Line1],
        [Line2],
        [City],
        [State],
        [CountryCode],
        [CountryName],
        [PostalCode],
        [RegionCode],
        [RegionName],
        [DaytimePhoneNumber],
        [EveningPhoneNumber],
        [FaxNumber],
        [Email]
    ) values (
        @Name,
        @CreatorId,
        @Created,
        @ModifierId,
        @Modified,
        @IsActive,
        @IsPrimary,
        @SortOrder,
        @Code,
        @IsFulfillmentCenter,
        @IsPickupLocation,
        @IsDeliveryLocation,
        @FirstName,
        @LastName,
        @Organization,
        @Line1,
        @Line2,
        @City,
        @State,
        @CountryCode,
        @CountryName,
        @PostalCode,
        @RegionCode,
        @RegionName,
        @DaytimePhoneNumber,
        @EveningPhoneNumber,
        @FaxNumber,
        @Email
    )
END
GO
PRINT N'Creating [dbo].[ecf_Inventory_SaveWarehouse]...';


GO
CREATE PROCEDURE [dbo].[ecf_Inventory_SaveWarehouse]
    @Name NVARCHAR(255),
    @CreatorId NVARCHAR(100),
    @Created DATETIME,
    @ModifierId NVARCHAR(100),
    @Modified DATETIME,
    @IsActive BIT,
    @IsPrimary BIT,
    @SortOrder INT,
    @Code NVARCHAR(50),
    @IsFulfillmentCenter BIT,
    @IsPickupLocation BIT,
    @IsDeliveryLocation BIT,
    @FirstName NVARCHAR(64),
    @LastName NVARCHAR(64),
    @Organization NVARCHAR(64),
    @Line1 NVARCHAR(80),
    @Line2 NVARCHAR(80),
    @City NVARCHAR(64),
    @State NVARCHAR(64),
    @CountryCode NVARCHAR(50),
    @CountryName NVARCHAR(50),
    @PostalCode NVARCHAR(20),
    @RegionCode NVARCHAR(50),
    @RegionName NVARCHAR(64),
    @DaytimePhoneNumber NVARCHAR(32),
    @EveningPhoneNumber NVARCHAR(32),
    @FaxNumber NVARCHAR(32),
    @Email NVARCHAR(64)
AS
BEGIN
    if exists (select 1 from [dbo].[Warehouse] where [Code] = @Code)
    begin
        exec [dbo].[ecf_Inventory_UpdateWarehouse]
            @Name,
            @CreatorId,
            @Created,
            @ModifierId,
            @Modified,
            @IsActive,
            @IsPrimary,
            @SortOrder,
            @Code,
            @IsFulfillmentCenter,
            @IsPickupLocation,
            @IsDeliveryLocation,
            @FirstName,
            @LastName,
            @Organization,
            @Line1,
            @Line2,
            @City,
            @State,
            @CountryCode,
            @CountryName,
            @PostalCode,
            @RegionCode,
            @RegionName,
            @DaytimePhoneNumber,
            @EveningPhoneNumber,
            @FaxNumber,
            @Email
    end
    else
    begin
        exec [dbo].[ecf_Inventory_InsertWarehouse]
            @Name,
            @CreatorId,
            @Created,
            @ModifierId,
            @Modified,
            @IsActive,
            @IsPrimary,
            @SortOrder,
            @Code,
            @IsFulfillmentCenter,
            @IsPickupLocation,
            @IsDeliveryLocation,
            @FirstName,
            @LastName,
            @Organization,
            @Line1,
            @Line2,
            @City,
            @State,
            @CountryCode,
            @CountryName,
            @PostalCode,
            @RegionCode,
            @RegionName,
            @DaytimePhoneNumber,
            @EveningPhoneNumber,
            @FaxNumber,
            @Email
    end
END
GO
PRINT N'Creating [dbo].[ecf_Inventory_ListWarehouses]...';


GO
CREATE PROCEDURE [dbo].[ecf_Inventory_ListWarehouses]
AS
BEGIN
    select
        [WarehouseId],
        [Name],
        [CreatorId],
        [Created],
        [ModifierId],
        [Modified],
        [IsActive],
        [IsPrimary],
        [SortOrder],
        [Code],
        [IsFulfillmentCenter],
        [IsPickupLocation],
        [IsDeliveryLocation],
        [FirstName],
        [LastName],
        [Organization],
        [Line1],
        [Line2],
        [City],
        [State],
        [CountryCode],
        [CountryName],
        [PostalCode],
        [RegionCode],
        [RegionName],
        [DaytimePhoneNumber],
        [EveningPhoneNumber],
        [FaxNumber],
        [Email]
    from [dbo].[Warehouse]
END
GO
PRINT N'Creating [dbo].[ecf_Inventory_GetWarehouse]...';


GO
CREATE PROCEDURE [dbo].[ecf_Inventory_GetWarehouse]
    @Code nvarchar(50)
AS
BEGIN
    select
        [WarehouseId],
        [Name],
        [CreatorId],
        [Created],
        [ModifierId],
        [Modified],
        [IsActive],
        [IsPrimary],
        [SortOrder],
        [Code],
        [IsFulfillmentCenter],
        [IsPickupLocation],
        [IsDeliveryLocation],
        [FirstName],
        [LastName],
        [Organization],
        [Line1],
        [Line2],
        [City],
        [State],
        [CountryCode],
        [CountryName],
        [PostalCode],
        [RegionCode],
        [RegionName],
        [DaytimePhoneNumber],
        [EveningPhoneNumber],
        [FaxNumber],
        [Email]
    from [dbo].[Warehouse]
    where [Code] = @Code
END
GO
PRINT N'Creating [dbo].[ecf_OrderGroupLock_GetByOrderGroupId]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderGroupLock_GetByOrderGroupId]
@OrderGroupId AS Int
AS
BEGIN
SET NOCOUNT ON;

SELECT top 1 [t01].[OrderLockId] AS [OrderLockId], [t01].[CustomerId] AS [CustomerId], [t01].[Created] AS [Created], [t01].[OrderGroupId] AS [OrderGroupId]
FROM [OrderGroupLock] AS [t01]
WHERE ([t01].[OrderGroupId]=@OrderGroupId)

END
GO
PRINT N'Creating [dbo].[ecf_OrderGroupLock_ListByCustomerId]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderGroupLock_ListByCustomerId]
@CustomerId AS Uniqueidentifier
AS
BEGIN
SET NOCOUNT ON;

SELECT [t01].[OrderLockId] AS [OrderLockId], [t01].[CustomerId] AS [CustomerId], [t01].[Created] AS [Created], [t01].[OrderGroupId] AS [OrderGroupId]
FROM [OrderGroupLock] AS [t01]
WHERE [t01].[CustomerId]=@CustomerId

END
GO
PRINT N'Creating [dbo].[mdpsp_sys_CheckReplaceUser]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_CheckReplaceUser]
	@OldUserId AS nvarchar(100),
	@Retval AS INT OUTPUT
AS
	SET NOCOUNT ON

	SET @Retval = 0

	DECLARE classall_cursor CURSOR FOR
		SELECT MetaClassId, TableName FROM MetaClass WHERE IsSystem =0 AND IsAbstract = 0

	DECLARE @MetaClassId	INT
	DECLARE @TableName		NVARCHAR(255)

	OPEN classall_cursor
	FETCH NEXT FROM classall_cursor INTO @MetaClassId, @TableName

	DECLARE @SQLString NVARCHAR(500)

	WHILE(@@FETCH_STATUS = 0 AND @Retval = 0)
	BEGIN

		SET @SQLString  = N'IF EXISTS(SELECT TOP 1 * FROM ' + @TableName  + ' WHERE CreatorId = @OldUserId) SELECT 1'
		EXEC sp_executesql @SQLString, N'@OldUserId AS nvarchar(100)', @OldUserId = @OldUserId
		IF @@ROWCOUNT <> 0
		BEGIN
			SET @Retval = 1
			BREAK
		END

		SET @SQLString  = N'IF EXISTS(SELECT TOP 1 * FROM ' + @TableName  + ' WHERE ModifierId = @OldUserId) SELECT 1'
		EXEC sp_executesql @SQLString, N'@OldUserId AS nvarchar(100)', @OldUserId = @OldUserId
		IF @@ROWCOUNT <> 0
		BEGIN
			SET @Retval = 1
			BREAK
		END

		FETCH NEXT FROM classall_cursor INTO @MetaClassId, @TableName
	END

	CLOSE classall_cursor
	DEALLOCATE classall_cursor
RETURN
GO
PRINT N'Creating [dbo].[aspnet_Setup_RemoveAllRoleMembers]...';


GO
CREATE PROCEDURE [dbo].[aspnet_Setup_RemoveAllRoleMembers]
    @name   sysname
AS
BEGIN
    CREATE TABLE #aspnet_RoleMembers
    (
        Group_name      sysname,
        Group_id        smallint,
        Users_in_group  sysname,
        User_id         smallint
    )
	
	INSERT INTO #aspnet_RoleMembers
	select Role_name = substring(r.name, 1, 25), Role_id = r.principal_id,
		Users_in_role = substring(u.name, 1, 25), Userid = u.principal_id
	from sys.database_principals u, sys.database_principals r, sys.database_role_members m
	where r.name = @name
		and r.principal_id = m.role_principal_id
		and u.principal_id = m.member_principal_id
	order by 1, 2

    DECLARE @user_id smallint
    DECLARE @cmd nvarchar(500)
    DECLARE c1 cursor FORWARD_ONLY FOR
        SELECT User_id FROM #aspnet_RoleMembers

    OPEN c1

    FETCH c1 INTO @user_id
    WHILE (@@fetch_status = 0)
    BEGIN
        SET @cmd = 'EXEC sp_droprolemember ' + '''' + @name + ''', ''' + USER_NAME(@user_id) + ''''
        EXEC (@cmd)
        FETCH c1 INTO @user_id
    END

    CLOSE c1
    DEALLOCATE c1
END
GO
PRINT N'Creating [dbo].[aspnet_Setup_RestorePermissions]...';


GO

CREATE PROCEDURE [dbo].aspnet_Setup_RestorePermissions
    @name   sysname
AS
BEGIN
    DECLARE @object sysname
    DECLARE @protectType char(10)
    DECLARE @action varchar(60)
    DECLARE @grantee sysname
    DECLARE @cmd nvarchar(500)
    DECLARE c1 cursor FORWARD_ONLY FOR
        SELECT Object, ProtectType, [Action], Grantee FROM #aspnet_Permissions where Object = @name

    OPEN c1

    FETCH c1 INTO @object, @protectType, @action, @grantee
    WHILE (@@fetch_status = 0)
    BEGIN
        SET @cmd = @protectType + ' ' + @action + ' on ' + @object + ' TO [' + @grantee + ']'
        EXEC (@cmd)
        FETCH c1 INTO @object, @protectType, @action, @grantee
    END

    CLOSE c1
    DEALLOCATE c1
END
GO
PRINT N'Creating [dbo].[ecf_Warehouse_Delete]...';


GO
CREATE PROCEDURE dbo.ecf_Warehouse_Delete
	@WarehouseId INT
AS
BEGIN
	BEGIN TRY
    DECLARE @initialTranCount INT = @@TRANCOUNT
    IF @initialTranCount = 0 BEGIN TRANSACTION
    
    DELETE FROM dbo.Warehouse
    WHERE WarehouseId = @WarehouseId
    
    IF @initialTranCount = 0 COMMIT TRANSACTION
	END TRY
	BEGIN CATCH
    DECLARE @msg NVARCHAR(4000), @severity INT, @state INT
    SELECT @msg = ERROR_MESSAGE(), @severity = ERROR_SEVERITY(), @state = ERROR_STATE()    
    IF @initialTranCount = 0 ROLLBACK TRANSACTION   
    RAISERROR(@msg, @severity, @state)
	END CATCH
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_AddMetaDictionary]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_AddMetaDictionary]
	@MetaFieldId	INT,
	@Language	NVARCHAR(20)=NULL,
	@DefaultValue	NVARCHAR(2048),
	@DefaultTag	IMAGE=NULL,
	@Value		NVARCHAR(2048),
	@Tag		IMAGE=NULL,
	@Retval	INT OUT
AS
	SET NOCOUNT ON
	SET @Retval = -1

BEGIN TRAN
	DECLARE @MultiLanguageValue BIT
	SELECT @MultiLanguageValue = MultiLanguageValue FROM MetaField WHERE MetaFieldId = @MetaFieldId

	IF  @MultiLanguageValue = 1
	BEGIN
		INSERT INTO MetaDictionary (MetaFieldId, [Value], Tag) VALUES (@MetaFieldId, @DefaultValue, @DefaultTag)
		IF @@ERROR <> 0 GOTO ERR
		SET @Retval = @@IDENTITY

		IF @Language IS NOT NULL
		BEGIN
			IF EXISTS(SELECT * FROM MetaDictionaryLocalization WHERE MetaDictionaryId = @Retval AND Language = @Language)
				UPDATE MetaDictionaryLocalization SET Value = @Value, Tag = @Tag WHERE MetaDictionaryId = @Retval AND Language = @Language
			ELSE
				INSERT INTO MetaDictionaryLocalization (MetaDictionaryId, Language,  Value, Tag) VALUES (@Retval, @Language, @Value, @Tag)
			IF @@ERROR <> 0 GOTO ERR
		END
	END
	ELSE
	BEGIN
		INSERT INTO MetaDictionary (MetaFieldId, [Value], Tag) VALUES (@MetaFieldId, @Value, @Tag)
		IF @@ERROR <> 0 GOTO ERR
		SET @Retval = @@IDENTITY
	END

	COMMIT TRAN
RETURN

ERR:
	SET @Retval = -1
	ROLLBACK TRAN
RETURN
GO
PRINT N'Creating [dbo].[ecf_Warehouse_Save]...';


GO
CREATE PROCEDURE dbo.ecf_Warehouse_Save
	@Warehouse udttWarehouse READONLY
AS
BEGIN
	BEGIN TRY
	DECLARE @initialTranCount INT = @@TRANCOUNT
    IF @initialTranCount = 0 BEGIN TRANSACTION

    IF (SELECT arg.WarehouseId FROM @Warehouse arg) IS NULL
		BEGIN 
			SET IDENTITY_INSERT dbo.Warehouse OFF
			INSERT INTO dbo.Warehouse
			(Name, CreatorId, Created, ModifierId, Modified, IsActive, IsPrimary, SortOrder, Code,
			 IsFulfillmentCenter, IsPickupLocation, IsDeliveryLocation,
			 FirstName, LastName, Organization, Line1, Line2, City, [State], CountryCode, CountryName,
			 PostalCode, RegionCode, RegionName, DaytimePhoneNumber, EveningPhoneNumber, FaxNumber, Email)
			SELECT arg.Name, arg.CreatorId, arg.Created, arg.ModifierId, arg.Modified,
				arg.IsActive, arg.IsPrimary, arg.SortOrder, arg.Code, arg.IsFulfillmentCenter, arg.IsPickupLocation, arg.IsDeliveryLocation, 
				arg.FirstName, arg.LastName, arg.Organization, arg.Line1, arg.Line2, arg.City, arg.[State], arg.CountryCode, arg.CountryName,
				arg.PostalCode, arg.RegionCode, arg.RegionName, arg.DaytimePhoneNumber, arg.EveningPhoneNumber,
				arg.FaxNumber, arg.Email
			FROM @Warehouse AS arg
		END
    ELSE
		BEGIN    
			UPDATE [dbo].[Warehouse]
			SET Name = arg.Name, Code = arg.Code, ModifierId = arg.ModifierId, Modified = arg.Modified,
			SortOrder = arg.SortOrder, IsActive = arg.IsActive, IsPrimary = arg.IsPrimary,
			IsFulfillmentCenter = arg.IsFulfillmentCenter, IsPickupLocation = arg.IsPickupLocation, IsDeliveryLocation = arg.IsDeliveryLocation, 
			FirstName = arg.FirstName, LastName = arg.LastName, Organization = arg.Organization, Line1 = arg.Line1, Line2 = arg.Line2, City = arg.City,
			[State] = arg.[State], CountryCode = arg.CountryCode, CountryName = arg.CountryName,
			PostalCode = arg.PostalCode, RegionCode = arg.RegionCode, RegionName = arg.RegionName,
			DaytimePhoneNumber = arg.DaytimePhoneNumber, EveningPhoneNumber = arg.EveningPhoneNumber,
			FaxNumber = arg.FaxNumber, Email = arg.Email
			FROM @Warehouse arg
			INNER JOIN dbo.Warehouse w
			ON w.WarehouseId = arg.WarehouseId
		END
		
    IF @initialTranCount = 0 COMMIT TRANSACTION
	END TRY
	BEGIN CATCH
    DECLARE @msg NVARCHAR(4000), @severity INT, @state INT
    SELECT @msg = ERROR_MESSAGE(), @severity = ERROR_SEVERITY(), @state = ERROR_STATE()    
    IF @initialTranCount = 0 ROLLBACK TRANSACTION   
    RAISERROR(@msg, @severity, @state)
	END CATCH
END
GO
PRINT N'Creating [dbo].[aspnet_WebEvent_LogEvent]...';


GO
CREATE PROCEDURE dbo.aspnet_WebEvent_LogEvent
        @EventId         char(32),
        @EventTimeUtc    datetime,
        @EventTime       datetime,
        @EventType       nvarchar(256),
        @EventSequence   decimal(19,0),
        @EventOccurrence decimal(19,0),
        @EventCode       int,
        @EventDetailCode int,
        @Message         nvarchar(1024),
        @ApplicationPath nvarchar(256),
        @ApplicationVirtualPath nvarchar(256),
        @MachineName    nvarchar(256),
        @RequestUrl      nvarchar(1024),
        @ExceptionType   nvarchar(256),
        @Details         ntext
AS
BEGIN
    INSERT
        dbo.aspnet_WebEvent_Events
        (
            EventId,
            EventTimeUtc,
            EventTime,
            EventType,
            EventSequence,
            EventOccurrence,
            EventCode,
            EventDetailCode,
            Message,
            ApplicationPath,
            ApplicationVirtualPath,
            MachineName,
            RequestUrl,
            ExceptionType,
            Details
        )
    VALUES
    (
        @EventId,
        @EventTimeUtc,
        @EventTime,
        @EventType,
        @EventSequence,
        @EventOccurrence,
        @EventCode,
        @EventDetailCode,
        @Message,
        @ApplicationPath,
        @ApplicationVirtualPath,
        @MachineName,
        @RequestUrl,
        @ExceptionType,
        @Details
    )
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_AddMetaAttribute]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_AddMetaAttribute]
	@AttrOwnerId		INT,
	@AttrOwnerType	INT,
	@Key			NVARCHAR(256),
	@Value			NVARCHAR(MAX)
AS
	IF ( (SELECT COUNT(*) FROM MetaAttribute WHERE AttrOwnerId = @AttrOwnerId AND AttrOwnerType = @AttrOwnerType AND [Key] = @Key) = 0)
	BEGIN
		-- Insert
		INSERT INTO MetaAttribute (AttrOwnerId, AttrOwnerType, [Key], [Value] ) VALUES (@AttrOwnerId, @AttrOwnerType, @Key, @Value)
	END
	ELSE
	BEGIN
		-- Update
		UPDATE MetaAttribute SET [Value] = @Value  WHERE AttrOwnerId = @AttrOwnerId AND AttrOwnerType = @AttrOwnerType AND [Key] = @Key
	END
GO
PRINT N'Creating [dbo].[ecf_Warehouse_GetByCode]...';


GO
CREATE PROCEDURE dbo.ecf_Warehouse_GetByCode
	@Code NVARCHAR(50)
AS
BEGIN
	SELECT * FROM Warehouse
	WHERE Code = @Code
END
GO
PRINT N'Creating [dbo].[ecf_Warehouse_GetById]...';


GO
CREATE PROCEDURE dbo.ecf_Warehouse_GetById
	@WarehouseId INT
AS
BEGIN
	SELECT * FROM Warehouse
	WHERE WarehouseId = @WarehouseId
END
GO
PRINT N'Creating [dbo].[ecf_Warehouse_List]...';


GO
CREATE PROCEDURE dbo.ecf_Warehouse_List
AS
BEGIN
	SELECT * FROM Warehouse
END
GO
PRINT N'Creating [dbo].[ecf_Currency_Modify]...';


GO

create procedure dbo.ecf_Currency_Modify
    @Currency udttCompatCurrency readonly,
    @CurrencyRate udttCompatCurrencyRate readonly
as
begin
    begin try
        declare @initialTranCount int = @@TRANCOUNT
        if @initialTranCount = 0 begin transaction
        
        declare @identitymap table (Placeholder int, Actual int)

        delete from CurrencyRate
        where CurrencyRateId in (select CurrencyRateId from @CurrencyRate where Operation = 'D')

        delete from Currency
        where CompatCurrencyId in (select CurrencyId from @Currency where Operation = 'D')

        update tgt
        set
            Modified = isnull(src.ModifiedDate, GETUTCDATE()),
            CurrencyName = src.Name
        from @Currency src
        join Currency tgt on src.CurrencyId = tgt.CompatCurrencyId
        where src.Operation = 'U'

        insert into Currency (CurrencyCode, Created, Modified, CurrencyName)
        select CurrencyCode, isnull(ModifiedDate, GETUTCDATE()), isnull(ModifiedDate, GETUTCDATE()), Name
        from @Currency
        where Operation = 'I'

        if (@@rowcount > 0)
        begin
            insert into @identitymap (Placeholder, Actual)
            select src.CurrencyId, tgt.CompatCurrencyId
            from @Currency src
            join Currency tgt on src.CurrencyCode = tgt.CurrencyCode
            where Operation = 'I'
        end

        update tgt
        set
            AverageRate = src.AverageRate,
            EndOfDayRate = src.EndOfDayRate,
            ModifiedDate = isnull(src.ModifiedDate, GETUTCDATE()),
            FromCurrencyId = isnull(fromId.Actual, src.FromCurrencyId),
            ToCurrencyId = isnull(toId.Actual, src.ToCurrencyId),
            CurrencyRateDate = src.CurrencyRateDate
        from @CurrencyRate src
        left outer join @identitymap fromId on src.FromCurrencyId = fromId.Placeholder
        left outer join @identitymap toId on src.ToCurrencyId = toId.Placeholder
        join CurrencyRate tgt on src.CurrencyRateId = tgt.CurrencyRateId
        where src.Operation = 'U'

        insert into CurrencyRate (AverageRate, EndOfDayRate, ModifiedDate, FromCurrencyId, ToCurrencyId, CurrencyRateDate)
        select
            src.AverageRate,
            src.EndOfDayRate, 
            isnull(src.ModifiedDate, GETUTCDATE()),
            isnull(fromId.Actual, src.FromCurrencyId), 
            isnull(toId.Actual, src.ToCurrencyId), 
            src.CurrencyRateDate
        from @CurrencyRate src
        left outer join @identitymap fromId on src.FromCurrencyId = fromId.Placeholder
        left outer join @identitymap toId on src.ToCurrencyId = toId.Placeholder
        where src.Operation = 'I'

        if @initialTranCount = 0 commit transaction
    end try
    begin catch
        declare @msg nvarchar(4000), @severity int, @state int
        select @msg = ERROR_MESSAGE(), @severity = ERROR_SEVERITY(), @state = ERROR_STATE()
        if @initialTranCount = 0 rollback transaction
        raiserror(@msg, @severity, @state)
    end catch
end
GO
PRINT N'Creating [dbo].[ecf_Currency_CurrencyId]...';


GO

create procedure dbo.ecf_Currency_CurrencyId
    @CurrencyId int
as
begin
    select
        CompatCurrencyId as CurrencyId,
        CurrencyCode,
        CurrencyName as Name,
        Modified as ModifiedDate
    from dbo.Currency
    where CompatCurrencyId = @CurrencyId

    select
        cr.CurrencyRateId,
        cr.AverageRate,
        cr.EndOfDayRate,
        cr.ModifiedDate,
        cr.FromCurrencyId,
        cr.ToCurrencyId,
        cr.CurrencyRateDate
    from dbo.CurrencyRate cr        
    where (FromCurrencyId = @CurrencyId or ToCurrencyId = @CurrencyId)
      and exists (select 1 from dbo.Currency c where c.CompatCurrencyId = @CurrencyId)
end
GO
PRINT N'Creating [dbo].[ecf_Currency_Code]...';


GO

create procedure dbo.ecf_Currency_Code
    @CurrencyCode nvarchar(8)
as
begin
    select
        CompatCurrencyId as CurrencyId,
        CurrencyCode,
        CurrencyName as Name,
        Modified as ModifiedDate
    from dbo.Currency
    where CurrencyCode = @CurrencyCode

    select
        cr.CurrencyRateId,
        cr.AverageRate,
        cr.EndOfDayRate,
        cr.ModifiedDate,
        cr.FromCurrencyId,
        cr.ToCurrencyId,
        cr.CurrencyRateDate
    from dbo.CurrencyRate cr    
    where exists (select 1 from dbo.Currency c where c.CompatCurrencyId = cr.FromCurrencyId and c.CurrencyCode = @CurrencyCode)
       or exists (select 1 from dbo.Currency c where c.CompatCurrencyId = cr.ToCurrencyId and c.CurrencyCode = @CurrencyCode)
end
GO
PRINT N'Creating [dbo].[ecf_Currency]...';


GO

create procedure dbo.ecf_Currency
as
begin
    select
        CompatCurrencyId as CurrencyId,
        CurrencyCode,
        CurrencyName as Name,
        Modified as ModifiedDate
    from Currency
    
    select
        cr.CurrencyRateId,
        cr.AverageRate,
        cr.EndOfDayRate,
        cr.ModifiedDate,
        cr.FromCurrencyId,
        cr.ToCurrencyId,
        cr.CurrencyRateDate
    from CurrencyRate cr
    where exists (select 1 from Currency c where c.CompatCurrencyId = cr.FromCurrencyId)
      and exists (select 1 from Currency c where c.CompatCurrencyId = cr.ToCurrencyId)
end
GO
PRINT N'Creating [dbo].[ecf_PriceDetail_ReplacePrices]...';


GO
create procedure [dbo].[ecf_PriceDetail_ReplacePrices]
    @CatalogKeys udttCatalogKey readonly,
    @PriceValues udttCatalogEntryPrice readonly
as
begin
    begin try
        declare @initialTranCount int = @@TRANCOUNT
        if @initialTranCount = 0 begin transaction
    
        delete from PriceDetail
        where exists (select 1 from @CatalogKeys ck where ck.CatalogEntryCode = PriceDetail.CatalogEntryCode)
     
        insert into PriceDetail (Created, Modified, CatalogEntryCode, MarketId, CurrencyCode, PriceTypeId, PriceCode, ValidFrom, ValidUntil, MinQuantity, UnitPrice)
        select GETUTCDATE(), GETUTCDATE(), CatalogEntryCode, MarketId, CurrencyCode, PriceTypeId, PriceCode, ValidFrom, ValidUntil, MinQuantity, UnitPrice
        from @PriceValues
                
        if @initialTranCount = 0 commit transaction
    end try
    begin catch
        declare @msg nvarchar(4000), @severity int, @state int
        select @msg = ERROR_MESSAGE(), @severity = ERROR_SEVERITY(), @state = ERROR_STATE()
        if @initialTranCount = 0 rollback transaction
        raiserror(@msg, @severity, @state)
    end catch
end
GO
PRINT N'Creating [dbo].[ecf_PriceDetail_Save]...';


GO
create procedure [dbo].[ecf_PriceDetail_Save]
    @priceValues udttPriceDetail readonly
as
begin
    begin try
        declare @initialTranCount int = @@TRANCOUNT
        if @initialTranCount = 0 begin transaction

        declare @results table (PriceValueId bigint)
        declare @affectedEntries table (CatalogEntryCode nvarchar(100))

        insert into @affectedEntries (CatalogEntryCode)
        select distinct CatalogEntryCode
        from dbo.PriceDetail
        where PriceValueId in (select PriceValueId from @priceValues where CatalogEntryCode is null)

        delete from dbo.PriceDetail
        where PriceValueId in (select PriceValueId from @priceValues where CatalogEntryCode is null)
                
        insert into @results (PriceValueId)
        select dst.PriceValueId
        from dbo.PriceDetail dst
        join @priceValues src on dst.PriceValueId = src.PriceValueId
        where src.PriceValueId > 0

        ;with update_effects as (
            select 
                dst.CatalogEntryCode as CatalogEntryCodeBefore,
                src.CatalogEntryCode as CatalogEntryCodeAfter
            from dbo.PriceDetail dst
            join @priceValues src on dst.PriceValueId = src.PriceValueId
        )
        insert into @affectedEntries (CatalogEntryCode)
        select CatalogEntryCodeBefore from update_effects
        union
        select CatalogEntryCodeAfter from update_effects

        update dst
        set
            Modified = GETUTCDATE(),
            CatalogEntryCode = src.CatalogEntryCode,
            MarketId = src.MarketId,
            CurrencyCode = src.CurrencyCode,
            PriceTypeId = src.PriceTypeId,
            PriceCode = src.PriceCode,
            ValidFrom = src.ValidFrom,
            ValidUntil = src.ValidUntil,
            MinQuantity = src.MinQuantity,
            UnitPrice = src.UnitPrice
        from dbo.PriceDetail dst
        join @priceValues src on dst.PriceValueId = src.PriceValueId
        where src.PriceValueId > 0

        declare @catalogEntryCode nvarchar(100)
        declare @marketId nvarchar(8)
        declare @currencyCode nvarchar(8)
        declare @priceTypeId int
        declare @priceCode nvarchar(256)
        declare @validFrom datetime
        declare @validUntil datetime
        declare @minQuantity decimal(38,9)
        declare @unitPrice DECIMAL (38, 9)
        declare inserted_prices cursor local for
            select CatalogEntryCode, MarketId, CurrencyCode, PriceTypeId, PriceCode, ValidFrom, ValidUntil, MinQuantity, UnitPrice
            from @priceValues
            where PriceValueId <= 0
        open inserted_prices
        while 1=1
        begin
            fetch next from inserted_prices into @catalogEntryCode, @marketId, @currencyCode, @priceTypeId, @priceCode, @validFrom, @validUntil, @minQuantity, @unitPrice
            if @@FETCH_STATUS != 0 break

            insert into dbo.PriceDetail (Created, Modified, CatalogEntryCode, MarketId, CurrencyCode, PriceTypeId, PriceCode, ValidFrom, ValidUntil, MinQuantity, UnitPrice)
            values (GETUTCDATE(), GETUTCDATE(), @catalogEntryCode, @marketId, @currencyCode, @priceTypeId, @priceCode, @validFrom, @validUntil, @minQuantity, @unitPrice)

            insert into @results (PriceValueId) 
            values (SCOPE_IDENTITY())

            insert into @affectedEntries (CatalogEntryCode)
            values (@catalogEntryCode)
        end
        close inserted_prices

        select 
            PriceValueId,
            Created,
            Modified,
            CatalogEntryCode,
            MarketId,
            CurrencyCode,
            PriceTypeId,
            PriceCode,
            ValidFrom,
            ValidUntil,
            MinQuantity,
            UnitPrice
        from PriceDetail
        where PriceValueId in (select PriceValueId from @results)

        select
            pd.PriceValueId,
            pd.Created,
            pd.Modified,
            ae.CatalogEntryCode,
            pd.MarketId,
            pd.CurrencyCode,
            pd.PriceTypeId,
            pd.PriceCode,
            pd.ValidFrom,
            pd.ValidUntil,
            pd.MinQuantity,
            pd.UnitPrice
        from (select distinct CatalogEntryCode from @affectedEntries) ae
        left outer join PriceDetail pd on ae.CatalogEntryCode = pd.CatalogEntryCode

        if @initialTranCount = 0 commit transaction
    end try
    begin catch
        declare @msg nvarchar(4000), @severity int, @state int
        select @msg = ERROR_MESSAGE(), @severity = ERROR_SEVERITY(), @state = ERROR_STATE()
        if @initialTranCount = 0 rollback transaction
        raiserror(@msg, @severity, @state)
    end catch
end
GO
PRINT N'Creating [dbo].[ecf_PriceDetail_List]...';


GO
create procedure [dbo].[ecf_PriceDetail_List]
    @catalogEntryId int = null,
    @catalogNodeId int = null,
    @MarketId nvarchar(8),
    @CurrencyCodes udttCurrencyCode readonly,
    @CustomerPricing udttCustomerPricing readonly,
    @totalCount int output,
    @pagingOffset int = null,
    @pagingCount int = null
as
begin
    declare @filterCurrencies bit = case when exists (select 1 from @CurrencyCodes) then 1 else 0 end
    declare @filterCustomerPricing bit = case when exists (select 1 from @CustomerPricing) then 1 else 0 end
    if (@pagingOffset is null and @pagingCount is null)
    begin
        set @totalCount = -1

        ;with specified_entries as (
            select @catalogEntryId as CatalogEntryId
            where @catalogEntryId is not null
            union
            select CatalogEntryId
            from NodeEntryRelation
            where CatalogNodeId = @catalogNodeId
        ),
        returned_entries as (
            select ce.CatalogEntryId, ce.Code
            from specified_entries se
            join CatalogEntry ce on se.CatalogEntryId = ce.CatalogEntryId
            union all
            select ce.CatalogEntryId, ce.Code
            from specified_entries se
            join CatalogEntryRelation cer
                on se.CatalogEntryId = cer.ParentEntryId
                and cer.RelationTypeId in ('ProductVariation')
            join CatalogEntry ce on cer.ChildEntryId = ce.CatalogEntryId
        )
        select
            pd.PriceValueId,
            pd.Created,
            pd.Modified,
            pd.CatalogEntryCode,
            pd.MarketId,
            pd.CurrencyCode,
            pd.PriceTypeId,
            pd.PriceCode,
            pd.ValidFrom,
            pd.ValidUntil,
            pd.MinQuantity,
            pd.UnitPrice
        from PriceDetail pd
        where exists (select 1 from returned_entries re where pd.CatalogEntryCode = re.Code)
        and (@MarketId = '' or pd.MarketId = @MarketId)
        and (@filterCurrencies = 0 or pd.CurrencyCode in (select CurrencyCode from @CurrencyCodes))
        and (@filterCustomerPricing = 0 or exists (select 1 from @CustomerPricing cp where cp.PriceTypeId = pd.PriceTypeId and cp.PriceCode = pd.PriceCode))
        order by CatalogEntryCode
    end
    else
    begin
        declare @ordered_results table (
            ordering int not null,
            PriceValueId bigint not null,
            Created datetime not null,
            Modified datetime not null,
            CatalogEntryCode nvarchar(100) not null,
            MarketId nvarchar(8) not null,
            CurrencyCode nvarchar(8) not null,
            PriceTypeId int not null,
            PriceCode nvarchar(256) not null,
            ValidFrom datetime not null,
            ValidUntil datetime null,
            MinQuantity decimal(38,9) not null,
            UnitPrice DECIMAL (38, 9) not null
        )

        ;with specified_entries as (
            select @catalogEntryId as CatalogEntryId
            where @catalogEntryId is not null
            union
            select CatalogEntryId
            from NodeEntryRelation
            where CatalogNodeId = @catalogNodeId
        ),
        returned_entries as (
            select ce.CatalogEntryId, ce.Code
            from specified_entries se
            join CatalogEntry ce on se.CatalogEntryId = ce.CatalogEntryId
            union all
            select ce.CatalogEntryId, ce.Code
            from specified_entries se
            join CatalogEntryRelation cer
                on se.CatalogEntryId = cer.ParentEntryId
                and cer.RelationTypeId in ('ProductVariation')
            join CatalogEntry ce on cer.ChildEntryId = ce.CatalogEntryId
        )
        insert into @ordered_results (
            ordering,
            PriceValueId,
            Created,
            Modified,
            CatalogEntryCode,
            MarketId,
            CurrencyCode,
            PriceTypeId,
            PriceCode,
            ValidFrom,
            ValidUntil,
            MinQuantity,
            UnitPrice
        )
        select
            --we order by price code, market id and currency code to make the similar prices near each others.
            ROW_NUMBER() over (ORDER BY pd.CatalogEntryCode, pd.PriceCode, pd.MarketId, pd.CurrencyCode) - 1, -- arguments are zero-based.
            pd.PriceValueId,
            pd.Created,
            pd.Modified,
            pd.CatalogEntryCode,
            pd.MarketId,
            pd.CurrencyCode,
            pd.PriceTypeId,
            pd.PriceCode,
            pd.ValidFrom,
            pd.ValidUntil,
            pd.MinQuantity,
            pd.UnitPrice
        from PriceDetail pd
        where exists (select 1 from returned_entries re where pd.CatalogEntryCode = re.Code)
        and (@MarketId = '' or pd.MarketId = @MarketId)
        and (@filterCurrencies = 0 or pd.CurrencyCode in (select CurrencyCode from @CurrencyCodes))
        and (@filterCustomerPricing = 0 or exists (select 1 from @CustomerPricing cp where cp.PriceTypeId = pd.PriceTypeId and cp.PriceCode = pd.PriceCode))
        select @totalCount = count(*) from @ordered_results

        select
            PriceValueId,
            Created,
            Modified,
            CatalogEntryCode,
            MarketId,
            CurrencyCode,
            PriceTypeId,
            PriceCode,
            ValidFrom,
            ValidUntil,
            MinQuantity,
            UnitPrice
        from @ordered_results
        where @pagingOffset <= ordering and ordering < (@pagingOffset + @pagingCount)
        order by ordering
    end
end
GO
PRINT N'Creating [dbo].[ecf_PriceDetail_Get]...';


GO
create procedure [dbo].[ecf_PriceDetail_Get]
    @priceValueId bigint
as
begin
    select
        pd.PriceValueId,
        pd.Created,
        pd.Modified,
        pd.CatalogEntryCode,
        pd.MarketId,
        pd.CurrencyCode,
        pd.PriceTypeId,
        pd.PriceCode,
        pd.ValidFrom,
        pd.ValidUntil,
        pd.MinQuantity,
        pd.UnitPrice
    from PriceDetail pd
    where pd.PriceValueId = @priceValueId
end
GO
PRINT N'Creating [dbo].[ecf_Pricing_EnsurePriceTypes]...';


GO


create procedure [dbo].[ecf_Pricing_EnsurePriceTypes]
    @PriceTypes udttPriceType readonly
as
begin
    begin try
        declare @initialTranCount int = @@TRANCOUNT
        if @initialTranCount = 0 begin transaction

        merge into dbo.PriceType tpt
        using (select distinct [PriceTypeId], [PriceTypeName] from @PriceTypes) src
        on (    tpt.PriceTypeId = src.PriceTypeId)
        when matched then update set tpt.PriceTypeName = src.PriceTypeName
        when not matched then insert ([PriceTypeId], [PriceTypeName])
            values (src.[PriceTypeId], src.[PriceTypeName]);

        if @initialTranCount = 0 commit transaction
    end try
    begin catch
        declare @msg nvarchar(4000), @severity int, @state int
        select @msg = ERROR_MESSAGE(), @severity = ERROR_SEVERITY(), @state = ERROR_STATE()
        if @initialTranCount = 0 rollback transaction
        raiserror(@msg, @severity, @state)
    end catch
end
GO
PRINT N'Creating [dbo].[ecf_Pricing_SetCatalogEntryPrices]...';


GO
create procedure dbo.ecf_Pricing_SetCatalogEntryPrices
    @CatalogKeys udttCatalogKey readonly,
    @PriceValues udttCatalogEntryPrice readonly
as
begin
    begin try
        declare @initialTranCount int = @@TRANCOUNT
        if @initialTranCount = 0 begin transaction

        delete pv
        from @CatalogKeys ck
        join dbo.PriceGroup pg on ck.CatalogEntryCode = pg.CatalogEntryCode
        join dbo.PriceValue pv on pg.PriceGroupId = pv.PriceGroupId

        merge into dbo.PriceGroup tgt
        using (select distinct CatalogEntryCode, MarketId, CurrencyCode, PriceTypeId, PriceCode from @PriceValues) src
        on (    tgt.CatalogEntryCode = src.CatalogEntryCode
            and tgt.MarketId = src.MarketId
            and tgt.CurrencyCode = src.CurrencyCode
            and tgt.PriceTypeId = src.PriceTypeId
            and tgt.PriceCode = src.PriceCode)
        when matched then update set Modified = GETUTCDATE()
        when not matched then insert (Created, Modified, CatalogEntryCode, MarketId, CurrencyCode, PriceTypeId, PriceCode)
            values (GETUTCDATE(), GETUTCDATE(), src.CatalogEntryCode, src.MarketId, src.CurrencyCode, src.PriceTypeId, src.PriceCode);

        insert into dbo.PriceValue (PriceGroupId, ValidFrom, ValidUntil, MinQuantity, MaxQuantity, UnitPrice)
        select pg.PriceGroupId, src.ValidFrom, src.ValidUntil, src.MinQuantity, src.MaxQuantity, src.UnitPrice
        from @PriceValues src
        left outer join PriceGroup pg
            on  src.CatalogEntryCode = pg.CatalogEntryCode
            and src.MarketId = pg.MarketId
            and src.CurrencyCode = pg.CurrencyCode
            and src.PriceTypeId = pg.PriceTypeId
            and src.PriceCode = pg.PriceCode

        delete tgt
        from dbo.PriceGroup tgt
        join @CatalogKeys ck on tgt.CatalogEntryCode = ck.CatalogEntryCode
        left join dbo.PriceValue pv on pv.PriceGroupId = tgt.PriceGroupId
        where pv.PriceGroupId is null

        if @initialTranCount = 0 commit transaction
    end try
    begin catch
        declare @msg nvarchar(4000), @severity int, @state int
        select @msg = ERROR_MESSAGE(), @severity = ERROR_SEVERITY(), @state = ERROR_STATE()
        if @initialTranCount = 0 rollback transaction
        raiserror(@msg, @severity, @state)
    end catch
end
GO
PRINT N'Creating [dbo].[ecf_CatalogEntryAssocations]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntryAssocations]
    @CatalogEntries dbo.udttEntityList readonly
AS
BEGIN
	SELECT CA.* FROM [CatalogAssociation] CA
	WHERE
		CA.CatalogEntryId IN (SELECT EntityId FROM  @CatalogEntries)
	
	SELECT CEA.* FROM [CatalogEntryAssociation] CEA
	INNER JOIN [CatalogAssociation] CA ON CA.CatalogAssociationId = CEA.CatalogAssociationId
	WHERE
		CA.CatalogEntryId IN (SELECT EntityId FROM  @CatalogEntries)
		
	SELECT * FROM [AssociationType]
END
GO
PRINT N'Creating [dbo].[ecf_Pricing_GetCatalogEntryPrices]...';


GO
create procedure dbo.ecf_Pricing_GetCatalogEntryPrices
    @CatalogKeys udttCatalogKey readonly
as
begin
    select pg.CatalogEntryCode, pg.MarketId, pg.CurrencyCode, pg.PriceTypeId, pg.PriceCode, pv.ValidFrom, pv.ValidUntil, pv.MinQuantity, pv.UnitPrice
    from @CatalogKeys ck
    join PriceGroup pg on ck.CatalogEntryCode = pg.CatalogEntryCode
    join PriceValue pv on pg.PriceGroupId = pv.PriceGroupId
end
GO
PRINT N'Creating [dbo].[ecf_CatalogNode_GetDeleteResults]...';


GO

create procedure dbo.ecf_CatalogNode_GetDeleteResults
    @CatalogId int,
    @CatalogNodeId int
as
begin
    declare @affectedNodes table (CatalogNodeId int, IsDelete int)
    declare @affectedEntries table (CatalogEntryId int, IsDelete int)
    
    ;with all_catalog_relations as
    (
        select ParentNodeId, CatalogNodeId as ChildNodeId, 1 as IsDelete from CatalogNode where CatalogId = @CatalogId
        union
        select ParentNodeId, ChildNodeId, 0 as IsDelete from CatalogNodeRelation where CatalogId = @CatalogId
    ),
    affected_nodes as
    (
        select
            cn.CatalogNodeId,
            1 as IsDelete,
            '|' + CAST(@CatalogNodeId as nvarchar(4000)) + '|' as CurrentNodePath
        from CatalogNode cn
        where cn.CatalogNodeId = @CatalogNodeId
        union all
        select 
            cn.CatalogNodeId,          
            case when cte.IsDelete = 1 and r.IsDelete = 1 then 1 else 0 end,            
            cte.CurrentNodePath + CAST(r.ChildNodeId as nvarchar(4000)) + '|'
        from affected_nodes cte
        join all_catalog_relations r on cte.CatalogNodeId = r.ParentNodeId and CHARINDEX(cast(r.ChildNodeId as nvarchar(4000)), cte.CurrentNodePath) = 0
        join CatalogNode cn on r.ChildNodeId = cn.CatalogNodeId
    )
    insert into @affectedNodes (CatalogNodeId, IsDelete)
    select n.CatalogNodeId, MAX(n.IsDelete)
    from affected_nodes n
    group by n.CatalogNodeId

    -- @result.IsCatalogEntry is always 0 at this point, joins do not need to specify that they are joining to nodes.
    insert into @affectedEntries (CatalogEntryId, IsDelete)
    select
        ce.CatalogEntryId, 
        MIN(isnull(ce_parent_nodeinfo.IsDelete, 0)) as IsDelete
    from @affectedNodes ns
    join NodeEntryRelation all_affected_node_relations on ns.CatalogNodeId = all_affected_node_relations.CatalogNodeId
    join CatalogEntry ce on all_affected_node_relations.CatalogEntryId = ce.CatalogEntryId
    join NodeEntryRelation ce_parents on ce.CatalogEntryId = ce_parents.CatalogEntryId
    left outer join @affectedNodes ce_parent_nodeinfo on ce_parents.CatalogNodeId = ce_parent_nodeinfo.CatalogNodeId
    group by ce.CatalogEntryId, ce.MetaClassId

    -- return entry updates, entry deletes, and node deletes; not node updates.
    -- node update rows only exist to populate the entry updates.
    select CatalogEntryId as EntityId, cast(1 as bit) as IsCatalogEntry, cast(IsDelete as bit) as IsDelete
    from @affectedEntries
    union all
    select CatalogNodeId, cast(0 as bit) as IsCatalogEntry, cast(IsDelete as bit) as IsDelete
    from @affectedNodes
    where IsDelete = 1    
end
GO
PRINT N'Creating [dbo].[ecf_Pricing_GetPrices]...';


GO

create procedure dbo.ecf_Pricing_GetPrices
    @MarketId nvarchar(8),
    @ValidOn datetime,
    @CatalogKeysAndQuantities udttCatalogKeyAndQuantity readonly,
    @CurrencyCodes udttCurrencyCode readonly,
    @CustomerPricing udttCustomerPricing readonly,
    @ReturnCustomerPricing bit = 0,
    @ReturnQuantities bit = 0
as
begin
    declare @filterCurrencies bit = case when exists (select 1 from @CurrencyCodes) then 1 else 0 end
    declare @filterCustomerPricing bit = case when exists (select 1 from @CustomerPricing) then 1 else 0 end

    select
        pg.CatalogEntryCode,
        pg.MarketId,
        pg.CurrencyCode,
        case when @ReturnCustomerPricing = 1 then pg.PriceTypeId else null end as PriceTypeId,
        case when @ReturnCustomerPricing = 1 then pg.PriceCode else null end as PriceCode,
        pv.ValidFrom,
        pv.ValidUntil,
        pv.MinQuantity,
        min(pv.UnitPrice) as UnitPrice
    from @CatalogKeysAndQuantities ckaq
    join PriceGroup pg on ckaq.CatalogEntryCode = pg.CatalogEntryCode
    join PriceValue pv on pg.PriceGroupId = pv.PriceGroupId
    where
		(@MarketId = '' or pg.MarketId = @MarketId)
        and (@filterCurrencies = 0 or pg.CurrencyCode in (select CurrencyCode from @CurrencyCodes))
        and (@filterCustomerPricing = 0 or exists (select 1 from @CustomerPricing cp where cp.PriceTypeId = pg.PriceTypeId and cp.PriceCode = pg.PriceCode))
        and pv.ValidFrom <= @ValidOn
        and (pv.ValidUntil is null or @ValidOn < pv.ValidUntil)
        and (@ReturnQuantities = 1 or (pv.MinQuantity <= ckaq.Quantity and ckaq.Quantity < ISNULL(pv.MaxQuantity, ckaq.Quantity+1)))
    group by pg.CatalogEntryCode, pg.MarketId, pg.CurrencyCode,
        case when @ReturnCustomerPricing = 1 then pg.PriceTypeId else null end,
        case when @ReturnCustomerPricing = 1 then pg.PriceCode else null end,
        pv.ValidFrom, pv.ValidUntil, pv.MinQuantity
end
GO
PRINT N'Creating [dbo].[ecf_CatalogNode_List]...';


GO

create procedure dbo.ecf_CatalogNode_List
    @CatalogNodes udttEntityList readonly
as
begin
    select *
    from CatalogNode
    where CatalogNodeId in (select EntityId from @CatalogNodes)
    
    select *
    from CatalogItemSeo
    where CatalogNodeId in (select EntityId from @CatalogNodes)
end
GO
PRINT N'Creating [dbo].[ecf_CatalogRelation_NodeDelete]...';


GO
create procedure [dbo].[ecf_CatalogRelation_NodeDelete]
    @CatalogEntries dbo.udttEntityList readonly,
    @CatalogNodes dbo.udttEntityList readonly
as
begin
    select *
	from CatalogNodeRelation
	where ParentNodeId in (select EntityId from @CatalogNodes)
	   or ChildNodeId in (select EntityId from @CatalogNodes)
    
    select *
    from CatalogEntryRelation
    where ParentEntryId in (select EntityId from @CatalogEntries)
       or ChildEntryId in (select EntityId from @CatalogEntries)
       
    select CatalogId, CatalogEntryId, CatalogNodeId, SortOrder, IsPrimary
    from NodeEntryRelation
    where CatalogEntryId in (select EntityId from @CatalogEntries)
       or CatalogNodeId in (select EntityId from @CatalogNodes)
end
GO
PRINT N'Creating [dbo].[ecf_CatalogRelationByChildEntryId]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogRelationByChildEntryId]
	@ChildEntryId int
AS
BEGIN
    select top 0 * from CatalogNodeRelation

	SELECT CER.* FROM CatalogEntryRelation CER
	INNER JOIN CatalogEntry CE ON CE.CatalogEntryId = CER.ChildEntryId
	WHERE
		CER.ChildEntryId = @ChildEntryId
	ORDER BY CER.SortOrder
	
	SELECT CatalogId, CatalogEntryId, CatalogNodeId, SortOrder, IsPrimary FROM NodeEntryRelation
	WHERE CatalogEntryId=@ChildEntryId
END
GO
PRINT N'Creating [dbo].[aspnet_Paths_CreatePath]...';


GO
CREATE PROCEDURE dbo.aspnet_Paths_CreatePath
    @ApplicationId UNIQUEIDENTIFIER,
    @Path           NVARCHAR(256),
    @PathId         UNIQUEIDENTIFIER OUTPUT
AS
BEGIN
    BEGIN TRANSACTION
    IF (NOT EXISTS(SELECT * FROM dbo.aspnet_Paths WHERE LoweredPath = LOWER(@Path) AND ApplicationId = @ApplicationId))
    BEGIN
        INSERT dbo.aspnet_Paths (ApplicationId, Path, LoweredPath) VALUES (@ApplicationId, @Path, LOWER(@Path))
    END
    COMMIT TRANSACTION
    SELECT @PathId = PathId FROM dbo.aspnet_Paths WHERE LOWER(@Path) = LoweredPath AND ApplicationId = @ApplicationId
END
GO
PRINT N'Creating [dbo].[aspnet_Personalization_GetApplicationId]...';


GO
CREATE PROCEDURE dbo.aspnet_Personalization_GetApplicationId (
    @ApplicationName NVARCHAR(256),
    @ApplicationId UNIQUEIDENTIFIER OUT)
AS
BEGIN
    SELECT @ApplicationId = ApplicationId FROM dbo.aspnet_Applications WHERE LOWER(@ApplicationName) = LoweredApplicationName
END
GO
PRINT N'Creating [dbo].[ecf_TaxCategory_Name]...';


GO
CREATE PROCEDURE [dbo].[ecf_TaxCategory_Name]
	@Name nvarchar(50)
AS
BEGIN
	
	SELECT T.* from [TaxCategory] T
	WHERE
		T.[Name] = @Name
END
GO
PRINT N'Creating [dbo].[ecf_TaxCategory_TaxCategoryId]...';


GO
CREATE PROCEDURE [dbo].[ecf_TaxCategory_TaxCategoryId]
	@TaxCategoryId int
AS
BEGIN
	
	SELECT T.* from [TaxCategory] T
	WHERE
		T.[TaxCategoryId] = @TaxCategoryId
END
GO
PRINT N'Creating [dbo].[ecf_TaxCategory]...';


GO
CREATE PROCEDURE [dbo].[ecf_TaxCategory]
AS
BEGIN
	
	SELECT T.* from [TaxCategory] T
	ORDER BY T.[Name]
END
GO
PRINT N'Creating [dbo].[ecf_CatalogLog]...';


GO
CREATE PROCEDURE ecf_CatalogLog
	@Created datetime = null,
	@Operation nvarchar(50) = null,
	@ObjectType nvarchar(50) = null,
    @StartingRec int,
	@NumRecords int
AS
BEGIN
	SET NOCOUNT ON;
	WITH OrderedLogs AS 
	(
		select *, row_number() over(order by LogId) as RowNumber from CatalogLog where COALESCE(@Operation, Operation) = Operation and COALESCE(@ObjectType, ObjectType) = ObjectType and COALESCE(@Created, Created) <= Created
	),
	OrderedLogsCount(TotalCount) as
	(
		select count(LogId) from OrderedLogs
	)
	select LogId, Operation, ObjectKey, ObjectType, Username, Created, Succeeded, Notes, TotalCount from OrderedLogs, OrderedLogsCount
	where RowNumber between @StartingRec and @StartingRec+@NumRecords-1
	SET NOCOUNT OFF;
END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntry_SearchInsertList]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntry_SearchInsertList]
	@SearchSetId uniqueidentifier,
	@List nvarchar(max)
AS
BEGIN
	SET NOCOUNT ON;
	INSERT INTO [CatalogEntrySearchResults]
           ([SearchSetId]
           ,[CatalogEntryId]
           ,[Created]
           ,[SortOrder])
     select @SearchSetId, L.Item, GETUTCDATE(), L.RowId
     from ecf_splitlist_with_rowid(@List) L
     inner join CatalogEntry E ON E.CatalogEntryId = L.Item
     ORDER BY L.RowId

	SET NOCOUNT OFF;
END
GO
PRINT N'Creating [dbo].[ecf_CatalogAssociation_CatalogId]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogAssociation_CatalogId]
	@CatalogId int
AS
BEGIN
	SELECT CA.* from [CatalogAssociation] CA
	INNER JOIN [CatalogEntry] CE ON CE.CatalogEntryId = CA.CatalogEntryId
	WHERE
		CE.CatalogId = @CatalogId
	ORDER BY CA.SortOrder

	SELECT CEA.* from [CatalogEntryAssociation] CEA
	INNER JOIN [CatalogAssociation] CA ON CA.CatalogAssociationId = CEA.CatalogAssociationId
	INNER JOIN [CatalogEntry] CE ON CE.CatalogEntryId = CA.CatalogEntryId
	WHERE
		CE.CatalogId = @CatalogId
	ORDER BY CA.SortOrder, CEA.SortOrder
		
	SELECT * FROM [AssociationType]
END
GO
PRINT N'Creating [dbo].[ecf_SiteCatalog_Insert]...';


GO
CREATE PROCEDURE [dbo].[ecf_SiteCatalog_Insert]
(
	@SiteId uniqueidentifier,
	@CatalogId int
)
AS
	SET NOCOUNT OFF
	INSERT INTO [dbo].[SiteCatalog] ([SiteId], [CatalogId]) VALUES (@SiteId, @CatalogId)
GO
PRINT N'Creating [dbo].[ecf_Search_CatalogNode]...';


GO
CREATE PROCEDURE [dbo].[ecf_Search_CatalogNode]
    @SearchSetId uniqueidentifier
AS
BEGIN

	SELECT N.* from [CatalogNode] N
	WHERE
		N.CatalogNodeId IN (SELECT [CatalogNodeId] FROM [CatalogNodeSearchResults] WHERE [SearchSetId] = @SearchSetId)

	SELECT S.* from CatalogItemSeo S
	INNER JOIN CatalogNode N ON N.CatalogNodeId = S.CatalogNodeId
	WHERE
		N.CatalogNodeId IN (SELECT [CatalogNodeId] FROM [CatalogNodeSearchResults] WHERE [SearchSetId] = @SearchSetId)

    -- Cleanup the loaded OrderGroupIds from SearchResults.
    DELETE FROM CatalogNodeSearchResults WHERE @SearchSetId = SearchSetId

END
GO
PRINT N'Creating [dbo].[GetContentSchemaVersionNumber]...';


GO
CREATE PROCEDURE [dbo].[GetContentSchemaVersionNumber]
AS
	DECLARE @major int, @minor int, @patch int

	SELECT @major = max([Major]) FROM [SchemaVersion]
	SELECT @minor = max([Minor]) FROM [SchemaVersion] WHERE Major = @major
	SELECT @patch = max([Patch]) FROM [SchemaVersion] WHERE Major = @major AND Minor = @minor

	SELECT Major, Minor, Patch, InstallDate FROM [SchemaVersion] 
	WHERE
		Major = @major AND 
		Minor = @minor AND 
		Patch = @patch
GO
PRINT N'Creating [dbo].[aspnet_Roles_GetAllRoles]...';


GO

CREATE PROCEDURE dbo.aspnet_Roles_GetAllRoles (
    @ApplicationName           nvarchar(256))
AS
BEGIN
    DECLARE @ApplicationId uniqueidentifier
    SELECT  @ApplicationId = NULL
    SELECT  @ApplicationId = ApplicationId FROM aspnet_Applications WHERE LOWER(@ApplicationName) = LoweredApplicationName
    IF (@ApplicationId IS NULL)
        RETURN
    SELECT RoleName
    FROM   dbo.aspnet_Roles WHERE ApplicationId = @ApplicationId
    ORDER BY RoleName
END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntryItemSeo_List]...';


GO

CREATE PROCEDURE dbo.ecf_CatalogEntryItemSeo_List
    @CatalogEntries dbo.udttEntityList readonly
AS
BEGIN
    SELECT n.*
    FROM CatalogEntry n
    JOIN @CatalogEntries r ON n.CatalogEntryId = r.EntityId
    ORDER BY r.SortOrder
    
    SELECT s.*
    FROM CatalogItemSeo s
    JOIN @CatalogEntries r on s.CatalogEntryId = r.EntityId

END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntry_List]...';


GO
 CREATE PROCEDURE [dbo].[ecf_CatalogEntry_List]
    @CatalogEntries dbo.udttEntityList READONLY,
	@ResponseGroup INT = NULL
AS
BEGIN
	SELECT n.*
	FROM CatalogEntry n
	JOIN @CatalogEntries r ON n.CatalogEntryId = r.EntityId
	ORDER BY r.SortOrder
	
	SELECT s.*
	FROM CatalogItemSeo s
	JOIN @CatalogEntries r ON s.CatalogEntryId = r.EntityId

	IF @ResponseGroup IS NULL
	BEGIN
		SELECT er.CatalogId, er.CatalogEntryId, er.CatalogNodeId, er.SortOrder, er.IsPrimary
		FROM NodeEntryRelation er
		JOIN @CatalogEntries r ON er.CatalogEntryId = r.EntityId
	END
	
	DECLARE @CatalogEntryIds udttContentList
	INSERT INTO @CatalogEntryIds
	SELECT EntityId from @CatalogEntries

	exec ecf_CatalogEntry_Components @CatalogEntryIds, @ResponseGroup
END
GO
PRINT N'Creating [dbo].[aspnet_UsersInRoles_FindUsersInRole]...';


GO

CREATE PROCEDURE dbo.aspnet_UsersInRoles_FindUsersInRole
    @ApplicationName  nvarchar(256),
    @RoleName         nvarchar(256),
    @UserNameToMatch  nvarchar(256)
AS
BEGIN
    DECLARE @ApplicationId uniqueidentifier
    SELECT  @ApplicationId = NULL
    SELECT  @ApplicationId = ApplicationId FROM aspnet_Applications WHERE LOWER(@ApplicationName) = LoweredApplicationName
    IF (@ApplicationId IS NULL)
        RETURN(1)
     DECLARE @RoleId uniqueidentifier
     SELECT  @RoleId = NULL

     SELECT  @RoleId = RoleId
     FROM    dbo.aspnet_Roles
     WHERE   LOWER(@RoleName) = LoweredRoleName AND ApplicationId = @ApplicationId

     IF (@RoleId IS NULL)
         RETURN(1)

    SELECT u.UserName
    FROM   dbo.aspnet_Users u, dbo.aspnet_UsersInRoles ur
    WHERE  u.UserId = ur.UserId AND @RoleId = ur.RoleId AND u.ApplicationId = @ApplicationId AND LoweredUserName LIKE LOWER(@UserNameToMatch)
    ORDER BY u.UserName
    RETURN(0)
END
GO
PRINT N'Creating [dbo].[ecf_Warehouse_WarehouseId]...';


GO
CREATE PROCEDURE [dbo].[ecf_Warehouse_WarehouseId]
	@WarehouseId int
AS
BEGIN
	select * from [Warehouse] 
		where [WarehouseId] = @WarehouseId
END
GO
PRINT N'Creating [dbo].[aspnet_UsersInRoles_GetUsersInRoles]...';


GO

CREATE PROCEDURE dbo.aspnet_UsersInRoles_GetUsersInRoles
    @ApplicationName  nvarchar(256),
    @RoleName         nvarchar(256)
AS
BEGIN
    DECLARE @ApplicationId uniqueidentifier
    SELECT  @ApplicationId = NULL
    SELECT  @ApplicationId = ApplicationId FROM aspnet_Applications WHERE LOWER(@ApplicationName) = LoweredApplicationName
    IF (@ApplicationId IS NULL)
        RETURN(1)
     DECLARE @RoleId uniqueidentifier
     SELECT  @RoleId = NULL

     SELECT  @RoleId = RoleId
     FROM    dbo.aspnet_Roles
     WHERE   LOWER(@RoleName) = LoweredRoleName AND ApplicationId = @ApplicationId

     IF (@RoleId IS NULL)
         RETURN(1)

    SELECT u.UserName
    FROM   dbo.aspnet_Users u, dbo.aspnet_UsersInRoles ur
    WHERE  u.UserId = ur.UserId AND @RoleId = ur.RoleId AND u.ApplicationId = @ApplicationId
    ORDER BY u.UserName
    RETURN(0)
END
GO
PRINT N'Creating [dbo].[ecf_Warehouse]...';


GO
CREATE PROCEDURE [dbo].[ecf_Warehouse]
AS
BEGIN
	select * from [Warehouse] 
		order by [Name]
END
GO
PRINT N'Creating [dbo].[ecf_Order_ReturnReasonsDictionaryName]...';


GO
CREATE PROCEDURE [dbo].[ecf_Order_ReturnReasonsDictionaryName]
	@ReturnReasonName nvarchar(50)
 AS
 BEGIN
	SELECT [ReturnReasonId]
		  ,[ReturnReasonText]
	FROM dbo.ReturnReasonDictionary
	WHERE ReturnReasonText = @ReturnReasonName
END
GO
PRINT N'Creating [dbo].[aspnet_UsersInRoles_RemoveUsersFromRoles]...';


GO

CREATE PROCEDURE dbo.aspnet_UsersInRoles_RemoveUsersFromRoles
	@ApplicationName  nvarchar(256),
	@UserNames		  nvarchar(4000),
	@RoleNames		  nvarchar(4000)
AS
BEGIN
	DECLARE @AppId uniqueidentifier
	SELECT  @AppId = NULL
	SELECT  @AppId = ApplicationId FROM aspnet_Applications WHERE LOWER(@ApplicationName) = LoweredApplicationName
	IF (@AppId IS NULL)
		RETURN(2)


	DECLARE @TranStarted   bit
	SET @TranStarted = 0

	IF( @@TRANCOUNT = 0 )
	BEGIN
		BEGIN TRANSACTION
		SET @TranStarted = 1
	END

	DECLARE @tbNames  table(Name nvarchar(256) NOT NULL PRIMARY KEY)
	DECLARE @tbRoles  table(RoleId uniqueidentifier NOT NULL PRIMARY KEY)
	DECLARE @tbUsers  table(UserId uniqueidentifier NOT NULL PRIMARY KEY)
	DECLARE @Num	  int
	DECLARE @Pos	  int
	DECLARE @NextPos  int
	DECLARE @Name	  nvarchar(256)
	DECLARE @CountAll int
	DECLARE @CountU	  int
	DECLARE @CountR	  int


	SET @Num = 0
	SET @Pos = 1
	WHILE(@Pos <= LEN(@RoleNames))
	BEGIN
		SELECT @NextPos = CHARINDEX(N',', @RoleNames,  @Pos)
		IF (@NextPos = 0 OR @NextPos IS NULL)
			SELECT @NextPos = LEN(@RoleNames) + 1
		SELECT @Name = RTRIM(LTRIM(SUBSTRING(@RoleNames, @Pos, @NextPos - @Pos)))
		SELECT @Pos = @NextPos+1

		INSERT INTO @tbNames VALUES (@Name)
		SET @Num = @Num + 1
	END

	INSERT INTO @tbRoles
	  SELECT RoleId
	  FROM   dbo.aspnet_Roles ar, @tbNames t
	  WHERE  LOWER(t.Name) = ar.LoweredRoleName AND ar.ApplicationId = @AppId
	SELECT @CountR = @@ROWCOUNT

	IF (@CountR <> @Num)
	BEGIN
		SELECT TOP 1 N'', Name
		FROM   @tbNames
		WHERE  LOWER(Name) NOT IN (SELECT ar.LoweredRoleName FROM dbo.aspnet_Roles ar,  @tbRoles r WHERE r.RoleId = ar.RoleId)
		IF( @TranStarted = 1 )
			ROLLBACK TRANSACTION
		RETURN(2)
	END


	DELETE FROM @tbNames WHERE 1=1
	SET @Num = 0
	SET @Pos = 1


	WHILE(@Pos <= LEN(@UserNames))
	BEGIN
		SELECT @NextPos = CHARINDEX(N',', @UserNames,  @Pos)
		IF (@NextPos = 0 OR @NextPos IS NULL)
			SELECT @NextPos = LEN(@UserNames) + 1
		SELECT @Name = RTRIM(LTRIM(SUBSTRING(@UserNames, @Pos, @NextPos - @Pos)))
		SELECT @Pos = @NextPos+1

		INSERT INTO @tbNames VALUES (@Name)
		SET @Num = @Num + 1
	END

	INSERT INTO @tbUsers
	  SELECT UserId
	  FROM   dbo.aspnet_Users ar, @tbNames t
	  WHERE  LOWER(t.Name) = ar.LoweredUserName AND ar.ApplicationId = @AppId

	SELECT @CountU = @@ROWCOUNT
	IF (@CountU <> @Num)
	BEGIN
		SELECT TOP 1 Name, N''
		FROM   @tbNames
		WHERE  LOWER(Name) NOT IN (SELECT au.LoweredUserName FROM dbo.aspnet_Users au,  @tbUsers u WHERE u.UserId = au.UserId)

		IF( @TranStarted = 1 )
			ROLLBACK TRANSACTION
		RETURN(1)
	END

	SELECT  @CountAll = COUNT(*)
	FROM	dbo.aspnet_UsersInRoles ur, @tbUsers u, @tbRoles r
	WHERE   ur.UserId = u.UserId AND ur.RoleId = r.RoleId

	IF (@CountAll <> @CountU * @CountR)
	BEGIN
		SELECT TOP 1 UserName, RoleName
		FROM		 @tbUsers tu, @tbRoles tr, dbo.aspnet_Users u, dbo.aspnet_Roles r
		WHERE		 u.UserId = tu.UserId AND r.RoleId = tr.RoleId AND
					 tu.UserId NOT IN (SELECT ur.UserId FROM dbo.aspnet_UsersInRoles ur WHERE ur.RoleId = tr.RoleId) AND
					 tr.RoleId NOT IN (SELECT ur.RoleId FROM dbo.aspnet_UsersInRoles ur WHERE ur.UserId = tu.UserId)
		IF( @TranStarted = 1 )
			ROLLBACK TRANSACTION
		RETURN(3)
	END

	DELETE FROM dbo.aspnet_UsersInRoles
	WHERE UserId IN (SELECT UserId FROM @tbUsers)
	  AND RoleId IN (SELECT RoleId FROM @tbRoles)
	IF( @TranStarted = 1 )
		COMMIT TRANSACTION
	RETURN(0)
END
GO
PRINT N'Creating [dbo].[ecf_CatalogRelation]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogRelation]
	@CatalogId INT,
	@CatalogNodeId INT,
	@CatalogEntryId INT,
	@GroupName NVARCHAR(100),
	@ResponseGroup INT
AS
BEGIN
	DECLARE @CatalogNode AS INT
	DECLARE @CatalogEntry AS INT
	DECLARE @NodeEntry AS INT

	SET @CatalogNode = 1
	SET @CatalogEntry = 2
	SET @NodeEntry = 4

	IF(@ResponseGroup & @CatalogNode = @CatalogNode)
		SELECT CNR.* FROM CatalogNodeRelation CNR
		INNER JOIN CatalogNode CN ON CN.CatalogNodeId = CNR.ParentNodeId AND (CN.CatalogId = @CatalogId OR @CatalogId = 0)
		WHERE (@CatalogNodeId = 0 OR CNR.ParentNodeId = @CatalogNodeId)
		ORDER BY CNR.SortOrder
	ELSE
		SELECT TOP 0 * FROM CatalogNodeRelation

	IF(@ResponseGroup & @CatalogEntry = @CatalogEntry)
	BEGIN
		IF (@CatalogNodeId = 0)
		BEGIN
			IF (@CatalogEntryId = 0)
				SELECT CER.* FROM CatalogEntryRelation CER
				INNER JOIN CatalogEntry CE ON CE.CatalogEntryId = CER.ParentEntryId AND (CE.CatalogId = @CatalogId OR @CatalogId = 0)
				WHERE (CER.GroupName = @GroupName OR LEN(@GroupName) = 0)
				ORDER BY CER.SortOrder
			ELSE
				SELECT CER.* FROM CatalogEntryRelation CER
				INNER JOIN CatalogEntry CE ON CE.CatalogEntryId = CER.ParentEntryId AND (CE.CatalogId = @CatalogId OR @CatalogId = 0)
				WHERE 
					 (CER.ParentEntryId = @CatalogEntryId) AND
					 (CER.GroupName = @GroupName OR LEN(@GroupName) = 0)
				ORDER BY CER.SortOrder
		END
		ELSE --We must filter by CatalogNodeId when getting CatalogEntryRelation if the @CatalogNodeId is different from zero, so that we don't get redundant data.
		BEGIN		
			IF (@CatalogEntryId = 0)
				SELECT CER.* FROM CatalogEntryRelation CER
				INNER JOIN CatalogEntry CE ON CE.CatalogEntryId = CER.ParentEntryId AND (CE.CatalogId = @CatalogId OR @CatalogId = 0)
				INNER JOIN NodeEntryRelation NER ON CE.CatalogEntryId=NER.CatalogEntryId AND NER.CatalogNodeId=@CatalogNodeId
				WHERE (CER.GroupName = @GroupName OR LEN(@GroupName) = 0)
				ORDER BY CER.SortOrder
			ELSE
				SELECT CER.* FROM CatalogEntryRelation CER
				INNER JOIN CatalogEntry CE ON CE.CatalogEntryId = CER.ParentEntryId AND (CE.CatalogId = @CatalogId OR @CatalogId = 0)
				INNER JOIN NodeEntryRelation NER ON CE.CatalogEntryId=NER.CatalogEntryId AND NER.CatalogNodeId=@CatalogNodeId
				WHERE
					 (CER.ParentEntryId = @CatalogEntryId) AND
					 (CER.GroupName = @GroupName OR LEN(@GroupName) = 0)
				ORDER BY CER.SortOrder
		END
	END
	ELSE
		SELECT TOP 0 * FROM CatalogEntryRelation

	IF(@ResponseGroup & @NodeEntry = @NodeEntry)
	BEGIN
		DECLARE @execStmt NVARCHAR(1000)
		SET @execStmt = 'SELECT NER.CatalogId, NER.CatalogEntryId, NER.CatalogNodeId, NER.SortOrder, NER.IsPrimary FROM NodeEntryRelation NER'
		
		IF @CatalogId != 0 OR @CatalogNodeId != 0 OR @CatalogEntryId != 0
			SET @execStmt = @execStmt + ' WHERE 0=0 '
		IF @CatalogId!=0
			SET @execStmt = @execStmt + ' AND (NER.CatalogId = @CatalogId) '
		IF @CatalogNodeId!=0
			SET @execStmt = @execStmt + ' AND (NER.CatalogNodeId = @CatalogNodeId) '
		IF @CatalogEntryId!=0
			SET @execStmt = @execStmt + ' AND (NER.CatalogEntryId = @CatalogEntryId) '

		SET @execStmt = @execStmt + ' ORDER BY NER.SortOrder'
		
		DECLARE @pars NVARCHAR(500)
		SET @pars = '@CatalogId int, @CatalogNodeId int, @CatalogEntryId int'
		EXEC sp_executesql @execStmt, @pars,
			@CatalogId=@CatalogId, @CatalogNodeId=@CatalogNodeId, @CatalogEntryId=@CatalogEntryId
	END
	ELSE
		SELECT TOP 0 CatalogId, CatalogEntryId, CatalogNodeId, SortOrder, IsPrimary FROM NodeEntryRelation
END
GO
PRINT N'Creating [dbo].[ecf_Order_ReturnReasonsDictionaryId]...';


GO
CREATE PROCEDURE [dbo].[ecf_Order_ReturnReasonsDictionaryId]
	@ReturnReasonId int
 AS
 BEGIN
	SELECT [ReturnReasonId]
		  ,[ReturnReasonText]
		  ,[Ordering]
		  ,[Visible]
	FROM dbo.ReturnReasonDictionary
	WHERE ReturnReasonId = @ReturnReasonId
END
GO
PRINT N'Creating [dbo].[aspnet_UsersInRoles_AddUsersToRoles]...';


GO

CREATE PROCEDURE dbo.aspnet_UsersInRoles_AddUsersToRoles
	@ApplicationName  nvarchar(256),
	@UserNames		  nvarchar(4000),
	@RoleNames		  nvarchar(4000),
	@CurrentTimeUtc   datetime
AS
BEGIN
	DECLARE @AppId uniqueidentifier
	SELECT  @AppId = NULL
	SELECT  @AppId = ApplicationId FROM aspnet_Applications WHERE LOWER(@ApplicationName) = LoweredApplicationName
	IF (@AppId IS NULL)
		RETURN(2)
	DECLARE @TranStarted   bit
	SET @TranStarted = 0

	IF( @@TRANCOUNT = 0 )
	BEGIN
		BEGIN TRANSACTION
		SET @TranStarted = 1
	END

	DECLARE @tbNames	table(Name nvarchar(256) NOT NULL PRIMARY KEY)
	DECLARE @tbRoles	table(RoleId uniqueidentifier NOT NULL PRIMARY KEY)
	DECLARE @tbUsers	table(UserId uniqueidentifier NOT NULL PRIMARY KEY)
	DECLARE @Num		int
	DECLARE @Pos		int
	DECLARE @NextPos	int
	DECLARE @Name		nvarchar(256)

	SET @Num = 0
	SET @Pos = 1
	WHILE(@Pos <= LEN(@RoleNames))
	BEGIN
		SELECT @NextPos = CHARINDEX(N',', @RoleNames,  @Pos)
		IF (@NextPos = 0 OR @NextPos IS NULL)
			SELECT @NextPos = LEN(@RoleNames) + 1
		SELECT @Name = RTRIM(LTRIM(SUBSTRING(@RoleNames, @Pos, @NextPos - @Pos)))
		SELECT @Pos = @NextPos+1

		INSERT INTO @tbNames VALUES (@Name)
		SET @Num = @Num + 1
	END

	INSERT INTO @tbRoles
	  SELECT RoleId
	  FROM   dbo.aspnet_Roles ar, @tbNames t
	  WHERE  LOWER(t.Name) = ar.LoweredRoleName AND ar.ApplicationId = @AppId

	IF (@@ROWCOUNT <> @Num)
	BEGIN
		SELECT TOP 1 Name
		FROM   @tbNames
		WHERE  LOWER(Name) NOT IN (SELECT ar.LoweredRoleName FROM dbo.aspnet_Roles ar,  @tbRoles r WHERE r.RoleId = ar.RoleId)
		IF( @TranStarted = 1 )
			ROLLBACK TRANSACTION
		RETURN(2)
	END

	DELETE FROM @tbNames WHERE 1=1
	SET @Num = 0
	SET @Pos = 1

	WHILE(@Pos <= LEN(@UserNames))
	BEGIN
		SELECT @NextPos = CHARINDEX(N',', @UserNames,  @Pos)
		IF (@NextPos = 0 OR @NextPos IS NULL)
			SELECT @NextPos = LEN(@UserNames) + 1
		SELECT @Name = RTRIM(LTRIM(SUBSTRING(@UserNames, @Pos, @NextPos - @Pos)))
		SELECT @Pos = @NextPos+1

		INSERT INTO @tbNames VALUES (@Name)
		SET @Num = @Num + 1
	END

	INSERT INTO @tbUsers
	  SELECT UserId
	  FROM   dbo.aspnet_Users ar, @tbNames t
	  WHERE  LOWER(t.Name) = ar.LoweredUserName AND ar.ApplicationId = @AppId

	IF (@@ROWCOUNT <> @Num)
	BEGIN
		DELETE FROM @tbNames
		WHERE LOWER(Name) IN (SELECT LoweredUserName FROM dbo.aspnet_Users au,  @tbUsers u WHERE au.UserId = u.UserId)

		INSERT dbo.aspnet_Users (ApplicationId, UserId, UserName, LoweredUserName, IsAnonymous, LastActivityDate)
		  SELECT @AppId, NEWID(), Name, LOWER(Name), 0, @CurrentTimeUtc
		  FROM   @tbNames

		INSERT INTO @tbUsers
		  SELECT  UserId
		  FROM	dbo.aspnet_Users au, @tbNames t
		  WHERE   LOWER(t.Name) = au.LoweredUserName AND au.ApplicationId = @AppId
	END

	IF (EXISTS (SELECT * FROM dbo.aspnet_UsersInRoles ur, @tbUsers tu, @tbRoles tr WHERE tu.UserId = ur.UserId AND tr.RoleId = ur.RoleId))
	BEGIN
		SELECT TOP 1 UserName, RoleName
		FROM		 dbo.aspnet_UsersInRoles ur, @tbUsers tu, @tbRoles tr, aspnet_Users u, aspnet_Roles r
		WHERE		u.UserId = tu.UserId AND r.RoleId = tr.RoleId AND tu.UserId = ur.UserId AND tr.RoleId = ur.RoleId

		IF( @TranStarted = 1 )
			ROLLBACK TRANSACTION
		RETURN(3)
	END

	INSERT INTO dbo.aspnet_UsersInRoles (UserId, RoleId)
	SELECT UserId, RoleId
	FROM @tbUsers, @tbRoles

	IF( @TranStarted = 1 )
		COMMIT TRANSACTION
	RETURN(0)
END
GO
PRINT N'Creating [dbo].[ecf_CatalogNodesList]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogNodesList]
(
	@CatalogId int,
	@CatalogNodeId int,
	@EntryMetaSQLClause nvarchar(max),
	@OrderClause nvarchar(100),
	@StartingRec int,
	@NumRecords int,
	@ReturnInactive bit = 0,
	@ReturnTotalCount bit = 1
)
AS

BEGIN
	SET NOCOUNT ON

	declare @execStmtString nvarchar(max)
	declare @selectStmtString nvarchar(max)
	declare @EntryMetaSQLClauseLength bigint
	declare @SelectEntryMetaQuery_tmp nvarchar(max)
	set @EntryMetaSQLClauseLength = LEN(@EntryMetaSQLClause)

	set @execStmtString=N''

	-- assign ORDER BY statement if it is empty
	if(Len(RTrim(LTrim(@OrderClause))) = 0)
		set @OrderClause = N'ID ASC'

    -- Construct meta class joins for CatalogEntry table if a WHERE clause has been specified for Entry Meta data
    IF(@EntryMetaSQLClauseLength>0)
    BEGIN
    	-- If there is a meta SQL clause provided, join to CatalogContentProperty table
    	-- Similar to [ecf_CatalogEntrySearch], but simpler due to fewer variations, i.e.:
    	--   No @Classes parameter
    	--   No @Namespace
		set @SelectEntryMetaQuery_tmp = '
			INNER JOIN
			(
				select CP.ObjectId, CP.ObjectTypeId, md.Value 
				from CatalogContentProperty CP 
				inner join MetaKey MK ON CP.Number = MK.MetaKey
				join MetaMultiValueDictionary mmvd on mk.MetaKey = mmvd.MetaKey 
				join MetaDictionary md on mmvd.MetaDictionaryId = md.MetaDictionaryId and mk.MetaFieldId = md.MetaFieldId 

				Where MetaFieldName = ''_ExcludedCatalogEntryMarkets'' 
					AND md.Value IN (' + @EntryMetaSQLClause + ')
					AND CP.ObjectTypeId = 0 -- entry
			) ExcludedMarkets ON ExcludedMarkets.ObjectId = CE.CatalogEntryId
		'
    END
    ELSE
    BEGIN
        set @SelectEntryMetaQuery_tmp = N''
    END

	if (COALESCE(@CatalogNodeId, 0)=0)
	begin
		-- if @CatalogNodeId=0
		set @selectStmtString=N'select SEL.*, row_number() over(order by '+ @OrderClause +N') as RowNumber
				from
				(
					-- select Catalog Nodes
					SELECT CN.[CatalogNodeId] as ID, CN.[Name], ''Node'' as Type, CN.[Code], CN.[StartDate], CN.[EndDate], CN.[IsActive], CN.[SortOrder], OG.[Name] as Owner
						FROM [CatalogNode] CN 
							JOIN Catalog C ON (CN.CatalogId = C.CatalogId)
                            LEFT JOIN cls_Organization OG ON (OG.OrganizationId = C.Owner)
						WHERE CatalogNodeId IN
						(SELECT DISTINCT N.CatalogNodeId from [CatalogNode] N
							LEFT OUTER JOIN CatalogNodeRelation NR ON N.CatalogNodeId = NR.ChildNodeId
							WHERE
							(
								(N.CatalogId = @CatalogId AND N.ParentNodeId = @CatalogNodeId)
								OR
								(NR.CatalogId = @CatalogId AND NR.ParentNodeId = @CatalogNodeId)
							)
							AND
							((N.IsActive = 1) or @ReturnInactive = 1)
						)

					UNION

					-- select Catalog Entries
					SELECT CE.[CatalogEntryId] as ID, CE.[Name], CE.ClassTypeId as Type, CE.[Code], CE.[StartDate], CE.[EndDate], CE.[IsActive], 0, OG.[Name] as Owner
						FROM [CatalogEntry] CE
							JOIN Catalog C ON (CE.CatalogId = C.CatalogId)'
							+ @SelectEntryMetaQuery_tmp 
							+ N'
                            LEFT JOIN cls_Organization OG ON (OG.OrganizationId = C.Owner)
					WHERE
						CE.CatalogId = @CatalogId AND
						NOT EXISTS(SELECT 1 FROM NodeEntryRelation R WHERE R.CatalogId = @CatalogId and CE.CatalogEntryId = R.CatalogEntryId) AND
						((CE.IsActive = 1) or @ReturnInactive = 1)
				) SEL'
	end
	else
	begin
		-- if @CatalogNodeId!=0

		-- Get the original catalog id for the given catalog node
		SELECT @CatalogId = [CatalogId] FROM [CatalogNode] WHERE [CatalogNodeId] = @CatalogNodeId

		set @selectStmtString=N'select SEL.*, row_number() over(order by '+ @OrderClause +N') as RowNumber
			from
			(
				-- select Catalog Nodes
				SELECT CN.[CatalogNodeId] as ID, CN.[Name], ''Node'' as Type, CN.[Code], CN.[StartDate], CN.[EndDate], CN.[IsActive], CN.[SortOrder], OG.[Name] as Owner
					FROM [CatalogNode] CN 
						JOIN Catalog C ON (CN.CatalogId = C.CatalogId)
						--We actually dont need to join NodeEntryRelation to get the SortOrder because it is always 0
                        --JOIN CatalogEntry CE ON CE.CatalogId = C.CatalogId
						--LEFT JOIN NodeEntryRelation NER ON (NER.CatalogId = CN.CatalogId And NER.CatalogNodeId = CN.CatalogNodeId  AND CE.CatalogEntryId = NER.CatalogEntryId ) 
                        LEFT JOIN cls_Organization OG ON (OG.OrganizationId = C.Owner)
					WHERE CN.CatalogNodeId IN
				(SELECT DISTINCT N.CatalogNodeId from [CatalogNode] N
				LEFT OUTER JOIN CatalogNodeRelation NR ON N.CatalogNodeId = NR.ChildNodeId
				WHERE
					((N.CatalogId = @CatalogId AND N.ParentNodeId = @CatalogNodeId) OR (NR.CatalogId = @CatalogId AND NR.ParentNodeId = @CatalogNodeId)) AND
					((N.IsActive = 1) or @ReturnInactive = 1))

				UNION
				
				-- select Catalog Entries
				SELECT CE.[CatalogEntryId] as ID, CE.[Name], CE.ClassTypeId as Type, CE.[Code], CE.[StartDate], CE.[EndDate], CE.[IsActive], R.[SortOrder], OG.[Name] as Owner
					FROM [CatalogEntry] CE
						JOIN Catalog C ON (CE.CatalogId = C.CatalogId)
						JOIN NodeEntryRelation R ON R.CatalogEntryId = CE.CatalogEntryId'
							+ @SelectEntryMetaQuery_tmp 
							+ N' 
                        LEFT JOIN cls_Organization OG ON (OG.OrganizationId = C.Owner)
				WHERE
					R.CatalogNodeId = @CatalogNodeId AND
					R.CatalogId = @CatalogId AND
						((CE.IsActive = 1) or @ReturnInactive = 1)
			) SEL'
	end

	if(@ReturnTotalCount = 1) -- Only return count if we requested it
		set @execStmtString=N'with SelNodes(ID, Name, Type, Code, StartDate, EndDate, IsActive, SortOrder, Owner, RowNumber)
			as
			(' + @selectStmtString +
			N'),
			SelNodesCount(TotalCount)
			as
			(
				select count(ID) from SelNodes
			)
			select  TOP ' + cast(@NumRecords as nvarchar(50)) + ' ID, Name, Type, Code, StartDate, EndDate, IsActive, SortOrder, Owner, RowNumber, C.TotalCount as RecordCount
			from SelNodes, SelNodesCount C
			where RowNumber >= ' + cast(@StartingRec as nvarchar(50)) + 
			' order by '+ @OrderClause
	else
		set @execStmtString=N'with SelNodes(ID, Name, Type, Code, StartDate, EndDate, IsActive, SortOrder, Owner, RowNumber)
			as
			(' + @selectStmtString +
			N')
			select  TOP ' + cast(@NumRecords as nvarchar(50)) + ' ID, Name, Type, Code, StartDate, EndDate, IsActive, SortOrder, Owner, RowNumber
			from SelNodes
			where RowNumber >= ' + cast(@StartingRec as nvarchar(50)) +
			' order by '+ @OrderClause
	
	declare @ParamDefinition nvarchar(500)
	set @ParamDefinition = N'@CatalogId int,
						@CatalogNodeId int,
						@StartingRec int,
						@NumRecords int,
						@ReturnInactive bit';
	exec sp_executesql @execStmtString, @ParamDefinition,
			@CatalogId = @CatalogId,
			@CatalogNodeId = @CatalogNodeId,
			@StartingRec = @StartingRec,
			@NumRecords = @NumRecords,
			@ReturnInactive = @ReturnInactive

	SET NOCOUNT OFF
END
GO
PRINT N'Creating [dbo].[ecf_Order_ReturnReasonsDictionary]...';


GO
CREATE PROCEDURE [dbo].[ecf_Order_ReturnReasonsDictionary]
	@ReturnInactive bit = 0
 AS
 BEGIN
	SELECT * FROM dbo.ReturnReasonDictionary RRD
	WHERE (([Visible] = 1) or @ReturnInactive = 1)
	ORDER BY RRD.[Ordering], RRD.[ReturnReasonText]
END
GO
PRINT N'Creating [dbo].[aspnet_Roles_RoleExists]...';


GO

CREATE PROCEDURE dbo.aspnet_Roles_RoleExists
    @ApplicationName  nvarchar(256),
    @RoleName         nvarchar(256)
AS
BEGIN
    DECLARE @ApplicationId uniqueidentifier
    SELECT  @ApplicationId = NULL
    SELECT  @ApplicationId = ApplicationId FROM aspnet_Applications WHERE LOWER(@ApplicationName) = LoweredApplicationName
    IF (@ApplicationId IS NULL)
        RETURN(0)
    IF (EXISTS (SELECT RoleName FROM dbo.aspnet_Roles WHERE LOWER(@RoleName) = LoweredRoleName AND ApplicationId = @ApplicationId ))
        RETURN(1)
    ELSE
        RETURN(0)
END
GO
PRINT N'Creating [dbo].[ecf_CatalogNodeSearch]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogNodeSearch]
(
	@SearchSetId			uniqueidentifier,
	@Catalogs 				nvarchar(max),
	@CatalogNodes 			nvarchar(max),
	@SQLClause 				nvarchar(max),
	@MetaSQLClause 			nvarchar(max),
	@OrderBy 				nvarchar(max),
	@StartingRec 			int,
	@NumRecords   			int,
	@RecordCount			int OUTPUT
)
AS
BEGIN
	SET NOCOUNT ON
	
	DECLARE @FilterQuery_tmp nvarchar(max)
	DECLARE @SelectMetaQuery_tmp nvarchar(max)
	DECLARE @FromQuery_tmp nvarchar(max)
	DECLARE @FullQuery nvarchar(max)

	set @SelectMetaQuery_tmp = 'select 100 as ''Rank'', META.ObjectId as ''Key'' from CatalogContentProperty META WHERE META.ObjectTypeId = 1 '
	
	-- Add meta Where clause
	if(LEN(@MetaSQLClause)>0)
		set @SelectMetaQuery_tmp = @SelectMetaQuery_tmp + ' AND ' + @MetaSQLClause + ' '

	-- Create from command
	SET @FromQuery_tmp = N'FROM CatalogNode' + N' INNER JOIN (select distinct U.[Key], U.Rank from (' + @SelectMetaQuery_tmp + N') U) META ON CatalogNode.CatalogNodeId = META.[Key] '

	set @FromQuery_tmp = @FromQuery_tmp + N' LEFT OUTER JOIN CatalogNodeRelation NR ON CatalogNode.CatalogNodeId = NR.ChildNodeId'
	set @FromQuery_tmp = @FromQuery_tmp + N' LEFT OUTER JOIN [Catalog] CR ON NR.CatalogId = NR.CatalogId'
	set @FromQuery_tmp = @FromQuery_tmp + N' LEFT OUTER JOIN [Catalog] C ON C.CatalogId = CatalogNode.CatalogId'
	set @FromQuery_tmp = @FromQuery_tmp + N' LEFT OUTER JOIN [CatalogNode] CN ON CatalogNode.ParentNodeId = CN.CatalogNodeId'
	set @FromQuery_tmp = @FromQuery_tmp + N' LEFT OUTER JOIN [CatalogNode] CNR ON NR.ParentNodeId = CNR.CatalogNodeId'

	if(Len(@OrderBy) = 0)
	begin
		set @OrderBy = 'CatalogNode.CatalogNodeId'
	end

	/* CATALOG AND NODE FILTERING */
	set @FilterQuery_tmp =  N' WHERE ((1=1'
	if(Len(@Catalogs) != 0)
		set @FilterQuery_tmp = @FilterQuery_tmp + N' AND (C.[Name] in (select Item from ecf_splitlist(''' + @Catalogs + ''')))'

	if(Len(@CatalogNodes) != 0)
		set @FilterQuery_tmp = @FilterQuery_tmp + N' AND (CatalogNode.[Code] in (select Item from ecf_splitlist(''' + REPLACE(@CatalogNodes,N'''',N'''''') + '''))))'
	else
		set @FilterQuery_tmp = @FilterQuery_tmp + N')'

	set @FilterQuery_tmp = @FilterQuery_tmp + N' OR (1=1'
	if(Len(@Catalogs) != 0)
		set @FilterQuery_tmp = '' + @FilterQuery_tmp + N' AND (CR.[Name] in (select Item from ecf_splitlist(''' + @Catalogs + ''')))'

	if(Len(@CatalogNodes) != 0)
		set @FilterQuery_tmp = @FilterQuery_tmp + N' AND (CNR.[Code] in (select Item from ecf_splitlist(''' + REPLACE(@CatalogNodes,N'''',N'''''') + '''))))'
	else
		set @FilterQuery_tmp = @FilterQuery_tmp + N')'

	set @FilterQuery_tmp = @FilterQuery_tmp + N')'
	
	-- add sql clause statement here, if specified
	if(Len(@SQLClause) != 0)
		set @FilterQuery_tmp = @FilterQuery_tmp + N' AND (' + @SqlClause + ')'

	set @FullQuery = N'SELECT count(CatalogNode.CatalogNodeId) OVER() TotalRecords, CatalogNode.CatalogNodeId, Rank, ROW_NUMBER() OVER(ORDER BY ' + @OrderBy + N') RowNumber ' + @FromQuery_tmp + @FilterQuery_tmp

	-- use temp table variable
	set @FullQuery = N'with OrderedResults as (' + @FullQuery +') INSERT INTO @Page_temp (TotalRecords, CatalogNodeId) SELECT top(' + cast(@NumRecords as nvarchar(50)) + ') TotalRecords, CatalogNodeId FROM OrderedResults WHERE RowNumber > ' + cast(@StartingRec as nvarchar(50)) + ';'
	set @FullQuery = 'declare @Page_temp table (TotalRecords int, CatalogNodeId int);' + @FullQuery + ';select @RecordCount = TotalRecords from @Page_temp;INSERT INTO CatalogNodeSearchResults (SearchSetId, CatalogNodeId) SELECT ''' + cast(@SearchSetId as nvarchar(100)) + N''', CatalogNodeId from @Page_temp;'
	--print @FullQuery
	exec sp_executesql @FullQuery, N'@RecordCount int output', @RecordCount = @RecordCount OUTPUT

	SET NOCOUNT OFF
END
GO
PRINT N'Creating [dbo].[ecf_PickList]...';


GO

CREATE PROCEDURE [dbo].[ecf_PickList]
	@ShipmentPackingStatus AS NVARCHAR(64)
AS
BEGIN
	SELECT PL.*, CAST((SELECT COUNT(*) FROM [Shipment] S WHERE S.[PickListId] = PL.[PickListId] AND S.[Status] = @ShipmentPackingStatus) AS INT) AS [PackingShipments]
	FROM [PickList] PL
	ORDER BY PL.[Name]
END
GO
PRINT N'Creating [dbo].[aspnet_Roles_DeleteRole]...';


GO

CREATE PROCEDURE dbo.aspnet_Roles_DeleteRole
    @ApplicationName            nvarchar(256),
    @RoleName                   nvarchar(256),
    @DeleteOnlyIfRoleIsEmpty    bit
AS
BEGIN
    DECLARE @ApplicationId uniqueidentifier
    SELECT  @ApplicationId = NULL
    SELECT  @ApplicationId = ApplicationId FROM aspnet_Applications WHERE LOWER(@ApplicationName) = LoweredApplicationName
    IF (@ApplicationId IS NULL)
        RETURN(1)

    DECLARE @ErrorCode     int
    SET @ErrorCode = 0

    DECLARE @TranStarted   bit
    SET @TranStarted = 0

    IF( @@TRANCOUNT = 0 )
    BEGIN
        BEGIN TRANSACTION
        SET @TranStarted = 1
    END
    ELSE
        SET @TranStarted = 0

    DECLARE @RoleId   uniqueidentifier
    SELECT  @RoleId = NULL
    SELECT  @RoleId = RoleId FROM dbo.aspnet_Roles WHERE LoweredRoleName = LOWER(@RoleName) AND ApplicationId = @ApplicationId

    IF (@RoleId IS NULL)
    BEGIN
        SELECT @ErrorCode = 1
        GOTO Cleanup
    END
    IF (@DeleteOnlyIfRoleIsEmpty <> 0)
    BEGIN
        IF (EXISTS (SELECT RoleId FROM dbo.aspnet_UsersInRoles  WHERE @RoleId = RoleId))
        BEGIN
            SELECT @ErrorCode = 2
            GOTO Cleanup
        END
    END


    DELETE FROM dbo.aspnet_UsersInRoles  WHERE @RoleId = RoleId

    IF( @@ERROR <> 0 )
    BEGIN
        SET @ErrorCode = -1
        GOTO Cleanup
    END

    DELETE FROM dbo.aspnet_Roles WHERE @RoleId = RoleId  AND ApplicationId = @ApplicationId

    IF( @@ERROR <> 0 )
    BEGIN
        SET @ErrorCode = -1
        GOTO Cleanup
    END

    IF( @TranStarted = 1 )
    BEGIN
        SET @TranStarted = 0
        COMMIT TRANSACTION
    END

    RETURN(0)

Cleanup:

    IF( @TranStarted = 1 )
    BEGIN
        SET @TranStarted = 0
        ROLLBACK TRANSACTION
    END

    RETURN @ErrorCode
END
GO
PRINT N'Creating [dbo].[ecf_CatalogNode_UriLanguage]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogNode_UriLanguage]
	@Uri nvarchar(255),
	@LanguageCode nvarchar(50),
	@ReturnInactive bit = 0
AS
BEGIN
	
	SELECT N.* from [CatalogNode] N 
	INNER JOIN CatalogItemSeo S ON N.CatalogNodeId = S.CatalogNodeId
	WHERE
		S.Uri = @Uri AND (S.LanguageCode = @LanguageCode OR @LanguageCode is NULL) AND
		((N.IsActive = 1) or @ReturnInactive = 1)

	SELECT S.* from CatalogItemSeo S
	INNER JOIN CatalogNode N ON N.CatalogNodeId = S.CatalogNodeId
	WHERE
		S.Uri = @Uri AND (S.LanguageCode = @LanguageCode OR @LanguageCode is NULL) AND
		((N.IsActive = 1) or @ReturnInactive = 1)
END
GO
PRINT N'Creating [dbo].[ecf_CatalogNode_SiteId]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogNode_SiteId]
    @SiteId uniqueidentifier,
	@ReturnInactive bit = 0
AS
BEGIN
	
	SELECT N.* from [CatalogNode] N 
	INNER JOIN SiteCatalog SC ON SC.CatalogId = N.CatalogId
	WHERE
		N.ParentNodeId = 0 AND
		SC.SiteId = @SiteId AND
		((N.IsActive = 1) or @ReturnInactive = 1)
	ORDER BY N.SortOrder

	SELECT S.* from CatalogItemSeo S
	INNER JOIN CatalogNode N ON N.CatalogNodeId = S.CatalogNodeId
	INNER JOIN SiteCatalog SC ON SC.CatalogId = N.CatalogId
	WHERE
		N.ParentNodeId = 0 AND
		SC.SiteId = @SiteId AND
		((N.IsActive = 1) or @ReturnInactive = 1)	

END
GO
PRINT N'Creating [dbo].[ecf_Jurisdiction_JurisdictionId]...';


GO
CREATE PROCEDURE [dbo].[ecf_Jurisdiction_JurisdictionId]
	@JurisdictionId int,
	@ReturnAllGroups bit = 0
AS
BEGIN
	select * from [Jurisdiction] 
		where [JurisdictionId] = @JurisdictionId

	IF @ReturnAllGroups=1 BEGIN -- return all jurisdiction groups of the found jurisdiction type
		select * from [JurisdictionGroup] 
			where [JurisdictionType] IN (select [JurisdictionType] from [Jurisdiction] 
											where [JurisdictionId] = @JurisdictionId)
	END ELSE BEGIN
		select JG.* from [JurisdictionGroup] JG
			inner join [JurisdictionRelation] JR on JR.[JurisdictionGroupId] = JG.[JurisdictionGroupId]
			where JR.[JurisdictionId] = @JurisdictionId
	END

	select JR.* from [JurisdictionRelation] JR
		inner join [Jurisdiction] J on JR.[JurisdictionId]=J.[JurisdictionId]
		where JR.[JurisdictionId] = @JurisdictionId
END
GO
PRINT N'Creating [dbo].[aspnet_UsersInRoles_GetRolesForUser]...';


GO

CREATE PROCEDURE dbo.aspnet_UsersInRoles_GetRolesForUser
    @ApplicationName  nvarchar(256),
    @UserName         nvarchar(256)
AS
BEGIN
    DECLARE @ApplicationId uniqueidentifier
    SELECT  @ApplicationId = NULL
    SELECT  @ApplicationId = ApplicationId FROM aspnet_Applications WHERE LOWER(@ApplicationName) = LoweredApplicationName
    IF (@ApplicationId IS NULL)
        RETURN(1)
    DECLARE @UserId uniqueidentifier
    SELECT  @UserId = NULL

    SELECT  @UserId = UserId
    FROM    dbo.aspnet_Users
    WHERE   LoweredUserName = LOWER(@UserName) AND ApplicationId = @ApplicationId

    IF (@UserId IS NULL)
        RETURN(1)

    SELECT r.RoleName
    FROM   dbo.aspnet_Roles r, dbo.aspnet_UsersInRoles ur
    WHERE  r.RoleId = ur.RoleId AND r.ApplicationId = @ApplicationId AND ur.UserId = @UserId
    ORDER BY r.RoleName
    RETURN (0)
END
GO
PRINT N'Creating [dbo].[ecf_CatalogNode_GetAllChildNodes]...';


GO
create procedure ecf_CatalogNode_GetAllChildNodes
    @catalogNodeIds udttCatalogNodeList readonly
as
begin
    with all_node_relations as 
    (
        select ParentNodeId, CatalogNodeId as ChildNodeId from CatalogNode
        where ParentNodeId > 0
        union
        select ParentNodeId, ChildNodeId from CatalogNodeRelation
    ),
    hierarchy as
    (
        select 
            n.CatalogNodeId,
            '|' + CAST(n.CatalogNodeId as nvarchar(4000)) + '|' as CyclePrevention
        from @catalogNodeIds n
        union all
        select
            children.ChildNodeId as CatalogNodeId,
            parent.CyclePrevention + CAST(children.ChildNodeId as nvarchar(4000)) + '|' as CyclePrevention
        from hierarchy parent
        join all_node_relations children on parent.CatalogNodeId = children.ParentNodeId
        where CHARINDEX('|' + CAST(children.ChildNodeId as nvarchar(4000)) + '|', parent.CyclePrevention) = 0
    )
    select CatalogNodeId from hierarchy
end
GO
PRINT N'Creating [dbo].[ecf_CatalogNode_GetAllChildEntries]...';


GO
create procedure ecf_CatalogNode_GetAllChildEntries
    @catalogNodeIds udttCatalogNodeList readonly
as
begin
	declare @hierarchy table (CatalogNodeId int)
	insert @hierarchy exec ecf_CatalogNode_GetAllChildNodes @catalogNodeIds

    select distinct ce.CatalogEntryId, ce.Code
    from CatalogEntry ce
    join NodeEntryRelation ner on ce.CatalogEntryId = ner.CatalogEntryId
    where ner.CatalogNodeId in (select CatalogNodeId from @hierarchy)
end
GO
PRINT N'Creating [dbo].[ecf_Jurisdiction_JurisdictionGroupId]...';


GO
CREATE PROCEDURE [dbo].[ecf_Jurisdiction_JurisdictionGroupId]
	@JurisdictionGroupId int
AS
BEGIN
	select * from [JurisdictionGroup] 
		where [JurisdictionGroupId] = @JurisdictionGroupId

	select JR.* from [JurisdictionRelation] JR
		inner join [JurisdictionGroup] J on JR.[JurisdictionGroupId]=J.[JurisdictionGroupId]
		where JR.[JurisdictionGroupId] = @JurisdictionGroupId
END
GO
PRINT N'Creating [dbo].[aspnet_UsersInRoles_IsUserInRole]...';


GO

CREATE PROCEDURE dbo.aspnet_UsersInRoles_IsUserInRole
    @ApplicationName  nvarchar(256),
    @UserName         nvarchar(256),
    @RoleName         nvarchar(256)
AS
BEGIN
    DECLARE @ApplicationId uniqueidentifier
    SELECT  @ApplicationId = NULL
    SELECT  @ApplicationId = ApplicationId FROM aspnet_Applications WHERE LOWER(@ApplicationName) = LoweredApplicationName
    IF (@ApplicationId IS NULL)
        RETURN(2)
    DECLARE @UserId uniqueidentifier
    SELECT  @UserId = NULL
    DECLARE @RoleId uniqueidentifier
    SELECT  @RoleId = NULL

    SELECT  @UserId = UserId
    FROM    dbo.aspnet_Users
    WHERE   LoweredUserName = LOWER(@UserName) AND ApplicationId = @ApplicationId

    IF (@UserId IS NULL)
        RETURN(2)

    SELECT  @RoleId = RoleId
    FROM    dbo.aspnet_Roles
    WHERE   LoweredRoleName = LOWER(@RoleName) AND ApplicationId = @ApplicationId

    IF (@RoleId IS NULL)
        RETURN(3)

    IF (EXISTS( SELECT * FROM dbo.aspnet_UsersInRoles WHERE  UserId = @UserId AND RoleId = @RoleId))
        RETURN(1)
    ELSE
        RETURN(0)
END
GO
PRINT N'Creating [dbo].[ecf_CatalogNode_Code]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogNode_Code]
	@CatalogNodeCode nvarchar(100),
	@ReturnInactive bit = 0
AS
BEGIN	
	SELECT N.* from [CatalogNode] N
	WHERE
		N.Code = @CatalogNodeCode AND
		((N.IsActive = 1) or @ReturnInactive = 1)

	SELECT S.* from CatalogItemSeo S
	INNER JOIN CatalogNode N ON N.CatalogNodeId = S.CatalogNodeId
	WHERE
		N.Code = @CatalogNodeCode AND
		((N.IsActive = 1) or @ReturnInactive = 1)
END
GO
PRINT N'Creating [dbo].[ecf_Jurisdiction_JurisdictionGroups]...';


GO
CREATE PROCEDURE [dbo].[ecf_Jurisdiction_JurisdictionGroups]
	@JurisdictionType int = null
AS
BEGIN
	select * from [JurisdictionGroup] JG
		where (COALESCE(@JurisdictionType, JG.[JurisdictionType]) = JG.[JurisdictionType] OR JG.[JurisdictionType] is null)
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_RegisterMetaFieldInSystemClass]...';


GO

CREATE PROCEDURE mdpsp_sys_RegisterMetaFieldInSystemClass
-- Add the parameters for the stored procedure here
	@ClassName nvarchar(255),
	@TableName nvarchar(255),
	@Namespace nvarchar(255)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	DECLARE @ClassId int
	DECLARE @FieldName nvarchar(255)
	DECLARE @FriendlyFieldName nvarchar(255)
	DECLARE @DataTypeId int
	DECLARE @Length int
	DECLARE @Nullable bit
	DECLARE @DUMMY int

    SELECT @ClassId = [MetaClassId] FROM [MetaClass] WHERE [Name] = @ClassName

	DECLARE fieldCursor CURSOR FOR
		SELECT @Namespace+ N'.' + @ClassName, SC .[name] as Name , SC .[name] , @ClassId ,MDT .[DataTypeId], SC .[length], SC .[isnullable], 0, 0, 0, 0  FROM syscolumns AS SC
			INNER JOIN sysobjects SO ON SO.[id] = SC.[id]
			INNER JOIN systypes ST ON ST.[xtype] = SC.[xtype]
			INNER JOIN MetaDataType MDT ON MDT.[Name] = ST.[name]
		WHERE SO.[id]  = object_id( @TableName) and OBJECTPROPERTY( SO.[id], N'IsTable') = 1 and ST.name<>'sysname' and SC .[name] NOT IN (SELECT MF.Name FROM [MetaField] MF WHERE SystemMetaClassId = @ClassId)
		ORDER BY colorder

	OPEN fieldCursor
	FETCH NEXT FROM fieldCursor INTO @Namespace, @FieldName, @FriendlyFieldName, @ClassId, @DataTypeId, @Length, @Nullable, @DUMMY, @DUMMY, @DUMMY, @DUMMY
	WHILE @@FETCH_STATUS = 0
		BEGIN
			PRINT 'Registering new MetaField' + @FieldName

			INSERT INTO [MetaField] ([Namespace], [Name], [FriendlyName], [SystemMetaClassId], [DataTypeId], [Length], [AllowNulls], [MultiLanguageValue], [AllowSearch], [IsEncrypted])
            VALUES (@Namespace, @FieldName, @FriendlyFieldName, @ClassId, @DataTypeId, @Length, @Nullable,  0, 0, 0)

            INSERT INTO [MetaClassMetaFieldRelation]  (MetaClassId, MetaFieldId)
					SELECT MC.[MetaClassId], @@IDENTITY FROM (
						SELECT [MetaClassId] FROM MetaClass WHERE ParentClassId = @ClassId UNION
						SELECT @ClassId
					) MC

			FETCH NEXT FROM fieldCursor INTO @Namespace, @FieldName, @FriendlyFieldName, @ClassId, @DataTypeId, @Length, @Nullable, @DUMMY, @DUMMY, @DUMMY, @DUMMY
		END
	CLOSE fieldCursor
	DEALLOCATE fieldCursor
END
GO
PRINT N'Creating [dbo].[ecf_Jurisdiction_JurisdictionGroupCode]...';


GO
CREATE PROCEDURE [dbo].[ecf_Jurisdiction_JurisdictionGroupCode]
	@JurisdictionGroupCode nvarchar(50)
AS
BEGIN
	select * from [JurisdictionGroup] 
		where [Code] = @JurisdictionGroupCode

	select JR.* from [JurisdictionRelation] JR
		inner join [JurisdictionGroup] J on JR.[JurisdictionGroupId]=J.[JurisdictionGroupId]
		where J.[Code] = @JurisdictionGroupCode
END
GO
PRINT N'Creating [dbo].[ecf_CatalogNode_CatalogParentNode]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogNode_CatalogParentNode]
    @CatalogId int,
	@ParentNodeId int,
	@ReturnInactive bit = 0
AS
BEGIN
	SELECT N.[CatalogNodeId]
      ,N.[CatalogId]
      ,N.[StartDate]
      ,N.[EndDate]
      ,N.[Name]
      ,N.[TemplateName]
      ,N.[Code]
      ,N.[ParentNodeId]
      ,N.[MetaClassId]
      ,N.[IsActive]
      ,N.[ContentAssetsID]
      ,N.[ContentGuid]
	  ,N.SortOrder AS SortOrder
	INTO #ChildNodes
	FROM [CatalogNode] N 
	WHERE 
		(N.CatalogId = @CatalogId AND N.ParentNodeId = @ParentNodeId) AND
		(N.IsActive = 1 OR @ReturnInactive = 1)
	
	SELECT * FROM #ChildNodes
	UNION ALL
	SELECT N.[CatalogNodeId]
      ,N.[CatalogId]
      ,N.[StartDate]
      ,N.[EndDate]
      ,N.[Name]
      ,N.[TemplateName]
      ,N.[Code]
      ,N.[ParentNodeId]
      ,N.[MetaClassId]
      ,N.[IsActive]
      ,N.[ContentAssetsID]
      ,N.[ContentGuid]
	  ,NR.SortOrder AS SortOrder 
	FROM [CatalogNode] N 
	LEFT OUTER JOIN CatalogNodeRelation NR ON N.CatalogNodeId = NR.ChildNodeId
	LEFT OUTER JOIN #ChildNodes CN ON N.CatalogNodeId = CN.CatalogNodeId
	WHERE 
		(NR.CatalogId = @CatalogId AND NR.ParentNodeId = @ParentNodeId) AND 
		(N.IsActive = 1 OR @ReturnInactive = 1) AND 
		CN.CatalogNodeId IS NULL
	ORDER BY SortOrder

	SELECT S.* FROM CatalogItemSeo S 
	WHERE CatalogNodeId IN
		(SELECT DISTINCT N.CatalogNodeId 
		FROM [CatalogNode] N 
		LEFT OUTER JOIN CatalogNodeRelation NR ON N.CatalogNodeId = NR.ChildNodeId
		WHERE
			((N.CatalogId = @CatalogId AND N.ParentNodeId = @ParentNodeId) OR (NR.CatalogId = @CatalogId AND NR.ParentNodeId = @ParentNodeId)) AND 
			(N.IsActive = 1 OR @ReturnInactive = 1))
END
GO
PRINT N'Creating [dbo].[ecf_Jurisdiction_JurisdictionCode]...';


GO
CREATE PROCEDURE [dbo].[ecf_Jurisdiction_JurisdictionCode]
	@JurisdictionCode nvarchar(50),
	@ReturnAllGroups bit = 0
AS
BEGIN
	select * from [Jurisdiction] 
		where [Code] = @JurisdictionCode

	IF @ReturnAllGroups=1 BEGIN -- return all jurisdiction groups of the found jurisdiction type
		select * from [JurisdictionGroup] 
			where [JurisdictionType] IN (select [JurisdictionType] from [Jurisdiction] 
											where [Code] = @JurisdictionCode)
	END ELSE BEGIN
		select JG.* from [JurisdictionGroup] JG
			inner join [JurisdictionRelation] JR on JR.[JurisdictionGroupId] = JG.[JurisdictionGroupId]
			inner join [Jurisdiction] J on JR.[JurisdictionId] = J.[JurisdictionId]
			where J.[Code] = @JurisdictionCode
	END

	select JR.* from [JurisdictionRelation] JR
		inner join [Jurisdiction] J on JR.[JurisdictionId]=J.[JurisdictionId]
		where J.[Code] = @JurisdictionCode
END
GO
PRINT N'Creating [dbo].[ecf_CatalogNode_CatalogName]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogNode_CatalogName]
	@CatalogName nvarchar(150),
	@ReturnInactive bit = 0
AS
BEGIN
	SELECT N.* from [CatalogNode] N
	INNER JOIN [Catalog] C ON C.CatalogId = N.CatalogId
	WHERE
		C.[Name] = @CatalogName AND N.ParentNodeId = 0 AND 
		((N.IsActive = 1) or @ReturnInactive = 1)
	ORDER BY N.SortOrder

	SELECT S.* from CatalogItemSeo S
	INNER JOIN CatalogNode N ON N.CatalogNodeId = S.CatalogNodeId
	INNER JOIN [Catalog] C ON C.CatalogId = N.CatalogId
	WHERE
		C.[Name] = @CatalogName AND N.ParentNodeId = 0 AND 
		((N.IsActive = 1) or @ReturnInactive = 1)
END
GO
PRINT N'Creating [dbo].[mdpsp_GetChildBySegment]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_GetChildBySegment]
	@parentNodeId int,
	@catalogId int = 0,
	@UriSegment nvarchar(255)
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON;

	SELECT
		S.CatalogNodeId as ChildId,
		S.LanguageCode,
		1 as ContentType
	FROM CatalogItemSeo S WITH (NOLOCK)
		INNER JOIN CatalogNode N WITH (NOLOCK) ON N.CatalogNodeId = S.CatalogNodeId
		LEFT OUTER JOIN CatalogNodeRelation NR ON NR.ChildNodeId = S.CatalogNodeId
	WHERE
		UriSegment = @UriSegment AND N.IsActive = 1 AND
		((N.ParentNodeId = @parentNodeId AND (N.CatalogId = @catalogId OR @catalogId = 0))
		OR
		(NR.ParentNodeId = @parentNodeId AND (NR.CatalogId = @catalogId OR @catalogId = 0)))

	UNION ALL

	(SELECT
		S.CatalogEntryId as ChildId,
		S.LanguageCode,
		0 as ContentType
	FROM CatalogItemSeo S  WITH (NOLOCK)
		INNER JOIN CatalogEntry E ON E.CatalogEntryId = S.CatalogEntryId
		LEFT OUTER JOIN NodeEntryRelation ER ON ER.CatalogEntryId = S.CatalogEntryId
	WHERE
		UriSegment = @UriSegment AND E.IsActive = 1 AND
		((ER.CatalogNodeId = @parentNodeId AND (ER.CatalogId = @catalogId OR @catalogId = 0))
		OR
		(@parentNodeId = 0 AND E.CatalogId = @catalogId))

	EXCEPT

	SELECT
		S.CatalogEntryId as ChildId,
		S.LanguageCode,
		0 as ContentType
	FROM CatalogItemSeo S  WITH (NOLOCK)
		INNER JOIN CatalogEntry E ON E.CatalogEntryId = S.CatalogEntryId 
		INNER JOIN NodeEntryRelation ER ON ER.CatalogEntryId = S.CatalogEntryId AND ER.IsPrimary = 1
	WHERE
		UriSegment = @UriSegment 
		AND E.CatalogId = @catalogId)
END
GO
PRINT N'Creating [dbo].[ecf_Jurisdiction]...';


GO
CREATE PROCEDURE [dbo].[ecf_Jurisdiction]
	@JurisdictionType int = null
AS
BEGIN
	select * from [Jurisdiction] 
		where (COALESCE(@JurisdictionType, [JurisdictionType]) = [JurisdictionType] OR [JurisdictionType] is null)

	select * from [JurisdictionGroup] 
		where (COALESCE(@JurisdictionType, [JurisdictionType]) = [JurisdictionType] OR [JurisdictionType] is null)

	select JR.* from [JurisdictionRelation] JR
		inner join [Jurisdiction] J on JR.[JurisdictionId]=J.[JurisdictionId]
		inner join [JurisdictionGroup] JG on JR.[JurisdictionGroupId]=JG.[JurisdictionGroupId]
		where (COALESCE(@JurisdictionType, J.[JurisdictionType]) = J.[JurisdictionType] OR J.[JurisdictionType] is null) and
			(COALESCE(@JurisdictionType, JG.[JurisdictionType]) = JG.[JurisdictionType] OR JG.[JurisdictionType] is null)
END
GO
PRINT N'Creating [dbo].[ecf_CatalogNode_CatalogId]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogNode_CatalogId]
    @CatalogId int,
	@ReturnInactive bit = 0
AS
BEGIN

	SELECT N.* from [CatalogNode] N
	WHERE
		N.CatalogId = @CatalogId AND
		((N.IsActive = 1) or @ReturnInactive = 1)
	ORDER BY N.SortOrder

	SELECT S.* from CatalogItemSeo S
	INNER JOIN CatalogNode N ON N.CatalogNodeId = S.CatalogNodeId
	WHERE
		N.CatalogId = @CatalogId AND
		((N.IsActive = 1) or @ReturnInactive = 1)	

END
GO
PRINT N'Creating [dbo].[ecf_ShippingMethod_GetCases]...';


GO
CREATE PROCEDURE [dbo].[ecf_ShippingMethod_GetCases]
	@ShippingMethodId uniqueidentifier,
	@CountryCode nvarchar(50) = null,
	@Total DECIMAL (38, 9) = null,
	@StateProvinceCode nvarchar(50) = null,
	@ZipPostalCode nvarchar(50) = null,
	@District nvarchar(50) = null,
	@County nvarchar(50) = null,
	@City nvarchar(50) = null
AS
BEGIN
/* First set all empty string variables except ShippingMethodId to NULL */
IF (LTRIM(RTRIM(@CountryCode)) = '')
  SET @CountryCode = NULL

IF (LTRIM(RTRIM(@StateProvinceCode)) = '')
  SET @StateProvinceCode = NULL

IF (LTRIM(RTRIM(@ZipPostalCode)) = '')
  SET @ZipPostalCode = NULL

IF (LTRIM(RTRIM(@District)) = '')
  SET @District = NULL

IF (LTRIM(RTRIM(@County)) = '')
  SET @County = NULL

IF (LTRIM(RTRIM(@City )) = '')
  SET @City = NULL

/* If Jurisdiction values in database are null or an empty string, they will return the same results */
	SELECT C.Charge, C.Total, C.StartDate, C.EndDate, C.JurisdictionGroupId from ShippingMethodCase C 
		inner join JurisdictionGroup JG ON JG.JurisdictionGroupId = C.JurisdictionGroupId
		inner join JurisdictionRelation JR ON JG.JurisdictionGroupId = JR.JurisdictionGroupId
		inner join Jurisdiction J ON JR.JurisdictionId = J.JurisdictionId
	WHERE 
		(C.StartDate < getutcdate() OR C.StartDate is null) AND 
		(C.EndDate > getutcdate() OR C.EndDate is null) AND 
		C.ShippingMethodId = @ShippingMethodId AND
		(@Total >= C.Total OR @Total is null) AND
		(J.CountryCode = @CountryCode OR (@CountryCode is null and J.CountryCode = 'WORLD')) AND 
		JG.JurisdictionType = 2 /*shipping*/ AND
		(COALESCE(@StateProvinceCode, J.StateProvinceCode) = J.StateProvinceCode OR J.StateProvinceCode is null OR RTRIM(LTRIM(J.StateProvinceCode)) = '') AND
		((REPLACE(@ZipPostalCode,' ','') between REPLACE(J.ZipPostalCodeStart,' ','') and REPLACE(J.ZipPostalCodeEnd,' ','') or @ZipPostalCode is null) OR J.ZipPostalCodeStart is null OR RTRIM(LTRIM(J.ZipPostalCodeStart)) = '') AND
		(COALESCE(@District, J.District) = J.District OR J.District is null OR RTRIM(LTRIM(J.District)) = '') AND
		(COALESCE(@County, J.County) = J.County OR J.County is null OR RTRIM(LTRIM(J.County)) = '') AND
		(COALESCE(@City, J.City) = J.City OR J.City is null OR RTRIM(LTRIM(J.City)) = '')
END
GO
PRINT N'Creating [dbo].[ecf_CatalogNode_Asset]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogNode_Asset]
    @CatalogNodeId int
AS
BEGIN
	SELECT A.* from [CatalogItemAsset] A
	WHERE
		A.CatalogNodeId = @CatalogNodeId
		AND A.CatalogNodeId > 0 -- Force using filtered index
END
GO
PRINT N'Creating [dbo].[ecf_GetTaxes]...';


GO
CREATE PROCEDURE ecf_GetTaxes
	@SiteId uniqueidentifier,
	@TaxCategory nvarchar(50),
	@LanguageCode nvarchar(50),
	@CountryCode nvarchar(50),
	@StateProvinceCode nvarchar(50) = null,
	@ZipPostalCode nvarchar(50) = null,
	@District nvarchar(50) = null,
	@County nvarchar(50) = null,
	@City nvarchar(50) = null
AS
	SELECT V.Percentage, T.TaxType, T.Name, (select L.DisplayName from TaxLanguage L where L.TaxId = V.TaxId and LanguageCode = @LanguageCode) DisplayName from TaxValue V 
		inner join Tax T ON T.TaxId = V.TaxId
		inner join JurisdictionGroup JG ON JG.JurisdictionGroupId = V.JurisdictionGroupId
		inner join JurisdictionRelation JR ON JG.JurisdictionGroupId = JR.JurisdictionGroupId
		inner join Jurisdiction J ON JR.JurisdictionId = J.JurisdictionId
	WHERE 
		V.AffectiveDate < getutcdate() AND 
		V.TaxCategory = @TaxCategory AND
		(COALESCE(V.SiteId, @SiteId) = @SiteId or SiteId is null) AND
		J.CountryCode = @CountryCode AND 
		JG.JurisdictionType = 1 /*tax*/ AND
		(COALESCE(@StateProvinceCode, J.StateProvinceCode) = J.StateProvinceCode OR J.StateProvinceCode is null) AND
		((@ZipPostalCode between J.ZipPostalCodeStart and J.ZipPostalCodeEnd or @ZipPostalCode is null) OR J.ZipPostalCodeStart is null) AND
		(COALESCE(@District, J.District) = J.District OR J.District is null) AND
		(COALESCE(@County, J.County) = J.County OR J.County is null) AND
		(COALESCE(@City, J.City) = J.City OR J.City is null)
GO
PRINT N'Creating [dbo].[ecf_CatalogNode]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogNode]
    @CatalogNodeId int,
	@ReturnInactive bit = 0
AS
BEGIN
	
	SELECT N.* from [CatalogNode] N
	WHERE
		N.CatalogNodeId = @CatalogNodeId AND
		((N.IsActive = 1) or @ReturnInactive = 1)

	SELECT S.* from CatalogItemSeo S
	INNER JOIN CatalogNode N ON N.CatalogNodeId = S.CatalogNodeId
	WHERE
		N.CatalogNodeId = @CatalogNodeId AND
		((N.IsActive = 1) or @ReturnInactive = 1)	

END
GO
PRINT N'Creating [dbo].[mc_blob_BlobStorageRemoveExpired]...';


GO
CREATE PROCEDURE [dbo].[mc_blob_BlobStorageRemoveExpired] 
	@PeriodInMin as int
AS
BEGIN
	SET NOCOUNT ON;

	DELETE FROM McBlobStorage 
    WHERE DateDiff(minute, [created], GETUTCDATE()) >= @PeriodInMin AND [isTemporary] = 1
END
GO
PRINT N'Creating [dbo].[ecf_Tax_TaxName]...';


GO
CREATE PROCEDURE [dbo].[ecf_Tax_TaxName]
	@Name nvarchar(50)
AS
BEGIN
	select T.* from [Tax] T 
		where T.[Name] = @Name 

	select TL.* from [TaxLanguage] TL
		inner join [Tax] T on T.[TaxId] = TL.[TaxId]
			where T.[Name] = @Name

	select TV.* from [TaxValue] TV
		inner join [Tax] T on T.[TaxId] = TV.[TaxId]
			where T.[Name] = @Name
END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntrySearch_GetResults]...';


GO
create procedure [dbo].[ecf_CatalogEntrySearch_GetResults]
    @SearchSetId uniqueidentifier,
    @FirstResultIndex int,
    @MaxResultCount int
as
begin
    declare @LastResultIndex int
    set @LastResultIndex = @FirstResultIndex + @MaxResultCount - 1
    
    declare @keyset table (CatalogEntryId int)
    insert into @keyset 
    select CatalogEntryId
    from CatalogEntrySearchResults_SingleSort ix
    where ix.SearchSetId = @SearchSetId
      and ix.ResultIndex between @FirstResultIndex and @LastResultIndex
    
    select ce.*
    from CatalogEntry ce
    join @keyset ks on ce.CatalogEntryId = ks.CatalogEntryId
    order by ce.CatalogEntryId
    
    select cis.*
    from CatalogItemSeo cis
    join @keyset ks on cis.CatalogEntryId = ks.CatalogEntryId
    order by cis.CatalogEntryId
    
    select v.*
    from Variation v
    join @keyset ks on v.CatalogEntryId = ks.CatalogEntryId
    order by v.CatalogEntryId
                    
    select distinct m.*
    from Merchant m
    join Variation v on m.MerchantId = v.MerchantId
    join @keyset ks on v.CatalogEntryId = ks.CatalogEntryId
   	    
   	select ca.*
   	from CatalogAssociation ca
   	join @keyset ks on ca.CatalogEntryId = ks.CatalogEntryId
    order by ca.CatalogEntryId

   	select cia.*
   	from CatalogItemAsset cia
   	join @keyset ks on cia.CatalogEntryId = ks.CatalogEntryId
    order by cia.CatalogEntryId

   	select ner.*
   	from NodeEntryRelation ner
   	join @keyset ks on ner.CatalogEntryId = ks.CatalogEntryId
    order by ner.CatalogEntryId

	-- Cleanup the loaded OrderGroupIds from SearchResults.
	delete from CatalogEntrySearchResults_SingleSort
	where @SearchSetId = SearchSetId and ResultIndex between @FirstResultIndex and @LastResultIndex
end
GO
PRINT N'Creating [dbo].[mdpsp_sys_RotateEncryptionKeys]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_RotateEncryptionKeys] AS
	-- encryption is disabled by default. To enable encryption, execute EncryptionSupport.sql file of EPiServer.Commerce.Core package.
GO
PRINT N'Creating [dbo].[mc_mcweb_FormDocumentSelect]...';


GO
CREATE PROCEDURE [dbo].[mc_mcweb_FormDocumentSelect]
@FormDocumentId AS Int
AS
BEGIN
SET NOCOUNT ON;

SELECT [t01].[FormDocumentId] AS [FormDocumentId], [t01].[MetaClassName] AS [MetaClassName], [t01].[FormDocumentName] AS [FormDocumentName], [t01].[FormDocumentXml] AS [FormDocumentXml], [t01].[MetaUITypeId] AS [MetaUITypeId]
FROM [mcweb_FormDocument] AS [t01]
WHERE ([t01].[FormDocumentId]=@FormDocumentId)
END
GO
PRINT N'Creating [dbo].[ecf_Tax_TaxId]...';


GO
CREATE PROCEDURE [dbo].[ecf_Tax_TaxId]
	@TaxId int	
AS
BEGIN
	select T.* from [Tax] T 
		where T.[TaxId] = @TaxId

	select TL.* from [TaxLanguage] TL
		inner join [Tax] T on T.[TaxId] = TL.[TaxId]
			where TL.[TaxId] = @TaxId

	select TV.* from [TaxValue] TV
		inner join [Tax] T on T.[TaxId] = TV.[TaxId]
			where TV.[TaxId] = @TaxId
END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntrySearch_Init]...';


GO
create procedure [dbo].[ecf_CatalogEntrySearch_Init]
    @CatalogId int,
    @SearchSetId uniqueidentifier,
    @IncludeInactive bit,
    @EarliestModifiedDate datetime = null,
    @LatestModifiedDate datetime = null,
    @DatabaseClockOffsetMS int = null
as
begin
	declare @purgedate datetime
	begin try
		set @purgedate = datediff(day, 3, GETUTCDATE())
		delete from [CatalogEntrySearchResults_SingleSort] where Created < @purgedate
	end try
	begin catch
	end catch

    declare @ModifiedCondition nvarchar(max)
    declare @EarliestModifiedFilter nvarchar(4000) = ''
	declare @LatestModifiedFilter nvarchar(4000) = ''
	declare @query nvarchar(max)
	declare @AppLogQuery nvarchar(4000)

	set @ModifiedCondition = 'select ObjectId from CatalogContentEx where ObjectTypeId = 0'
    
    -- @ModifiedFilter: if there is a filter, build the where clause for it here.
    if (@EarliestModifiedDate is not null)
    begin
	  	set @EarliestModifiedFilter = ' Modified >= cast(''' + CONVERT(nvarchar(100), @EarliestModifiedDate, 127) + ''' as datetime)'
	  	set @ModifiedCondition = @ModifiedCondition + ' and ' + @EarliestModifiedFilter
	end
    if (@LatestModifiedDate is not null)
    begin
    	set @LatestModifiedFilter = ' Modified <= cast('''  + CONVERT(nvarchar(100), @LatestModifiedDate, 127) + ''' as datetime)'
	 	set @ModifiedCondition = @ModifiedCondition + ' and ' + @LatestModifiedFilter
	end

    -- find all the catalog entries that have modified relations in NodeEntryRelation, or deleted relations in ApplicationLog
    if (@EarliestModifiedDate is not null and @LatestModifiedDate is not null)
    begin

		set @EarliestModifiedFilter = ' Modified >= cast(''' + CONVERT(nvarchar(100), @EarliestModifiedDate, 127) + ''' as datetime)'
		set @LatestModifiedFilter = ' Modified <= cast('''  + CONVERT(nvarchar(100), @LatestModifiedDate, 127) + ''' as datetime)'
		
		declare @EarliestModifiedFilterPadded nvarchar(4000) =  @EarliestModifiedFilter
		declare @LatestModifiedFilterPadded nvarchar(4000) = @LatestModifiedFilter

        -- adjust modified date filters to account for clock difference between database server and application server clocks    
        if (isnull(@DatabaseClockOffsetMS, 0) > 0)
        begin
            set @EarliestModifiedFilterPadded = ' Modified >= cast(''' + CONVERT(nvarchar(100), DATEADD(MS, -@DatabaseClockOffsetMS, @EarliestModifiedDate), 127) + ''' as datetime)'
			set @LatestModifiedFilterPadded = ' Modified <= cast('''  + CONVERT(nvarchar(100), DATEADD(MS, -@DatabaseClockOffsetMS, @LatestModifiedDate), 127) + ''' as datetime)'
		end

		-- applying the NodeEntryRelation.
		set @ModifiedCondition = @ModifiedCondition + ' union select CatalogEntryId from NodeEntryRelation where ' + @EarliestModifiedFilterPadded + ' and ' + @LatestModifiedFilterPadded
	
		set @EarliestModifiedFilter = REPLACE( @EarliestModifiedFilter, 'Modified', 'Created')
		set @LatestModifiedFilter = REPLACE( @LatestModifiedFilter, 'Modified', 'Created')
			
		set @AppLogQuery = ' union select cast(ObjectKey as int) as CatalogEntryId from ApplicationLog where [Source] = ''catalog'' and [Operation] = ''Modified'' and [ObjectType] = ''relation'' and ' + @EarliestModifiedFilter + ' and ' + @LatestModifiedFilter

		-- applying the ApplicationLog.
		set @ModifiedCondition = @ModifiedCondition + @AppLogQuery
    end

    set @query = 'insert into CatalogEntrySearchResults_SingleSort (SearchSetId, ResultIndex, CatalogEntryId) ' +
    'select distinct ''' + cast(@SearchSetId as nvarchar(36)) + ''', ROW_NUMBER() over (order by e.CatalogEntryId), e.CatalogEntryId from CatalogEntry e ' +
    ' inner join (' + @ModifiedCondition + ') o on e.CatalogEntryId = o.ObjectId' + 
	' where e.CatalogId = ' + cast(@CatalogId as nvarchar) + ' ' 	 
      
    if @IncludeInactive = 0 set @query = @query + ' and e.IsActive = 1'

    execute dbo.sp_executesql @query
    
    select @@ROWCOUNT
end
GO
PRINT N'Creating [dbo].[mdpsp_sys_UpdateMetaSqlScriptTemplate]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_UpdateMetaSqlScriptTemplate]
	@MetaClassId 	INT,
	@FieldListChanged	NVARCHAR(MAX)
AS
	UPDATE MetaClass SET FieldListChangedSqlScript = @FieldListChanged WHERE MetaClassId = @MetaClassId
GO
PRINT N'Creating [dbo].[mc_mcweb_FormDocumentDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_mcweb_FormDocumentDelete]
@FormDocumentId AS Int
AS
BEGIN
SET NOCOUNT ON;
DELETE FROM [mcweb_FormDocument]
WHERE
[FormDocumentId] = @FormDocumentId
END
GO
PRINT N'Creating [dbo].[ecf_Tax]...';


GO
CREATE PROCEDURE [dbo].[ecf_Tax]
	@TaxType int = null
AS
BEGIN
	select T.* from [Tax] T 
		where (COALESCE(@TaxType, T.[TaxType]) = T.[TaxType] OR T.[TaxType] is null)

	select TL.* from [TaxLanguage] TL
		inner join [Tax] T on TL.[TaxId]=T.[TaxId]
		where (COALESCE(@TaxType, T.[TaxType]) = T.[TaxType] OR T.[TaxType] is null)

	select TV.* from [TaxValue] TV
		inner join [Tax] T on TV.[TaxId]=T.[TaxId]
		where (COALESCE(@TaxType, T.[TaxType]) = T.[TaxType] OR T.[TaxType] is null)
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_UpdateMetaRule]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_UpdateMetaRule]
	@RuleId	INT,
	@MetaClassId	INT,
	@Data		IMAGE,
	@RetVal	INT	OUTPUT
AS
	SET NOCOUNT ON

	IF ((SELECT COUNT(*) FROM MetaRule WHERE RuleId=@RuleId) = 0)
	BEGIN
		INSERT INTO MetaRule(MetaClassId, Data) VALUES (@MetaClassId, @Data)

		IF @@ERROR <> 0 SET @RetVal = -1
		ELSE SET @RetVal = @@IDENTITY
	END
	ELSE
	BEGIN
		UPDATE MetaRule SET Data=@Data WHERE RuleId=@RuleId
		SET @RetVal = @RuleId
	END

	SET NOCOUNT OFF
GO
PRINT N'Creating [dbo].[mc_mcweb_FormDocumentUpdate]...';


GO
CREATE PROCEDURE [dbo].[mc_mcweb_FormDocumentUpdate]
@MetaClassName AS NVarChar(4000),
@FormDocumentName AS NVarChar(4000),
@FormDocumentXml AS NText,
@MetaUITypeId AS NVarChar(4000),
@FormDocumentId AS Int
AS
BEGIN
SET NOCOUNT ON;

UPDATE [mcweb_FormDocument] SET
[MetaClassName] = @MetaClassName,
[FormDocumentName] = @FormDocumentName,
[FormDocumentXml] = @FormDocumentXml,
[MetaUITypeId] = @MetaUITypeId WHERE
[FormDocumentId] = @FormDocumentId
END
GO
PRINT N'Creating [dbo].[ecf_ShippingPackage_PackageId]...';


GO
CREATE PROCEDURE [dbo].[ecf_ShippingPackage_PackageId]
	@PackageId int
AS
	select * from [Package] P 
		where P.[PackageId] = @PackageId
GO
PRINT N'Creating [dbo].[ecf_CatalogEntryByCode]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntryByCode]
	@CatalogEntryCode nvarchar(100),
	@ReturnInactive bit = 0,
	@ResponseGroup INT = NULL
AS
BEGIN
	DECLARE @CatalogEntryIds udttContentList
	INSERT INTO @CatalogEntryIds
	SELECT N.CatalogEntryId from [CatalogEntry] N
	WHERE
		N.Code = @CatalogEntryCode AND
		((N.IsActive = 1) or @ReturnInactive = 1)

	SELECT N.* from [CatalogEntry] N
	INNER JOIN @CatalogEntryIds C ON C.ContentId = N.CatalogEntryId

	SELECT S.* from CatalogItemSeo S
	INNER JOIN @CatalogEntryIds C ON C.ContentId = S.CatalogEntryId

	exec ecf_CatalogEntry_Components @CatalogEntryIds, @ResponseGroup
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_UpdateMetaObjectValue]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_UpdateMetaObjectValue]
	@MetaKey	INT,
	@MetaClassId	INT,
	@MetaObjectId	INT
AS
	SET NOCOUNT ON

	IF (EXISTS(SELECT * FROM MetaObjectValue WHERE MetaKey = @MetaKey) )
		UPDATE MetaObjectValue SET MetaClassId = @MetaClassId, MetaObjectId = @MetaObjectId WHERE MetaKey = @MetaKey
	ELSE
		INSERT INTO MetaObjectValue (MetaKey,MetaClassId,MetaObjectId)
			VALUES (@MetaKey,@MetaClassId,@MetaObjectId)
GO
PRINT N'Creating [dbo].[mc_mcweb_FormDocumentInsert]...';


GO
CREATE PROCEDURE [dbo].[mc_mcweb_FormDocumentInsert]
(
@FormDocumentId int = NULL OUTPUT,
@MetaClassName nvarchar(50),
@FormDocumentName nvarchar(50),
@FormDocumentXml ntext,
@MetaUITypeId nvarchar(50))
AS
SET NOCOUNT ON
INSERT INTO [mcweb_FormDocument]
(
[MetaClassName],
[FormDocumentName],
[FormDocumentXml],
[MetaUITypeId])
VALUES(
@MetaClassName,
@FormDocumentName,
@FormDocumentXml,
@MetaUITypeId)
SELECT @FormDocumentId = SCOPE_IDENTITY();
RETURN @@Error
GO
PRINT N'Creating [dbo].[ecf_ShippingPackage_Name]...';


GO
CREATE PROCEDURE [dbo].[ecf_ShippingPackage_Name]
	@Name nvarchar(100)
AS
	select * from [Package] P 
		where P.[Name] = @Name
GO
PRINT N'Creating [dbo].[mdpsp_sys_UpdateMetaFile]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_UpdateMetaFile]
	@MetaKey	INT,
	@FileName	NVARCHAR(256),
	@ContentType	NVARCHAR(256),
	@Data		image,
	@Size		INT,
	@CreationTime	DATETIME,
	@LastWriteTime 	DATETIME,
	@LastReadTime	DATETIME
AS
	SET NOCOUNT ON

	IF (EXISTS(SELECT * FROM MetaFileValue WHERE MetaKey = @MetaKey) )
		UPDATE MetaFileValue SET [FileName] = @FileName, ContentType = @ContentType, Data = @Data, [Size] = @Size,
			CreationTime = @CreationTime, LastWriteTime = @LastWriteTime, LastReadTime = @LastReadTime WHERE MetaKey = @MetaKey
	ELSE
		INSERT INTO MetaFileValue (MetaKey,FileName,ContentType,Data, Size,CreationTime, LastWriteTime, LastReadTime )
			VALUES (@MetaKey,@FileName,@ContentType,@Data, @Size,@CreationTime, @LastWriteTime, @LastReadTime)
GO
PRINT N'Creating [dbo].[mc_mcweb_ListViewProfileSelect]...';


GO
CREATE PROCEDURE [dbo].[mc_mcweb_ListViewProfileSelect]
@ListViewProfileId AS Int
AS
BEGIN
SET NOCOUNT ON;
SELECT [t01].[ListViewProfileId] AS [ListViewProfileId], [t01].[UserId] AS [UserId], [t01].[MetaClassName] AS [MetaClassName], [t01].[ViewName] AS [ViewName], [t01].[PlaceName] AS [PlaceName], [t01].[IsSystem] AS [IsSystem], [t01].[IsPublic] AS [IsPublic], [t01].[XSListViewProfile] AS [XSListViewProfile], [t01].[UserUid] AS [UserUid]
FROM [mcweb_ListViewProfile] AS [t01]
WHERE ([t01].[ListViewProfileId]=@ListViewProfileId)
END
GO
PRINT N'Creating [dbo].[ecf_ShippingPackage]...';


GO
CREATE PROCEDURE [dbo].[ecf_ShippingPackage]
AS
	select * from [Package] P
GO
PRINT N'Creating [dbo].[ecf_CatalogEntry_UriSegment]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntry_UriSegment]
	@UriSegment nvarchar(255),
	@CatalogEntryId int,
	@ReturnInactive bit = 0
AS
BEGIN
	SELECT COUNT(*) from CatalogItemSeo S
	INNER JOIN CatalogEntry N ON N.CatalogEntryId = S.CatalogEntryId
	WHERE
		S.UriSegment = @UriSegment AND
		S.CatalogEntryId <> @CatalogEntryId AND
		((N.IsActive = 1) or @ReturnInactive = 1)
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_UpdateMetaFieldWeight]...';


GO





CREATE PROCEDURE [dbo].[mdpsp_sys_UpdateMetaFieldWeight]
	@MetaClassId	INT,
	@MetaFieldId	INT,
	@Weight	INT
AS
	IF NOT EXISTS(	SELECT * FROM MetaClassMetaFieldRelation WHERE MetaClassId = @MetaClassId AND MetaFieldId = @MetaFieldId)
		RAISERROR ('Wrong @MetaClassId or @MetaFieldId.', 16,1)
	ELSE
		UPDATE MetaClassMetaFieldRelation SET  Weight = @Weight WHERE MetaClassId = @MetaClassId AND MetaFieldId = @MetaFieldId
GO
PRINT N'Creating [dbo].[mc_mcweb_ListViewProfileDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_mcweb_ListViewProfileDelete]
@ListViewProfileId AS Int
AS
BEGIN
SET NOCOUNT ON;

DELETE FROM [mcweb_ListViewProfile]
WHERE
[ListViewProfileId] = @ListViewProfileId
END
GO
PRINT N'Creating [dbo].[ecf_ShippingOption_ShippingOptionId]...';


GO
CREATE PROCEDURE [dbo].[ecf_ShippingOption_ShippingOptionId]
	@ShippingOptionId uniqueidentifier
AS
BEGIN
	select * from [ShippingOption] 
		where [ShippingOptionId] = @ShippingOptionId
	select SOP.* from [ShippingOptionParameter] SOP 
	inner join [ShippingOption] SO on SO.[ShippingOptionId]=SOP.[ShippingOptionId]
		where SO.[ShippingOptionId] = @ShippingOptionId
	select * from [Package] P
		inner join [ShippingPackage] SP on P.[PackageId]=SP.[PackageId]
			where SP.[ShippingOptionId] = @ShippingOptionId
	select * from [ShippingPackage] where [ShippingOptionId] = @ShippingOptionId
END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntry_UriLanguage]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntry_UriLanguage]
	@Uri nvarchar(255),
	@LanguageCode nvarchar(50),
	@ReturnInactive bit = 0,
	@ResponseGroup INT = NULL
AS
BEGIN
	DECLARE @CatalogEntryIds udttContentList
	INSERT INTO @CatalogEntryIds
	SELECT N.CatalogEntryId from [CatalogEntry] N
	INNER JOIN CatalogItemSeo S ON N.CatalogEntryId = S.CatalogEntryId
	WHERE
		S.Uri = @Uri AND (S.LanguageCode = @LanguageCode OR @LanguageCode is NULL) AND
		((N.IsActive = 1) or @ReturnInactive = 1)

	SELECT TOP(1) N.* from [CatalogEntry] N 
	INNER JOIN CatalogItemSeo S ON N.CatalogEntryId = S.CatalogEntryId
	INNER JOIN @CatalogEntryIds C ON C.ContentId = N.CatalogEntryId

	SELECT S.* from CatalogItemSeo S
	INNER JOIN @CatalogEntryIds C ON C.ContentId = S.CatalogEntryId

	exec ecf_CatalogEntry_Components @CatalogEntryIds, @ResponseGroup
END
GO
PRINT N'Creating [dbo].[ecf_reporting_LowStock]...';


GO
CREATE PROCEDURE [dbo].[ecf_reporting_LowStock] 
As

BEGIN

    SELECT E.[Name], E.Code as SkuId, I.BackorderAvailableUtc as [BackorderAvailabilityDate],
    I.PreorderAvailableUtc as [PreorderAvailabilityDate],
    I.IsTracked as [InventoryStatus],
    [AllowBackorder] = 
        CASE 
            WHEN I.BackorderAvailableQuantity > 0 THEN 1
            ELSE 0
        END,
    [AllowPreOrder] = 
        CASE 
            WHEN I.PreorderAvailableUtc > convert(datetime,0x0000000000000000) THEN 1
            ELSE 0
        END,
    I.BackorderAvailableQuantity as [BackorderQuantity],
    I.PreorderAvailableQuantity as [PreorderQuantity],
    I.ReorderMinQuantity,
    I.WarehouseCode,
    I.AdditionalQuantity as [ReservedQuantity],
    I.PurchaseAvailableQuantity + I.AdditionalQuantity as [InstockQuantity],
    W.Name as WarehouseName from [InventoryService] I
    INNER JOIN [CatalogEntry] E ON E.Code = I.CatalogEntryCode 
    INNER JOIN Catalog C ON C.CatalogId = E.CatalogId
    INNER JOIN [Warehouse] W ON I.WarehouseCode = W.Code
    WHERE I.PurchaseAvailableQuantity <= I.ReorderMinQuantity AND I.IsTracked <> 0 

END
GO
PRINT N'Creating [dbo].[mdpsp_sys_UpdateMetaFieldEnabled]...';


GO




CREATE PROCEDURE [dbo].[mdpsp_sys_UpdateMetaFieldEnabled]
	@MetaClassId	INT,
	@MetaFieldId	INT,
	@Enabled	BIT
AS
	IF NOT EXISTS(	SELECT * FROM MetaClassMetaFieldRelation WHERE MetaClassId = @MetaClassId AND MetaFieldId = @MetaFieldId)
		RAISERROR ('Wrong @MetaClassId or @MetaFieldId.', 16,1)
	ELSE
		UPDATE MetaClassMetaFieldRelation SET  Enabled = @Enabled WHERE MetaClassId = @MetaClassId AND MetaFieldId = @MetaFieldId
GO
PRINT N'Creating [dbo].[mc_mcweb_ListViewProfileUpdate]...';


GO
CREATE PROCEDURE [dbo].[mc_mcweb_ListViewProfileUpdate]
@UserId AS Int,
@MetaClassName AS NVarChar(4000),
@ViewName AS NVarChar(4000),
@PlaceName AS NVarChar(4000),
@IsSystem AS Bit,
@IsPublic AS Bit,
@XSListViewProfile AS NText,
@UserUid AS UniqueIdentifier,
@ListViewProfileId AS Int
AS
BEGIN
SET NOCOUNT ON;

UPDATE [mcweb_ListViewProfile] SET
[UserId] = @UserId,
[MetaClassName] = @MetaClassName,
[ViewName] = @ViewName,
[PlaceName] = @PlaceName,
[IsSystem] = @IsSystem,
[IsPublic] = @IsPublic,
[XSListViewProfile] = @XSListViewProfile,
[UserUid] = @UserUid WHERE
[ListViewProfileId] = @ListViewProfileId

END
GO
PRINT N'Creating [dbo].[ecf_ShippingMethod_ShippingMethodId]...';


GO
CREATE PROCEDURE [dbo].[ecf_ShippingMethod_ShippingMethodId]
	@ShippingMethodId uniqueidentifier,
	@ReturnInactive bit = 0
AS
BEGIN
	select SO.* from [ShippingOption] SO
		inner join [ShippingMethod] SM on SO.[ShippingOptionId]=SM.[ShippingOptionId]
	where SM.[ShippingMethodId] = @ShippingMethodId

	select SOP.* from [ShippingOptionParameter] SOP 
		inner join [ShippingMethod] SM on SOP.[ShippingOptionId]=SM.[ShippingOptionId]
	where SM.[ShippingMethodId] = @ShippingMethodId

	select SM.* from [ShippingMethod] SM
		where ((SM.[IsActive] = 1) or @ReturnInactive = 1) and SM.[ShippingMethodId] = @ShippingMethodId

	select SMP.* from [ShippingMethodParameter] SMP
		inner join [ShippingMethod] SM on SMP.[ShippingMethodId]=SM.[ShippingMethodId]
			where ((SM.[IsActive] = 1) or @ReturnInactive = 1) and SM.[ShippingMethodId] = @ShippingMethodId

	select SMC.* from [ShippingMethodCase] SMC
		inner join [ShippingMethod] SM on SMC.[ShippingMethodId]=SM.[ShippingMethodId]
			where ((SM.[IsActive] = 1) or @ReturnInactive = 1) and SM.[ShippingMethodId] = @ShippingMethodId

	select SC.* from [ShippingCountry] SC
		inner join [ShippingMethod] SM on SC.[ShippingMethodId]=SM.[ShippingMethodId]
			where ((SM.[IsActive] = 1) or @ReturnInactive = 1) and SM.[ShippingMethodId] = @ShippingMethodId

	select SR.* from [ShippingRegion] SR
		inner join [ShippingMethod] SM on SR.[ShippingMethodId]=SM.[ShippingMethodId]
			where ((SM.[IsActive] = 1) or @ReturnInactive = 1) and SM.[ShippingMethodId] = @ShippingMethodId

	select SPR.* from [ShippingPaymentRestriction] SPR
		inner join [ShippingMethod] SM on SPR.[ShippingMethodId]=SM.[ShippingMethodId]
			where ((SM.[IsActive] = 1) or @ReturnInactive = 1) and SM.[ShippingMethodId] = @ShippingMethodId and SPR.[RestrictShippingMethods] = 0

	select P.* from [Package] P
		inner join [ShippingPackage] SP on SP.[PackageId]=P.[PackageId]
		inner join [ShippingMethod] SM on SP.[ShippingOptionId]=SM.[ShippingOptionId]
			where ((SM.[IsActive] = 1) or @ReturnInactive = 1) and SM.[ShippingMethodId] = @ShippingMethodId

	select SP.* from [ShippingPackage] SP
		inner join [ShippingMethod] SM on SP.[ShippingOptionId]=SM.[ShippingOptionId]
			where ((SM.[IsActive] = 1) or @ReturnInactive = 1) and SM.[ShippingMethodId] = @ShippingMethodId

	select SMS.* from [MarketShippingMethods] SMS
		inner join [ShippingMethod] SM on SMS.[ShippingMethodId]=SM.[ShippingMethodId]
			where ((SM.[IsActive] = 1) or @ReturnInactive = 1) and SM.[ShippingMethodId] = @ShippingMethodId
END
GO
PRINT N'Creating [dbo].[aspnet_Profile_GetProfiles]...';


GO

CREATE PROCEDURE dbo.aspnet_Profile_GetProfiles
    @ApplicationName        nvarchar(256),
    @ProfileAuthOptions     int,
    @PageIndex              int,
    @PageSize               int,
    @UserNameToMatch        nvarchar(256) = NULL,
    @InactiveSinceDate      datetime      = NULL
AS
BEGIN
    DECLARE @ApplicationId uniqueidentifier
    SELECT  @ApplicationId = NULL
    SELECT  @ApplicationId = ApplicationId FROM aspnet_Applications WHERE LOWER(@ApplicationName) = LoweredApplicationName
    IF (@ApplicationId IS NULL)
        RETURN

    -- Set the page bounds
    DECLARE @PageLowerBound int
    DECLARE @PageUpperBound int
    DECLARE @TotalRecords   int
    SET @PageLowerBound = @PageSize * @PageIndex
    SET @PageUpperBound = @PageSize - 1 + @PageLowerBound

    -- Create a temp table TO store the select results
    CREATE TABLE #PageIndexForUsers
    (
        IndexId int IDENTITY (0, 1) NOT NULL,
        UserId uniqueidentifier
    )

    -- Insert into our temp table
    INSERT INTO #PageIndexForUsers (UserId)
        SELECT  u.UserId
        FROM    dbo.aspnet_Users u, dbo.aspnet_Profile p
        WHERE   ApplicationId = @ApplicationId
            AND u.UserId = p.UserId
            AND (@InactiveSinceDate IS NULL OR LastActivityDate <= @InactiveSinceDate)
            AND (     (@ProfileAuthOptions = 2)
                   OR (@ProfileAuthOptions = 0 AND IsAnonymous = 1)
                   OR (@ProfileAuthOptions = 1 AND IsAnonymous = 0)
                 )
            AND (@UserNameToMatch IS NULL OR LoweredUserName LIKE LOWER(@UserNameToMatch))
        ORDER BY UserName

    SELECT  u.UserName, u.IsAnonymous, u.LastActivityDate, p.LastUpdatedDate,
            DATALENGTH(p.PropertyNames) + DATALENGTH(p.PropertyValuesString) + DATALENGTH(p.PropertyValuesBinary)
    FROM    dbo.aspnet_Users u, dbo.aspnet_Profile p, #PageIndexForUsers i
    WHERE   u.UserId = p.UserId AND p.UserId = i.UserId AND i.IndexId >= @PageLowerBound AND i.IndexId <= @PageUpperBound

    SELECT COUNT(*)
    FROM   #PageIndexForUsers

    DROP TABLE #PageIndexForUsers
END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntry_ParentEntryId]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntry_ParentEntryId]
    @ParentEntryId int,
	@ClassTypeId nvarchar(50) = '',
	@RelationTypeId nvarchar(50) = '',
	@ReturnInactive bit = 0,
	@ResponseGroup INT = NULL
AS
BEGIN

	if(@ClassTypeId = '')
		set @ClassTypeId = null

	if(@RelationTypeId = '')
		set @RelationTypeId = null

	DECLARE @CatalogEntryIds udttContentList
	INSERT INTO @CatalogEntryIds
	SELECT N.CatalogEntryId from [CatalogEntry] N
	INNER JOIN CatalogEntryRelation R ON R.ChildEntryId = N.CatalogEntryId
	WHERE
	R.ParentEntryId = @ParentEntryId AND COALESCE(@ClassTypeId, N.ClassTypeId) = N.ClassTypeId AND COALESCE(@RelationTypeId, R.RelationTypeId) = R.RelationTypeId AND
	((N.IsActive = 1) or @ReturnInactive = 1)
	ORDER BY R.SortOrder

	SELECT N.*, R.Quantity, R.RelationTypeId, R.GroupName, R.SortOrder from [CatalogEntry] N
	INNER JOIN CatalogEntryRelation R ON R.ChildEntryId = N.CatalogEntryId
	INNER JOIN @CatalogEntryIds C ON C.ContentId = N.CatalogEntryId
	WHERE R.ParentEntryId = @ParentEntryId

	SELECT S.* from CatalogItemSeo S
	INNER JOIN @CatalogEntryIds C ON C.ContentId = S.CatalogEntryId

	exec ecf_CatalogEntry_Components @CatalogEntryIds, @ResponseGroup
END
GO
PRINT N'Creating [dbo].[ecf_reporting_Shipping]...';


GO
CREATE PROCEDURE [dbo].[ecf_reporting_Shipping] 
	@MarketId nvarchar(8),
	@CurrencyCode NVARCHAR(8),
	@interval VARCHAR(20),
	@startdate DATETIME, -- parameter expected in UTC
	@enddate DATETIME, -- parameter expected in UTC
	@offset_st INT,
	@offset_dt INT
AS

BEGIN

	SELECT	x.Period,  
			ISNULL(y.ShippingMethodDisplayName, 'NONE') AS ShippingMethodDisplayName,
			ISNULL(y.NumberofOrders, 0) AS NumberOfOrders,
			ISNULL(y.ShippingTotal, 0) AS TotalShipping,
			ISNULL(y.ShippingDiscount, 0) AS ShippingDiscount,
			ISNULL(y.ShippingCost, 0) AS ShippingCost
			
	FROM 
	(
		SELECT DISTINCT 
			(CASE WHEN @interval = 'Day'
				THEN CONVERT(VARCHAR(10), D.DateFull, 101)
			WHEN @interval = 'Month'
			THEN (DATENAME(MM, D.DateFull) + ', ' + CAST(YEAR(D.DateFull) AS VARCHAR(20))) 
			ElSE CAST(YEAR(D.DateFull) AS VARCHAR(20))  
			End) AS Period 
		FROM ReportingDates D LEFT OUTER JOIN OrderFormEx FEX ON D.DateFull = FEX.Created
		WHERE 
			-- convert back from UTC using offset to generate a list of WEBSERVER datetimes
			D.DateFull BETWEEN 
				cast(floor(cast(dbo.fn_GetDaylightSavingsTime(@startdate, @offset_st, @offset_dt) as float)) as datetime) AND
				cast(floor(cast(dbo.fn_GetDaylightSavingsTime(@enddate, @offset_st, @offset_dt) as float)) as datetime)
	) AS x

	LEFT JOIN

	(
		SELECT DISTINCT (CASE WHEN @interval = 'Day'
							THEN CONVERT(VARCHAR(20), dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt), 101)
							WHEN @interval = 'Month'
							THEN (DATENAME(MM, dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt)) + ', ' 
								+ CAST(YEAR(dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt)) AS VARCHAR(20)) )
							ElSE CAST(YEAR(dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt)) AS VARCHAR(20))   
							End) AS Period, 
				COUNT(S.ShipmentId) AS NumberofOrders, 
				SUM(S.ShipmentTotal) AS ShippingTotal,
				SUM(S.ShippingDiscountAmount) AS ShippingDiscount,
				SUM(S.ShipmentTotal - S.ShippingDiscountAmount) AS ShippingCost,
				SM.DisplayName AS ShippingMethodDisplayName
		FROM Shipment AS S INNER JOIN
		ShippingMethod AS SM ON S.ShippingMethodId = SM.ShippingMethodId INNER JOIN
			OrderForm AS F ON S.OrderFormId = F.OrderFormId INNER JOIN
			OrderFormEx AS FEX ON FEX.ObjectId = F.OrderFormId INNER JOIN
			OrderGroup AS OG ON OG.OrderGroupId = F.OrderGroupId
		WHERE (FEX.Created BETWEEN @startdate AND @enddate)
		AND OG.BillingCurrency = @CurrencyCode 
		AND (LEN(@MarketId) = 0 OR OG.MarketId = @MarketId)
		AND S.Status <> 'Cancelled'
		GROUP BY (Case WHEN @interval = 'Day'
					THEN CONVERT(VARCHAR(20), dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt), 101)
					WHEN @interval = 'Month'
					THEN (DATENAME(MM, dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt)) + ', ' + CAST(YEAR(dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt)) AS VARCHAR(20))  )
					ElSE CAST(YEAR(dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt)) AS VARCHAR(20))   
				END), SM.DisplayName
	) AS y

	ON x.Period = y.Period
	ORDER BY CONVERT(datetime, x.Period, 101)

END
GO
PRINT N'Creating [dbo].[mdpsp_sys_UpdateMetaField]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_UpdateMetaField]
	@MetaFieldId 	INT,
	@Namespace 	NVARCHAR(1024) = N'Mediachase.MetaDataPlus.User',
	@FriendlyName	NVARCHAR(256),
	@Description	NVARCHAR(MAX),
	@Tag		IMAGE
AS
	UPDATE MetaField SET Namespace = @Namespace, FriendlyName = @FriendlyName, Description = @Description, Tag = @Tag WHERE MetaFieldId = @MetaFieldId
GO
PRINT N'Creating [dbo].[mc_mcweb_ListViewProfileInsert]...';


GO
CREATE PROCEDURE [dbo].[mc_mcweb_ListViewProfileInsert]
@UserId AS Int,
@MetaClassName AS NVarChar(4000),
@ViewName AS NVarChar(4000),
@PlaceName AS NVarChar(4000),
@IsSystem AS Bit,
@IsPublic AS Bit,
@XSListViewProfile AS NText,
@UserUid AS UniqueIdentifier,
@ListViewProfileId AS Int = NULL OUTPUT
AS
BEGIN
SET NOCOUNT ON;

INSERT INTO [mcweb_ListViewProfile]
(
[UserId],
[MetaClassName],
[ViewName],
[PlaceName],
[IsSystem],
[IsPublic],
[XSListViewProfile],
[UserUid])
VALUES(
@UserId,
@MetaClassName,
@ViewName,
@PlaceName,
@IsSystem,
@IsPublic,
@XSListViewProfile,
@UserUid)
SELECT @ListViewProfileId = SCOPE_IDENTITY();

END
GO
PRINT N'Creating [dbo].[ecf_ShippingMethod_Market]...';


GO
CREATE PROCEDURE [dbo].[ecf_ShippingMethod_Market]
    @MarketId nvarchar(10) = null,
    @ReturnInactive bit = 0
AS
BEGIN
    declare @_shippingMethodIds as table (ShippingMethodId uniqueidentifier)
    insert into @_shippingMethodIds
    select SM.ShippingMethodId
        from [ShippingMethod] SM
        inner join [MarketShippingMethods] MSM
          on SM.ShippingMethodId = MSM.ShippingMethodId
        inner join [Warehouse] W
          on (SM.Name <> 'In Store Pickup' or W.IsPickupLocation = 1)
        where COALESCE(@MarketId, MSM.MarketId) = MSM.MarketId
          and ((SM.[IsActive] = 1) or (@ReturnInactive = 1))

    select * from [ShippingOption]
    
    select SOP.* from [ShippingOptionParameter] SOP 
    inner join [ShippingOption] SO on SOP.[ShippingOptionId]=SO.[ShippingOptionId]
        
    select distinct SM.* from [ShippingMethod] SM where ShippingMethodId in (select ShippingMethodId from @_shippingMethodIds) order by SM.Ordering
    select * from [ShippingMethodParameter] where ShippingMethodId in (select ShippingMethodId from @_shippingMethodIds)
    select * from [ShippingMethodCase] where ShippingMethodId in (select ShippingMethodId from @_shippingMethodIds)
    select * from [ShippingCountry] where ShippingMethodId in (select ShippingMethodId from @_shippingMethodIds)
    select * from [ShippingRegion] where ShippingMethodId in (select ShippingMethodId from @_shippingMethodIds)
    
    select * from [ShippingPaymentRestriction]
        where 
            ShippingMethodId in (select ShippingMethodId from @_shippingMethodIds)
            and
            [RestrictShippingMethods] = 0
    select * from [Package]

    select SP.* from [ShippingPackage] SP 
    inner join [Package] P on SP.[PackageId]=P.[PackageId]
	select * from [MarketShippingMethods] where ShippingMethodId in (select ShippingMethodId from @_shippingMethodIds)
END
GO
PRINT N'Creating [dbo].[aspnet_Profile_GetNumberOfInactiveProfiles]...';


GO

CREATE PROCEDURE dbo.aspnet_Profile_GetNumberOfInactiveProfiles
    @ApplicationName        nvarchar(256),
    @ProfileAuthOptions     int,
    @InactiveSinceDate      datetime
AS
BEGIN
    DECLARE @ApplicationId uniqueidentifier
    SELECT  @ApplicationId = NULL
    SELECT  @ApplicationId = ApplicationId FROM aspnet_Applications WHERE LOWER(@ApplicationName) = LoweredApplicationName
    IF (@ApplicationId IS NULL)
    BEGIN
        SELECT 0
        RETURN
    END

    SELECT  COUNT(*)
    FROM    dbo.aspnet_Users u, dbo.aspnet_Profile p
    WHERE   ApplicationId = @ApplicationId
        AND u.UserId = p.UserId
        AND (LastActivityDate <= @InactiveSinceDate)
        AND (
                (@ProfileAuthOptions = 2)
                OR (@ProfileAuthOptions = 0 AND IsAnonymous = 1)
                OR (@ProfileAuthOptions = 1 AND IsAnonymous = 0)
            )
END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntry_Name]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntry_Name]
	@Name nvarchar(100) = '',
	@ClassTypeId nvarchar(50) = '',
	@ReturnInactive bit = 0,
	@ResponseGroup INT = NULL
AS
BEGIN

	if(@ClassTypeId = '')
		set @ClassTypeId = null

	if(@Name = '')
		set @Name = null

	DECLARE @CatalogEntryIds udttContentList
	INSERT INTO @CatalogEntryIds
	SELECT N.CatalogEntryId from [CatalogEntry] N
	WHERE
	N.[Name] like @Name AND COALESCE(@ClassTypeId, N.ClassTypeId) = N.ClassTypeId AND
	((N.IsActive = 1) or @ReturnInactive = 1)

	SELECT N.* from [CatalogEntry] N
	INNER JOIN @CatalogEntryIds C ON N.CatalogEntryId = C.ContentId
	

	SELECT DISTINCT S.* from CatalogItemSeo S
	INNER JOIN @CatalogEntryIds C ON S.CatalogEntryId = C.ContentId

	exec ecf_CatalogEntry_Components @CatalogEntryIds, @ResponseGroup
END
GO
PRINT N'Creating [dbo].[ecf_reporting_ProductBestSellers]...';


GO
CREATE PROCEDURE [dbo].[ecf_reporting_ProductBestSellers] 
	@MarketId nvarchar(8),
	@CurrencyCode NVARCHAR(8),
	@interval VARCHAR(20),
	@startdate DATETIME, -- parameter expected in UTC
	@enddate DATETIME, -- parameter expected in UTC
	@offset_st INT,
	@offset_dt INT
AS

BEGIN

	SELECT	z.Period, 
			z.ProductName, 
			z.Price, 
			z.Ordered,
			z.Code
	FROM
	(
		SELECT	x.Period as Period,  
				ISNULL(y.ProductName, 'NONE') AS ProductName,
				ISNULL(y.Price,0) AS Price,
				ISNULL(y.ItemsOrdered, 0) AS Ordered,
				RANK() OVER (PARTITION BY x.Period
						ORDER BY y.Price DESC) AS PriceRank,
				y.Code
		FROM 
		(
			SELECT	DISTINCT (CASE WHEN @interval = 'Day'
								THEN CONVERT(VARCHAR(10), D.DateFull, 101)
								WHEN @interval = 'Month'
								THEN (DATENAME(MM, D.DateFull) + ', ' + CAST(YEAR(D.DateFull) AS VARCHAR(20))) 
								ElSE CAST(YEAR(D.DateFull) AS VARCHAR(20))  
								End) AS Period 
			FROM ReportingDates D LEFT OUTER JOIN OrderFormEx FEX ON D.DateFull = FEX.Created
		WHERE 
			-- convert back from UTC using offset to generate a list of WEBSERVER datetimes
			D.DateFull BETWEEN 
				cast(floor(cast(dbo.fn_GetDaylightSavingsTime(@startdate, @offset_st, @offset_dt) as float)) as datetime) AND
				cast(floor(cast(dbo.fn_GetDaylightSavingsTime(@enddate, @offset_st, @offset_dt) as float)) as datetime)
		) AS x

		LEFT JOIN

		(
			SELECT  DISTINCT (CASE WHEN @interval = 'Day'
								THEN CONVERT(VARCHAR(20), dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt), 101)
								WHEN @interval = 'Month'
								THEN (DATENAME(MM, dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt)) + ', ' + CAST(YEAR(dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt)) AS VARCHAR(20)) )
								ElSE CAST(YEAR(dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt)) AS VARCHAR(20))   End) as Period, 
					
				 E.Name AS ProductName,
					L.ListPrice AS Price,
					SUM(L.Quantity) AS ItemsOrdered,
					RANK() OVER (PARTITION BY (CASE WHEN @interval = 'Day'
													THEN CONVERT(VARCHAR(20), dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt), 101)
													WHEN @interval = 'Month'
													THEN (DATENAME(MM, dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt)) + ', ' + CAST(YEAR(dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt)) AS VARCHAR(20)) )
													ElSE CAST(YEAR(dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt)) AS VARCHAR(20))   
												END) 
								ORDER BY SUM(L.Quantity) DESC) AS PeriodRank,
					E.Code
			FROM 
				LineItem AS L INNER JOIN OrderFormEx AS FEX ON L.OrderFormId = FEX.ObjectId 
				INNER JOIN OrderForm AS F ON L.OrderFormId = F.OrderFormId
				INNER JOIN CatalogEntry E ON L.CatalogEntryId = E.Code
				INNER JOIN OrderGroup AS OG ON F.OrderGroupId = OG.OrderGroupId AND isnull (OG.Status, '') = 'Completed'
			WHERE CONVERT(VARCHAR(20), dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt), 101) >=  @startdate AND CONVERT(VARCHAR(20), dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt), 101) < @enddate +1 
				AND (FEX.RMANumber = '' OR FEX.RMANumber IS NULL)
				AND OG.Name <> 'Exchange'
				AND OG.BillingCurrency = @CurrencyCode 
				AND (LEN(@MarketId) = 0 OR OG.MarketId = @MarketId)
			GROUP BY (Case WHEN @interval = 'Day'
						THEN CONVERT(VARCHAR(20), dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt), 101)
						WHEN @interval = 'Month'
						THEN (DATENAME(MM, dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt)) + ', ' + CAST(YEAR(dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt)) AS VARCHAR(20))  )
						ElSE CAST(YEAR(dbo.fn_GetDaylightSavingsTime(FEX.Created, @offset_st, @offset_dt)) AS VARCHAR(20))   
					END) ,E.Name, L.ListPrice, E.Code
				
		
					
		) AS y

ON x.Period = y.Period
WHERE y.PeriodRank IS NULL 
OR y.PeriodRank = 1



	)AS z

WHERE z.PriceRank = 1
ORDER BY CONVERT(datetime, z.Period, 101)
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_UpdateMetaDictionary]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_UpdateMetaDictionary]
	@MetaDictionaryId	INT,
	@Language	NVARCHAR(20)=NULL,
	@DefaultValue	NVARCHAR(2048),
	@DefaultTag	IMAGE=NULL,
	@Value		NVARCHAR(2048),
	@Tag		IMAGE=NULL
AS
	SET NOCOUNT ON

BEGIN TRAN
	DECLARE @MultiLanguageValue BIT

	SELECT @MultiLanguageValue = MultiLanguageValue FROM MetaField MF
	INNER JOIN MetaDictionary MD ON MD.MetaFieldId = MF.MetaFieldId
	WHERE MD.MetaDictionaryId = @MetaDictionaryId

	IF NOT EXISTS(SELECT * FROM MetaDictionary WHERE MetaDictionaryId = @MetaDictionaryId )
	BEGIN
		RAISERROR('Wrong @MetaDictionaryId.',16,1)
		GOTO ERR
	END

	IF @MultiLanguageValue = 1
	BEGIN
		UPDATE MetaDictionary SET [Value] = @DefaultValue, [Tag] = @DefaultTag   WHERE MetaDictionaryId = @MetaDictionaryId
		IF @@ERROR <> 0 GOTO ERR

		IF @Language IS NOT NULL
		BEGIN
			IF EXISTS(SELECT * FROM MetaDictionaryLocalization WHERE MetaDictionaryId = @MetaDictionaryId AND Language = @Language)
				UPDATE MetaDictionaryLocalization SET Value = @Value, Tag = @Tag WHERE MetaDictionaryId = @MetaDictionaryId AND Language = @Language
			ELSE
				INSERT INTO MetaDictionaryLocalization (MetaDictionaryId, Language,  Value, Tag) VALUES (@MetaDictionaryId, @Language, @Value, @Tag)
			IF @@ERROR <> 0 GOTO ERR
		END
	END
	ELSE
	BEGIN
		UPDATE MetaDictionary SET [Value] = @Value, [Tag] = @Tag   WHERE MetaDictionaryId = @MetaDictionaryId
		IF @@ERROR <> 0 GOTO ERR
	END

	COMMIT TRAN
RETURN

ERR:
	ROLLBACK TRAN
RETURN
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaFieldTypeSelect]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaFieldTypeSelect]
@MetaFieldTypeId AS Int
AS
BEGIN
SET NOCOUNT ON;

SELECT [t01].[MetaFieldTypeId] AS [MetaFieldTypeId], [t01].[Name] AS [Name], [t01].[FriendlyName] AS [FriendlyName], [t01].[McDataType] AS [McDataType], [t01].[XSViews] AS [XSViews], [t01].[XSAttributes] AS [XSAttributes], [t01].[Owner] AS [Owner], [t01].[AccessLevel] AS [AccessLevel]
FROM [mcmd_MetaFieldType] AS [t01]
WHERE ([t01].[MetaFieldTypeId]=@MetaFieldTypeId)

END
GO
PRINT N'Creating [dbo].[ecf_ShippingMethod_Language]...';


GO
CREATE PROCEDURE [dbo].[ecf_ShippingMethod_Language]
	@LanguageId nvarchar(10) = null,
	@ReturnInactive bit = 0
AS
BEGIN
	declare @_shippingMethodIds as table (ShippingMethodId uniqueidentifier)
	insert into @_shippingMethodIds
	select ShippingMethodId 
		from ShippingMethod 
		where COALESCE(@LanguageId, LanguageId) = LanguageId 
		and (([IsActive] = 1) or @ReturnInactive = 1) 

	select * from [ShippingOption]
	select SOP.* from [ShippingOptionParameter] SOP 
	inner join [ShippingOption] SO on SOP.[ShippingOptionId]=SO.[ShippingOptionId]
	select distinct SM.* from [ShippingMethod] SM 
	inner join [Warehouse] W on SM.Name <> 'In Store Pickup' or W.IsPickupLocation = 1
		where COALESCE(@LanguageId, LanguageId) = LanguageId and ((SM.[IsActive] = 1) or @ReturnInactive = 1)
		order by SM.Ordering
	select * from [ShippingMethodParameter] where ShippingMethodId in (select ShippingMethodId from @_shippingMethodIds)
	select * from [ShippingMethodCase] where ShippingMethodId in (select ShippingMethodId from @_shippingMethodIds)
	select * from [ShippingCountry] where ShippingMethodId in (select ShippingMethodId from @_shippingMethodIds)
	select * from [ShippingRegion] where ShippingMethodId in (select ShippingMethodId from @_shippingMethodIds)
	select * from [ShippingPaymentRestriction] 
		where 
			(ShippingMethodId in (select ShippingMethodId from @_shippingMethodIds) )
				and
			[RestrictShippingMethods] = 0
	select * from [Package]
	select SP.* from [ShippingPackage] SP 
	inner join [Package] P on SP.[PackageId]=P.[PackageId]
	select * from [MarketShippingMethods] where ShippingMethodId in (select ShippingMethodId from @_shippingMethodIds)
END
GO
PRINT N'Creating [dbo].[aspnet_Profile_DeleteInactiveProfiles]...';


GO

CREATE PROCEDURE dbo.aspnet_Profile_DeleteInactiveProfiles
    @ApplicationName        nvarchar(256),
    @ProfileAuthOptions     int,
    @InactiveSinceDate      datetime
AS
BEGIN
    DECLARE @ApplicationId uniqueidentifier
    SELECT  @ApplicationId = NULL
    SELECT  @ApplicationId = ApplicationId FROM aspnet_Applications WHERE LOWER(@ApplicationName) = LoweredApplicationName
    IF (@ApplicationId IS NULL)
    BEGIN
        SELECT  0
        RETURN
    END

    DELETE
    FROM    dbo.aspnet_Profile
    WHERE   UserId IN
            (   SELECT  UserId
                FROM    dbo.aspnet_Users u
                WHERE   ApplicationId = @ApplicationId
                        AND (LastActivityDate <= @InactiveSinceDate)
                        AND (
                                (@ProfileAuthOptions = 2)
                             OR (@ProfileAuthOptions = 0 AND IsAnonymous = 1)
                             OR (@ProfileAuthOptions = 1 AND IsAnonymous = 0)
                            )
            )

    SELECT  @@ROWCOUNT
END
GO
PRINT N'Creating [dbo].[ecf_reporting_SaleReport]...';


GO
CREATE PROCEDURE [dbo].[ecf_reporting_SaleReport] 
	@MarketId nvarchar(8),
	@CurrencyCode NVARCHAR(8),
	@interval VARCHAR(20),
	@startdate DATETIME, -- parameter expected in UTC
	@enddate DATETIME, -- parameter expected in UTC
	@offset_st INT,
	@offset_dt INT
AS

BEGIN

	with periodQuery as
	(
		SELECT DISTINCT	
			(CASE WHEN @interval = 'Day'
				THEN CONVERT(VARCHAR(10), D.DateFull, 101)
			WHEN @interval = 'Month'
			THEN (DATENAME(MM, D.DateFull) + ',' + CAST(YEAR(D.DateFull) AS VARCHAR(20))) 
			ElSE CAST(YEAR(D.DateFull) AS VARCHAR(20))  
			End) AS Period 
		FROM ReportingDates D
		WHERE
			-- convert back from UTC using offset to generate a list of WEBSERVER datetimes
			D.DateFull BETWEEN 
				cast(floor(cast(dbo.fn_GetDaylightSavingsTime(@startdate, @offset_st, @offset_dt) as float)) as datetime) AND
				cast(floor(cast(dbo.fn_GetDaylightSavingsTime(@enddate, @offset_st, @offset_dt) as float)) as datetime)
	)
	, lineItemsQuery as
	(
		select sum(Quantity) ItemsOrdered, L.OrderGroupId
		from LineItem L 
				inner join OrderForm as OF1 on L.OrderFormId = OF1.OrderFormId
				where OF1.Name <> 'Return'
				group by L.OrderGroupId
	)
	, orderFormQuery as
	(
		select sum(DiscountAmount) Discounts, OrderGroupId
		from OrderForm 
				group by OrderGroupId
	)
	, paymentQuery as
	(
		select sum(Amount) TotalPayment, OFP.OrderGroupId
		from OrderFormPayment as OFP
				where OFP.TransactionType = 'Capture' OR OFP.TransactionType = 'Sale'
				group by OFP.OrderGroupId
	)
	, orderQuery as 
	(
		SELECT
			(CASE WHEN @interval = 'Day'
				THEN CONVERT(VARCHAR(10), dbo.fn_GetDaylightSavingsTime(PO.Created, @offset_st, @offset_dt), 101)
				WHEN @interval = 'Month'
				THEN (DATENAME(MM, dbo.fn_GetDaylightSavingsTime(PO.Created, @offset_st, @offset_dt)) + ','
					+ CAST(YEAR(dbo.fn_GetDaylightSavingsTime(PO.Created, @offset_st, @offset_dt)) AS VARCHAR(20))) 
				ElSE CAST(YEAR(dbo.fn_GetDaylightSavingsTime(PO.Created, @offset_st, @offset_dt)) AS VARCHAR(20))  
				End) AS Period, 
			COALESCE(COUNT(OG.OrderGroupId), 0) AS NumberofOrders
			, SUM(L1.ItemsOrdered) AS ItemsOrdered
			, SUM(OG.SubTotal) AS SubTotal
			, SUM(OG.TaxTotal) AS Tax
			, SUM(OG.ShippingTotal) AS Shipping 
			, SUM(OF1.Discounts) AS Discounts
			, SUM(OG.Total) AS Total
			, SUM(P.TotalPayment) AS Invoiced
		FROM OrderGroup AS OG 
			INNER JOIN OrderGroup_PurchaseOrder AS PO 
				ON PO.ObjectId = OG.OrderGroupId
			INNER JOIN orderFormQuery OF1 
				on OF1.OrderGroupId = OG.OrderGroupId
			LEFT JOIN paymentQuery AS P 
				ON P.OrderGroupId = OG.OrderGroupId 
			LEFT JOIN lineItemsQuery L1 
				on L1.OrderGroupId = OG.OrderGroupId
        WHERE 
			-- PO.Created is stored in UTC
            PO.Created
			BETWEEN
				-- pad range by one day to include outlying records on narrow date ranges
				DATEADD(DD, -1, @startdate) AND 
				DATEADD(DD, 1, @enddate)
			AND OG.Name <> 'Exchange' AND
				OG.[Status] <> 'Cancelled' AND
				OG.BillingCurrency = @CurrencyCode AND
				(LEN(@MarketId) = 0 OR OG.MarketId = @MarketId)
		GROUP BY
			(CASE WHEN @interval = 'Day'
				THEN CONVERT(VARCHAR(10), dbo.fn_GetDaylightSavingsTime(PO.Created, @offset_st, @offset_dt), 101)
				WHEN @interval = 'Month'
				THEN (DATENAME(MM, dbo.fn_GetDaylightSavingsTime(PO.Created, @offset_st, @offset_dt)) + ','
					+ CAST(YEAR(dbo.fn_GetDaylightSavingsTime(PO.Created, @offset_st, @offset_dt)) AS VARCHAR(20))) 
				ElSE CAST(YEAR(dbo.fn_GetDaylightSavingsTime(PO.Created, @offset_st, @offset_dt)) AS VARCHAR(20))  
							End)
	)
	
	SELECT	
		P.Period
		, O.NumberofOrders as NumberofOrders
		, O.ItemsOrdered
		, O.SubTotal
		, O.Tax
		, O.Shipping
		, O.Discounts
		, O.Total
		, O.Invoiced
	FROM periodQuery P LEFT JOIN orderQuery O 
		on P.Period = O.Period
	ORDER BY CONVERT(datetime, P.Period, 101) 

END
GO
PRINT N'Creating [dbo].[mdpsp_sys_UpdateMetaClass]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_UpdateMetaClass]
	@MetaClassId 	INT,
	@Namespace		NVARCHAR(1024),
	@Name			NVARCHAR(256),
	@FriendlyName	NVARCHAR(256),
	@Description	NVARCHAR(MAX),
	@Tag			IMAGE
AS
	UPDATE MetaClass SET Namespace = @Namespace, Name = @Name, FriendlyName = @FriendlyName, Description = @Description, Tag = @Tag WHERE MetaClassId = @MetaClassId
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaFieldTypeDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaFieldTypeDelete]
@MetaFieldTypeId AS Int
AS
BEGIN
SET NOCOUNT ON;

DELETE FROM [mcmd_MetaFieldType]
WHERE
[MetaFieldTypeId] = @MetaFieldTypeId

END
GO
PRINT N'Creating [dbo].[ecf_ShipmentDiscount_Update]...';


GO
CREATE PROCEDURE [dbo].[ecf_ShipmentDiscount_Update]
(
	@ShipmentDiscountId int,
	@ShipmentId int,
	@DiscountId int,
	@OrderGroupId int,
	@DiscountAmount DECIMAL (38, 9),
	@DiscountCode nvarchar(50) = NULL,
	@DiscountName nvarchar(50) = NULL,
	@DisplayMessage nvarchar(100) = NULL,
	@DiscountValue DECIMAL (38, 9)
)
AS
	SET NOCOUNT ON
	
	UPDATE [ShipmentDiscount]
	SET
		[ShipmentId] = @ShipmentId,
		[DiscountId] = @DiscountId,
		[OrderGroupId] = @OrderGroupId,
		[DiscountAmount] = @DiscountAmount,
		[DiscountCode] = @DiscountCode,
		[DiscountName] = @DiscountName,
		[DisplayMessage] = @DisplayMessage,
		[DiscountValue] = @DiscountValue
	WHERE 
		[ShipmentDiscountId] = @ShipmentDiscountId

	RETURN @@Error
GO
PRINT N'Creating [dbo].[ecf_CatalogEntry_CatalogNodeId]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntry_CatalogNodeId]
	@CatalogId int,
    @CatalogNodeId int,
	@ReturnInactive bit = 0,
	@ResponseGroup INT = NULL
AS
BEGIN
	DECLARE @CatalogEntryIds udttContentList
	INSERT INTO @CatalogEntryIds
	SELECT N.CatalogEntryId from [CatalogEntry] N
	INNER JOIN NodeEntryRelation R ON R.CatalogEntryId = N.CatalogEntryId
	WHERE
		R.CatalogNodeId = @CatalogNodeId AND
		R.CatalogId = @CatalogId AND
		((N.IsActive = 1) or @ReturnInactive = 1)
	ORDER BY R.SortOrder

	SELECT N.* from [CatalogEntry] N
	INNER JOIN @CatalogEntryIds C on N.CatalogEntryId = C.ContentId

	SELECT S.* from CatalogItemSeo S
	INNER JOIN @CatalogEntryIds C on S.CatalogEntryId = C.ContentId
	
	exec ecf_CatalogEntry_Components @CatalogEntryIds, @ResponseGroup
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_ReplaceUser]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_ReplaceUser]
	@OldUserId AS nvarchar(100),
	@NewUserId AS nvarchar(100)
AS
BEGIN
    SET NOCOUNT ON
    BEGIN TRAN
	DECLARE classall_cursor CURSOR FOR
		SELECT MetaClassId, TableName FROM MetaClass WHERE IsSystem =0 AND IsAbstract = 0

	DECLARE @MetaClassId	INT
	DECLARE @TableName		NVARCHAR(255)

	OPEN classall_cursor
	FETCH NEXT FROM classall_cursor INTO @MetaClassId, @TableName

	DECLARE @SQLString NVARCHAR(500)

	WHILE @@FETCH_STATUS = 0
	BEGIN
		SET @SQLString  = N'UPDATE ' + @TableName  + ' SET CreatorId = @NewUserId WHERE CreatorId = @OldUserId'
		EXEC sp_executesql @SQLString, N'@OldUserId AS nvarchar(100), @NewUserId AS nvarchar(100)', @OldUserId = @OldUserId, @NewUserId = @NewUserId
		IF @@ERROR <> 0 GOTO ERR

		SET @SQLString  = N'UPDATE ' + @TableName  + ' SET ModifierId = @NewUserId WHERE ModifierId = @OldUserId'
		EXEC sp_executesql @SQLString, N'@OldUserId AS nvarchar(100), @NewUserId AS nvarchar(100)', @OldUserId = @OldUserId, @NewUserId = @NewUserId
		IF @@ERROR <> 0 GOTO ERR

	    FETCH NEXT FROM classall_cursor INTO @MetaClassId, @TableName
	END

	CLOSE classall_cursor
	DEALLOCATE classall_cursor

	COMMIT TRAN
    RETURN

ERR:
	CLOSE classall_cursor
	DEALLOCATE classall_cursor

	ROLLBACK TRAN
    RETURN
END
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaFieldTypeUpdate]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaFieldTypeUpdate]
@Name AS NVarChar(4000),
@FriendlyName AS NVarChar(4000),
@McDataType AS Int,
@XSViews AS NText,
@XSAttributes AS NText,
@Owner AS NVarChar(4000),
@AccessLevel AS Int,
@MetaFieldTypeId AS Int
AS
BEGIN
SET NOCOUNT ON;

UPDATE [mcmd_MetaFieldType] SET
[Name] = @Name,
[FriendlyName] = @FriendlyName,
[McDataType] = @McDataType,
[XSViews] = @XSViews,
[XSAttributes] = @XSAttributes,
[Owner] = @Owner,
[AccessLevel] = @AccessLevel WHERE
[MetaFieldTypeId] = @MetaFieldTypeId

END
GO
PRINT N'Creating [dbo].[ecf_ShipmentDiscount_Insert]...';


GO
CREATE PROCEDURE [dbo].[ecf_ShipmentDiscount_Insert]
(
	@ShipmentDiscountId int = NULL OUTPUT,
	@ShipmentId int,
	@DiscountId int,
	@OrderGroupId int,
	@DiscountAmount DECIMAL (38, 9),
	@DiscountCode nvarchar(50) = NULL,
	@DiscountName nvarchar(50) = NULL,
	@DisplayMessage nvarchar(100) = NULL,
	@DiscountValue DECIMAL (38, 9)
)
AS
	SET NOCOUNT ON

	INSERT INTO [ShipmentDiscount]
	(
		[ShipmentId],
		[DiscountId],
		[OrderGroupId],
		[DiscountAmount],
		[DiscountCode],
		[DiscountName],
		[DisplayMessage],
		[DiscountValue]
	)
	VALUES
	(
		@ShipmentId,
		@DiscountId,
		@OrderGroupId,
		@DiscountAmount,
		@DiscountCode,
		@DiscountName,
		@DisplayMessage,
		@DiscountValue
	)

	SELECT @ShipmentDiscountId = SCOPE_IDENTITY()

	RETURN @@Error
GO
PRINT N'Creating [dbo].[ecf_CatalogEntry_CatalogNameCatalogNodeId]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntry_CatalogNameCatalogNodeId]
	@CatalogName nvarchar(150),
	@CatalogNodeId int,
	@ReturnInactive bit = 0,
	@ResponseGroup INT = NULL
AS
BEGIN
	DECLARE @CatalogEntryIds udttContentList
	INSERT INTO @CatalogEntryIds
	SELECT N.CatalogEntryId from [CatalogEntry] N
	INNER JOIN NodeEntryRelation R ON R.CatalogEntryId = N.CatalogEntryId
	INNER JOIN [Catalog] C ON R.CatalogId = C.CatalogId
	WHERE
		R.CatalogNodeId = @CatalogNodeId AND
		C.[Name] = @CatalogName AND
		((N.IsActive = 1) or @ReturnInactive = 1)
	ORDER BY R.SortOrder

	SELECT N.* from [CatalogEntry] N
	INNER JOIN @CatalogEntryIds C ON C.ContentId = N.CatalogEntryId

	SELECT S.* from CatalogItemSeo S
	INNER JOIN @CatalogEntryIds C ON C.ContentId = S.CatalogEntryId

	exec ecf_CatalogEntry_Components @CatalogEntryIds, @ResponseGroup
END
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaFieldTypeInsert]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaFieldTypeInsert]
@Name AS NVarChar(4000),
@FriendlyName AS NVarChar(4000),
@McDataType AS Int,
@XSViews AS NText,
@XSAttributes AS NText,
@Owner AS NVarChar(4000),
@AccessLevel AS Int,
@MetaFieldTypeId AS Int = NULL OUTPUT
AS
BEGIN
SET NOCOUNT ON;

INSERT INTO [mcmd_MetaFieldType]
(
[Name],
[FriendlyName],
[McDataType],
[XSViews],
[XSAttributes],
[Owner],
[AccessLevel])
VALUES(
@Name,
@FriendlyName,
@McDataType,
@XSViews,
@XSAttributes,
@Owner,
@AccessLevel)
SELECT @MetaFieldTypeId = SCOPE_IDENTITY();

END
GO
PRINT N'Creating [dbo].[ecf_ShipmentDiscount_Delete]...';


GO
CREATE PROCEDURE [dbo].[ecf_ShipmentDiscount_Delete]
(
	@ShipmentDiscountId int
)
AS
	SET NOCOUNT ON

	DELETE 
	FROM   [ShipmentDiscount]
	WHERE  
		[ShipmentDiscountId] = @ShipmentDiscountId

	RETURN @@Error
GO
PRINT N'Creating [dbo].[aspnet_Profile_GetProperties]...';


GO

CREATE PROCEDURE dbo.aspnet_Profile_GetProperties
    @ApplicationName      nvarchar(256),
    @UserName             nvarchar(256),
    @CurrentTimeUtc       datetime
AS
BEGIN
    DECLARE @ApplicationId uniqueidentifier
    SELECT  @ApplicationId = NULL
    SELECT  @ApplicationId = ApplicationId FROM dbo.aspnet_Applications WHERE LOWER(@ApplicationName) = LoweredApplicationName
    IF (@ApplicationId IS NULL)
        RETURN

    DECLARE @UserId uniqueidentifier
    SELECT  @UserId = NULL

    SELECT @UserId = UserId
    FROM   dbo.aspnet_Users
    WHERE  ApplicationId = @ApplicationId AND LoweredUserName = LOWER(@UserName)

    IF (@UserId IS NULL)
        RETURN
    SELECT TOP 1 PropertyNames, PropertyValuesString, PropertyValuesBinary
    FROM         dbo.aspnet_Profile
    WHERE        UserId = @UserId

    IF (@@ROWCOUNT > 0)
    BEGIN
        UPDATE dbo.aspnet_Users
        SET    LastActivityDate=@CurrentTimeUtc
        WHERE  UserId = @UserId
    END
END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntry_CatalogNameCatalogNodeCode]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntry_CatalogNameCatalogNodeCode]
	@CatalogName nvarchar(150),
	@CatalogNodeCode nvarchar(100),
	@ReturnInactive bit = 0,
	@ResponseGroup INT = NULL
AS
BEGIN
	DECLARE @CatalogEntryIds udttContentList
	INSERT INTO @CatalogEntryIds
	SELECT N.CatalogEntryId from [CatalogEntry] N
	INNER JOIN NodeEntryRelation R ON R.CatalogEntryId = N.CatalogEntryId
	INNER JOIN CatalogNode CN ON R.CatalogNodeId = CN.CatalogNodeId
	INNER JOIN [Catalog] C ON R.CatalogId = C.CatalogId
	WHERE
		CN.Code = @CatalogNodeCode AND
		C.[Name] = @CatalogName AND
		((N.IsActive = 1) or @ReturnInactive = 1)
	ORDER BY R.SortOrder

	SELECT N.* from [CatalogEntry] N
	INNER JOIN @CatalogEntryIds C ON C.ContentId = N.CatalogEntryId

	SELECT S.* from CatalogItemSeo S
	INNER JOIN @CatalogEntryIds C ON C.ContentId = S.CatalogEntryId

	exec ecf_CatalogEntry_Components @CatalogEntryIds, @ResponseGroup
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_RefreshSystemMetaClassInfo]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_RefreshSystemMetaClassInfo]
	@MetaClassId	INT
AS
	SET NOCOUNT ON
BEGIN
    BEGIN TRAN
	DECLARE @TableName NVARCHAR(256)
	DECLARE @Namespace NVARCHAR(1024)
	DECLARE @Name NVARCHAR(256)

	IF NOT EXISTS( SELECT * FROM MetaClass WHERE MetaClassId = @MetaClassId AND IsSystem = 1)
	BEGIN
		RAISERROR ('Wrong @MetaClassId. The class is neither system nor existed.', 16,1)
		GOTO ERR
	END

	SELECT @Name = [Name], @TableName = TableName, @Namespace = Namespace FROM MetaClass WHERE MetaClassId = @MetaClassId AND IsSystem = 1

	-- Step 1. Remove old fields
	DELETE FROM MetaClassMetaFieldRelation WHERE MetaClassId = @MetaClassId
	IF @@ERROR<> 0 GOTO ERR

	DELETE FROM MetaClassMetaFieldRelation WHERE MetaFieldId IN (SELECT MetaFieldId FROM MetaField WHERE SystemMetaClassId = @MetaClassId)
	IF @@ERROR<> 0 GOTO ERR

	DELETE FROM MetaField WHERE SystemMetaClassId = @MetaClassId
	IF @@ERROR<> 0 GOTO ERR

	-- Step 2. Create new fields
	INSERT INTO [MetaField]  ([Namespace], [Name], [FriendlyName], [SystemMetaClassId], [DataTypeId], [Length], [AllowNulls], [MultiLanguageValue], [AllowSearch], [IsEncrypted])
	SELECT @Namespace + N'.' + @Name, SC.[name], SC.[name], @MetaClassId, MDT.[DataTypeId], SC.[length], SC.[isnullable], 0, 0, 0
    FROM syscolumns AS SC
	INNER JOIN sysobjects SO ON SO.[id] = SC.id
	INNER JOIN systypes ST ON ST.[xtype] = SC .[xtype]
	INNER JOIN MetaDataType MDT ON MDT.[Name] = ST .[name]
    WHERE SO.[id]  = object_id( @TableName) and OBJECTPROPERTY( SO.[id], N'IsTable') = 1 and ST.name<>'sysname'
	ORDER BY colorder /* Aug 29, 2006 */

	IF @@ERROR<> 0 GOTO ERR

	INSERT INTO [MetaClassMetaFieldRelation] (MetaClassId, MetaFieldId)
	SELECT @MetaClassId, MetaFieldId FROM MetaField WHERE [SystemMetaClassId] = @MetaClassId

	IF @@ERROR<> 0 GOTO ERR

	-- Step 3. Update child-field relations
	INSERT INTO [MetaClassMetaFieldRelation]  (MetaClassId, MetaFieldId)
	SELECT MC.MetaClassId, MF.MetaFieldId FROM MetaField MF, MetaClass MC
	WHERE MF.[SystemMetaClassId] = @MetaClassId AND MC.ParentClassId = @MetaClassId ORDER BY MC.MetaClassId

	IF @@ERROR<> 0 GOTO ERR

	COMMIT TRAN
	--PRINT('COMMIT TRAN')
    RETURN

ERR:
	ROLLBACK TRAN
	--PRINT('ROLLBACK TRAN')
    RETURN
END
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaClassDataSourceSelect]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaClassDataSourceSelect]
@MetaClassDataSourceId AS Int
AS
BEGIN
SET NOCOUNT ON;

SELECT [t01].[MetaClassDataSourceId] AS [MetaClassDataSourceId], [t01].[MetaClassId] AS [MetaClassId], [t01].[PrimaryTable] AS [PrimaryTable], [t01].[XSExtendedTables] AS [XSExtendedTables], [t01].[XSConditions] AS [XSConditions]
FROM [mcmd_MetaClassDataSource] AS [t01]
WHERE ([t01].[MetaClassDataSourceId]=@MetaClassDataSourceId)

END
GO
PRINT N'Creating [dbo].[ecf_Shipment_Update]...';


GO
CREATE PROCEDURE [dbo].[ecf_Shipment_Update]
(
	@ShipmentId int,
	@OrderFormId int,
	@OrderGroupId int,
	@ShippingMethodId uniqueidentifier,
	@ShippingAddressId nvarchar(64) = NULL,
	@ShipmentTrackingNumber nvarchar(128) = NULL,
	@ShipmentTotal DECIMAL (38, 9),
	@ShippingDiscountAmount DECIMAL (38, 9),
	@ShippingMethodName nvarchar(128) = NULL,
	@Epi_ShippingCost DECIMAL (38, 9),
	@Epi_ShippingTax DECIMAL (38, 9),
	@Status nvarchar(64) = NULL,
	@LineItemIds nvarchar(max) = NULL,
	@WarehouseCode nvarchar(50) = NULL,
	@PickListId int = NULL,
	@SubTotal DECIMAL (38, 9),
	@OperationKeys nvarchar(max) = NULL
)
AS
	SET NOCOUNT ON
	
	UPDATE [Shipment]
	SET
		[OrderFormId] = @OrderFormId,
		[OrderGroupId] = @OrderGroupId,
		[ShippingMethodId] = @ShippingMethodId,
		[ShippingAddressId] = @ShippingAddressId,
		[ShipmentTrackingNumber] = @ShipmentTrackingNumber,
		[ShipmentTotal] = @ShipmentTotal,
		[ShippingDiscountAmount] = @ShippingDiscountAmount,
		[ShippingMethodName] = @ShippingMethodName,
		[Epi_ShippingCost] = @Epi_ShippingCost,
		[Epi_ShippingTax] = @Epi_ShippingTax,
		[Status] = @Status,
		[LineItemIds] = @LineItemIds,
		[WarehouseCode] = @WarehouseCode,
		[PickListId] = @PickListId,
		[SubTotal] = @SubTotal,
		[OperationKeys] = @OperationKeys
	WHERE 
		[ShipmentId] = @ShipmentId

	RETURN @@Error
GO
PRINT N'Creating [dbo].[ecf_CatalogEntry_CatalogName]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntry_CatalogName]
	@CatalogName nvarchar(150),
	@ReturnInactive bit = 0,
	@ResponseGroup INT = NULL
AS
BEGIN
	DECLARE @CatalogEntryIds udttContentList
	INSERT INTO @CatalogEntryIds
	SELECT N.CatalogEntryId from [CatalogEntry] N
	INNER JOIN [Catalog] C ON N.CatalogId = C.CatalogId
	WHERE
		C.[Name] = @CatalogName AND
		((N.IsActive = 1) or @ReturnInactive = 1)

	SELECT N.* from [CatalogEntry] N
	INNER JOIN @CatalogEntryIds C ON C.ContentId = N.CatalogEntryId

	SELECT S.* from CatalogItemSeo S
	INNER JOIN @CatalogEntryIds C ON C.ContentId = S.CatalogEntryId

	exec ecf_CatalogEntry_Components @CatalogEntryIds, @ResponseGroup
END
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaClassDataSourceDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaClassDataSourceDelete]
@MetaClassDataSourceId AS Int
AS
BEGIN
SET NOCOUNT ON;

DELETE FROM [mcmd_MetaClassDataSource]
WHERE
[MetaClassDataSourceId] = @MetaClassDataSourceId

END
GO
PRINT N'Creating [dbo].[ecf_Shipment_Insert]...';


GO
CREATE PROCEDURE [dbo].[ecf_Shipment_Insert]
(
	@ShipmentId int = NULL OUTPUT,
	@OrderFormId int,
	@OrderGroupId int,
	@ShippingMethodId uniqueidentifier,
	@ShippingAddressId nvarchar(64) = NULL,
	@ShipmentTrackingNumber nvarchar(128) = NULL,
	@ShipmentTotal DECIMAL (38, 9),
	@ShippingDiscountAmount DECIMAL (38, 9),
	@ShippingMethodName nvarchar(128) = NULL,
	@Epi_ShippingCost DECIMAL (38, 9),
	@Epi_ShippingTax DECIMAL (38, 9),
	@Status nvarchar(64) = NULL,
	@LineItemIds nvarchar(max) = NULL,
	@WarehouseCode nvarchar(50) = NULL,
	@PickListId int = NULL,
	@SubTotal DECIMAL (38, 9),
	@OperationKeys nvarchar(max) = NULL
)
AS
	SET NOCOUNT ON

	INSERT INTO [Shipment]
	(
		[OrderFormId],
		[OrderGroupId],
		[ShippingMethodId],
		[ShippingAddressId],
		[ShipmentTrackingNumber],
		[ShipmentTotal],
		[ShippingDiscountAmount],
		[ShippingMethodName],
		[Epi_ShippingCost],
		[Epi_ShippingTax],
		[Status],
		[LineItemIds],
		[WarehouseCode],
		[PickListId],
		[SubTotal],
		[OperationKeys]
	)
	VALUES
	(
		@OrderFormId,
		@OrderGroupId,
		@ShippingMethodId,
		@ShippingAddressId,
		@ShipmentTrackingNumber,
		@ShipmentTotal,
		@ShippingDiscountAmount,
		@ShippingMethodName,
		@Epi_ShippingCost,
		@Epi_ShippingTax,
		@Status,
		@LineItemIds,
		@WarehouseCode,
		@PickListId,
		@SubTotal,
		@OperationKeys
	)

	SELECT @ShipmentId = SCOPE_IDENTITY()

	RETURN @@Error
GO
PRINT N'Creating [dbo].[ecf_CatalogEntry_CatalogId]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntry_CatalogId]
    @CatalogId int,
	@ReturnInactive bit = 0,
	@ResponseGroup INT = NULL
AS
BEGIN
	DECLARE @CatalogEntryIds udttContentList
	INSERT INTO @CatalogEntryIds
	SELECT N.CatalogEntryId from [CatalogEntry] N
	WHERE
		N.CatalogId = @CatalogId AND
		NOT EXISTS(SELECT * FROM NodeEntryRelation R WHERE R.CatalogId = @CatalogId and N.CatalogEntryId = R.CatalogEntryId) AND
		((N.IsActive = 1) or @ReturnInactive = 1)

	SELECT N.* from [CatalogEntry] N
	INNER JOIN @CatalogEntryIds C ON C.ContentId = N.CatalogEntryId

	SELECT S.* from CatalogItemSeo S
	INNER JOIN @CatalogEntryIds C ON C.ContentId = S.CatalogEntryId

	exec ecf_CatalogEntry_Components @CatalogEntryIds, @ResponseGroup
END
GO
PRINT N'Creating [dbo].[mc_Security_SsoTicketCheck]...';


GO
CREATE PROCEDURE [dbo].[mc_Security_SsoTicketCheck]
	@SsoTicket nvarchar(64),
	@UserName nvarchar(256),
	@UtcNow datetime = null,
	@PurgeBefore datetime = null
as
begin
	set nocount on
	
	if (@UtcNow is null) set @UtcNow = GETUTCDATE()
	if (@PurgeBefore is null) set @PurgeBefore = DATEADD(day, -2, @UtcNow)

	declare @ApplicationName nvarchar(200)
	declare @Valid bit
	declare @ExpirationUtc datetime
	
	begin try
		begin transaction check_ssoticket_transaction

		select @ApplicationName = [ApplicationName], @Valid = [Valid], @ExpirationUtc = [ExpirationUtc]
		from [Security_SsoTickets]
		with (HOLDLOCK, ROWLOCK)
		where [SsoTicket] = @SsoTicket and [UserName] = @UserName
	  
		update [Security_SsoTickets] set Valid = 0 where [SsoTicket] = @SsoTicket
		
		commit transaction check_ssoticket_transaction
	end try
	begin catch
		rollback transaction check_ssoticket_transaction
	end catch

	begin try	
		delete from [Security_SsoTickets] where [ExpirationUtc] < @PurgeBefore
	end try
	begin catch
	end catch
	
	if @Valid is null set @Valid = 0
	if @Valid = 0 set @ApplicationName = null
	
	select @Valid as Valid, @ApplicationName as ApplicationName
end
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaClassDataSourceUpdate]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaClassDataSourceUpdate]
@MetaClassId AS Int,
@PrimaryTable AS NVarChar(4000),
@XSExtendedTables AS NText,
@XSConditions AS NText,
@MetaClassDataSourceId AS Int
AS
BEGIN
SET NOCOUNT ON;

UPDATE [mcmd_MetaClassDataSource] SET
[MetaClassId] = @MetaClassId,
[PrimaryTable] = @PrimaryTable,
[XSExtendedTables] = @XSExtendedTables,
[XSConditions] = @XSConditions WHERE
[MetaClassDataSourceId] = @MetaClassDataSourceId

END
GO
PRINT N'Creating [dbo].[ecf_Shipment_Delete]...';


GO
CREATE PROCEDURE [dbo].[ecf_Shipment_Delete]
(
	@ShipmentId int
)
AS
	SET NOCOUNT ON

	EXEC [dbo].[mdpsp_avto_ShipmentEx_Delete] @ShipmentId
	DELETE FROM [ShipmentDiscount] where ShipmentId = @ShipmentId
	DELETE FROM [Shipment] WHERE  [ShipmentId] = @ShipmentId	

	RETURN @@Error
GO
PRINT N'Creating [dbo].[mc_Security_SsoTicketCreate]...';


GO
CREATE PROCEDURE [dbo].[mc_Security_SsoTicketCreate]
	@SsoTicket nvarchar(64),
	@UserName nvarchar(256),
	@ApplicationName nvarchar(200) = null,
	@ExpirationUtc datetime
as
begin
	set nocount on

	begin try
		begin transaction create_ssoticket_transaction
	
		update [Security_SsoTickets]
		set Valid = 0
		where UserName = @UserName and Valid = 1
	
		insert into [Security_SsoTickets] ([SsoTicket], [UserName], [ApplicationName], [ExpirationUtc], [Valid])
		values (@SsoTicket, @UserName, @ApplicationName, @ExpirationUtc, 1)
	
		commit transaction create_ssoticket_transaction
	end try
	begin catch
		rollback transaction create_ssoticket_transaction
	end catch
end
GO
PRINT N'Creating [dbo].[mdpsp_sys_MetaFieldAllowSearch]...';


GO
CREATE PROCEDURE dbo.mdpsp_sys_MetaFieldAllowSearch
    @MetaFieldId int,
    @AllowSearch bit
as
begin
    set nocount on

    if not exists (select 1 from MetaField where MetaFieldId = @MetaFieldId)
    begin
        raiserror('The specified meta field does not exists or is a system field.', 16,1)
    end
    else
    begin
        update MetaField
        set AllowSearch = @AllowSearch
        where MetaFieldId = @MetaFieldId
    end
end
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaClassDataSourceInsert]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaClassDataSourceInsert]
@MetaClassId AS Int,
@PrimaryTable AS NVarChar(4000),
@XSExtendedTables AS NText,
@XSConditions AS NText,
@MetaClassDataSourceId AS Int = NULL OUTPUT
AS
BEGIN
SET NOCOUNT ON;

INSERT INTO [mcmd_MetaClassDataSource]
(
[MetaClassId],
[PrimaryTable],
[XSExtendedTables],
[XSConditions])
VALUES(
@MetaClassId,
@PrimaryTable,
@XSExtendedTables,
@XSConditions)
SELECT @MetaClassDataSourceId = SCOPE_IDENTITY();

END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntry_AssociatedByCode]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntry_AssociatedByCode]
	@CatalogEntryCode nvarchar(100),
	@AssociationName nvarchar(150) = '',
	@ReturnInactive bit = 0,
	@ResponseGroup INT = NULL
AS
BEGIN
	DECLARE @CatalogEntryIds udttContentList
	INSERT INTO @CatalogEntryIds
	SELECT N.CatalogEntryId from [CatalogEntry] N
	INNER JOIN CatalogEntryAssociation A ON A.CatalogEntryId = N.CatalogEntryId
	INNER JOIN CatalogAssociation CA ON CA.CatalogAssociationId = A.CatalogAssociationId
	INNER JOIN CatalogEntry NE ON NE.CatalogEntryId = CA.CatalogEntryId
	WHERE
		NE.Code = @CatalogEntryCode AND COALESCE(@AssociationName, CA.AssociationName) = CA.AssociationName AND 
		((N.IsActive = 1) or @ReturnInactive = 1)
	ORDER BY CA.SortOrder, A.SortOrder

	if(@AssociationName = '')
		set @AssociationName = null
	
	SELECT N.* from [CatalogEntry] N
	INNER JOIN @CatalogEntryIds C ON C.ContentId = N.CatalogEntryId

	SELECT S.* from CatalogItemSeo S
	INNER JOIN @CatalogEntryIds C ON C.ContentId = S.CatalogEntryId

	exec ecf_CatalogEntry_Components @CatalogEntryIds, @ResponseGroup
END
GO
PRINT N'Creating [dbo].[mc_Security_RoleAssignmentSelect]...';


GO
CREATE PROCEDURE [dbo].[mc_Security_RoleAssignmentSelect]
@SecurityRoleAssignmentId AS UniqueIdentifier
AS
BEGIN
SET NOCOUNT ON;

SELECT [t01].[SecurityRoleAssignmentId] AS [SecurityRoleAssignmentId], [t01].[RoleParticipant] AS [RoleParticipant], [t01].[Role] AS [Role], [t01].[Scope] AS [Scope], [t01].[CheckMode] AS [CheckMode], [t01].[IsOnlyForOwner] AS [IsOnlyForOwner]
FROM [Security_RoleAssignment] AS [t01]
WHERE ([t01].[SecurityRoleAssignmentId]=@SecurityRoleAssignmentId)

END

-- End
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMultiValueDictionary]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMultiValueDictionary]
	@MetaKey	INT
AS

SELECT MVD.MetaDictionaryId FROM MetaMultiValueDictionary MVD
	WHERE MVD.MetaKey = @MetaKey
GO
PRINT N'Creating [dbo].[mc_mcmd_ModuleInsert]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_ModuleInsert]
@Name AS NVarChar(4000),
@XSAttributes AS NText,
@ModuleId AS Int = NULL OUTPUT
AS
BEGIN
SET NOCOUNT ON;

INSERT INTO [mcmd_Module]
(
[Name],
[XSAttributes])
VALUES(
@Name,
@XSAttributes)
SELECT @ModuleId = SCOPE_IDENTITY();

END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntry_Associated]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntry_Associated]
    @CatalogEntryId int,
	@AssociationName nvarchar(150) = '',
	@ReturnInactive bit = 0,
	@ResponseGroup INT = NULL
AS
BEGIN
	if(@AssociationName = '')
		set @AssociationName = null

	DECLARE @CatalogEntryIds udttContentList
	INSERT INTO @CatalogEntryIds
	SELECT N.CatalogEntryId from [CatalogEntry] N
	INNER JOIN CatalogEntryAssociation A ON A.CatalogEntryId = N.CatalogEntryId
	INNER JOIN CatalogAssociation CA ON CA.CatalogAssociationId = A.CatalogAssociationId
	WHERE
		CA.CatalogEntryId = @CatalogEntryId AND COALESCE(@AssociationName, CA.AssociationName) = CA.AssociationName AND 
		((N.IsActive = 1) or @ReturnInactive = 1)
	ORDER BY CA.SortOrder, A.SortOrder

	SELECT N.* from [CatalogEntry] N
	INNER JOIN @CatalogEntryIds C on N.CatalogEntryId = C.ContentId

	SELECT S.* from CatalogItemSeo S
	INNER JOIN @CatalogEntryIds C on S.CatalogEntryId = C.ContentId

	exec ecf_CatalogEntry_Components @CatalogEntryIds, @ResponseGroup
END
GO
PRINT N'Creating [dbo].[mc_Security_RoleAssignmentDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_Security_RoleAssignmentDelete]
@SecurityRoleAssignmentId AS UniqueIdentifier
AS
BEGIN
SET NOCOUNT ON;

DELETE FROM [Security_RoleAssignment]
WHERE
[SecurityRoleAssignmentId] = @SecurityRoleAssignmentId

END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaTypeList]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaTypeList]
AS
	SELECT DataTypeId, [Name], FriendlyName, [Description], Length, SqlName, AllowNulls, Variable, IsSQLCommonType FROM MetaDataType
GO
PRINT N'Creating [dbo].[mc_mcmd_ModuleSelect]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_ModuleSelect]
@ModuleId AS Int
AS
BEGIN
SET NOCOUNT ON;

SELECT [t01].[ModuleId] AS [ModuleId], [t01].[Name] AS [Name], [t01].[XSAttributes] AS [XSAttributes]
FROM [mcmd_Module] AS [t01]
WHERE ([t01].[ModuleId]=@ModuleId)

END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntry_AssetKey]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntry_AssetKey]
	@AssetKey nvarchar(254)
AS
BEGIN
	SELECT A.* from [CatalogItemAsset] A
		INNER JOIN [CatalogEntry] CE ON CE.CatalogEntryId = A.CatalogEntryId
	WHERE
		A.AssetKey = @AssetKey
END
GO
PRINT N'Creating [dbo].[mc_Security_RoleAssignmentUpdate]...';


GO
CREATE PROCEDURE [dbo].[mc_Security_RoleAssignmentUpdate]
@RoleParticipant AS UniqueIdentifier,
@Role AS NVarChar(4000),
@Scope AS NText,
@CheckMode AS Int,
@IsOnlyForOwner AS Bit,
@SecurityRoleAssignmentId AS UniqueIdentifier
AS
BEGIN
SET NOCOUNT ON;

UPDATE [Security_RoleAssignment] SET
[RoleParticipant] = @RoleParticipant,
[Role] = @Role,
[Scope] = @Scope,
[CheckMode] = @CheckMode,
[IsOnlyForOwner] = @IsOnlyForOwner WHERE
[SecurityRoleAssignmentId] = @SecurityRoleAssignmentId

END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaType]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaType]
	@MetaTypeId	INT
AS
	SELECT DataTypeId, Name, FriendlyName, Description, Length, SqlName, AllowNulls, Variable, IsSQLCommonType FROM MetaDataType WHERE
		DataTypeId = @MetaTypeId
GO
PRINT N'Creating [dbo].[mc_mcmd_ModuleUpdate]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_ModuleUpdate]
@Name AS NVarChar(4000),
@XSAttributes AS NText,
@ModuleId AS Int
AS
BEGIN
SET NOCOUNT ON;

UPDATE [mcmd_Module] SET
[Name] = @Name,
[XSAttributes] = @XSAttributes WHERE
[ModuleId] = @ModuleId

END
GO
PRINT N'Creating [dbo].[aspnet_Membership_FindUsersByEmail]...';


GO
CREATE PROCEDURE dbo.aspnet_Membership_FindUsersByEmail
    @ApplicationName       nvarchar(256),
    @EmailToMatch          nvarchar(256),
    @PageIndex             int,
    @PageSize              int
AS
BEGIN
    DECLARE @ApplicationId uniqueidentifier
    SELECT  @ApplicationId = NULL
    SELECT  @ApplicationId = ApplicationId FROM dbo.aspnet_Applications WHERE LOWER(@ApplicationName) = LoweredApplicationName
    IF (@ApplicationId IS NULL)
        RETURN 0

    -- Set the page bounds
    DECLARE @PageLowerBound int
    DECLARE @PageUpperBound int
    DECLARE @TotalRecords   int
    SET @PageLowerBound = @PageSize * @PageIndex
    SET @PageUpperBound = @PageSize - 1 + @PageLowerBound

    -- Create a temp table TO store the select results
    CREATE TABLE #PageIndexForUsers
    (
        IndexId int IDENTITY (0, 1) NOT NULL,
        UserId uniqueidentifier
    )

    -- Insert into our temp table
    IF( @EmailToMatch IS NULL )
        INSERT INTO #PageIndexForUsers (UserId)
            SELECT u.UserId
            FROM   dbo.aspnet_Users u, dbo.aspnet_Membership m
            WHERE  u.ApplicationId = @ApplicationId AND m.UserId = u.UserId AND m.Email IS NULL
            ORDER BY m.LoweredEmail
    ELSE
        INSERT INTO #PageIndexForUsers (UserId)
            SELECT u.UserId
            FROM   dbo.aspnet_Users u, dbo.aspnet_Membership m
            WHERE  u.ApplicationId = @ApplicationId AND m.UserId = u.UserId AND m.LoweredEmail LIKE LOWER(@EmailToMatch)
            ORDER BY m.LoweredEmail

    SELECT  u.UserName, m.Email, m.PasswordQuestion, m.Comment, m.IsApproved,
            m.CreateDate,
            m.LastLoginDate,
            u.LastActivityDate,
            m.LastPasswordChangedDate,
            u.UserId, m.IsLockedOut,
            m.LastLockoutDate
    FROM   dbo.aspnet_Membership m, dbo.aspnet_Users u, #PageIndexForUsers p
    WHERE  u.UserId = p.UserId AND u.UserId = m.UserId AND
           p.IndexId >= @PageLowerBound AND p.IndexId <= @PageUpperBound
    ORDER BY m.LoweredEmail

    SELECT  @TotalRecords = COUNT(*)
    FROM    #PageIndexForUsers
    RETURN @TotalRecords
END
GO
PRINT N'Creating [dbo].[mc_Security_RoleAssignmentInsert]...';


GO
CREATE PROCEDURE [dbo].[mc_Security_RoleAssignmentInsert]
@SecurityRoleAssignmentId AS UniqueIdentifier,
@RoleParticipant AS UniqueIdentifier,
@Role AS NVarChar(4000),
@Scope AS NText,
@CheckMode AS Int,
@IsOnlyForOwner AS Bit
AS
BEGIN
SET NOCOUNT ON;

INSERT INTO [Security_RoleAssignment]
(
[SecurityRoleAssignmentId],
[RoleParticipant],
[Role],
[Scope],
[CheckMode],
[IsOnlyForOwner])
VALUES(
@SecurityRoleAssignmentId,
@RoleParticipant,
@Role,
@Scope,
@CheckMode,
@IsOnlyForOwner)

END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaStringDictionary]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaStringDictionary]
	@MetaKey	INT
AS
	SELECT MetaKey, [Key],[Value] FROM MetaStringDictionaryValue WHERE MetaKey = @MetaKey
GO
PRINT N'Creating [dbo].[mc_mcmd_ModuleDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_ModuleDelete]
@ModuleId AS Int
AS
BEGIN
SET NOCOUNT ON;

DELETE FROM [mcmd_Module]
WHERE
[ModuleId] = @ModuleId

END
GO
PRINT N'Creating [dbo].[aspnet_Membership_FindUsersByName]...';


GO
CREATE PROCEDURE dbo.aspnet_Membership_FindUsersByName
    @ApplicationName       nvarchar(256),
    @UserNameToMatch       nvarchar(256),
    @PageIndex             int,
    @PageSize              int
AS
BEGIN
    DECLARE @ApplicationId uniqueidentifier
    SELECT  @ApplicationId = NULL
    SELECT  @ApplicationId = ApplicationId FROM dbo.aspnet_Applications WHERE LOWER(@ApplicationName) = LoweredApplicationName
    IF (@ApplicationId IS NULL)
        RETURN 0

    -- Set the page bounds
    DECLARE @PageLowerBound int
    DECLARE @PageUpperBound int
    DECLARE @TotalRecords   int
    SET @PageLowerBound = @PageSize * @PageIndex
    SET @PageUpperBound = @PageSize - 1 + @PageLowerBound

    -- Create a temp table TO store the select results
    CREATE TABLE #PageIndexForUsers
    (
        IndexId int IDENTITY (0, 1) NOT NULL,
        UserId uniqueidentifier
    )

    -- Insert into our temp table
    INSERT INTO #PageIndexForUsers (UserId)
        SELECT u.UserId
        FROM   dbo.aspnet_Users u, dbo.aspnet_Membership m
        WHERE  u.ApplicationId = @ApplicationId AND m.UserId = u.UserId AND u.LoweredUserName LIKE LOWER(@UserNameToMatch)
        ORDER BY u.UserName


    SELECT  u.UserName, m.Email, m.PasswordQuestion, m.Comment, m.IsApproved,
            m.CreateDate,
            m.LastLoginDate,
            u.LastActivityDate,
            m.LastPasswordChangedDate,
            u.UserId, m.IsLockedOut,
            m.LastLockoutDate
    FROM   dbo.aspnet_Membership m, dbo.aspnet_Users u, #PageIndexForUsers p
    WHERE  u.UserId = p.UserId AND u.UserId = m.UserId AND
           p.IndexId >= @PageLowerBound AND p.IndexId <= @PageUpperBound
    ORDER BY u.UserName

    SELECT  @TotalRecords = COUNT(*)
    FROM    #PageIndexForUsers
    RETURN @TotalRecords
END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntry]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntry]
    @CatalogEntryId int,
	@ReturnInactive bit = 0,
	@ResponseGroup INT = NULL
AS
BEGIN

	DECLARE @CatalogEntryFull INT
	DECLARE @Associations INT
	DECLARE @Assets INT
	DECLARE @Variations INT

	SET @CatalogEntryFull = 4
	SET @Associations = 8
	SET @Assets = 32
	SET @Variations = 128

	IF (@ReturnInactive = 0)
	BEGIN
		IF  NOT EXISTS(SELECT CatalogEntryId FROM [CatalogEntry] N WHERE N.CatalogEntryId = @CatalogEntryId AND N.IsActive = 1)
			RETURN
	END

	SELECT N.* from [CatalogEntry] N
	WHERE
		N.CatalogEntryId = @CatalogEntryId

	SELECT S.* from CatalogItemSeo S
	WHERE
		S.CatalogEntryId = @CatalogEntryId 

	IF ((@ResponseGroup & @Variations = @Variations)
		OR (@ResponseGroup & @CatalogEntryFull = @CatalogEntryFull))
	BEGIN
		SELECT v.*
		FROM Variation v
		WHERE v.CatalogEntryId = @CatalogEntryId
	
		SELECT m.*
		FROM Merchant m
		INNER JOIN Variation v ON m.MerchantId = v.MerchantId
		WHERE v.CatalogEntryId = @CatalogEntryId
    END

	IF ((@ResponseGroup & @Associations = @Associations)
		OR (@ResponseGroup & @CatalogEntryFull = @CatalogEntryFull))
	BEGIN
		SELECT a.*
		FROM CatalogAssociation a
		WHERE a.CatalogEntryId = @CatalogEntryId
	END

	IF ((@ResponseGroup & @Assets = @Assets)
		OR (@ResponseGroup & @CatalogEntryFull = @CatalogEntryFull))
	BEGIN
		SELECT a.*
		FROM CatalogItemAsset a
		WHERE a.CatalogEntryId = @CatalogEntryId
		AND a.CatalogNodeId = 0 -- get Entry only, not Node
	END
END
GO
PRINT N'Creating [dbo].[mc_RolePermissionSelect]...';


GO
CREATE PROCEDURE [dbo].[mc_RolePermissionSelect]
@RolePermissionId AS Int
AS
BEGIN
SET NOCOUNT ON;

SELECT [t01].[RolePermissionId] AS [RolePermissionId], [t01].[RoleName] AS [RoleName], [t01].[Permission] AS [Permission]
FROM [RolePermission] AS [t01]
WHERE ([t01].[RolePermissionId]=@RolePermissionId)

END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaRuleByMetaClassId]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaRuleByMetaClassId]
	@MetaClassId	INT
AS
	SELECT RuleId, MetaClassId, Data FROM MetaRule
	WHERE MetaClassId = @MetaClassId
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaFieldMapUpdate]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaFieldMapUpdate]
@Name AS NVarChar(4000),
@SrcMetaClassId AS Int,
@DestMetaClassId AS Int,
@XSReferences AS NText,
@XSElements AS NText,
@MetaFieldMapId AS Int
AS
BEGIN
SET NOCOUNT ON;

UPDATE [mcmd_MetaFieldMap] SET
[Name] = @Name,
[SrcMetaClassId] = @SrcMetaClassId,
[DestMetaClassId] = @DestMetaClassId,
[XSReferences] = @XSReferences,
[XSElements] = @XSElements WHERE
[MetaFieldMapId] = @MetaFieldMapId

END
GO
PRINT N'Creating [dbo].[aspnet_Membership_GetNumberOfUsersOnline]...';


GO
CREATE PROCEDURE dbo.aspnet_Membership_GetNumberOfUsersOnline
    @ApplicationName            nvarchar(256),
    @MinutesSinceLastInActive   int,
    @CurrentTimeUtc             datetime
AS
BEGIN
    DECLARE @DateActive datetime
    SELECT  @DateActive = DATEADD(minute,  -(@MinutesSinceLastInActive), @CurrentTimeUtc)

    DECLARE @NumOnline int
    SELECT  @NumOnline = COUNT(*)
    FROM    dbo.aspnet_Users u WITH (NOLOCK),
            dbo.aspnet_Applications a WITH (NOLOCK),
            dbo.aspnet_Membership m WITH (NOLOCK)
    WHERE   u.ApplicationId = a.ApplicationId                  AND
            LastActivityDate > @DateActive                     AND
            a.LoweredApplicationName = LOWER(@ApplicationName) AND
            u.UserId = m.UserId
    RETURN(@NumOnline)
END
GO
PRINT N'Creating [dbo].[ecf_CatalogAssociationByName]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogAssociationByName]
	@AssociationName nvarchar(150)
AS
BEGIN
	SELECT CA.* from [CatalogAssociation] CA
		INNER JOIN [CatalogEntry] CE ON CE.CatalogEntryId = CA.CatalogEntryId
	WHERE
		CA.AssociationName = @AssociationName
	ORDER BY CA.SortOrder

	SELECT CEA.* from [CatalogEntryAssociation] CEA
		INNER JOIN [CatalogAssociation] CA ON CA.CatalogAssociationId = CEA.CatalogAssociationId
		INNER JOIN [CatalogEntry] CE ON CE.CatalogEntryId = CA.CatalogEntryId
	WHERE
		(CA.AssociationName = @AssociationName OR (CA.AssociationName IS NULL AND @AssociationName IS NULL))
	ORDER BY CA.SortOrder, CEA.SortOrder
		
	SELECT * FROM [AssociationType]
END
GO
PRINT N'Creating [dbo].[mc_RolePermissionDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_RolePermissionDelete]
@RolePermissionId AS Int
AS
BEGIN
SET NOCOUNT ON;

DELETE FROM [RolePermission]
WHERE
[RolePermissionId] = @RolePermissionId

END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaRuleById]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaRuleById]
	@RuleId	INT
AS
	SELECT RuleId, MetaClassId, Data FROM MetaRule
	WHERE RuleId = @RuleId
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaFieldMapInsert]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaFieldMapInsert]
@MetaFieldMapId AS Int,
@Name AS NVarChar(4000),
@SrcMetaClassId AS Int,
@DestMetaClassId AS Int,
@XSReferences AS NText,
@XSElements AS NText
AS
BEGIN
SET NOCOUNT ON;

INSERT INTO [mcmd_MetaFieldMap]
(
[MetaFieldMapId],
[Name],
[SrcMetaClassId],
[DestMetaClassId],
[XSReferences],
[XSElements])
VALUES(
@MetaFieldMapId,
@Name,
@SrcMetaClassId,
@DestMetaClassId,
@XSReferences,
@XSElements)

END
GO
PRINT N'Creating [dbo].[aspnet_Membership_GetAllUsers]...';


GO
CREATE PROCEDURE dbo.aspnet_Membership_GetAllUsers
    @ApplicationName       nvarchar(256),
    @PageIndex             int,
    @PageSize              int
AS
BEGIN
    DECLARE @ApplicationId uniqueidentifier
    SELECT  @ApplicationId = NULL
    SELECT  @ApplicationId = ApplicationId FROM dbo.aspnet_Applications WHERE LOWER(@ApplicationName) = LoweredApplicationName
    IF (@ApplicationId IS NULL)
        RETURN 0


    -- Set the page bounds
    DECLARE @PageLowerBound int
    DECLARE @PageUpperBound int
    DECLARE @TotalRecords   int
    SET @PageLowerBound = @PageSize * @PageIndex
    SET @PageUpperBound = @PageSize - 1 + @PageLowerBound

    -- Create a temp table TO store the select results
    CREATE TABLE #PageIndexForUsers
    (
        IndexId int IDENTITY (0, 1) NOT NULL,
        UserId uniqueidentifier
    )

    -- Insert into our temp table
    INSERT INTO #PageIndexForUsers (UserId)
    SELECT u.UserId
    FROM   dbo.aspnet_Membership m, dbo.aspnet_Users u
    WHERE  u.ApplicationId = @ApplicationId AND u.UserId = m.UserId
    ORDER BY u.UserName

    SELECT @TotalRecords = @@ROWCOUNT

    SELECT u.UserName, m.Email, m.PasswordQuestion, m.Comment, m.IsApproved,
            m.CreateDate,
            m.LastLoginDate,
            u.LastActivityDate,
            m.LastPasswordChangedDate,
            u.UserId, m.IsLockedOut,
            m.LastLockoutDate
    FROM   dbo.aspnet_Membership m, dbo.aspnet_Users u, #PageIndexForUsers p
    WHERE  u.UserId = p.UserId AND u.UserId = m.UserId AND
           p.IndexId >= @PageLowerBound AND p.IndexId <= @PageUpperBound
    ORDER BY u.UserName
    RETURN @TotalRecords
END
GO
PRINT N'Creating [dbo].[ecf_CatalogAssociation_Delete]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogAssociation_Delete]
(
	@CatalogAssociationId int
)
AS
	SET NOCOUNT ON

	DELETE 
	FROM [CatalogAssociation]
	WHERE  
		[CatalogAssociationId] = @CatalogAssociationId

	RETURN @@Error
GO
PRINT N'Creating [dbo].[mc_RolePermissionUpdate]...';


GO
CREATE PROCEDURE [dbo].[mc_RolePermissionUpdate]
@RoleName AS NVarChar(4000),
@Permission AS NVarChar(4000),
@RolePermissionId AS Int
AS
BEGIN
SET NOCOUNT ON;

UPDATE [RolePermission] SET
[RoleName] = @RoleName,
[Permission] = @Permission WHERE
[RolePermissionId] = @RolePermissionId

END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaObjectValue]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaObjectValue]
	@MetaKey	INT
AS
	SELECT MetaKey, MetaClassId, MetaObjectId  FROM MetaObjectValue WHERE MetaKey = @MetaKey
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaFieldMapSelect]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaFieldMapSelect]
@MetaFieldMapId AS Int
AS
BEGIN
SET NOCOUNT ON;

SELECT [t01].[MetaFieldMapId] AS [MetaFieldMapId], [t01].[Name] AS [Name], [t01].[SrcMetaClassId] AS [SrcMetaClassId], [t01].[DestMetaClassId] AS [DestMetaClassId], [t01].[XSReferences] AS [XSReferences], [t01].[XSElements] AS [XSElements]
FROM [mcmd_MetaFieldMap] AS [t01]
WHERE ([t01].[MetaFieldMapId]=@MetaFieldMapId)

END
GO
PRINT N'Creating [dbo].[aspnet_Membership_ChangePasswordQuestionAndAnswer]...';


GO
CREATE PROCEDURE dbo.aspnet_Membership_ChangePasswordQuestionAndAnswer
    @ApplicationName       nvarchar(256),
    @UserName              nvarchar(256),
    @NewPasswordQuestion   nvarchar(256),
    @NewPasswordAnswer     nvarchar(128)
AS
BEGIN
    DECLARE @UserId uniqueidentifier
    SELECT  @UserId = NULL
    SELECT  @UserId = u.UserId
    FROM    dbo.aspnet_Membership m, dbo.aspnet_Users u, dbo.aspnet_Applications a
    WHERE   LoweredUserName = LOWER(@UserName) AND
            u.ApplicationId = a.ApplicationId  AND
            LOWER(@ApplicationName) = a.LoweredApplicationName AND
            u.UserId = m.UserId
    IF (@UserId IS NULL)
    BEGIN
        RETURN(1)
    END

    UPDATE dbo.aspnet_Membership
    SET    PasswordQuestion = @NewPasswordQuestion, PasswordAnswer = @NewPasswordAnswer
    WHERE  UserId=@UserId
    RETURN(0)
END
GO
PRINT N'Creating [dbo].[ecf_CatalogAssociation_CatalogEntryId]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogAssociation_CatalogEntryId]
    @CatalogEntryId int
AS
BEGIN
	SELECT CA.* from [CatalogAssociation] CA
	WHERE
		CA.CatalogEntryId = @CatalogEntryId
	ORDER BY CA.SortOrder

	SELECT CEA.* from [CatalogEntryAssociation] CEA
	INNER JOIN [CatalogAssociation] CA ON CA.CatalogAssociationId = CEA.CatalogAssociationId
	WHERE
		CA.CatalogEntryId = @CatalogEntryId
	ORDER BY CA.SortOrder, CEA.SortOrder
		
	SELECT * FROM [AssociationType]
END
GO
PRINT N'Creating [dbo].[mc_RolePermissionInsert]...';


GO
CREATE PROCEDURE [dbo].[mc_RolePermissionInsert]
@RoleName AS NVarChar(4000),
@Permission AS NVarChar(4000),
@RolePermissionId AS Int = NULL OUTPUT
AS
BEGIN
SET NOCOUNT ON;

INSERT INTO [RolePermission]
(
[RoleName],
[Permission])
VALUES(
@RoleName,
@Permission)
SELECT @RolePermissionId = SCOPE_IDENTITY();

END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaFileList]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaFileList]
 AS
	SELECT MetaKey, [FileName], ContentType, Data, CreationTime, LastWriteTime, LastReadTime FROM MetaFileValue
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaFieldMapDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaFieldMapDelete]
@MetaFieldMapId AS Int
AS
BEGIN
SET NOCOUNT ON;

DELETE FROM [mcmd_MetaFieldMap]
WHERE
[MetaFieldMapId] = @MetaFieldMapId

END
GO
PRINT N'Creating [dbo].[aspnet_Membership_UpdateUser]...';


GO
CREATE PROCEDURE dbo.aspnet_Membership_UpdateUser
    @ApplicationName      nvarchar(256),
    @UserName             nvarchar(256),
    @Email                nvarchar(256),
    @Comment              ntext,
    @IsApproved           bit,
    @LastLoginDate        datetime,
    @LastActivityDate     datetime,
    @UniqueEmail          int,
    @CurrentTimeUtc       datetime
AS
BEGIN
    DECLARE @UserId uniqueidentifier
    DECLARE @ApplicationId uniqueidentifier
    SELECT  @UserId = NULL
    SELECT  @UserId = u.UserId, @ApplicationId = a.ApplicationId
    FROM    dbo.aspnet_Users u, dbo.aspnet_Applications a, dbo.aspnet_Membership m
    WHERE   LoweredUserName = LOWER(@UserName) AND
            u.ApplicationId = a.ApplicationId  AND
            LOWER(@ApplicationName) = a.LoweredApplicationName AND
            u.UserId = m.UserId

    IF (@UserId IS NULL)
        RETURN(1)

    IF (@UniqueEmail = 1)
    BEGIN
        IF (EXISTS (SELECT *
                    FROM  dbo.aspnet_Membership WITH (UPDLOCK, HOLDLOCK)
                    WHERE ApplicationId = @ApplicationId  AND @UserId <> UserId AND LoweredEmail = LOWER(@Email)))
        BEGIN
            RETURN(7)
        END
    END

    DECLARE @TranStarted   bit
    SET @TranStarted = 0

    IF( @@TRANCOUNT = 0 )
    BEGIN
	    BEGIN TRANSACTION
	    SET @TranStarted = 1
    END
    ELSE
	SET @TranStarted = 0

    UPDATE dbo.aspnet_Users WITH (ROWLOCK)
    SET
         LastActivityDate = @LastActivityDate
    WHERE
       @UserId = UserId

    IF( @@ERROR <> 0 )
        GOTO Cleanup

    UPDATE dbo.aspnet_Membership WITH (ROWLOCK)
    SET
         Email            = @Email,
         LoweredEmail     = LOWER(@Email),
         Comment          = @Comment,
         IsApproved       = @IsApproved,
         LastLoginDate    = @LastLoginDate
    WHERE
       @UserId = UserId

    IF( @@ERROR <> 0 )
        GOTO Cleanup

    IF( @TranStarted = 1 )
    BEGIN
	SET @TranStarted = 0
	COMMIT TRANSACTION
    END

    RETURN 0

Cleanup:

    IF( @TranStarted = 1 )
    BEGIN
        SET @TranStarted = 0
    	ROLLBACK TRANSACTION
    END

    RETURN -1
END
GO
PRINT N'Creating [dbo].[ecf_CatalogAssociation_CatalogEntryCode]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogAssociation_CatalogEntryCode]
	@CatalogId int,
	@CatalogEntryCode nvarchar(100)
AS
BEGIN
	SELECT CA.* from [CatalogAssociation] CA
		INNER JOIN [CatalogEntry] CE ON CE.CatalogEntryId = CA.CatalogEntryId
	WHERE
		CE.Code = @CatalogEntryCode AND
		CE.CatalogId = @CatalogId
	ORDER BY CA.SortOrder

	SELECT CEA.* from [CatalogEntryAssociation] CEA
		INNER JOIN [CatalogAssociation] CA ON CA.CatalogAssociationId = CEA.CatalogAssociationId
		INNER JOIN [CatalogEntry] CE ON CE.CatalogEntryId = CA.CatalogEntryId
	WHERE
		CE.Code = @CatalogEntryCode AND
		CE.CatalogId = @CatalogId
	ORDER BY CA.SortOrder, CEA.SortOrder
		
	SELECT * FROM [AssociationType]
END
GO
PRINT N'Creating [dbo].[ecf_RolePermission]...';


GO
CREATE PROCEDURE [dbo].[ecf_RolePermission]
	@Roles nvarchar(max)
AS
BEGIN
	SET NOCOUNT ON;
	select * from RolePermission where RoleName in (select Item from ecf_splitlist(@Roles))
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaFile]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaFile]
	@MetaKey	INT
AS
	SELECT MetaKey, [FileName], ContentType, Data, CreationTime, LastWriteTime, LastReadTime FROM MetaFileValue WHERE MetaKey = @MetaKey
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaViewUpdate]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaViewUpdate]
@MetaClassId AS Int,
@Card AS NVarChar(4000),
@Name AS NVarChar(4000),
@FriendlyName AS NVarChar(4000),
@XSAttributes AS NText,
@XSFilters AS NText,
@XSSorts AS NText,
@XSGroups AS NText,
@XSAvailableFields AS NText,
@Owner AS NVarChar(4000),
@AccessLevel AS Int,
@MetaViewId AS Int
AS
BEGIN
SET NOCOUNT ON;

UPDATE [mcmd_MetaView] SET
[MetaClassId] = @MetaClassId,
[Card] = @Card,
[Name] = @Name,
[FriendlyName] = @FriendlyName,
[XSAttributes] = @XSAttributes,
[XSFilters] = @XSFilters,
[XSSorts] = @XSSorts,
[XSGroups] = @XSGroups,
[XSAvailableFields] = @XSAvailableFields,
[Owner] = @Owner,
[AccessLevel] = @AccessLevel WHERE
[MetaViewId] = @MetaViewId

END
GO
PRINT N'Creating [dbo].[aspnet_Membership_UnlockUser]...';


GO
CREATE PROCEDURE dbo.aspnet_Membership_UnlockUser
    @ApplicationName                         nvarchar(256),
    @UserName                                nvarchar(256)
AS
BEGIN
    DECLARE @UserId uniqueidentifier
    SELECT  @UserId = NULL
    SELECT  @UserId = u.UserId
    FROM    dbo.aspnet_Users u, dbo.aspnet_Applications a, dbo.aspnet_Membership m
    WHERE   LoweredUserName = LOWER(@UserName) AND
            u.ApplicationId = a.ApplicationId  AND
            LOWER(@ApplicationName) = a.LoweredApplicationName AND
            u.UserId = m.UserId

    IF ( @UserId IS NULL )
        RETURN 1

    UPDATE dbo.aspnet_Membership
    SET IsLockedOut = 0,
        FailedPasswordAttemptCount = 0,
        FailedPasswordAttemptWindowStart = CONVERT( datetime, '17540101', 112 ),
        FailedPasswordAnswerAttemptCount = 0,
        FailedPasswordAnswerAttemptWindowStart = CONVERT( datetime, '17540101', 112 ),
        LastLockoutDate = CONVERT( datetime, '17540101', 112 )
    WHERE @UserId = UserId

    RETURN 0
END
GO
PRINT N'Creating [dbo].[ecf_CatalogAssociation]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogAssociation]
    @CatalogAssociationId int
AS
BEGIN
	SELECT CA.* from [CatalogAssociation] CA
	WHERE
		CA.CatalogAssociationId = @CatalogAssociationId
	ORDER BY CA.SortOrder

	SELECT CEA.* from [CatalogEntryAssociation] CEA
	INNER JOIN [CatalogAssociation] CA ON CA.CatalogAssociationId = CEA.CatalogAssociationId
	WHERE
		CA.CatalogAssociationId = @CatalogAssociationId
	ORDER BY CA.SortOrder, CEA.SortOrder
		
	SELECT * FROM [AssociationType]
	/*SELECT DISTINCT AT.* FROM [AssociationType] AT 
	INNER JOIN [CatalogEntryAssociation] CEA ON AT.AssociationTypeId = CEA.AssociationTypeId
	INNER JOIN [CatalogAssociation] CA ON CA.CatalogAssociationId = CEA.CatalogAssociationId
	WHERE
		CA.CatalogEntryId = @CatalogEntryId*/
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaFieldWeight]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaFieldWeight]
	@MetaClassId	INT,
	@MetaFieldId	INT
AS
	IF NOT EXISTS(	SELECT * FROM MetaClassMetaFieldRelation WHERE MetaClassId = @MetaClassId AND MetaFieldId = @MetaFieldId)
		RAISERROR ('Wrong @MetaClassId or @MetaFieldId.', 16,1)

	SELECT Weight, Enabled FROM MetaClassMetaFieldRelation WHERE MetaClassId = @MetaClassId AND MetaFieldId = @MetaFieldId
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaViewDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaViewDelete]
@MetaViewId AS Int
AS
BEGIN
SET NOCOUNT ON;

DELETE FROM [mcmd_MetaView]
WHERE
[MetaViewId] = @MetaViewId

END
GO
PRINT N'Creating [dbo].[aspnet_Membership_ResetPassword]...';


GO
CREATE PROCEDURE dbo.aspnet_Membership_ResetPassword
    @ApplicationName             nvarchar(256),
    @UserName                    nvarchar(256),
    @NewPassword                 nvarchar(128),
    @MaxInvalidPasswordAttempts  int,
    @PasswordAttemptWindow       int,
    @PasswordSalt                nvarchar(128),
    @CurrentTimeUtc              datetime,
    @PasswordFormat              int = 0,
    @PasswordAnswer              nvarchar(128) = NULL
AS
BEGIN
    DECLARE @IsLockedOut                            bit
    DECLARE @LastLockoutDate                        datetime
    DECLARE @FailedPasswordAttemptCount             int
    DECLARE @FailedPasswordAttemptWindowStart       datetime
    DECLARE @FailedPasswordAnswerAttemptCount       int
    DECLARE @FailedPasswordAnswerAttemptWindowStart datetime

    DECLARE @UserId                                 uniqueidentifier
    SET     @UserId = NULL

    DECLARE @ErrorCode     int
    SET @ErrorCode = 0

    DECLARE @TranStarted   bit
    SET @TranStarted = 0

    IF( @@TRANCOUNT = 0 )
    BEGIN
	    BEGIN TRANSACTION
	    SET @TranStarted = 1
    END
    ELSE
    	SET @TranStarted = 0

    SELECT  @UserId = u.UserId
    FROM    dbo.aspnet_Users u, dbo.aspnet_Applications a, dbo.aspnet_Membership m
    WHERE   LoweredUserName = LOWER(@UserName) AND
            u.ApplicationId = a.ApplicationId  AND
            LOWER(@ApplicationName) = a.LoweredApplicationName AND
            u.UserId = m.UserId

    IF ( @UserId IS NULL )
    BEGIN
        SET @ErrorCode = 1
        GOTO Cleanup
    END

    SELECT @IsLockedOut = IsLockedOut,
           @LastLockoutDate = LastLockoutDate,
           @FailedPasswordAttemptCount = FailedPasswordAttemptCount,
           @FailedPasswordAttemptWindowStart = FailedPasswordAttemptWindowStart,
           @FailedPasswordAnswerAttemptCount = FailedPasswordAnswerAttemptCount,
           @FailedPasswordAnswerAttemptWindowStart = FailedPasswordAnswerAttemptWindowStart
    FROM dbo.aspnet_Membership WITH ( UPDLOCK )
    WHERE @UserId = UserId

    IF( @IsLockedOut = 1 )
    BEGIN
        SET @ErrorCode = 99
        GOTO Cleanup
    END

    UPDATE dbo.aspnet_Membership
    SET    Password = @NewPassword,
           LastPasswordChangedDate = @CurrentTimeUtc,
           PasswordFormat = @PasswordFormat,
           PasswordSalt = @PasswordSalt
    WHERE  @UserId = UserId AND
           ( ( @PasswordAnswer IS NULL ) OR ( LOWER( PasswordAnswer ) = LOWER( @PasswordAnswer ) ) )

    IF ( @@ROWCOUNT = 0 )
        BEGIN
            IF( @CurrentTimeUtc > DATEADD( minute, @PasswordAttemptWindow, @FailedPasswordAnswerAttemptWindowStart ) )
            BEGIN
                SET @FailedPasswordAnswerAttemptWindowStart = @CurrentTimeUtc
                SET @FailedPasswordAnswerAttemptCount = 1
            END
            ELSE
            BEGIN
                SET @FailedPasswordAnswerAttemptWindowStart = @CurrentTimeUtc
                SET @FailedPasswordAnswerAttemptCount = @FailedPasswordAnswerAttemptCount + 1
            END

            BEGIN
                IF( @FailedPasswordAnswerAttemptCount >= @MaxInvalidPasswordAttempts )
                BEGIN
                    SET @IsLockedOut = 1
                    SET @LastLockoutDate = @CurrentTimeUtc
                END
            END

            SET @ErrorCode = 3
        END
    ELSE
        BEGIN
            IF( @FailedPasswordAnswerAttemptCount > 0 )
            BEGIN
                SET @FailedPasswordAnswerAttemptCount = 0
                SET @FailedPasswordAnswerAttemptWindowStart = CONVERT( datetime, '17540101', 112 )
            END
        END

    IF( NOT ( @PasswordAnswer IS NULL ) )
    BEGIN
        UPDATE dbo.aspnet_Membership
        SET IsLockedOut = @IsLockedOut, LastLockoutDate = @LastLockoutDate,
            FailedPasswordAttemptCount = @FailedPasswordAttemptCount,
            FailedPasswordAttemptWindowStart = @FailedPasswordAttemptWindowStart,
            FailedPasswordAnswerAttemptCount = @FailedPasswordAnswerAttemptCount,
            FailedPasswordAnswerAttemptWindowStart = @FailedPasswordAnswerAttemptWindowStart
        WHERE @UserId = UserId

        IF( @@ERROR <> 0 )
        BEGIN
            SET @ErrorCode = -1
            GOTO Cleanup
        END
    END

    IF( @TranStarted = 1 )
    BEGIN
	SET @TranStarted = 0
	COMMIT TRANSACTION
    END

    RETURN @ErrorCode

Cleanup:

    IF( @TranStarted = 1 )
    BEGIN
        SET @TranStarted = 0
    	ROLLBACK TRANSACTION
    END

    RETURN @ErrorCode

END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaFieldListByMetaClassId]...';


GO
create procedure [dbo].[mdpsp_sys_LoadMetaFieldListByMetaClassId]
    @MetaClassId int
as
begin
    select
        mf.[MetaFieldId],
        mf.[Namespace],
        mf.[Name],
        mf.[FriendlyName],
        mf.[Description],
        mf.[SystemMetaClassId],
        mf.[DataTypeId],
        mf.[Length],
        mf.[AllowNulls],
        mf.[MultiLanguageValue],
        mf.[AllowSearch],
        mf.[Tag],
        mf.[IsEncrypted],
        cfr.[Weight],
        cfr.[Enabled],
        cast(case when mf.SystemMetaClassId = 0 then ROW_NUMBER() over (partition by mf.SystemMetaClassId order by mf.Name)
            else null end as int) as ParameterIndex
    from MetaField mf
    join MetaClassMetaFieldRelation cfr ON cfr.MetaFieldId = mf.MetaFieldId
    where cfr.MetaClassId = @MetaClassId
    order by mf.IsKeyField desc, cfr.[Weight]
end
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaViewSelect]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaViewSelect]
@MetaViewId AS Int
AS
BEGIN
SET NOCOUNT ON;

SELECT [t01].[MetaViewId] AS [MetaViewId], [t01].[MetaClassId] AS [MetaClassId], [t01].[Card] AS [Card], [t01].[Name] AS [Name], [t01].[FriendlyName] AS [FriendlyName], [t01].[XSAttributes] AS [XSAttributes], [t01].[XSFilters] AS [XSFilters], [t01].[XSSorts] AS [XSSorts], [t01].[XSGroups] AS [XSGroups], [t01].[XSAvailableFields] AS [XSAvailableFields], [t01].[Owner] AS [Owner], [t01].[AccessLevel] AS [AccessLevel]
FROM [mcmd_MetaView] AS [t01]
WHERE ([t01].[MetaViewId]=@MetaViewId)

END
GO
PRINT N'Creating [dbo].[aspnet_Membership_SetPassword]...';


GO
CREATE PROCEDURE dbo.aspnet_Membership_SetPassword
    @ApplicationName  nvarchar(256),
    @UserName         nvarchar(256),
    @NewPassword      nvarchar(128),
    @PasswordSalt     nvarchar(128),
    @CurrentTimeUtc   datetime,
    @PasswordFormat   int = 0
AS
BEGIN
    DECLARE @UserId uniqueidentifier
    SELECT  @UserId = NULL
    SELECT  @UserId = u.UserId
    FROM    dbo.aspnet_Users u, dbo.aspnet_Applications a, dbo.aspnet_Membership m
    WHERE   LoweredUserName = LOWER(@UserName) AND
            u.ApplicationId = a.ApplicationId  AND
            LOWER(@ApplicationName) = a.LoweredApplicationName AND
            u.UserId = m.UserId

    IF (@UserId IS NULL)
        RETURN(1)

    UPDATE dbo.aspnet_Membership
    SET Password = @NewPassword, PasswordFormat = @PasswordFormat, PasswordSalt = @PasswordSalt,
        LastPasswordChangedDate = @CurrentTimeUtc
    WHERE @UserId = UserId
    RETURN(0)
END
GO
PRINT N'Creating [dbo].[ecf_CreateTableJoinQuery]...';


GO
CREATE PROCEDURE [dbo].[ecf_CreateTableJoinQuery]
(
	@SourceTableName   	sysname,	
	@TargetQuery 		nvarchar(max),
	@SourceJoinKey		sysname, 
	@TargetJoinKey		sysname,
	@JoinType			nvarchar(50),
	@JoinQuery 			nvarchar(max) OUTPUT
)
AS
BEGIN

	SET @SourceTableName = LTRIM(RTRIM(@SourceTableName))

	IF (SUBSTRING(@SourceTableName, 1, 1) <> N'[' OR SUBSTRING(@SourceTableName, LEN(@SourceTableName),1) <> N']')
	BEGIN
		SET @SourceTableName=N'['+@SourceTableName+N']'
	END
	
	SET @TargetQuery = LTRIM(RTRIM(@TargetQuery))
/*
	IF (SUBSTRING(@TargetTableName, 1, 1) <> N'[' OR SUBSTRING(@TargetTableName, LEN(@TargetTableName),1) <> N']')
	BEGIN
		SET @TargetTableName=N'['+@TargetTableName+N']'
	END
*/
	--set @JoinQuery = @JoinType + N' ' + @TargetTableName + N' ' + @TargetTableName + N' ON ' + @SourceTableName + N'.[' + @SourceJoinKey + N'] = ' + @TargetTableName + N'.[' + @TargetJoinKey + N']'
	set @JoinQuery = @JoinType + N' ' + @TargetQuery + N' ON ' + @SourceTableName + N'.[' + @SourceJoinKey + N'] = ' + @TargetJoinKey
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaFieldList]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaFieldList]
AS
BEGIN
	SELECT [MetaFieldId], [Namespace], [Name], [FriendlyName], [Description], [SystemMetaClassId], [DataTypeId], [Length], [AllowNulls], [MultiLanguageValue], [AllowSearch], [Tag], [IsEncrypted]
	FROM MetaField
END
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaViewInsert]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaViewInsert]
@MetaClassId AS Int,
@Card AS NVarChar(4000),
@Name AS NVarChar(4000),
@FriendlyName AS NVarChar(4000),
@XSAttributes AS NText,
@XSFilters AS NText,
@XSSorts AS NText,
@XSGroups AS NText,
@XSAvailableFields AS NText,
@Owner AS NVarChar(4000),
@AccessLevel AS Int,
@MetaViewId AS Int = NULL OUTPUT
AS
BEGIN
SET NOCOUNT ON;

INSERT INTO [mcmd_MetaView]
(
[MetaClassId],
[Card],
[Name],
[FriendlyName],
[XSAttributes],
[XSFilters],
[XSSorts],
[XSGroups],
[XSAvailableFields],
[Owner],
[AccessLevel])
VALUES(
@MetaClassId,
@Card,
@Name,
@FriendlyName,
@XSAttributes,
@XSFilters,
@XSSorts,
@XSGroups,
@XSAvailableFields,
@Owner,
@AccessLevel)
SELECT @MetaViewId = SCOPE_IDENTITY();

END
GO
PRINT N'Creating [dbo].[ecf_Search_OrderGroup]...';


GO
CREATE PROCEDURE [dbo].[ecf_Search_OrderGroup]
    @results udttOrderGroupId readonly
AS
BEGIN

-- Return GroupIds.
SELECT [OrderGroupId] FROM @results


-- Prevent any queries if order group doesn't exist
IF NOT EXISTS(SELECT * from OrderGroup G INNER JOIN @results R ON G.OrderGroupId = R.OrderGroupId)
	RETURN;

-- Return Order Form Collection
SELECT 'OrderForm' TableName, OE.*, O.*
	FROM [OrderFormEx] OE 
		INNER JOIN OrderForm O ON O.OrderFormId = OE.ObjectId 
		INNER JOIN @results R ON O.OrderGroupId = R.OrderGroupId 

if(@@ROWCOUNT = 0)
	RETURN;

-- Return Order Form Collection
SELECT 'OrderGroupAddress' TableName, OE.*, O.*
	FROM [OrderGroupAddressEx] OE 
		INNER JOIN OrderGroupAddress O ON O.OrderGroupAddressId = OE.ObjectId  
		INNER JOIN @results R ON O.OrderGroupId = R.OrderGroupId 

-- Return Shipment Collection
SELECT 'Shipment' TableName, SE.*, S.*
	FROM [ShipmentEx] SE 
		INNER JOIN Shipment S ON S.ShipmentId = SE.ObjectId 
		INNER JOIN @results R ON S.OrderGroupId = R.OrderGroupId 

-- Return Line Item Collection
SELECT 'LineItem' TableName, LE.*, L.*
	FROM [LineItemEx] LE 
		INNER JOIN LineItem L ON L.LineItemId = LE.ObjectId 
		INNER JOIN @results R ON L.OrderGroupId = R.OrderGroupId 

-- Return Order Form Payment Collection
EXEC dbo.ecf_Search_Payment @results

-- Return Order Form Discount Collection
SELECT 'OrderFormDiscount' TableName, D.* 
	FROM [OrderFormDiscount] D 
		INNER JOIN @results R ON D.OrderGroupId = R.OrderGroupId 

-- Return Line Item Discount Collection
SELECT 'LineItemDiscount' TableName, D.* 
	FROM [LineItemDiscount] D 
		INNER JOIN @results R ON D.OrderGroupId = R.OrderGroupId 

-- Return Shipment Discount Collection
SELECT 'ShipmentDiscount' TableName, D.* 
	FROM [ShipmentDiscount] D 
		INNER JOIN @results R ON D.OrderGroupId = R.OrderGroupId 
		
-- Return OrderGroupNote Collection
SELECT 'OrderGroupNote' TableName, 
		G.OrderNoteId, 
		G.CustomerId, 
		G.Created, 
		G.OrderGroupId, 
		G.Detail,
		G.LineItemId,
		G.Title,
		G.Type,
		G.Channel,
		G.EventType
	FROM [OrderGroupNote] G 
	INNER JOIN @results R ON G.OrderGroupId = R.OrderGroupId

EXEC dbo.PromotionInformationLoad @results

-- assign random local variable to set @@rowcount attribute to 1
declare @temp as int
set @temp = 1

END
GO
PRINT N'Creating [dbo].[aspnet_Membership_GetPassword]...';


GO
CREATE PROCEDURE dbo.aspnet_Membership_GetPassword
    @ApplicationName                nvarchar(256),
    @UserName                       nvarchar(256),
    @MaxInvalidPasswordAttempts     int,
    @PasswordAttemptWindow          int,
    @CurrentTimeUtc                 datetime,
    @PasswordAnswer                 nvarchar(128) = NULL
AS
BEGIN
    DECLARE @UserId                                 uniqueidentifier
    DECLARE @PasswordFormat                         int
    DECLARE @Password                               nvarchar(128)
    DECLARE @passAns                                nvarchar(128)
    DECLARE @IsLockedOut                            bit
    DECLARE @LastLockoutDate                        datetime
    DECLARE @FailedPasswordAttemptCount             int
    DECLARE @FailedPasswordAttemptWindowStart       datetime
    DECLARE @FailedPasswordAnswerAttemptCount       int
    DECLARE @FailedPasswordAnswerAttemptWindowStart datetime

    DECLARE @ErrorCode     int
    SET @ErrorCode = 0

    DECLARE @TranStarted   bit
    SET @TranStarted = 0

    IF( @@TRANCOUNT = 0 )
    BEGIN
	    BEGIN TRANSACTION
	    SET @TranStarted = 1
    END
    ELSE
    	SET @TranStarted = 0

    SELECT  @UserId = u.UserId,
            @Password = m.Password,
            @passAns = m.PasswordAnswer,
            @PasswordFormat = m.PasswordFormat,
            @IsLockedOut = m.IsLockedOut,
            @LastLockoutDate = m.LastLockoutDate,
            @FailedPasswordAttemptCount = m.FailedPasswordAttemptCount,
            @FailedPasswordAttemptWindowStart = m.FailedPasswordAttemptWindowStart,
            @FailedPasswordAnswerAttemptCount = m.FailedPasswordAnswerAttemptCount,
            @FailedPasswordAnswerAttemptWindowStart = m.FailedPasswordAnswerAttemptWindowStart
    FROM    dbo.aspnet_Applications a, dbo.aspnet_Users u, dbo.aspnet_Membership m WITH ( UPDLOCK )
    WHERE   LOWER(@ApplicationName) = a.LoweredApplicationName AND
            u.ApplicationId = a.ApplicationId    AND
            u.UserId = m.UserId AND
            LOWER(@UserName) = u.LoweredUserName

    IF ( @@rowcount = 0 )
    BEGIN
        SET @ErrorCode = 1
        GOTO Cleanup
    END

    IF( @IsLockedOut = 1 )
    BEGIN
        SET @ErrorCode = 99
        GOTO Cleanup
    END

    IF ( NOT( @PasswordAnswer IS NULL ) )
    BEGIN
        IF( ( @passAns IS NULL ) OR ( LOWER( @passAns ) <> LOWER( @PasswordAnswer ) ) )
        BEGIN
            IF( @CurrentTimeUtc > DATEADD( minute, @PasswordAttemptWindow, @FailedPasswordAnswerAttemptWindowStart ) )
            BEGIN
                SET @FailedPasswordAnswerAttemptWindowStart = @CurrentTimeUtc
                SET @FailedPasswordAnswerAttemptCount = 1
            END
            ELSE
            BEGIN
                SET @FailedPasswordAnswerAttemptCount = @FailedPasswordAnswerAttemptCount + 1
                SET @FailedPasswordAnswerAttemptWindowStart = @CurrentTimeUtc
            END

            BEGIN
                IF( @FailedPasswordAnswerAttemptCount >= @MaxInvalidPasswordAttempts )
                BEGIN
                    SET @IsLockedOut = 1
                    SET @LastLockoutDate = @CurrentTimeUtc
                END
            END

            SET @ErrorCode = 3
        END
        ELSE
        BEGIN
            IF( @FailedPasswordAnswerAttemptCount > 0 )
            BEGIN
                SET @FailedPasswordAnswerAttemptCount = 0
                SET @FailedPasswordAnswerAttemptWindowStart = CONVERT( datetime, '17540101', 112 )
            END
        END

        UPDATE dbo.aspnet_Membership
        SET IsLockedOut = @IsLockedOut, LastLockoutDate = @LastLockoutDate,
            FailedPasswordAttemptCount = @FailedPasswordAttemptCount,
            FailedPasswordAttemptWindowStart = @FailedPasswordAttemptWindowStart,
            FailedPasswordAnswerAttemptCount = @FailedPasswordAnswerAttemptCount,
            FailedPasswordAnswerAttemptWindowStart = @FailedPasswordAnswerAttemptWindowStart
        WHERE @UserId = UserId

        IF( @@ERROR <> 0 )
        BEGIN
            SET @ErrorCode = -1
            GOTO Cleanup
        END
    END

    IF( @TranStarted = 1 )
    BEGIN
	SET @TranStarted = 0
	COMMIT TRANSACTION
    END

    IF( @ErrorCode = 0 )
        SELECT @Password, @PasswordFormat

    RETURN @ErrorCode

Cleanup:

    IF( @TranStarted = 1 )
    BEGIN
        SET @TranStarted = 0
    	ROLLBACK TRANSACTION
    END

    RETURN @ErrorCode

END
GO
PRINT N'Creating [dbo].[ecf_Catalog_Update]...';


GO
CREATE PROCEDURE [dbo].[ecf_Catalog_Update]
(
	@CatalogId int,
	@Name nvarchar(150),
	@StartDate datetime,
	@EndDate datetime,
	@DefaultCurrency nvarchar(128),
	@WeightBase nvarchar(128),
	@DefaultLanguage nvarchar(10),
	@IsPrimary bit,
	@IsActive bit,
	@Created datetime,
	@Modified datetime,
	@CreatorId nvarchar(256),
	@ModifierId nvarchar(256),
	@SortOrder int
)
AS
	SET NOCOUNT OFF;
	UPDATE [Catalog]
	SET
		[Name] = @Name,
		[StartDate] = @StartDate,
		[EndDate] = @EndDate,
		[DefaultCurrency] = @DefaultCurrency,
		[WeightBase] = @WeightBase,
		[DefaultLanguage] = @DefaultLanguage,
		[IsPrimary] = @IsPrimary,
		[IsActive] = @IsActive,
		[Created] = @Created,
		[Modified] = @Modified,
		[CreatorId] = @CreatorId,
		[ModifierId] = @ModifierId,
		[SortOrder] = @SortOrder
	WHERE 
		[CatalogId] = @CatalogId

	RETURN @@Error
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaFieldByNamespace]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaFieldByNamespace]
	@Namespace		NVARCHAR(1024),
	@Deep			BIT
AS
BEGIN
	IF @Deep = 1
		SELECT [MetaFieldId], [Namespace], [Name], [FriendlyName], [Description], [SystemMetaClassId], [DataTypeId], [Length], [AllowNulls], [MultiLanguageValue], [AllowSearch], [Tag], [IsEncrypted]
		FROM MetaField WHERE Namespace = @Namespace OR Namespace LIKE (@Namespace + '.%')
	ELSE
		SELECT [MetaFieldId], [Namespace], [Name], [FriendlyName], [Description], [SystemMetaClassId], [DataTypeId], [Length], [AllowNulls], [MultiLanguageValue], [AllowSearch], [Tag], [IsEncrypted]
		FROM MetaField WHERE Namespace = @Namespace
END
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaFieldSelect]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaFieldSelect]
@MetaFieldId AS Int
AS
BEGIN
SET NOCOUNT ON;

SELECT [t01].[MetaFieldId] AS [MetaFieldId], [t01].[MetaClassId] AS [MetaClassId], [t01].[Name] AS [Name], [t01].[FriendlyName] AS [FriendlyName], [t01].[TypeName] AS [TypeName], [t01].[Nullable] AS [Nullable], [t01].[DefaultValue] AS [DefaultValue], [t01].[ReadOnly] AS [ReadOnly], [t01].[XSDataSource] AS [XSDataSource], [t01].[XSAttributes] AS [XSAttributes], [t01].[Owner] AS [Owner], [t01].[AccessLevel] AS [AccessLevel]
FROM [mcmd_MetaField] AS [t01]
WHERE ([t01].[MetaFieldId]=@MetaFieldId)

END
GO
PRINT N'Creating [dbo].[ecf_PaymentMethod_SystemKeyword]...';


GO
CREATE PROCEDURE [dbo].[ecf_PaymentMethod_SystemKeyword]
	@SystemKeyword nvarchar(30),
	@LanguageId nvarchar(128),
	@MarketId nvarchar(8),
	@ReturnInactive bit = 0
AS
BEGIN
	select * from [PaymentMethod] 
	where COALESCE(@LanguageId, [LanguageId]) = [LanguageId] and 
		(([IsActive] = 1) or @ReturnInactive = 1) and 
		COALESCE (@SystemKeyword, [SystemKeyword]) = [SystemKeyword]
		order by [Ordering]

	select PMP.* from [PaymentMethodParameter] PMP 
	inner join [PaymentMethod] PM on PMP.[PaymentMethodId] = PM.[PaymentMethodId] 
		where COALESCE(@LanguageId, PM.[LanguageId]) = [LanguageId] and 
		(PM.[SystemKeyword] = @SystemKeyword) and 
		((PM.[IsActive] = 1) or @ReturnInactive = 1)

	select SPR.* from [ShippingPaymentRestriction] SPR  
	inner join [PaymentMethod] PM on SPR.[PaymentMethodId] = PM.[PaymentMethodId] 
		where COALESCE(@LanguageId, PM.[LanguageId]) = [LanguageId] and 
		(PM.[SystemKeyword] = @SystemKeyword) and 
		((PM.[IsActive] = 1) or @ReturnInactive = 1) and 
		SPR.[RestrictShippingMethods]=1
	
	select MPM.* from [MarketPaymentMethods] MPM  
	inner join [PaymentMethod] PM on MPM.[PaymentMethodId] = PM.[PaymentMethodId] 
		where COALESCE(@LanguageId, PM.[LanguageId]) = [LanguageId] and 
		COALESCE (@SystemKeyword, [SystemKeyword]) = [SystemKeyword] and
		COALESCE (@MarketId, [MarketId]) = [MarketId] and
		((PM.[IsActive] = 1) or @ReturnInactive = 1)
END
GO
PRINT N'Creating [dbo].[aspnet_Membership_UpdateUserInfo]...';


GO
CREATE PROCEDURE dbo.aspnet_Membership_UpdateUserInfo
    @ApplicationName                nvarchar(256),
    @UserName                       nvarchar(256),
    @IsPasswordCorrect              bit,
    @UpdateLastLoginActivityDate    bit,
    @MaxInvalidPasswordAttempts     int,
    @PasswordAttemptWindow          int,
    @CurrentTimeUtc                 datetime,
    @LastLoginDate                  datetime,
    @LastActivityDate               datetime
AS
BEGIN
    DECLARE @UserId                                 uniqueidentifier
    DECLARE @IsApproved                             bit
    DECLARE @IsLockedOut                            bit
    DECLARE @LastLockoutDate                        datetime
    DECLARE @FailedPasswordAttemptCount             int
    DECLARE @FailedPasswordAttemptWindowStart       datetime
    DECLARE @FailedPasswordAnswerAttemptCount       int
    DECLARE @FailedPasswordAnswerAttemptWindowStart datetime

    DECLARE @ErrorCode     int
    SET @ErrorCode = 0

    DECLARE @TranStarted   bit
    SET @TranStarted = 0

    IF( @@TRANCOUNT = 0 )
    BEGIN
	    BEGIN TRANSACTION
	    SET @TranStarted = 1
    END
    ELSE
    	SET @TranStarted = 0

    SELECT  @UserId = u.UserId,
            @IsApproved = m.IsApproved,
            @IsLockedOut = m.IsLockedOut,
            @LastLockoutDate = m.LastLockoutDate,
            @FailedPasswordAttemptCount = m.FailedPasswordAttemptCount,
            @FailedPasswordAttemptWindowStart = m.FailedPasswordAttemptWindowStart,
            @FailedPasswordAnswerAttemptCount = m.FailedPasswordAnswerAttemptCount,
            @FailedPasswordAnswerAttemptWindowStart = m.FailedPasswordAnswerAttemptWindowStart
    FROM    dbo.aspnet_Applications a, dbo.aspnet_Users u, dbo.aspnet_Membership m WITH ( UPDLOCK )
    WHERE   LOWER(@ApplicationName) = a.LoweredApplicationName AND
            u.ApplicationId = a.ApplicationId    AND
            u.UserId = m.UserId AND
            LOWER(@UserName) = u.LoweredUserName

    IF ( @@rowcount = 0 )
    BEGIN
        SET @ErrorCode = 1
        GOTO Cleanup
    END

    IF( @IsLockedOut = 1 )
    BEGIN
        GOTO Cleanup
    END

    IF( @IsPasswordCorrect = 0 )
    BEGIN
        IF( @CurrentTimeUtc > DATEADD( minute, @PasswordAttemptWindow, @FailedPasswordAttemptWindowStart ) )
        BEGIN
            SET @FailedPasswordAttemptWindowStart = @CurrentTimeUtc
            SET @FailedPasswordAttemptCount = 1
        END
        ELSE
        BEGIN
            SET @FailedPasswordAttemptWindowStart = @CurrentTimeUtc
            SET @FailedPasswordAttemptCount = @FailedPasswordAttemptCount + 1
        END

        BEGIN
            IF( @FailedPasswordAttemptCount >= @MaxInvalidPasswordAttempts )
            BEGIN
                SET @IsLockedOut = 1
                SET @LastLockoutDate = @CurrentTimeUtc
            END
        END
    END
    ELSE
    BEGIN
        IF( @FailedPasswordAttemptCount > 0 OR @FailedPasswordAnswerAttemptCount > 0 )
        BEGIN
            SET @FailedPasswordAttemptCount = 0
            SET @FailedPasswordAttemptWindowStart = CONVERT( datetime, '17540101', 112 )
            SET @FailedPasswordAnswerAttemptCount = 0
            SET @FailedPasswordAnswerAttemptWindowStart = CONVERT( datetime, '17540101', 112 )
            SET @LastLockoutDate = CONVERT( datetime, '17540101', 112 )
        END
    END

    IF( @UpdateLastLoginActivityDate = 1 )
    BEGIN
        UPDATE  dbo.aspnet_Users
        SET     LastActivityDate = @LastActivityDate
        WHERE   @UserId = UserId

        IF( @@ERROR <> 0 )
        BEGIN
            SET @ErrorCode = -1
            GOTO Cleanup
        END

        UPDATE  dbo.aspnet_Membership
        SET     LastLoginDate = @LastLoginDate
        WHERE   UserId = @UserId

        IF( @@ERROR <> 0 )
        BEGIN
            SET @ErrorCode = -1
            GOTO Cleanup
        END
    END


    UPDATE dbo.aspnet_Membership
    SET IsLockedOut = @IsLockedOut, LastLockoutDate = @LastLockoutDate,
        FailedPasswordAttemptCount = @FailedPasswordAttemptCount,
        FailedPasswordAttemptWindowStart = @FailedPasswordAttemptWindowStart,
        FailedPasswordAnswerAttemptCount = @FailedPasswordAnswerAttemptCount,
        FailedPasswordAnswerAttemptWindowStart = @FailedPasswordAnswerAttemptWindowStart
    WHERE @UserId = UserId

    IF( @@ERROR <> 0 )
    BEGIN
        SET @ErrorCode = -1
        GOTO Cleanup
    END

    IF( @TranStarted = 1 )
    BEGIN
	SET @TranStarted = 0
	COMMIT TRANSACTION
    END

    RETURN @ErrorCode

Cleanup:

    IF( @TranStarted = 1 )
    BEGIN
        SET @TranStarted = 0
    	ROLLBACK TRANSACTION
    END

    RETURN @ErrorCode

END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaFieldByName]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaFieldByName]
	@Name		NVARCHAR(256)
AS
BEGIN
	SELECT [MetaFieldId] ,  [Namespace], [Name], [FriendlyName], [Description], [SystemMetaClassId], [DataTypeId],[Length],[AllowNulls],[MultiLanguageValue], [AllowSearch], [Tag], [IsEncrypted]
	FROM MetaField WHERE  [Name] = @Name	AND SystemMetaClassId = 0
END
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaFieldDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaFieldDelete]
@MetaFieldId AS Int
AS
BEGIN
SET NOCOUNT ON;

DELETE FROM [mcmd_MetaField]
WHERE
[MetaFieldId] = @MetaFieldId

END
GO
PRINT N'Creating [dbo].[ecf_PaymentMethod_PaymentMethodId]...';


GO
CREATE PROCEDURE [dbo].[ecf_PaymentMethod_PaymentMethodId]
	@PaymentMethodId uniqueidentifier,
	@ReturnInactive bit = 0
AS
BEGIN
	select * from [PaymentMethod] 
		where [PaymentMethodId] = @PaymentMethodId and 
			(([IsActive] = 1) or @ReturnInactive = 1)

	if @@rowcount > 0 begin
		select * from [PaymentMethodParameter] 
			where [PaymentMethodId] = @PaymentMethodId

		select * from [ShippingPaymentRestriction] 
			where [PaymentMethodId] = @PaymentMethodId and [RestrictShippingMethods] = 1
	end
	else begin
		-- select nothing
		select * from [PaymentMethodParameter] where 1=0
		select * from [ShippingPaymentRestriction] where 1=0
	end
		select MPM.* from [MarketPaymentMethods] MPM  
		inner join [PaymentMethod] PM on MPM.[PaymentMethodId] = PM.[PaymentMethodId] 
		where ((PM.[IsActive] = 1) or @ReturnInactive = 1) and 
		MPM.[PaymentMethodId] = @PaymentMethodId
END
GO
PRINT N'Creating [dbo].[aspnet_Membership_GetPasswordWithFormat]...';


GO
CREATE PROCEDURE dbo.aspnet_Membership_GetPasswordWithFormat
    @ApplicationName                nvarchar(256),
    @UserName                       nvarchar(256),
    @UpdateLastLoginActivityDate    bit,
    @CurrentTimeUtc                 datetime
AS
BEGIN
    DECLARE @IsLockedOut                        bit
    DECLARE @UserId                             uniqueidentifier
    DECLARE @Password                           nvarchar(128)
    DECLARE @PasswordSalt                       nvarchar(128)
    DECLARE @PasswordFormat                     int
    DECLARE @FailedPasswordAttemptCount         int
    DECLARE @FailedPasswordAnswerAttemptCount   int
    DECLARE @IsApproved                         bit
    DECLARE @LastActivityDate                   datetime
    DECLARE @LastLoginDate                      datetime

    SELECT  @UserId          = NULL

    SELECT  @UserId = u.UserId, @IsLockedOut = m.IsLockedOut, @Password=Password, @PasswordFormat=PasswordFormat,
            @PasswordSalt=PasswordSalt, @FailedPasswordAttemptCount=FailedPasswordAttemptCount,
		    @FailedPasswordAnswerAttemptCount=FailedPasswordAnswerAttemptCount, @IsApproved=IsApproved,
            @LastActivityDate = LastActivityDate, @LastLoginDate = LastLoginDate
    FROM    dbo.aspnet_Applications a, dbo.aspnet_Users u, dbo.aspnet_Membership m
    WHERE   LOWER(@ApplicationName) = a.LoweredApplicationName AND
            u.ApplicationId = a.ApplicationId    AND
            u.UserId = m.UserId AND
            LOWER(@UserName) = u.LoweredUserName

    IF (@UserId IS NULL)
        RETURN 1

    IF (@IsLockedOut = 1)
        RETURN 99

    SELECT   @Password, @PasswordFormat, @PasswordSalt, @FailedPasswordAttemptCount,
             @FailedPasswordAnswerAttemptCount, @IsApproved, @LastLoginDate, @LastActivityDate

    IF (@UpdateLastLoginActivityDate = 1 AND @IsApproved = 1)
    BEGIN
        UPDATE  dbo.aspnet_Membership
        SET     LastLoginDate = @CurrentTimeUtc
        WHERE   UserId = @UserId

        UPDATE  dbo.aspnet_Users
        SET     LastActivityDate = @CurrentTimeUtc
        WHERE   @UserId = UserId
    END


    RETURN 0
END
GO
PRINT N'Creating [dbo].[ecf_Catalog_GetAllChildEntries]...';


GO

create procedure dbo.ecf_Catalog_GetAllChildEntries
	@catalogIds udttCatalogList readonly
as
begin
	select distinct ce.CatalogEntryId, ce.Code
	from CatalogEntry ce
	join NodeEntryRelation ner on ce.CatalogEntryId = ner.CatalogEntryId
	where ner.CatalogNodeId in (
		select CatalogNodeId
		from CatalogNode
		where CatalogId in (select CatalogId from @catalogIds)
		union
		select ChildNodeId
		from CatalogNodeRelation
		where CatalogId in (select CatalogId from @catalogIds)
	)
end
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaField]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaField]
	@MetaFieldId	INT
AS
BEGIN
	SELECT [MetaFieldId] , [Namespace], [Name], [FriendlyName], [Description], [SystemMetaClassId], [DataTypeId],[Length],[AllowNulls],[MultiLanguageValue], [AllowSearch], [Tag], [IsEncrypted]
	FROM MetaField WHERE MetaFieldId = @MetaFieldId
END
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaFieldUpdate]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaFieldUpdate]
@MetaClassId AS Int,
@Name AS NVarChar(4000),
@FriendlyName AS NVarChar(4000),
@TypeName AS NVarChar(4000),
@Nullable AS Bit,
@DefaultValue AS NText,
@ReadOnly AS Bit,
@XSDataSource AS NText,
@XSAttributes AS NText,
@Owner AS NVarChar(4000),
@AccessLevel AS Int,
@MetaFieldId AS Int
AS
BEGIN
SET NOCOUNT ON;

UPDATE [mcmd_MetaField] SET
[MetaClassId] = @MetaClassId,
[Name] = @Name,
[FriendlyName] = @FriendlyName,
[TypeName] = @TypeName,
[Nullable] = @Nullable,
[DefaultValue] = @DefaultValue,
[ReadOnly] = @ReadOnly,
[XSDataSource] = @XSDataSource,
[XSAttributes] = @XSAttributes,
[Owner] = @Owner,
[AccessLevel] = @AccessLevel WHERE
[MetaFieldId] = @MetaFieldId

END
GO
PRINT N'Creating [dbo].[ecf_PaymentMethod_Market]...';


GO
CREATE PROCEDURE [dbo].[ecf_PaymentMethod_Market]
	@MarketId nvarchar(8),
	@LanguageId nvarchar(128),
	@ReturnInactive bit = 0
AS
BEGIN
	select PM.* from [PaymentMethod] PM
	inner join [MarketPaymentMethods] PMM on PMM.[PaymentMethodId] = PM.[PaymentMethodId]
		where COALESCE(@MarketId, PMM.[MarketId]) = PMM.[MarketId] and
		COALESCE(@LanguageId, PM.[LanguageId]) = PM.[LanguageId] and
		((PM.[IsActive] = 1) or @ReturnInactive = 1)

	select PMP.* from [PaymentMethodParameter] PMP
	inner join [PaymentMethod] PM on PMP.[PaymentMethodId] = PM.[PaymentMethodId] 
	inner join [MarketPaymentMethods] PMM on PMM.[PaymentMethodId] = PM.[PaymentMethodId] 
		where COALESCE(@MarketId, PMM.[MarketId]) = PMM.[MarketId] and 
		COALESCE(@LanguageId, PM.[LanguageId]) = PM.[LanguageId] and
		((PM.[IsActive] = 1) or @ReturnInactive = 1)

	select SPR.* from [ShippingPaymentRestriction] SPR  
	inner join [PaymentMethod] PM on SPR.[PaymentMethodId] = PM.[PaymentMethodId] 
	inner join [MarketPaymentMethods] PMM on PMM.[PaymentMethodId] = PM.[PaymentMethodId]
		where COALESCE(@MarketId, PMM.[MarketId]) = PMM.[MarketId] and
		COALESCE(@LanguageId, PM.[LanguageId]) = PM.[LanguageId] and 
		((PM.[IsActive] = 1) or @ReturnInactive = 1) and
		SPR.[RestrictShippingMethods]=0

	select MPM.* from [MarketPaymentMethods] MPM  
	inner join [PaymentMethod] PM on MPM.[PaymentMethodId] = PM.[PaymentMethodId] 
		where COALESCE(@LanguageId, PM.[LanguageId]) = [LanguageId] and 
		MPM.[MarketId] = @MarketId and
		((PM.[IsActive] = 1) or @ReturnInactive = 1)

END
GO
PRINT N'Creating [dbo].[aspnet_Membership_GetUserByEmail]...';


GO
CREATE PROCEDURE dbo.aspnet_Membership_GetUserByEmail
    @ApplicationName  nvarchar(256),
    @Email            nvarchar(256)
AS
BEGIN
    IF( @Email IS NULL )
        SELECT  u.UserName
        FROM    dbo.aspnet_Applications a, dbo.aspnet_Users u, dbo.aspnet_Membership m
        WHERE   LOWER(@ApplicationName) = a.LoweredApplicationName AND
                u.ApplicationId = a.ApplicationId    AND
                u.UserId = m.UserId AND
                m.LoweredEmail IS NULL
    ELSE
        SELECT  u.UserName
        FROM    dbo.aspnet_Applications a, dbo.aspnet_Users u, dbo.aspnet_Membership m
        WHERE   LOWER(@ApplicationName) = a.LoweredApplicationName AND
                u.ApplicationId = a.ApplicationId    AND
                u.UserId = m.UserId AND
                LOWER(@Email) = m.LoweredEmail

    IF (@@rowcount = 0)
        RETURN(1)
    RETURN(0)
END
GO
PRINT N'Creating [dbo].[ecf_Catalog]...';


GO
CREATE PROCEDURE [dbo].[ecf_Catalog]
	@CatalogId int = null,
	@ReturnInactive bit = 0
AS
BEGIN
	
	SELECT DISTINCT C.* from [Catalog] C
		LEFT OUTER JOIN SiteCatalog SC ON SC.CatalogId = C.CatalogId
	WHERE
		(
			(C.CatalogId = COALESCE(@CatalogId,C.CatalogId) or (@CatalogId is null and C.CatalogId is null))
		) and 
		(C.IsActive = 1 or @ReturnInactive = 1)

	SELECT DISTINCT L.* from [CatalogLanguage] L
		LEFT OUTER JOIN [Catalog] C ON C.CatalogId = L.CatalogId
		LEFT OUTER JOIN SiteCatalog SC ON SC.CatalogId = C.CatalogId
	WHERE
		(
			(C.CatalogId = COALESCE(@CatalogId,C.CatalogId) or (@CatalogId is null and C.CatalogId is null))
		) and 
		(C.IsActive = 1 or @ReturnInactive = 1)

	SELECT DISTINCT SC.* from SiteCatalog SC
		INNER JOIN [Catalog] C ON SC.CatalogId = C.CatalogId
	WHERE
		(
			(C.CatalogId = COALESCE(@CatalogId,C.CatalogId) or (@CatalogId is null and C.CatalogId is null))
		) and 
		(C.IsActive = 1 or @ReturnInactive = 1)
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaDictionary]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaDictionary]
	@MetaFieldId	INT,
	@Language	NVARCHAR(20)=NULL
AS
	DECLARE @MultiLanguageValue BIT

	SELECT @MultiLanguageValue = MultiLanguageValue FROM MetaField
	WHERE MetaFieldId = @MetaFieldId

	IF @Language IS NOT NULL AND @MultiLanguageValue = 1
	BEGIN
		SELECT MD.MetaDictionaryId, MD.MetaFieldId, MD.[Value] as DefaultValue,  MDL.Value  as Value, MDL.Tag as Tag
		FROM MetaDictionary MD
			LEFT JOIN MetaDictionaryLocalization MDL ON MDL.MetaDictionaryId = MD.MetaDictionaryId
		WHERE MD.MetaFieldId = @MetaFieldId AND MDL.Language = @Language
	END
	ELSE
	BEGIN
		SELECT MetaDictionaryId, MetaFieldId, [Value] as DefaultValue, Tag as DefaultTag, [Value] as Value, Tag as Tag
		FROM MetaDictionary
		WHERE MetaFieldId = @MetaFieldId
	END
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaFieldInsert]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaFieldInsert]
@MetaClassId AS Int,
@Name AS NVarChar(4000),
@FriendlyName AS NVarChar(4000),
@TypeName AS NVarChar(4000),
@Nullable AS Bit,
@DefaultValue AS NText,
@ReadOnly AS Bit,
@XSDataSource AS NText,
@XSAttributes AS NText,
@Owner AS NVarChar(4000),
@AccessLevel AS Int,
@MetaFieldId AS Int = NULL OUTPUT
AS
BEGIN
SET NOCOUNT ON;

INSERT INTO [mcmd_MetaField]
(
[MetaClassId],
[Name],
[FriendlyName],
[TypeName],
[Nullable],
[DefaultValue],
[ReadOnly],
[XSDataSource],
[XSAttributes],
[Owner],
[AccessLevel])
VALUES(
@MetaClassId,
@Name,
@FriendlyName,
@TypeName,
@Nullable,
@DefaultValue,
@ReadOnly,
@XSDataSource,
@XSAttributes,
@Owner,
@AccessLevel)
SELECT @MetaFieldId = SCOPE_IDENTITY();

END
GO
PRINT N'Creating [dbo].[ecf_PaymentMethod_Language]...';


GO
CREATE PROCEDURE [dbo].[ecf_PaymentMethod_Language]
	@LanguageId nvarchar(128),
	@ReturnInactive bit = 0
AS
BEGIN
	select * from [PaymentMethod] 
	where COALESCE(@LanguageId, [LanguageId]) = [LanguageId] and 
		(([IsActive] = 1) or @ReturnInactive = 1) order by [Ordering]

	select PMP.* from [PaymentMethodParameter] PMP 
	inner join [PaymentMethod] PM on PMP.[PaymentMethodId] = PM.[PaymentMethodId] 
		where COALESCE(@LanguageId, PM.[LanguageId]) = [LanguageId] and 
		((PM.[IsActive] = 1) or @ReturnInactive = 1)

	select SPR.* from [ShippingPaymentRestriction] SPR  
	inner join [PaymentMethod] PM on SPR.[PaymentMethodId] = PM.[PaymentMethodId] 
		where COALESCE(@LanguageId, PM.[LanguageId]) = [LanguageId] and 
		((PM.[IsActive] = 1) or @ReturnInactive = 1) and 
		SPR.[RestrictShippingMethods]=0
			
	select MPM.* from [MarketPaymentMethods] MPM  
	inner join [PaymentMethod] PM on MPM.[PaymentMethodId] = PM.[PaymentMethodId] 
		where COALESCE(@LanguageId, PM.[LanguageId]) = [LanguageId] and 
		((PM.[IsActive] = 1) or @ReturnInactive = 1)
END
GO
PRINT N'Creating [dbo].[aspnet_Membership_GetUserByUserId]...';


GO
CREATE PROCEDURE dbo.aspnet_Membership_GetUserByUserId
    @UserId               uniqueidentifier,
    @CurrentTimeUtc       datetime,
    @UpdateLastActivity   bit = 0
AS
BEGIN
    IF ( @UpdateLastActivity = 1 )
    BEGIN
        UPDATE   dbo.aspnet_Users
        SET      LastActivityDate = @CurrentTimeUtc
        FROM     dbo.aspnet_Users
        WHERE    @UserId = UserId

        IF ( @@ROWCOUNT = 0 ) -- User ID not found
            RETURN -1
    END

    SELECT  m.Email, m.PasswordQuestion, m.Comment, m.IsApproved,
            m.CreateDate, m.LastLoginDate, u.LastActivityDate,
            m.LastPasswordChangedDate, u.UserName, m.IsLockedOut,
            m.LastLockoutDate
    FROM    dbo.aspnet_Users u, dbo.aspnet_Membership m
    WHERE   @UserId = u.UserId AND u.UserId = m.UserId

    IF ( @@ROWCOUNT = 0 ) -- User ID not found
       RETURN -1

    RETURN 0
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaClassListByMetaField]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaClassListByMetaField]
	@MetaFieldId	INT
AS
	SELECT MC.MetaClassId, MC.Namespace, MC.Name, MC.FriendlyName, MC.IsSystem,  MC.IsAbstract, MC.ParentClassId, MC.TableName, MC.Description, MC.FieldListChangedSqlScript, MC.Tag
	FROM MetaClass MC
	INNER JOIN MetaClassMetaFieldRelation MCFR ON MCFR.MetaClassId = MC.MetaClassId
	WHERE MCFR.MetaFieldId = @MetaFieldId
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaEnumSelect]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaEnumSelect]
@MetaEnumId AS Int
AS
BEGIN
SET NOCOUNT ON;

SELECT [t01].[MetaEnumId] AS [MetaEnumId], [t01].[Id] AS [Id], [t01].[TypeName] AS [TypeName], [t01].[FriendlyName] AS [FriendlyName], [t01].[OrderId] AS [OrderId], [t01].[Owner] AS [Owner], [t01].[AccessLevel] AS [AccessLevel]
FROM [mcmd_MetaEnum] AS [t01]
WHERE ([t01].[MetaEnumId]=@MetaEnumId)

END
GO
PRINT N'Creating [dbo].[ecf_OrderSearch]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderSearch]
(
	@SQLClause 					nvarchar(max),
	@MetaSQLClause 				nvarchar(max),
	@OrderBy 					nvarchar(max),
	@Namespace					nvarchar(1024) = N'',
	@Classes					nvarchar(max) = N'',
	@StartingRec 				int,
	@NumRecords   				int,
	@RecordCount                int OUTPUT,
	@ReturnTotalCount			bit = 1
)
AS
BEGIN
	SET NOCOUNT ON

	DECLARE @query_tmp nvarchar(max)
	DECLARE @FilterQuery_tmp nvarchar(max)
	DECLARE @TableName_tmp sysname
	DECLARE @SelectMetaQuery_tmp nvarchar(max)
	DECLARE @FromQuery_tmp nvarchar(max)
	DECLARE @FullQuery nvarchar(max)
	DECLARE @SelectQuery nvarchar(max)
	DECLARE @CountQuery nvarchar(max)

	-- 1. Cycle through all the available product meta classes
	--print 'Iterating through meta classes'
	DECLARE MetaClassCursor CURSOR READ_ONLY
	FOR SELECT TableName FROM MetaClass 
		WHERE Namespace like @Namespace + '%' AND ([Name] in (select Item from ecf_splitlist(@Classes)) or @Classes = '')
		and IsSystem = 0

	OPEN MetaClassCursor
	FETCH NEXT FROM MetaClassCursor INTO @TableName_tmp
	WHILE (@@fetch_status = 0)
	BEGIN 
		--print 'Metaclass Table: ' + @TableName_tmp
		set @Query_tmp = 'select META.ObjectId as ''Key'' from ' + @TableName_tmp + ' META'
		
		-- Add meta Where clause
		if(LEN(@MetaSQLClause)>0)
			set @query_tmp = @query_tmp + ' WHERE ' + @MetaSQLClause

		if(@SelectMetaQuery_tmp is null)
			set @SelectMetaQuery_tmp = @Query_tmp;
		else
			set @SelectMetaQuery_tmp = @SelectMetaQuery_tmp + N' UNION ALL ' + @Query_tmp;

	FETCH NEXT FROM MetaClassCursor INTO @TableName_tmp
	END
	CLOSE MetaClassCursor
	DEALLOCATE MetaClassCursor

	-- Create from command
	SET @FromQuery_tmp = N' INNER JOIN (select distinct U.[Key] from (' + @SelectMetaQuery_tmp + N') U) META ON OrderGroup.[OrderGroupId] = META.[Key] '

	set @FilterQuery_tmp = N' WHERE 1=1'
	-- add sql clause statement here, if specified
	if(Len(@SQLClause) != 0)
		set @FilterQuery_tmp = @FilterQuery_tmp + N' AND (' + @SqlClause + ')'
		
	if(Len(@OrderBy) = 0)
	begin
		set @OrderBy = ' OrderGroupId DESC'
	end

	set @SelectQuery = N'SELECT OrderGroupId'  + 
		' FROM dbo.OrderGroup OrderGroup ' + @FromQuery_tmp + @FilterQuery_tmp + ' ORDER BY ' + @OrderBy +
		' OFFSET '  + cast(@StartingRec as nvarchar(50)) + '  ROWS ' +
		' FETCH NEXT ' + cast(@NumRecords as nvarchar(50)) + ' ROWS ONLY ;';
	set @CountQuery= N'SET @RecordCount= (SELECT Count(1) FROM dbo.OrderGroup OrderGroup ' + @FromQuery_tmp + @FilterQuery_tmp +');';

	IF (@NumRecords = 0)
	BEGIN
		set @FullQuery =  @CountQuery
	END
	ELSE IF (@ReturnTotalCount = 1)
	BEGIN
		set @FullQuery =  @CountQuery+ @SelectQuery;
	END
	ELSE
	BEGIN
		set @FullQuery =  @SelectQuery;
	END

	--print @FullQuery
	exec sp_executesql @FullQuery, N'@RecordCount int output', @RecordCount = @RecordCount OUTPUT

	SET NOCOUNT OFF
END
GO
PRINT N'Creating [dbo].[aspnet_Membership_GetUserByName]...';


GO
CREATE PROCEDURE dbo.aspnet_Membership_GetUserByName
    @ApplicationName      nvarchar(256),
    @UserName             nvarchar(256),
    @CurrentTimeUtc       datetime,
    @UpdateLastActivity   bit = 0
AS
BEGIN
    DECLARE @UserId uniqueidentifier

    IF (@UpdateLastActivity = 1)
    BEGIN
        -- select user ID from aspnet_users table
        SELECT TOP 1 @UserId = u.UserId
        FROM    dbo.aspnet_Applications a, dbo.aspnet_Users u, dbo.aspnet_Membership m
        WHERE    LOWER(@ApplicationName) = a.LoweredApplicationName AND
                u.ApplicationId = a.ApplicationId    AND
                LOWER(@UserName) = u.LoweredUserName AND u.UserId = m.UserId

        IF (@@ROWCOUNT = 0) -- Username not found
            RETURN -1

        UPDATE   dbo.aspnet_Users
        SET      LastActivityDate = @CurrentTimeUtc
        WHERE    @UserId = UserId

        SELECT m.Email, m.PasswordQuestion, m.Comment, m.IsApproved,
                m.CreateDate, m.LastLoginDate, u.LastActivityDate, m.LastPasswordChangedDate,
                u.UserId, m.IsLockedOut, m.LastLockoutDate
        FROM    dbo.aspnet_Applications a, dbo.aspnet_Users u, dbo.aspnet_Membership m
        WHERE  @UserId = u.UserId AND u.UserId = m.UserId 
    END
    ELSE
    BEGIN
        SELECT TOP 1 m.Email, m.PasswordQuestion, m.Comment, m.IsApproved,
                m.CreateDate, m.LastLoginDate, u.LastActivityDate, m.LastPasswordChangedDate,
                u.UserId, m.IsLockedOut,m.LastLockoutDate
        FROM    dbo.aspnet_Applications a, dbo.aspnet_Users u, dbo.aspnet_Membership m
        WHERE    LOWER(@ApplicationName) = a.LoweredApplicationName AND
                u.ApplicationId = a.ApplicationId    AND
                LOWER(@UserName) = u.LoweredUserName AND u.UserId = m.UserId

        IF (@@ROWCOUNT = 0) -- Username not found
            RETURN -1
    END

    RETURN 0
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaClassList]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaClassList]
AS

SELECT C.MetaClassId, C.Namespace, C.[Name], C.FriendlyName, C.IsSystem, C.IsAbstract, C.ParentClassId, C.TableName, C.[Description], C.FieldListChangedSqlScript, C.Tag,
	P.[Name] AS ParentName, P.TableName AS ParentTableName, P.FriendlyName AS ParentFriendlyName
  FROM MetaClass C
	LEFT JOIN MetaClass P ON (C.ParentClassId = P.MetaClassId)
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaEnumDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaEnumDelete]
@MetaEnumId AS Int
AS
BEGIN
SET NOCOUNT ON;

DELETE FROM [mcmd_MetaEnum]
WHERE
[MetaEnumId] = @MetaEnumId

END
GO
PRINT N'Creating [dbo].[ecf_OrderGroupAddress_Update]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderGroupAddress_Update]
(
	@OrderGroupAddressId int,
	@OrderGroupId int,
	@Name nvarchar(64) = NULL,
	@FirstName nvarchar(64) = NULL,
	@LastName nvarchar(64) = NULL,
	@Organization nvarchar(64) = NULL,
	@Line1 nvarchar(80) = NULL,
	@Line2 nvarchar(80) = NULL,
	@City nvarchar(64) = NULL,
	@State nvarchar(64) = NULL,
	@CountryCode nvarchar(50) = NULL,
	@CountryName nvarchar(50) = NULL,
	@PostalCode nvarchar(20) = NULL,
	@RegionCode nvarchar(50) = NULL,
	@RegionName nvarchar(64) = NULL,
	@DaytimePhoneNumber nvarchar(32) = NULL,
	@EveningPhoneNumber nvarchar(32) = NULL,
	@FaxNumber nvarchar(32) = NULL,
	@Email nvarchar(64) = NULL
)
AS
	SET NOCOUNT ON
	
	UPDATE [OrderGroupAddress]
	SET
		[OrderGroupId] = @OrderGroupId,
		[Name] = @Name,
		[FirstName] = @FirstName,
		[LastName] = @LastName,
		[Organization] = @Organization,
		[Line1] = @Line1,
		[Line2] = @Line2,
		[City] = @City,
		[State] = @State,
		[CountryCode] = @CountryCode,
		[CountryName] = @CountryName,
		[PostalCode] = @PostalCode,
		[RegionCode] = @RegionCode,
		[RegionName] = @RegionName,
		[DaytimePhoneNumber] = @DaytimePhoneNumber,
		[EveningPhoneNumber] = @EveningPhoneNumber,
		[FaxNumber] = @FaxNumber,
		[Email] = @Email
	WHERE 
		[OrderGroupAddressId] = @OrderGroupAddressId

	RETURN @@Error
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaClassByNamespace]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaClassByNamespace]
	@Namespace		NVARCHAR(1024),
	@Deep			BIT
AS
	IF @Deep = 1
		SELECT MetaClassId, Namespace, Name, FriendlyName, IsSystem, IsAbstract, ParentClassId, TableName, Description, FieldListChangedSqlScript, Tag
		FROM MetaClass WHERE  Namespace = @Namespace OR Namespace LIKE (@Namespace + '.%')
	ELSE
		SELECT MetaClassId, Namespace, Name, FriendlyName, IsSystem, IsAbstract, ParentClassId, TableName, Description, FieldListChangedSqlScript, Tag
		FROM MetaClass WHERE Namespace = @Namespace
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaEnumUpdate]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaEnumUpdate]
@Id AS Int,
@TypeName AS NVarChar(4000),
@FriendlyName AS NVarChar(4000),
@OrderId AS Int,
@Owner AS NVarChar(4000),
@AccessLevel AS Int,
@MetaEnumId AS Int
AS
BEGIN
SET NOCOUNT ON;

UPDATE [mcmd_MetaEnum] SET
[Id] = @Id,
[TypeName] = @TypeName,
[FriendlyName] = @FriendlyName,
[OrderId] = @OrderId,
[Owner] = @Owner,
[AccessLevel] = @AccessLevel WHERE
[MetaEnumId] = @MetaEnumId

END
GO
PRINT N'Creating [dbo].[ecf_OrderGroupAddress_Insert]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderGroupAddress_Insert]
(
	@OrderGroupAddressId int = NULL OUTPUT,
	@OrderGroupId int,
	@Name nvarchar(64) = NULL,
	@FirstName nvarchar(64) = NULL,
	@LastName nvarchar(64) = NULL,
	@Organization nvarchar(64) = NULL,
	@Line1 nvarchar(80) = NULL,
	@Line2 nvarchar(80) = NULL,
	@City nvarchar(64) = NULL,
	@State nvarchar(64) = NULL,
	@CountryCode nvarchar(50) = NULL,
	@CountryName nvarchar(50) = NULL,
	@PostalCode nvarchar(20) = NULL,
	@RegionCode nvarchar(50) = NULL,
	@RegionName nvarchar(64) = NULL,
	@DaytimePhoneNumber nvarchar(32) = NULL,
	@EveningPhoneNumber nvarchar(32) = NULL,
	@FaxNumber nvarchar(32) = NULL,
	@Email nvarchar(64) = NULL
)
AS
	SET NOCOUNT ON

	INSERT INTO [OrderGroupAddress]
	(
		[OrderGroupId],
		[Name],
		[FirstName],
		[LastName],
		[Organization],
		[Line1],
		[Line2],
		[City],
		[State],
		[CountryCode],
		[CountryName],
		[PostalCode],
		[RegionCode],
		[RegionName],
		[DaytimePhoneNumber],
		[EveningPhoneNumber],
		[FaxNumber],
		[Email]
	)
	VALUES
	(
		@OrderGroupId,
		@Name,
		@FirstName,
		@LastName,
		@Organization,
		@Line1,
		@Line2,
		@City,
		@State,
		@CountryCode,
		@CountryName,
		@PostalCode,
		@RegionCode,
		@RegionName,
		@DaytimePhoneNumber,
		@EveningPhoneNumber,
		@FaxNumber,
		@Email
	)

	SELECT @OrderGroupAddressId = SCOPE_IDENTITY()

	RETURN @@Error
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaClassByName]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaClassByName]
	@Name		NVARCHAR(256)
AS
	SELECT MetaClassId, Namespace, Name, FriendlyName, IsSystem, IsAbstract,ParentClassId, TableName, Description, FieldListChangedSqlScript, Tag
	FROM MetaClass WHERE Name = @Name
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaEnumInsert]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaEnumInsert]
@Id AS Int,
@TypeName AS NVarChar(4000),
@FriendlyName AS NVarChar(4000),
@OrderId AS Int,
@Owner AS NVarChar(4000),
@AccessLevel AS Int,
@MetaEnumId AS Int = NULL OUTPUT
AS
BEGIN
SET NOCOUNT ON;

INSERT INTO [mcmd_MetaEnum]
(
[Id],
[TypeName],
[FriendlyName],
[OrderId],
[Owner],
[AccessLevel])
VALUES(
@Id,
@TypeName,
@FriendlyName,
@OrderId,
@Owner,
@AccessLevel)
SELECT @MetaEnumId = SCOPE_IDENTITY();

END
GO
PRINT N'Creating [dbo].[ecf_OrderGroupAddress_Delete]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderGroupAddress_Delete]
(
	@OrderGroupAddressId int
)
AS
	SET NOCOUNT ON

	EXEC [dbo].[mdpsp_avto_OrderGroupAddressEx_Delete] @OrderGroupAddressId
	DELETE FROM [OrderGroupAddress] WHERE [OrderGroupAddressId] = @OrderGroupAddressId

	RETURN @@Error
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaClassById]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaClassById]
	@MetaClassId	INT
AS
	SELECT MetaClassId, Namespace, Name, FriendlyName, IsSystem, IsAbstract, ParentClassId, TableName, Description, FieldListChangedSqlScript, Tag
	FROM MetaClass WHERE MetaClassId = @MetaClassId
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaClassInsert]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaClassInsert]
@Name AS NVarChar(4000),
@FriendlyName AS NVarChar(4000),
@PluralName AS NVarChar(4000),
@TitleFieldName AS NVarChar(4000),
@XSValidators AS NText,
@XSAttributes AS NText,
@XSExtensions AS NText,
@Owner AS NVarChar(4000),
@AccessLevel AS Int,
@XSModules AS NText,
@MetaClassId AS Int = NULL OUTPUT
AS
BEGIN
SET NOCOUNT ON;

INSERT INTO [mcmd_MetaClass]
(
[Name],
[FriendlyName],
[PluralName],
[TitleFieldName],
[XSValidators],
[XSAttributes],
[XSExtensions],
[Owner],
[AccessLevel],
[XSModules])
VALUES(
@Name,
@FriendlyName,
@PluralName,
@TitleFieldName,
@XSValidators,
@XSAttributes,
@XSExtensions,
@Owner,
@AccessLevel,
@XSModules)
SELECT @MetaClassId = SCOPE_IDENTITY();

END
GO
PRINT N'Creating [dbo].[ecf_OrderGroup_Update]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderGroup_Update]
(
	@OrderGroupId int OUT,
	@InstanceId uniqueidentifier,
	@AffiliateId uniqueidentifier,
	@Name nvarchar(64) = NULL,
	@CustomerId uniqueidentifier,
	@CustomerName nvarchar(64) = NULL,
	@AddressId nvarchar(50) = NULL,
	@ShippingTotal DECIMAL (38, 9),
	@HandlingTotal DECIMAL (38, 9),
	@TaxTotal DECIMAL (38, 9),
	@SubTotal DECIMAL (38, 9),
	@Total DECIMAL (38, 9),
	@BillingCurrency nvarchar(64) = NULL,
	@Status nvarchar(64) = NULL,
	@ProviderId nvarchar(255) = NULL,
	@SiteId nvarchar(255) = NULL,
	@OwnerOrg nvarchar(255) = NULL,
	@Owner nvarchar(255) = NULL,
	@MarketId nvarchar(8),
	@Epi_MarketName nvarchar(50),
	@Epi_PricesIncludeTax bit = 0
)
AS
BEGIN

	SET NOCOUNT OFF
	DECLARE @Err int

		UPDATE [OrderGroup]
		SET
			[InstanceId] = @InstanceId,
			[AffiliateId] = @AffiliateId,
			[Name] = @Name,
			[CustomerId] = @CustomerId,
			[CustomerName] = @CustomerName,
			[AddressId] = @AddressId,
			[ShippingTotal] = @ShippingTotal,
			[HandlingTotal] = @HandlingTotal,
			[TaxTotal] = @TaxTotal,
			[SubTotal] = @SubTotal,
			[Total] = @Total,
			[BillingCurrency] = @BillingCurrency,
			[Status] = @Status,
			[ProviderId] = @ProviderId,
			[SiteId] = @SiteId,
			[OwnerOrg] = @OwnerOrg,
			[Owner] = @Owner,
			[MarketId] = @MarketId,
			[Epi_MarketName] = @Epi_MarketName,
			[Epi_PricesIncludeTax] = @Epi_PricesIncludeTax
		WHERE
			[OrderGroupId] = @OrderGroupId

	SET @Err = @@Error

	RETURN @Err
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadMetaAttributes]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadMetaAttributes]
	@AttrOwnerId		INT,
	@AttrOwnerType	INT
AS
	SELECT [Key], [Value] FROM MetaAttribute WHERE AttrOwnerId = @AttrOwnerId AND AttrOwnerType = @AttrOwnerType
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaClassUpdate]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaClassUpdate]
@Name AS NVarChar(4000),
@FriendlyName AS NVarChar(4000),
@PluralName AS NVarChar(4000),
@TitleFieldName AS NVarChar(4000),
@XSValidators AS NText,
@XSAttributes AS NText,
@XSExtensions AS NText,
@Owner AS NVarChar(4000),
@AccessLevel AS Int,
@XSModules AS NText,
@MetaClassId AS Int
AS
BEGIN
SET NOCOUNT ON;

UPDATE [mcmd_MetaClass] SET
[Name] = @Name,
[FriendlyName] = @FriendlyName,
[PluralName] = @PluralName,
[TitleFieldName] = @TitleFieldName,
[XSValidators] = @XSValidators,
[XSAttributes] = @XSAttributes,
[XSExtensions] = @XSExtensions,
[Owner] = @Owner,
[AccessLevel] = @AccessLevel,
[XSModules] = @XSModules WHERE
[MetaClassId] = @MetaClassId

END
GO
PRINT N'Creating [dbo].[ecf_OrderGroup_Insert]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderGroup_Insert]
(
	@OrderGroupId int OUT,
	@InstanceId uniqueidentifier,
	@AffiliateId uniqueidentifier,
	@Name nvarchar(64) = NULL,
	@CustomerId uniqueidentifier,
	@CustomerName nvarchar(64) = NULL,
	@AddressId nvarchar(50) = NULL,
	@ShippingTotal DECIMAL (38, 9),
	@HandlingTotal DECIMAL (38, 9),
	@TaxTotal DECIMAL (38, 9),
	@SubTotal DECIMAL (38, 9),
	@Total DECIMAL (38, 9),
	@BillingCurrency nvarchar(64) = NULL,
	@Status nvarchar(64) = NULL,
	@ProviderId nvarchar(255) = NULL,
	@SiteId nvarchar(255) = NULL,
	@OwnerOrg nvarchar(255) = NULL,
	@Owner nvarchar(255) = NULL,
	@MarketId nvarchar(8),
	@Epi_MarketName nvarchar(50),
	@Epi_PricesIncludeTax bit = 0
)
AS
BEGIN

	SET NOCOUNT OFF
	DECLARE @Err int

	if(@OrderGroupId is null)
	begin
		INSERT
		INTO [OrderGroup]
		(
			[InstanceId],
			[AffiliateId],
			[Name],
			[CustomerId],
			[CustomerName],
			[AddressId],
			[ShippingTotal],
			[HandlingTotal],
			[TaxTotal],
			[SubTotal],
			[Total],
			[BillingCurrency],
			[Status],
			[ProviderId],
			[SiteId],
			[OwnerOrg],
			[Owner],
			[MarketId],
			[Epi_MarketName],
			[Epi_PricesIncludeTax]
		)
		VALUES
		(
			@InstanceId,
			@AffiliateId,
			@Name,
			@CustomerId,
			@CustomerName,
			@AddressId,
			@ShippingTotal,
			@HandlingTotal,
			@TaxTotal,
			@SubTotal,
			@Total,
			@BillingCurrency,
			@Status,
			@ProviderId,
			@SiteId,
			@OwnerOrg,
			@Owner,
			@MarketId,
			@Epi_MarketName,
			@Epi_PricesIncludeTax
		)
		SELECT @OrderGroupId = SCOPE_IDENTITY()
	end

	SET @Err = @@Error

	RETURN @Err
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_LoadChildMetaClassList]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_LoadChildMetaClassList]
	@MetaClassId	INT
AS
	SELECT MetaClassId, Namespace,Name, [FriendlyName], IsSystem, IsAbstract, ParentClassId, TableName, Description, FieldListChangedSqlScript, Tag
	FROM MetaClass WHERE ParentClassId = @MetaClassId
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaClassDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaClassDelete]
@MetaClassId AS Int
AS
BEGIN
SET NOCOUNT ON;

DELETE FROM [mcmd_MetaClass]
WHERE
[MetaClassId] = @MetaClassId

END
GO
PRINT N'Creating [dbo].[mdpsp_sys_GetUniqueFieldName]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_GetUniqueFieldName]
	@Name		NVARCHAR(256),
	@UniqueName 	NVARCHAR(256) OUT
AS
	SET NOCOUNT OFF

	DECLARE	@Index		INT

	SET @UniqueName	= @Name
	SET @Index = (SELECT COUNT(*) FROM MetaField WHERE SystemMetaClassId = 0 AND Name LIKE @Name + '[0123456789]%')

	WHILE (SELECT COUNT(*) FROM MetaField WHERE SystemMetaClassId = 0 AND Name=@UniqueName) <> 0
	BEGIN
		SET @UniqueName = @Name + CAST(@Index  AS NVARCHAR(32))
		SET @Index = @Index + 1
	END
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaClassSelect]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaClassSelect]
@MetaClassId AS Int
AS
BEGIN
SET NOCOUNT ON;

SELECT [t01].[MetaClassId] AS [MetaClassId], [t01].[Name] AS [Name], [t01].[FriendlyName] AS [FriendlyName], [t01].[PluralName] AS [PluralName], [t01].[TitleFieldName] AS [TitleFieldName], [t01].[XSValidators] AS [XSValidators], [t01].[XSAttributes] AS [XSAttributes], [t01].[XSExtensions] AS [XSExtensions], [t01].[Owner] AS [Owner], [t01].[AccessLevel] AS [AccessLevel], [t01].[XSModules] AS [XSModules]
FROM [mcmd_MetaClass] AS [t01]
WHERE ([t01].[MetaClassId]=@MetaClassId)

END
GO
PRINT N'Creating [dbo].[ecf_OrderFormPayment_Update]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderFormPayment_Update]
(
	@PaymentId int,
	@OrderFormId int,
	@OrderGroupId int,
	@BillingAddressId nvarchar(64) = NULL,
	@PaymentMethodId uniqueidentifier,
	@PaymentMethodName nvarchar(128) = NULL,
	@CustomerName nvarchar(64) = NULL,
	@Amount DECIMAL (38, 9),
	@PaymentType int,
	@ValidationCode nvarchar(64) = NULL,
	@AuthorizationCode nvarchar(255) = NULL,
	@TransactionType nvarchar(255) = NULL,
	@TransactionID nvarchar(255) = NULL,
	@ProviderTransactionID nvarchar(255) = NULL,
	@Status nvarchar(64) = NULL,
	@ImplementationClass nvarchar(255)
)
AS
	SET NOCOUNT ON
	
	UPDATE [OrderFormPayment]
	SET
		[OrderFormId] = @OrderFormId,
		[OrderGroupId] = @OrderGroupId,
		[BillingAddressId] = @BillingAddressId,
		[PaymentMethodId] = @PaymentMethodId,
		[PaymentMethodName] = @PaymentMethodName,
		[CustomerName] = @CustomerName,
		[Amount] = @Amount,
		[PaymentType] = @PaymentType,
		[ValidationCode] = @ValidationCode,
		[AuthorizationCode] = @AuthorizationCode,
		[TransactionType] = @TransactionType,
		[TransactionID] = @TransactionID,
		[ProviderTransactionID] = @ProviderTransactionID,
		[Status] = @Status,
		[ImplementationClass] = @ImplementationClass
	WHERE 
		[PaymentId] = @PaymentId

	RETURN @@Error
GO
PRINT N'Creating [dbo].[mdpsp_sys_GetMetaKeyInfo]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_GetMetaKeyInfo]
	@MetaKey	INT
AS
	SET NOCOUNT ON
	SELECT * FROM MetaKey WHERE MetaKey = @MetaKey
GO
PRINT N'Creating [dbo].[mc_mcmd_TmpMetaFileSelect]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_TmpMetaFileSelect]
(
@TmpFileId int
)
AS
    SET NOCOUNT ON
SELECT [TmpFileId],
[Created],
[FileUID],
[FileName],
[Body] FROM mcmd_TmpMetaFile
WHERE
[TmpFileId] = @TmpFileId
GO
PRINT N'Creating [dbo].[ecf_OrderFormPayment_Insert]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderFormPayment_Insert]
(
	@PaymentId int = NULL OUTPUT,
	@OrderFormId int,
	@OrderGroupId int,
	@BillingAddressId nvarchar(64) = NULL,
	@PaymentMethodId uniqueidentifier,
	@PaymentMethodName nvarchar(128) = NULL,
	@CustomerName nvarchar(64) = NULL,
	@Amount DECIMAL (38, 9),
	@PaymentType int,
	@ValidationCode nvarchar(64) = NULL,
	@AuthorizationCode nvarchar(255) = NULL,
	@TransactionType nvarchar(255) = NULL,
	@TransactionID nvarchar(255) = NULL,
	@ProviderTransactionID nvarchar(255) = NULL,
	@Status nvarchar(64) = NULL,
	@ImplementationClass nvarchar(255)
)
AS
	SET NOCOUNT ON

	INSERT INTO [OrderFormPayment]
	(
		[OrderFormId],
		[OrderGroupId],
		[BillingAddressId],
		[PaymentMethodId],
		[PaymentMethodName],
		[CustomerName],
		[Amount],
		[PaymentType],
		[ValidationCode],
		[AuthorizationCode],
		[TransactionType],
		[TransactionID],
		[Status],
		[ImplementationClass],
		[ProviderTransactionID]
	)
	VALUES
	(
		@OrderFormId,
		@OrderGroupId,
		@BillingAddressId,
		@PaymentMethodId,
		@PaymentMethodName,
		@CustomerName,
		@Amount,
		@PaymentType,
		@ValidationCode,
		@AuthorizationCode,
		@TransactionType,
		@TransactionID,
		@Status,
		@ImplementationClass,
		@ProviderTransactionID
	)

	SELECT @PaymentId = SCOPE_IDENTITY()

	RETURN @@Error
GO
PRINT N'Creating [dbo].[mdpsp_sys_GetMetaKey]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_GetMetaKey]
	@MetaObjectId	INT,
	@WorkId			INT = NULL,
	@MetaClassId	INT,
	@MetaFieldId	INT,
	@Language NVARCHAR(20) = NULL,
	@Retval	INT	OUT
AS
SET NOCOUNT ON

DECLARE @TableName NVARCHAR(256)
SET @TableName = (SELECT TableName FROM MetaClass WHERE MetaClassId = @MetaClassId)

IF dbo.mdpfn_sys_IsCatalogMetaDataTable(@TableName) = 0
BEGIN
	DECLARE @IsMultiLanguage BIT
	SET @IsMultiLanguage = (SELECT MultiLanguageValue FROM MetaField WHERE MetaFieldId = @MetaFieldId)

	IF @IsMultiLanguage = 0 OR ISNULL(@Language, '') = ''
	BEGIN
		SELECT @Retval = MetaKey FROM MetaKey WHERE MetaObjectId = @MetaObjectId AND MetaClassId = @MetaClassId AND MetaFieldId = @MetaFieldId
		
		IF @Retval IS NULL
		BEGIN
			INSERT INTO MetaKey (MetaObjectId, MetaClassId, MetaFieldId) VALUES (@MetaObjectId, @MetaClassId, @MetaFieldId)
			SET @Retval = SCOPE_IDENTITY()
		END
	END
	ELSE
	BEGIN
		SELECT @Retval = MetaKey FROM MetaKey WHERE MetaObjectId = @MetaObjectId AND MetaClassId = @MetaClassId AND MetaFieldId = @MetaFieldId AND Language=@Language COLLATE DATABASE_DEFAULT
		
		IF @Retval IS NULL
		BEGIN
			INSERT INTO MetaKey (MetaObjectId, MetaClassId, MetaFieldId, Language) VALUES (@MetaObjectId, @MetaClassId, @MetaFieldId, @Language)
			SET @Retval = SCOPE_IDENTITY()
		END
	END
END
ELSE
BEGIN
	IF ISNULL(@Language, '') = ''
	BEGIN
		DECLARE @CatalogId INT
		SET @CatalogId = CASE WHEN @TableName LIKE 'CatalogEntryEx%' THEN
								(SELECT CatalogId FROM CatalogEntry WHERE CatalogEntryId = @MetaObjectId)
								WHEN @TableName LIKE 'CatalogNodeEx%' THEN							
								(SELECT CatalogId FROM CatalogNode WHERE CatalogNodeId = @MetaObjectId)
							END
		SET @Language = (SELECT DefaultLanguage FROM dbo.Catalog WHERE CatalogId = @CatalogId)
	END

	SELECT @Retval = MetaKey FROM MetaKey WHERE MetaObjectId = @MetaObjectId AND MetaClassId = @MetaClassId AND MetaFieldId = @MetaFieldId AND ISNULL(@WorkId,0) = ISNULL(WorkId,0) AND Language = @Language COLLATE DATABASE_DEFAULT
		
	IF @Retval IS NULL
	BEGIN
		INSERT INTO MetaKey (MetaObjectId, WorkId, MetaClassId, MetaFieldId, Language) VALUES (@MetaObjectId, @WorkId, @MetaClassId, @MetaFieldId, @Language)
		SET @Retval = SCOPE_IDENTITY()
	END
END
GO
PRINT N'Creating [dbo].[mc_mcmd_TmpMetaFileInsert]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_TmpMetaFileInsert]
(
@TmpFileId int = NULL OUTPUT,
@FileUID uniqueidentifier,
@FileName nvarchar(510)
)
AS
    SET NOCOUNT ON
INSERT INTO [mcmd_TmpMetaFile]
(
[FileUID],
[FileName])
VALUES(
@FileUID,
@FileName)
SELECT @TmpFileId = SCOPE_IDENTITY();
RETURN @@Error
GO
PRINT N'Creating [dbo].[ecf_OrderFormPayment_Delete]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderFormPayment_Delete]
(
	@PaymentId int
)
AS
	SET NOCOUNT ON

	EXEC [dbo].[mdpsp_avto_OrderFormPayment_CashCard_Delete] @PaymentId
	EXEC [dbo].[mdpsp_avto_OrderFormPayment_CreditCard_Delete] @PaymentId
	EXEC [dbo].[mdpsp_avto_OrderFormPayment_GiftCard_Delete] @PaymentId	
	EXEC [dbo].[mdpsp_avto_OrderFormPayment_Invoice_Delete] @PaymentId
	EXEC [dbo].[mdpsp_avto_OrderFormPayment_Other_Delete] @PaymentId
	DELETE FROM [OrderFormPayment] WHERE [PaymentId] = @PaymentId 

	RETURN @@Error
GO
PRINT N'Creating [dbo].[mc_mcmd_TmpMetaFileDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_TmpMetaFileDelete]
(
@TmpFileId int
)
AS
    SET NOCOUNT ON
DELETE FROM [mcmd_TmpMetaFile]
WHERE
[TmpFileId] = @TmpFileId
RETURN @@Error
GO
PRINT N'Creating [dbo].[ecf_OrderFormDiscount_Update]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderFormDiscount_Update]
(
	@OrderFormDiscountId int,
	@OrderFormId int,
	@DiscountId int,
	@OrderGroupId int,
	@DiscountAmount DECIMAL (38, 9),
	@DiscountCode nvarchar(50) = NULL,
	@DiscountName nvarchar(50) = NULL,
	@DisplayMessage nvarchar(100) = NULL,
	@DiscountValue DECIMAL (38, 9)
)
AS
	SET NOCOUNT ON
	
	UPDATE [OrderFormDiscount]
	SET
		[OrderFormId] = @OrderFormId,
		[DiscountId] = @DiscountId,
		[OrderGroupId] = @OrderGroupId,
		[DiscountAmount] = @DiscountAmount,
		[DiscountCode] = @DiscountCode,
		[DiscountName] = @DiscountName,
		[DisplayMessage] = @DisplayMessage,
		[DiscountValue] = @DiscountValue
	WHERE 
		[OrderFormDiscountId] = @OrderFormDiscountId

	RETURN @@Error
GO
PRINT N'Creating [dbo].[mc_mcmd_TmpMetaFileCleanUp]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_TmpMetaFileCleanUp] 
	@ExpiredDate datetime
AS
	DELETE FROM mcmd_TmpMetaFile WHERE Created < @ExpiredDate
GO
PRINT N'Creating [dbo].[ecf_OrderFormDiscount_Insert]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderFormDiscount_Insert]
(
	@OrderFormDiscountId int = NULL OUTPUT,
	@OrderFormId int,
	@DiscountId int,
	@OrderGroupId int,
	@DiscountAmount DECIMAL (38, 9),
	@DiscountCode nvarchar(50) = NULL,
	@DiscountName nvarchar(50) = NULL,
	@DisplayMessage nvarchar(100) = NULL,
	@DiscountValue DECIMAL (38, 9)
)
AS
	SET NOCOUNT ON

	INSERT INTO [OrderFormDiscount]
	(
		[OrderFormId],
		[DiscountId],
		[OrderGroupId],
		[DiscountAmount],
		[DiscountCode],
		[DiscountName],
		[DisplayMessage],
		[DiscountValue]
	)
	VALUES
	(
		@OrderFormId,
		@DiscountId,
		@OrderGroupId,
		@DiscountAmount,
		@DiscountCode,
		@DiscountName,
		@DisplayMessage,
		@DiscountValue
	)

	SELECT @OrderFormDiscountId = SCOPE_IDENTITY()

	RETURN @@Error
GO
PRINT N'Creating [dbo].[aspnet_AnyDataInTables]...';


GO
CREATE PROCEDURE [dbo].aspnet_AnyDataInTables
    @TablesToCheck int
AS
BEGIN
    -- Check Membership table if (@TablesToCheck & 1) is set
    IF ((@TablesToCheck & 1) <> 0 AND
        (EXISTS (SELECT name FROM sysobjects WHERE (name = N'vw_aspnet_MembershipUsers') AND (type = 'V'))))
    BEGIN
        IF (EXISTS(SELECT TOP 1 UserId FROM dbo.aspnet_Membership))
        BEGIN
            SELECT N'aspnet_Membership'
            RETURN
        END
    END

    -- Check aspnet_Roles table if (@TablesToCheck & 2) is set
    IF ((@TablesToCheck & 2) <> 0  AND
        (EXISTS (SELECT name FROM sysobjects WHERE (name = N'vw_aspnet_Roles') AND (type = 'V'))) )
    BEGIN
        IF (EXISTS(SELECT TOP 1 RoleId FROM dbo.aspnet_Roles))
        BEGIN
            SELECT N'aspnet_Roles'
            RETURN
        END
    END

    -- Check aspnet_Profile table if (@TablesToCheck & 4) is set
    IF ((@TablesToCheck & 4) <> 0  AND
        (EXISTS (SELECT name FROM sysobjects WHERE (name = N'vw_aspnet_Profiles') AND (type = 'V'))) )
    BEGIN
        IF (EXISTS(SELECT TOP 1 UserId FROM dbo.aspnet_Profile))
        BEGIN
            SELECT N'aspnet_Profile'
            RETURN
        END
    END

    -- Check aspnet_PersonalizationPerUser table if (@TablesToCheck & 8) is set
    IF ((@TablesToCheck & 8) <> 0  AND
        (EXISTS (SELECT name FROM sysobjects WHERE (name = N'vw_aspnet_WebPartState_User') AND (type = 'V'))) )
    BEGIN
        IF (EXISTS(SELECT TOP 1 UserId FROM dbo.aspnet_PersonalizationPerUser))
        BEGIN
            SELECT N'aspnet_PersonalizationPerUser'
            RETURN
        END
    END

    -- Check aspnet_PersonalizationPerUser table if (@TablesToCheck & 16) is set
    IF ((@TablesToCheck & 16) <> 0  AND
        (EXISTS (SELECT name FROM sysobjects WHERE (name = N'aspnet_WebEvent_LogEvent') AND (type = 'P'))) )
    BEGIN
        IF (EXISTS(SELECT TOP 1 * FROM dbo.aspnet_WebEvent_Events))
        BEGIN
            SELECT N'aspnet_WebEvent_Events'
            RETURN
        END
    END

    -- Check aspnet_Users table if (@TablesToCheck & 1,2,4 & 8) are all set
    IF ((@TablesToCheck & 1) <> 0 AND
        (@TablesToCheck & 2) <> 0 AND
        (@TablesToCheck & 4) <> 0 AND
        (@TablesToCheck & 8) <> 0 AND
        (@TablesToCheck & 32) <> 0 AND
        (@TablesToCheck & 128) <> 0 AND
        (@TablesToCheck & 256) <> 0 AND
        (@TablesToCheck & 512) <> 0 AND
        (@TablesToCheck & 1024) <> 0)
    BEGIN
        IF (EXISTS(SELECT TOP 1 UserId FROM dbo.aspnet_Users))
        BEGIN
            SELECT N'aspnet_Users'
            RETURN
        END
        IF (EXISTS(SELECT TOP 1 ApplicationId FROM dbo.aspnet_Applications))
        BEGIN
            SELECT N'aspnet_Applications'
            RETURN
        END
    END
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_AddMetaField]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_AddMetaField]
	@Namespace 		NVARCHAR(1024) = N'Mediachase.MetaDataPlus.User',
	@Name		NVARCHAR(256),
	@FriendlyName	NVARCHAR(256),
	@Description	NVARCHAR(MAX),
	@DataTypeId	INT,
	@Length	INT,
	@AllowNulls	BIT,
	@MultiLanguageValue BIT,
	@AllowSearch	BIT,
	@IsEncrypted	BIT,
	@Retval 	INT OUTPUT
AS
BEGIN
	-- Step 0. Prepare
	SET NOCOUNT ON
	SET @Retval = -1

    BEGIN TRAN
	    DECLARE @DataTypeVariable	INT
	    DECLARE @DataTypeLength	INT

	    SELECT @DataTypeVariable = Variable, @DataTypeLength = Length FROM MetaDataType WHERE DataTypeId = @DataTypeId

	    IF (@Length <= 0 OR @Length > @DataTypeLength )
		    SET @Length = @DataTypeLength

	    -- Step 2. Insert a record in to MetaField table.
	    INSERT INTO [MetaField]  ([Namespace], [Name], [FriendlyName], [Description], [DataTypeId], [Length], [AllowNulls],  [MultiLanguageValue], [AllowSearch], [IsEncrypted])
		    VALUES(@Namespace, @Name,  @FriendlyName, @Description, @DataTypeId, @Length, @AllowNulls, @MultiLanguageValue, @AllowSearch, @IsEncrypted)

	    IF @@ERROR <> 0 GOTO ERR

	    SET @Retval = IDENT_CURRENT('[MetaField]')

	    COMMIT TRAN
    RETURN

ERR:
	SET @Retval = -1
	ROLLBACK TRAN
    RETURN
END
GO
PRINT N'Creating [dbo].[mc_mcmd_SelectedEnumValueUpdate]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_SelectedEnumValueUpdate]
(
@SelectedEnumValueId int,
@Key uniqueidentifier,
@TypeName nvarchar(100),
@Id int)
AS
    SET NOCOUNT ON
UPDATE [mcmd_SelectedEnumValue]
SET
[Key] = @Key,
[TypeName] = @TypeName,
[Id] = @Id
WHERE
[SelectedEnumValueId] = @SelectedEnumValueId
RETURN @@Error
GO
PRINT N'Creating [dbo].[ecf_OrderFormDiscount_Delete]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderFormDiscount_Delete]
(
	@OrderFormDiscountId int
)
AS
	SET NOCOUNT ON

	DELETE 
	FROM   [OrderFormDiscount]
	WHERE  
		[OrderFormDiscountId] = @OrderFormDiscountId

	RETURN @@Error
GO
PRINT N'Creating [dbo].[aspnet_Users_DeleteUser]...';


GO
CREATE PROCEDURE [dbo].aspnet_Users_DeleteUser
    @ApplicationName  nvarchar(256),
    @UserName         nvarchar(256),
    @TablesToDeleteFrom int,
    @NumTablesDeletedFrom int OUTPUT
AS
BEGIN
    DECLARE @UserId               uniqueidentifier
    SELECT  @UserId               = NULL
    SELECT  @NumTablesDeletedFrom = 0

    DECLARE @TranStarted   bit
    SET @TranStarted = 0

    IF( @@TRANCOUNT = 0 )
    BEGIN
	    BEGIN TRANSACTION
	    SET @TranStarted = 1
    END
    ELSE
	SET @TranStarted = 0

    DECLARE @ErrorCode   int
    DECLARE @RowCount    int

    SET @ErrorCode = 0
    SET @RowCount  = 0

    SELECT  @UserId = u.UserId
    FROM    dbo.aspnet_Users u, dbo.aspnet_Applications a
    WHERE   u.LoweredUserName       = LOWER(@UserName)
        AND u.ApplicationId         = a.ApplicationId
        AND LOWER(@ApplicationName) = a.LoweredApplicationName

    IF (@UserId IS NULL)
    BEGIN
        GOTO Cleanup
    END

    -- Delete from Membership table if (@TablesToDeleteFrom & 1) is set
    IF ((@TablesToDeleteFrom & 1) <> 0 AND
        (EXISTS (SELECT name FROM sysobjects WHERE (name = N'vw_aspnet_MembershipUsers') AND (type = 'V'))))
    BEGIN
        DELETE FROM dbo.aspnet_Membership WHERE @UserId = UserId

        SELECT @ErrorCode = @@ERROR,
               @RowCount = @@ROWCOUNT

        IF( @ErrorCode <> 0 )
            GOTO Cleanup

        IF (@RowCount <> 0)
            SELECT  @NumTablesDeletedFrom = @NumTablesDeletedFrom + 1
    END

    -- Delete from aspnet_UsersInRoles table if (@TablesToDeleteFrom & 2) is set
    IF ((@TablesToDeleteFrom & 2) <> 0  AND
        (EXISTS (SELECT name FROM sysobjects WHERE (name = N'vw_aspnet_UsersInRoles') AND (type = 'V'))) )
    BEGIN
        DELETE FROM dbo.aspnet_UsersInRoles WHERE @UserId = UserId

        SELECT @ErrorCode = @@ERROR,
                @RowCount = @@ROWCOUNT

        IF( @ErrorCode <> 0 )
            GOTO Cleanup

        IF (@RowCount <> 0)
            SELECT  @NumTablesDeletedFrom = @NumTablesDeletedFrom + 1
    END

    -- Delete from aspnet_Profile table if (@TablesToDeleteFrom & 4) is set
    IF ((@TablesToDeleteFrom & 4) <> 0  AND
        (EXISTS (SELECT name FROM sysobjects WHERE (name = N'vw_aspnet_Profiles') AND (type = 'V'))) )
    BEGIN
        DELETE FROM dbo.aspnet_Profile WHERE @UserId = UserId

        SELECT @ErrorCode = @@ERROR,
                @RowCount = @@ROWCOUNT

        IF( @ErrorCode <> 0 )
            GOTO Cleanup

        IF (@RowCount <> 0)
            SELECT  @NumTablesDeletedFrom = @NumTablesDeletedFrom + 1
    END

    -- Delete from aspnet_PersonalizationPerUser table if (@TablesToDeleteFrom & 8) is set
    IF ((@TablesToDeleteFrom & 8) <> 0  AND
        (EXISTS (SELECT name FROM sysobjects WHERE (name = N'vw_aspnet_WebPartState_User') AND (type = 'V'))) )
    BEGIN
        DELETE FROM dbo.aspnet_PersonalizationPerUser WHERE @UserId = UserId

        SELECT @ErrorCode = @@ERROR,
                @RowCount = @@ROWCOUNT

        IF( @ErrorCode <> 0 )
            GOTO Cleanup

        IF (@RowCount <> 0)
            SELECT  @NumTablesDeletedFrom = @NumTablesDeletedFrom + 1
    END

    -- Delete from aspnet_Users table if (@TablesToDeleteFrom & 1,2,4 & 8) are all set
    IF ((@TablesToDeleteFrom & 1) <> 0 AND
        (@TablesToDeleteFrom & 2) <> 0 AND
        (@TablesToDeleteFrom & 4) <> 0 AND
        (@TablesToDeleteFrom & 8) <> 0 AND
        (EXISTS (SELECT UserId FROM dbo.aspnet_Users WHERE @UserId = UserId)))
    BEGIN
        DELETE FROM dbo.aspnet_Users WHERE @UserId = UserId

        SELECT @ErrorCode = @@ERROR,
                @RowCount = @@ROWCOUNT

        IF( @ErrorCode <> 0 )
            GOTO Cleanup

        IF (@RowCount <> 0)
            SELECT  @NumTablesDeletedFrom = @NumTablesDeletedFrom + 1
    END

    IF( @TranStarted = 1 )
    BEGIN
	    SET @TranStarted = 0
	    COMMIT TRANSACTION
    END

    RETURN 0

Cleanup:
    SET @NumTablesDeletedFrom = 0

    IF( @TranStarted = 1 )
    BEGIN
        SET @TranStarted = 0
	    ROLLBACK TRANSACTION
    END

    RETURN @ErrorCode

END
GO
PRINT N'Creating [dbo].[mc_mcmd_SelectedEnumValueSelect]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_SelectedEnumValueSelect]
(
@SelectedEnumValueId int
)
AS
    SET NOCOUNT ON
SELECT [SelectedEnumValueId],
[Key],
[TypeName],
[Id] FROM mcmd_SelectedEnumValue
WHERE
[SelectedEnumValueId] = @SelectedEnumValueId
GO
PRINT N'Creating [dbo].[ecf_OrderForm_Update]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderForm_Update]
(
	@OrderFormId int,
	@OrderGroupId int,
	@Name nvarchar(64) = NULL,
	@BillingAddressId nvarchar(64) = NULL,
	@DiscountAmount DECIMAL (38, 9),
	@SubTotal DECIMAL (38, 9),
	@ShippingTotal DECIMAL (38, 9),
	@HandlingTotal DECIMAL (38, 9),
	@TaxTotal DECIMAL (38, 9),
	@Total DECIMAL (38, 9),
	@Status nvarchar(64) = NULL,
	@ProviderId nvarchar(255) = NULL,
	@ReturnComment nvarchar(1024) = NULL,
	@ReturnType nvarchar(50) = NULL,
	@ReturnAuthCode nvarchar(255) = NULL,
	@OrigOrderFormId int = NULL,
	@ExchangeOrderGroupId int = NULL,
	@AuthorizedPaymentTotal DECIMAL (38, 9),
	@CapturedPaymentTotal DECIMAL (38, 9)
)
AS
	SET NOCOUNT ON
	
	UPDATE [OrderForm]
	SET
		[OrderGroupId] = @OrderGroupId,
		[Name] = @Name,
		[BillingAddressId] = @BillingAddressId,
		[DiscountAmount] = @DiscountAmount,
		[SubTotal] = @SubTotal,
		[ShippingTotal] = @ShippingTotal,
		[HandlingTotal] = @HandlingTotal,
		[TaxTotal] = @TaxTotal,
		[Total] = @Total,
		[Status] = @Status,
		[ProviderId] = @ProviderId,
		[ReturnComment] = @ReturnComment,
		[ReturnType] = @ReturnType,
		[ReturnAuthCode] = @ReturnAuthCode,
		[OrigOrderFormId] = @OrigOrderFormId,
		[ExchangeOrderGroupId] = @ExchangeOrderGroupId,
		[AuthorizedPaymentTotal] = @AuthorizedPaymentTotal,
		[CapturedPaymentTotal] = @CapturedPaymentTotal
	WHERE 
		[OrderFormId] = @OrderFormId

	RETURN @@Error
GO
PRINT N'Creating [dbo].[aspnet_Users_CreateUser]...';


GO

CREATE PROCEDURE [dbo].aspnet_Users_CreateUser
    @ApplicationId    uniqueidentifier,
    @UserName         nvarchar(256),
    @IsUserAnonymous  bit,
    @LastActivityDate DATETIME,
    @UserId           uniqueidentifier OUTPUT
AS
BEGIN
    IF( @UserId IS NULL )
        SELECT @UserId = NEWID()
    ELSE
    BEGIN
        IF( EXISTS( SELECT UserId FROM dbo.aspnet_Users
                    WHERE @UserId = UserId ) )
            RETURN -1
    END

    INSERT dbo.aspnet_Users (ApplicationId, UserId, UserName, LoweredUserName, IsAnonymous, LastActivityDate)
    VALUES (@ApplicationId, @UserId, @UserName, LOWER(@UserName), @IsUserAnonymous, @LastActivityDate)

    RETURN 0
END
GO
PRINT N'Creating [dbo].[mc_mcmd_SelectedEnumValueInsert]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_SelectedEnumValueInsert]
(
@SelectedEnumValueId int = NULL OUTPUT
,
@Key uniqueidentifier,
@TypeName nvarchar(100),
@Id int)
AS
    SET NOCOUNT ON
INSERT INTO [mcmd_SelectedEnumValue]
(
[Key],
[TypeName],
[Id])
VALUES(
@Key,
@TypeName,
@Id)
SELECT @SelectedEnumValueId = SCOPE_IDENTITY();
RETURN @@Error
GO
PRINT N'Creating [dbo].[ecf_OrderForm_Insert]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderForm_Insert]
(
	@OrderFormId int = NULL OUTPUT,
	@OrderGroupId int,
	@Name nvarchar(64) = NULL,
	@BillingAddressId nvarchar(64) = NULL,
	@DiscountAmount DECIMAL(38, 9),
	@SubTotal DECIMAL(38, 9),
	@ShippingTotal DECIMAL(38, 9),
	@HandlingTotal DECIMAL (38, 9),
	@TaxTotal DECIMAL (38, 9),
	@Total DECIMAL (38, 9),
	@Status nvarchar(64) = NULL,
	@ProviderId nvarchar(255) = NULL,
	@ReturnComment nvarchar(1024) = NULL,
	@ReturnType nvarchar(50) = NULL,
	@ReturnAuthCode nvarchar(255) = NULL,
	@OrigOrderFormId int = NULL,
	@ExchangeOrderGroupId int  = NULL,
	@AuthorizedPaymentTotal DECIMAL (38, 9),
	@CapturedPaymentTotal DECIMAL (38, 9)
)
AS
	SET NOCOUNT ON

	INSERT INTO [OrderForm]
	(
		[OrderGroupId],
		[Name],
		[BillingAddressId],
		[DiscountAmount],
		[SubTotal],
		[ShippingTotal],
		[HandlingTotal],
		[TaxTotal],
		[Total],
		[Status],
		[ProviderId],
		[ReturnComment],
		[ReturnType],
		[ReturnAuthCode],
		[OrigOrderFormId],
		[ExchangeOrderGroupId],
		[AuthorizedPaymentTotal],
		[CapturedPaymentTotal]
		
	)
	VALUES
	(
		@OrderGroupId,
		@Name,
		@BillingAddressId,
		@DiscountAmount,
		@SubTotal,
		@ShippingTotal,
		@HandlingTotal,
		@TaxTotal,
		@Total,
		@Status,
		@ProviderId,
		@ReturnComment,
		@ReturnType,
		@ReturnAuthCode,
		@OrigOrderFormId,
		@ExchangeOrderGroupId,
		@AuthorizedPaymentTotal,
		@CapturedPaymentTotal
	)

	SELECT @OrderFormId = SCOPE_IDENTITY()

	RETURN @@Error
GO
PRINT N'Creating [dbo].[aspnet_UnRegisterSchemaVersion]...';


GO

CREATE PROCEDURE [dbo].aspnet_UnRegisterSchemaVersion
    @Feature                   nvarchar(128),
    @CompatibleSchemaVersion   nvarchar(128)
AS
BEGIN
    DELETE FROM dbo.aspnet_SchemaVersions
        WHERE   Feature = LOWER(@Feature) AND @CompatibleSchemaVersion = CompatibleSchemaVersion
END
GO
PRINT N'Creating [dbo].[mc_mcmd_SelectedEnumValueDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_SelectedEnumValueDelete]
(
@SelectedEnumValueId int
)
AS
    SET NOCOUNT ON
DELETE FROM [mcmd_SelectedEnumValue]
WHERE
[SelectedEnumValueId] = @SelectedEnumValueId
RETURN @@Error
GO
PRINT N'Creating [dbo].[ecf_OrderForm_Delete]...';


GO
CREATE PROCEDURE [dbo].[ecf_OrderForm_Delete]
(
	@OrderFormId int
)
AS
	SET NOCOUNT ON
	DECLARE @TempObjectId int	

	-- Delete line items
	DECLARE _cursor CURSOR READ_ONLY FOR 
		SELECT LineItemId FROM [LineItem] where OrderFormId = @OrderFormId
	OPEN _cursor
	FETCH NEXT FROM _cursor INTO @TempObjectId
	WHILE (@@fetch_status = 0) BEGIN
		DELETE FROM [LineItemDiscount] where LineItemId = @TempObjectId
		EXEC [dbo].[mdpsp_avto_LineItemEx_Delete] @TempObjectId
		FETCH NEXT FROM _cursor INTO @TempObjectId
	END
	CLOSE _cursor
	DEALLOCATE _cursor
	DELETE FROM [LineItem] where OrderFormId = @OrderFormId

	-- Delete payments
	DECLARE _cursor CURSOR READ_ONLY FOR 
		SELECT PaymentId FROM [OrderFormPayment] where OrderFormId = @OrderFormId
	OPEN _cursor
	FETCH NEXT FROM _cursor INTO @TempObjectId
	WHILE (@@fetch_status = 0) BEGIN
		EXEC [dbo].[mdpsp_avto_OrderFormPayment_CashCard_Delete] @TempObjectId
		EXEC [dbo].[mdpsp_avto_OrderFormPayment_CreditCard_Delete] @TempObjectId
		EXEC [dbo].[mdpsp_avto_OrderFormPayment_GiftCard_Delete] @TempObjectId	
		EXEC [dbo].[mdpsp_avto_OrderFormPayment_Invoice_Delete] @TempObjectId
		EXEC [dbo].[mdpsp_avto_OrderFormPayment_Other_Delete] @TempObjectId
		
		EXEC [dbo].[mdpsp_avto_OrderFormPayment_Exchange_Delete] @TempObjectId
		FETCH NEXT FROM _cursor INTO @TempObjectId
	END
	CLOSE _cursor
	DEALLOCATE _cursor
	DELETE FROM [OrderFormPayment] where OrderFormId = @OrderFormId

	-- Delete OrderFormDiscount
	DELETE FROM [OrderFormDiscount] where OrderFormId = @OrderFormId

	-- Delete Shipment
	DECLARE _cursor CURSOR READ_ONLY FOR 
		SELECT ShipmentId FROM [Shipment] where OrderFormId = @OrderFormId
	OPEN _cursor
	FETCH NEXT FROM _cursor INTO @TempObjectId
	WHILE (@@fetch_status = 0) BEGIN
		DELETE FROM [ShipmentDiscount] where ShipmentId = @TempObjectId
		EXEC [dbo].[mdpsp_avto_ShipmentEx_Delete] @TempObjectId
		FETCH NEXT FROM _cursor INTO @TempObjectId
	END
	CLOSE _cursor
	DEALLOCATE _cursor
	DELETE FROM [Shipment] where OrderFormId = @OrderFormId

	-- Delete OrderForm
	select @TempObjectId = OrderFormId FROM [OrderForm] where OrderFormId = @OrderFormId
	EXEC [dbo].[mdpsp_avto_OrderFormEx_Delete] @TempObjectId
	DELETE FROM [OrderForm] where OrderFormId = @OrderFormId

	RETURN @@Error
GO
PRINT N'Creating [dbo].[aspnet_Applications_CreateApplication]...';


GO

CREATE PROCEDURE [dbo].aspnet_Applications_CreateApplication
    @ApplicationName      nvarchar(256),
    @ApplicationId        uniqueidentifier OUTPUT
AS
BEGIN
    SELECT  @ApplicationId = ApplicationId FROM dbo.aspnet_Applications WHERE LOWER(@ApplicationName) = LoweredApplicationName

    IF(@ApplicationId IS NULL)
    BEGIN
        DECLARE @TranStarted   bit
        SET @TranStarted = 0

        IF( @@TRANCOUNT = 0 )
        BEGIN
	        BEGIN TRANSACTION
	        SET @TranStarted = 1
        END
        ELSE
    	    SET @TranStarted = 0

        SELECT  @ApplicationId = ApplicationId
        FROM dbo.aspnet_Applications WITH (UPDLOCK, HOLDLOCK)
        WHERE LOWER(@ApplicationName) = LoweredApplicationName

        IF(@ApplicationId IS NULL)
        BEGIN
            SELECT  @ApplicationId = NEWID()
            INSERT  dbo.aspnet_Applications (ApplicationId, ApplicationName, LoweredApplicationName)
            VALUES  (@ApplicationId, @ApplicationName, LOWER(@ApplicationName))
        END


        IF( @TranStarted = 1 )
        BEGIN
            IF(@@ERROR = 0)
            BEGIN
	        SET @TranStarted = 0
	        COMMIT TRANSACTION
            END
            ELSE
            BEGIN
                SET @TranStarted = 0
                ROLLBACK TRANSACTION
            END
        END
    END
END
GO
PRINT N'Creating [dbo].[aspnet_CheckSchemaVersion]...';


GO

CREATE PROCEDURE [dbo].aspnet_CheckSchemaVersion
    @Feature                   nvarchar(128),
    @CompatibleSchemaVersion   nvarchar(128)
AS
BEGIN
    IF (EXISTS( SELECT  *
                FROM    dbo.aspnet_SchemaVersions
                WHERE   Feature = LOWER( @Feature ) AND
                        CompatibleSchemaVersion = @CompatibleSchemaVersion ))
        RETURN 0

    RETURN 1
END
GO
PRINT N'Creating [dbo].[ecf_LineItemDiscount_Update]...';


GO
CREATE PROCEDURE [dbo].[ecf_LineItemDiscount_Update]
(
	@LineItemDiscountId int,
	@LineItemId int,
	@DiscountId int,
	@OrderGroupId int,
	@DiscountAmount DECIMAL (38, 9),
	@DiscountCode nvarchar(50) = NULL,
	@DiscountName nvarchar(50) = NULL,
	@DisplayMessage nvarchar(100) = NULL,
	@DiscountValue DECIMAL (38, 9)
)
AS
	SET NOCOUNT ON
	
	UPDATE [LineItemDiscount]
	SET
		[LineItemId] = @LineItemId,
		[DiscountId] = @DiscountId,
		[OrderGroupId] = @OrderGroupId,
		[DiscountAmount] = @DiscountAmount,
		[DiscountCode] = @DiscountCode,
		[DiscountName] = @DiscountName,
		[DisplayMessage] = @DisplayMessage,
		[DiscountValue] = @DiscountValue
	WHERE 
		[LineItemDiscountId] = @LineItemDiscountId

	RETURN @@Error
GO
PRINT N'Creating [dbo].[aspnet_RegisterSchemaVersion]...';


GO

CREATE PROCEDURE [dbo].aspnet_RegisterSchemaVersion
    @Feature                   nvarchar(128),
    @CompatibleSchemaVersion   nvarchar(128),
    @IsCurrentVersion          bit,
    @RemoveIncompatibleSchema  bit
AS
BEGIN
    IF( @RemoveIncompatibleSchema = 1 )
    BEGIN
        DELETE FROM dbo.aspnet_SchemaVersions WHERE Feature = LOWER( @Feature )
    END
    ELSE
    BEGIN
        IF( @IsCurrentVersion = 1 )
        BEGIN
            UPDATE dbo.aspnet_SchemaVersions
            SET IsCurrentVersion = 0
            WHERE Feature = LOWER( @Feature )
        END
    END

    INSERT  dbo.aspnet_SchemaVersions( Feature, CompatibleSchemaVersion, IsCurrentVersion )
    VALUES( LOWER( @Feature ), @CompatibleSchemaVersion, @IsCurrentVersion )
END
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaLinkUpdate]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaLinkUpdate]
(
@LinkId int,
@MetaClassName nvarchar(50) = NULL
,
@MetaObjectId int = NULL
,
@UID ntext = NULL
)
AS
    SET NOCOUNT ON

UPDATE [mcmd_MetaLink]
SET
[MetaClassName] = @MetaClassName,
[MetaObjectId] = @MetaObjectId,
[UID] = @UID
WHERE
[LinkId] = @LinkId
RETURN @@Error
GO
PRINT N'Creating [dbo].[ecf_LineItemDiscount_Insert]...';


GO
CREATE PROCEDURE [dbo].[ecf_LineItemDiscount_Insert]
(
	@LineItemDiscountId int = NULL OUTPUT,
	@LineItemId int,
	@DiscountId int,
	@OrderGroupId int,
	@DiscountAmount DECIMAL (38, 9),
	@DiscountCode nvarchar(50) = NULL,
	@DiscountName nvarchar(50) = NULL,
	@DisplayMessage nvarchar(100) = NULL,
	@DiscountValue DECIMAL (38, 9)
)
AS
	SET NOCOUNT ON

	INSERT INTO [LineItemDiscount]
	(
		[LineItemId],
		[DiscountId],
		[OrderGroupId],
		[DiscountAmount],
		[DiscountCode],
		[DiscountName],
		[DisplayMessage],
		[DiscountValue]
	)
	VALUES
	(
		@LineItemId,
		@DiscountId,
		@OrderGroupId,
		@DiscountAmount,
		@DiscountCode,
		@DiscountName,
		@DisplayMessage,
		@DiscountValue
	)

	SELECT @LineItemDiscountId = SCOPE_IDENTITY()

	RETURN @@Error
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaLinkSelect]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaLinkSelect]
(
@LinkId int
)
AS
    SET NOCOUNT ON

SELECT [LinkId],
[MetaClassName],
[MetaObjectId],
[UID] FROM mcmd_MetaLink
WHERE
[LinkId] = @LinkId
GO
PRINT N'Creating [dbo].[ecf_LineItemDiscount_Delete]...';


GO
CREATE PROCEDURE [dbo].[ecf_LineItemDiscount_Delete]
(
	@LineItemDiscountId int
)
AS
	SET NOCOUNT ON

	DELETE 
	FROM   [LineItemDiscount]
	WHERE  
		[LineItemDiscountId] = @LineItemDiscountId

	RETURN @@Error
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaLinkInsert]...';


GO
-- Create SP
CREATE PROCEDURE [dbo].[mc_mcmd_MetaLinkInsert]
(
@LinkId int = NULL OUTPUT
,
@MetaClassName nvarchar(50) = NULL
,
@MetaObjectId int = NULL
,
@UID ntext = NULL
)
AS
    SET NOCOUNT ON

INSERT INTO [mcmd_MetaLink]
(
[MetaClassName],
[MetaObjectId],
[UID])
VALUES(
@MetaClassName,
@MetaObjectId,
@UID)
SELECT @LinkId = SCOPE_IDENTITY();
RETURN @@Error
GO
PRINT N'Creating [dbo].[ecf_LineItem_Update]...';


GO
CREATE PROCEDURE [dbo].[ecf_LineItem_Update]
(
	@LineItemId int,
	@OrderFormId int,
	@OrderGroupId int,
	@Catalog nvarchar(255),
	@CatalogNode nvarchar(255),
	@ParentCatalogEntryId nvarchar(255),
	@CatalogEntryId nvarchar(255),
	@Quantity DECIMAL(38, 9),
	@PlacedPrice DECIMAL(38, 9),
	@ListPrice DECIMAL(38, 9),
	@LineItemDiscountAmount DECIMAL(38, 9),
	@OrderLevelDiscountAmount DECIMAL(38, 9),
	@ShippingAddressId nvarchar(255),
	@ShippingMethodName nvarchar(128) = NULL,
	@ShippingMethodId uniqueidentifier,
	@ExtendedPrice DECIMAL(38, 9),
	@Epi_SalesTax DECIMAL(38, 9),
	@Description nvarchar(255) = NULL,
	@Status nvarchar(64) = NULL,
	@DisplayName nvarchar(128) = NULL,
	@AllowBackordersAndPreorders bit,
	@InStockQuantity DECIMAL(38, 9),
	@PreorderQuantity DECIMAL(38, 9),
	@BackorderQuantity DECIMAL(38, 9),
	@InventoryStatus int,
	@LineItemOrdering datetime,
	@ConfigurationId nvarchar(255) = NULL,
	@MinQuantity DECIMAL(38, 9),
	@MaxQuantity DECIMAL(38, 9),
	@ProviderId nvarchar(255) = NULL,
	@ReturnReason nvarchar(255)= NULL,
	@OrigLineItemId int = NULL,
	@ReturnQuantity DECIMAL(38, 9),
	@WarehouseCode nvarchar(50) = NULL,
    @IsInventoryAllocated bit = NULL,
	@Epi_TaxCategoryId int = NULL
)
AS
	SET NOCOUNT ON
	
	UPDATE [LineItem]
	SET
		[OrderFormId] = @OrderFormId,
		[OrderGroupId] = @OrderGroupId,
		[Catalog] = @Catalog,
		[CatalogNode] = @CatalogNode,
		[ParentCatalogEntryId] = @ParentCatalogEntryId,
		[CatalogEntryId] = @CatalogEntryId,
		[Quantity] = @Quantity,
		[PlacedPrice] = @PlacedPrice,
		[ListPrice] = @ListPrice,
		[LineItemDiscountAmount] = @LineItemDiscountAmount,
		[OrderLevelDiscountAmount] = @OrderLevelDiscountAmount,
		[ShippingAddressId] = @ShippingAddressId,
		[ShippingMethodName] = @ShippingMethodName,
		[ShippingMethodId] = @ShippingMethodId,
		[ExtendedPrice] = @ExtendedPrice,
		[Epi_SalesTax] = @Epi_SalesTax,
		[Description] = @Description,
		[Status] = @Status,
		[DisplayName] = @DisplayName,
		[AllowBackordersAndPreorders] = @AllowBackordersAndPreorders,
		[InStockQuantity] = @InStockQuantity,
		[PreorderQuantity] = @PreorderQuantity,
		[BackorderQuantity] = @BackorderQuantity,
		[InventoryStatus] = @InventoryStatus,
		[LineItemOrdering] = @LineItemOrdering,
		[ConfigurationId] = @ConfigurationId,
		[MinQuantity] = @MinQuantity,
		[MaxQuantity] = @MaxQuantity,
		[ProviderId] = @ProviderId,
		[ReturnReason] = @ReturnReason,
		[OrigLineItemId] = @OrigLineItemId,
		[ReturnQuantity] = @ReturnQuantity,
		[WarehouseCode] = @WarehouseCode,
        [IsInventoryAllocated] = @IsInventoryAllocated,
		[Epi_TaxCategoryId] = @Epi_TaxCategoryId
	WHERE 
		[LineItemId] = @LineItemId

	IF @@ERROR > 0
	BEGIN
		RAISERROR('Concurrency Error',16,1)
	END

	RETURN @@Error
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaLinkDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaLinkDelete]
(
@LinkId int
)
AS
    SET NOCOUNT ON

DELETE FROM [mcmd_MetaLink]
WHERE
[LinkId] = @LinkId
RETURN @@Error
GO
PRINT N'Creating [dbo].[ecf_LineItem_Insert]...';


GO
CREATE PROCEDURE [dbo].[ecf_LineItem_Insert]
(
	@LineItemId int = NULL OUTPUT,
	@OrderFormId int,
	@OrderGroupId int,
	@Catalog nvarchar(255),
	@CatalogNode nvarchar(255),
	@ParentCatalogEntryId nvarchar(255),
	@CatalogEntryId nvarchar(255),
	@Quantity DECIMAL (38, 9),
	@PlacedPrice DECIMAL(38, 9),
	@ListPrice DECIMAL(38, 9),
	@LineItemDiscountAmount DECIMAL(38, 9),
	@OrderLevelDiscountAmount DECIMAL(38, 9),
	@ShippingAddressId nvarchar(64),
	@ShippingMethodName nvarchar(128) = NULL,
	@ShippingMethodId uniqueidentifier,
	@ExtendedPrice DECIMAL(38, 9),
	@Epi_SalesTax DECIMAL(38, 9),
	@Description nvarchar(255) = NULL,
	@Status nvarchar(64) = NULL,
	@DisplayName nvarchar(128) = NULL,
	@AllowBackordersAndPreorders bit,
	@InStockQuantity DECIMAL(38, 9),
	@PreorderQuantity DECIMAL(38, 9),
	@BackorderQuantity DECIMAL(38, 9),
	@InventoryStatus int,
	@LineItemOrdering datetime,
	@ConfigurationId nvarchar(255) = NULL,
	@MinQuantity DECIMAL(38, 9),
	@MaxQuantity DECIMAL(38, 9),
	@ProviderId nvarchar(255) = NULL,
	@ReturnReason nvarchar(255)= NULL,
	@OrigLineItemId int = NULL,
	@ReturnQuantity DECIMAL(38, 9),
	@WarehouseCode nvarchar(50) = NULL,
    @IsInventoryAllocated bit = NULL,
	@Epi_TaxCategoryId int = NULL
)
AS
	SET NOCOUNT ON

	INSERT INTO [LineItem]
	(
		[OrderFormId],
		[OrderGroupId],
		[Catalog],
		[CatalogNode],
		[ParentCatalogEntryId],
		[CatalogEntryId],
		[Quantity],
		[PlacedPrice],
		[ListPrice],
		[LineItemDiscountAmount],
		[OrderLevelDiscountAmount],
		[ShippingAddressId],
		[ShippingMethodName],
		[ShippingMethodId],
		[ExtendedPrice],
		[Epi_SalesTax],
		[Description],
		[Status],
		[DisplayName],
		[AllowBackordersAndPreorders],
		[InStockQuantity],
		[PreorderQuantity],
		[BackorderQuantity],
		[InventoryStatus],
		[LineItemOrdering],
		[ConfigurationId],
		[MinQuantity],
		[MaxQuantity],
		[ProviderId],
		[ReturnReason],
		[OrigLineItemId],
		[ReturnQuantity],
		[WarehouseCode],
        [IsInventoryAllocated],
		[Epi_TaxCategoryId]
	)
	VALUES
	(
		@OrderFormId,
		@OrderGroupId,
		@Catalog,
		@CatalogNode,
		@ParentCatalogEntryId,
		@CatalogEntryId,
		@Quantity,
		@PlacedPrice,
		@ListPrice,
		@LineItemDiscountAmount,
		@OrderLevelDiscountAmount,
		@ShippingAddressId,
		@ShippingMethodName,
		@ShippingMethodId,
		@ExtendedPrice,
		@Epi_SalesTax,
		@Description,
		@Status,
		@DisplayName,
		@AllowBackordersAndPreorders,
		@InStockQuantity,
		@PreorderQuantity,
		@BackorderQuantity,
		@InventoryStatus,
		@LineItemOrdering,
		@ConfigurationId,
		@MinQuantity,
		@MaxQuantity,
		@ProviderId,
		@ReturnReason,
		@OrigLineItemId,
		@ReturnQuantity,
		@WarehouseCode,
        @IsInventoryAllocated,
		@Epi_TaxCategoryId
	)

	SELECT @LineItemId = SCOPE_IDENTITY()

	RETURN @@Error
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaIdentifierUpdate]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaIdentifierUpdate]
(
@IdentifierId int,
@Value nvarchar(510))
AS
    SET NOCOUNT ON
UPDATE [mcmd_MetaIdentifier]
SET
[Value] = @Value
WHERE
[IdentifierId] = @IdentifierId
RETURN @@Error
GO
PRINT N'Creating [dbo].[ecf_LineItem_Delete]...';


GO
CREATE PROCEDURE [dbo].[ecf_LineItem_Delete]
(
	@LineItemId int
)
AS
	SET NOCOUNT ON
	DECLARE @TempObjectId int	

	EXEC [dbo].[mdpsp_avto_LineItemEx_Delete] @LineItemId
	DELETE FROM [LineItemDiscount] WHERE [LineItemId] = @LineItemId
	DELETE FROM [LineItem] WHERE [LineItemId] = @LineItemId

	RETURN @@Error
GO
PRINT N'Creating [dbo].[mdpsp_sys_DeleteMetaRule]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_DeleteMetaRule]
	@RuleId	INT
AS
	SET NOCOUNT ON

	DELETE FROM MetaRule WHERE RuleId=@RuleId

	SET NOCOUNT OFF
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaIdentifierSelect]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaIdentifierSelect]
(
@IdentifierId int
)
AS
    SET NOCOUNT ON
SELECT [IdentifierId],
[PeriodKey],
[TypeName],
[MetaClassName],
[MetaFieldName],
[Id],
[Value] FROM mcmd_MetaIdentifier
WHERE
[IdentifierId] = @IdentifierId
GO
PRINT N'Creating [dbo].[ecf_GetMostRecentOrder]...';


GO
CREATE PROCEDURE [dbo].[ecf_GetMostRecentOrder]
(
	@CustomerId uniqueidentifier
)
AS
BEGIN
    declare @results udttOrderGroupId
    
    insert into @results (OrderGroupId)
	select top 1 [OrderGroupId]
	from [OrderGroup_PurchaseOrder] PO
	join OrderGroup OG on PO.ObjectId = OG.OrderGroupId
	where ([CustomerId] = @CustomerId)
	ORDER BY ObjectId DESC

	exec dbo.ecf_Search_OrderGroup @results

	-- Return Purchase Order Details
	DECLARE @search_condition nvarchar(max)
	CREATE TABLE #OrderSearchResults(OrderGroupId int)
	insert into #OrderSearchResults select OrderGroupId from @results
	SET @search_condition = N'INNER JOIN OrderGroup OG ON OG.OrderGroupId = T.ObjectId WHERE [T].[ObjectId] IN (SELECT [OrderGroupId] FROM #OrderSearchResults)'
	exec mdpsp_avto_OrderGroup_PurchaseOrder_Search NULL, '''OrderGroup'' TableName, [OG].*', @search_condition

	DROP TABLE #OrderSearchResults
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_DeleteMetaObjectValue]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_DeleteMetaObjectValue]
	@MetaKey	INT
AS
	SET NOCOUNT ON
	DELETE FROM MetaObjectValue WHERE MetaKey = @MetaKey
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaIdentifierInsert]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaIdentifierInsert]
(
@IdentifierId int = NULL OUTPUT,
@Value nvarchar(510) OUTPUT,
@PeriodKey varchar(10),
@TypeName nvarchar(100),
@MetaClassName nvarchar(100),
@MetaFieldName nvarchar(100),
@MaskLength int
)
AS
    SET NOCOUNT ON

DECLARE @Number nvarchar(50)
DECLARE @Id int

SELECT @Id = Id FROM mcmd_MetaIdentifier WHERE PeriodKey=@PeriodKey AND TypeName=@TypeName AND MetaClassName=@MetaClassName AND MetaFieldName=@MetaFieldName

IF @Id IS NULL
	SET @Id = 1
ELSE
	SET @Id = @Id + 1

SET @Number = CAST(@Id As nvarchar(50))

IF LEN(@Number) < @MaskLength
	SET @Number = REPLICATE('0', @MaskLength - LEN(@Number)) + @Number

SET @Value = REPLACE(@Value, '#', @Number)

INSERT INTO [mcmd_MetaIdentifier]
(
[PeriodKey],
[TypeName],
[MetaClassName],
[MetaFieldName],
[Value],
[Id])
VALUES(
@PeriodKey,
@TypeName,
@MetaClassName,
@MetaFieldName,
@Value,
@Id)

SELECT @IdentifierId = SCOPE_IDENTITY();
RETURN @@Error
GO
PRINT N'Creating [dbo].[ecf_Country_CountryId]...';


GO
CREATE PROCEDURE [dbo].[ecf_Country_CountryId]
	@CountryId int,
	@ReturnInactive bit = 0
AS
BEGIN
	select * from [Country] C 
		where [CountryId] = @CountryId and 
			((C.[Visible] = 1) or @ReturnInactive = 1)

	select SP.* from [StateProvince] SP 
		inner join [Country] C on C.[CountryId] = SP.[CountryId]
		where SP.[CountryId] = @CountryId and 
			((C.[Visible] = 1) or @ReturnInactive = 1) and 
			((SP.[Visible] = 1) or @ReturnInactive = 1)
		order by SP.[Ordering], SP.[Name]
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_DeleteMetaFile]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_DeleteMetaFile]
	@MetaKey	INT
AS
	SET NOCOUNT ON
	DELETE FROM MetaFileValue WHERE MetaKey = @MetaKey
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaIdentifierDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaIdentifierDelete]
(
@IdentifierId int
)
AS
    SET NOCOUNT ON
DELETE FROM [mcmd_MetaIdentifier]
WHERE
[IdentifierId] = @IdentifierId
RETURN @@Error
GO
PRINT N'Creating [dbo].[ecf_Country_Code]...';


GO
CREATE PROCEDURE [dbo].[ecf_Country_Code]
	@Code nvarchar(3),
	@ReturnInactive bit = 0
AS
BEGIN
	select * from [Country] C 
		where [Code] = @Code and
			((C.[Visible] = 1) or @ReturnInactive = 1)

	select SP.* from [StateProvince] SP 
		inner join [Country] C on C.[CountryId] = SP.[CountryId]
		where C.[Code] = @Code and
			((C.[Visible] = 1) or @ReturnInactive = 1) and 
			((SP.[Visible] = 1) or @ReturnInactive = 1)
		order by SP.[Ordering], SP.[Name]
END
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaFileUpdate]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaFileUpdate]
(
@FileId int,
@FileUID uniqueidentifier,
@FileName nvarchar(510)
)
AS
    SET NOCOUNT ON
UPDATE [mcmd_MetaFile]
SET
[FileUID] = @FileUID,
[FileName] = @FileName
WHERE
[FileId] = @FileId
RETURN @@Error
GO
PRINT N'Creating [dbo].[ecf_Country]...';


GO
CREATE PROCEDURE [dbo].[ecf_Country]
	@ReturnInactive bit = 0
AS
BEGIN
	select * from [Country] C 
		where
			(([Visible] = 1) or @ReturnInactive = 1)
		order by C.[Ordering], C.[Name]

	select SP.* from [StateProvince] SP 
		inner join [Country] C on C.[CountryId] = SP.[CountryId]
		where
			((C.[Visible] = 1) or @ReturnInactive = 1) and 
			((SP.[Visible] = 1) or @ReturnInactive = 1)
		order by SP.[Ordering], SP.[Name]
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_DeleteMetaDictionary]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_DeleteMetaDictionary]
	@MetaDictionaryId	INT
AS
BEGIN
	-- Step 0. Prepare
	SET NOCOUNT ON

	BEGIN TRAN

	IF NOT EXISTS(SELECT * FROM MetaDictionary WHERE MetaDictionaryId = @MetaDictionaryId)
	BEGIN
		RAISERROR ('Wrong @MetaDictionaryId.', 16, 1)
		GOTO ERR
	END

	DELETE FROM MetaDictionary WHERE MetaDictionaryId = @MetaDictionaryId

	IF @@ERROR <> 0 GOTO ERR

	COMMIT TRAN
	RETURN
ERR:
	ROLLBACK TRAN
	RETURN @@Error
END
GO
PRINT N'Creating [dbo].[ecf_Market_Delete]...';


GO

create procedure dbo.ecf_Market_Delete
    @MarketId nvarchar(8)
as
begin
    delete from dbo.Market
    where MarketId = @MarketId
end
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaFileSelect]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaFileSelect]
(
@FileId int
)
AS
    SET NOCOUNT ON
SELECT [FileId],
[FileUID],
[FileName],
[Body],
DATALENGTH(Body) as Length FROM mcmd_MetaFile
WHERE
[FileId] = @FileId
GO
PRINT N'Creating [dbo].[ecf_Market_Update]...';


GO

create procedure dbo.ecf_Market_Update
    @MarketId nvarchar(8),
    @IsEnabled bit,
	@PricesIncludeTax bit,
    @MarketName nvarchar(50),
    @MarketDescription nvarchar(4000),
    @DefaultCurrencyCode nvarchar(8),
    @DefaultLanguageCode nvarchar(84),
    @CurrencyCodes udttCurrencyCode readonly,
    @LanguageCodes udttLanguageCode readonly,
    @CountryCodes udttCountryCode readonly
as
begin
    begin try
        declare @initialTranCount int = @@TRANCOUNT
        if @initialTranCount = 0 begin transaction

        if not exists (select 1 from @CurrencyCodes where CurrencyCode = @DefaultCurrencyCode) raiserror('Default currency must be included in the currency list.', 10, 0)
        if not exists (select 1 from @LanguageCodes where LanguageCode = @DefaultLanguageCode) raiserror('Default language must be included in the language list.', 10, 0)            

        update dbo.Market
        set Modified = GETUTCDATE(), IsEnabled = @IsEnabled, MarketName = @MarketName, MarketDescription = @MarketDescription, DefaultCurrencyCode = @DefaultCurrencyCode, DefaultLanguageCode = @DefaultLanguageCode, PricesIncludeTax = @PricesIncludeTax
        where MarketId = @MarketId
        
        delete mc
        from dbo.MarketCurrencies mc
        where mc.MarketId = @MarketId
          and not exists (select 1 from @CurrencyCodes cc where mc.CurrencyCode = cc.CurrencyCode)
        
        insert into dbo.MarketCurrencies (MarketId, CurrencyCode)
        select @MarketId, CurrencyCode
        from @CurrencyCodes cc
        where not exists (select 1 from dbo.MarketCurrencies mc where mc.MarketId = @MarketId and mc.CurrencyCode = cc.CurrencyCode)
        
        delete ml
        from dbo.MarketLanguages ml
        where ml.MarketId = @MarketId
          and not exists (select 1 from @LanguageCodes cc where ml.LanguageCode = cc.LanguageCode)
        
        insert into dbo.MarketLanguages (MarketId, LanguageCode)
        select @MarketId, LanguageCode
        from @LanguageCodes lc
        where not exists (select 1 from dbo.MarketLanguages ml where ml.MarketId = @MarketId and ml.LanguageCode = lc.LanguageCode)

        delete mc
        from dbo.MarketCountries mc
        where mc.MarketId = @MarketId
          and not exists (select 1 from @CountryCodes cc where mc.CountryCode = cc.CountryCode)

        insert into dbo.MarketCountries (MarketId, CountryCode)
        select @MarketId, CountryCode
        from @CountryCodes cc
        where not exists (select 1 from dbo.MarketCountries mc where mc.MarketId = @MarketId and mc.CountryCode = cc.CountryCode)

        if @initialTranCount = 0 commit transaction ecf_Market_Update
    end try
    begin catch
        declare @msg nvarchar(4000), @severity int, @state int
        select @msg = ERROR_MESSAGE(), @severity = ERROR_SEVERITY(), @state = ERROR_STATE()
        if @initialTranCount = 0 rollback transaction
        raiserror(@msg, @severity, @state)
    end catch
end
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaFileInsert]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaFileInsert]
(
@FileId int = NULL OUTPUT,
@FileUID uniqueidentifier,
@FileName nvarchar(510)
)
AS
    SET NOCOUNT ON
INSERT INTO [mcmd_MetaFile]
(
[FileUID],
[FileName])
VALUES(
@FileUID,
@FileName)
SELECT @FileId = SCOPE_IDENTITY();
RETURN @@Error
GO
PRINT N'Creating [dbo].[mc_OrderGroupLockSelect]...';


GO
CREATE PROCEDURE [dbo].[mc_OrderGroupLockSelect]
@OrderLockId AS Int
AS
BEGIN
SET NOCOUNT ON;

SELECT [t01].[OrderLockId] AS [OrderLockId], [t01].[CustomerId] AS [CustomerId], [t01].[Created] AS [Created], [t01].[OrderGroupId] AS [OrderGroupId]
FROM [OrderGroupLock] AS [t01]
WHERE ([t01].[OrderLockId]=@OrderLockId)

END
GO
PRINT N'Creating [dbo].[ecf_Setting_Name]...';


GO
CREATE PROCEDURE [dbo].[ecf_Setting_Name]
	@Name nvarchar(100)
AS
BEGIN
	select * from [CommonSettings] 
		where [Name] = @Name
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_DeleteMetaClassProcedure]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_DeleteMetaClassProcedure]
	@MetaClassId	INT
AS
	SET NOCOUNT ON

BEGIN TRAN
	IF NOT EXISTS( SELECT * FROM MetaClass WHERE MetaClassId = @MetaClassId)
	BEGIN
		RAISERROR ('Wrong @MetaClassId. The class is system or not existed.', 16,1)
		GOTO ERR
	END

	-- Step 1. Create SQL Code
	PRINT'Step 1. Create SQL Code'

	DECLARE	@MetaClassTable			NVARCHAR(256)
	DECLARE	@MetaClassGetSpName			NVARCHAR(256)
	DECLARE	@MetaClassUpdateSpName		NVARCHAR(256)
	DECLARE	@MetaClassDeleteSpName		NVARCHAR(256)
	DECLARE	@MetaClassListSpName		NVARCHAR(256)

	SELECT @MetaClassTable = TableName FROM MetaClass WHERE MetaClassId = @MetaClassId

	SET @MetaClassGetSpName 		= 'mdpsp_avto_' +@MetaClassTable +'_Get'
	SET @MetaClassUpdateSpName 	= 'mdpsp_avto_' +@MetaClassTable +'_Update'
	SET @MetaClassDeleteSpName 	= 'mdpsp_avto_' +@MetaClassTable +'_Delete'
	SET @MetaClassListSpName 	= 'mdpsp_avto_' +@MetaClassTable +'_List'

	-- Step 2. Drop operation
	PRINT'Step 2. Drop operation'

	if exists (select * from dbo.sysobjects where id = object_id(@MetaClassUpdateSpName) and OBJECTPROPERTY(id, N'IsProcedure') = 1)
		EXEC('drop procedure ' + @MetaClassUpdateSpName)
	IF @@ERROR <> 0 GOTO ERR

	if exists (select * from dbo.sysobjects where id = object_id(@MetaClassGetSpName) and OBJECTPROPERTY(id, N'IsProcedure') = 1)
		EXEC('drop procedure ' + @MetaClassGetSpName)
	IF @@ERROR <> 0 GOTO ERR

	if exists (select * from dbo.sysobjects where id = object_id(@MetaClassDeleteSpName) and OBJECTPROPERTY(id, N'IsProcedure') = 1)
		EXEC('drop procedure ' + @MetaClassDeleteSpName)
	IF @@ERROR <> 0 GOTO ERR

	if exists (select * from dbo.sysobjects where id = object_id(@MetaClassListSpName) and OBJECTPROPERTY(id, N'IsProcedure') = 1)
		EXEC('drop procedure ' + @MetaClassListSpName)
	IF @@ERROR <> 0 GOTO ERR

	COMMIT TRAN
	--PRINT('COMMIT TRAN')
RETURN

ERR:
	ROLLBACK TRAN
	--PRINT('ROLLBACK TRAN')
RETURN
GO
PRINT N'Creating [dbo].[ecf_Market_Create]...';


GO

create procedure dbo.ecf_Market_Create
    @MarketId nvarchar(8),
    @IsEnabled bit,
	@PricesIncludeTax bit, 
    @MarketName nvarchar(50),
    @MarketDescription nvarchar(4000),
    @DefaultCurrencyCode nvarchar(8),
    @DefaultLanguageCode nvarchar(84),
    @CurrencyCodes udttCurrencyCode readonly,
    @LanguageCodes udttLanguageCode readonly,
    @CountryCodes udttCountryCode readonly
as
begin
    begin try
        declare @initialTranCount int = @@TRANCOUNT
        if @initialTranCount = 0 begin transaction

        if not exists (select 1 from @CurrencyCodes where CurrencyCode = @DefaultCurrencyCode) raiserror('Default currency must be included in the currency list.', 10, 0)
        if not exists (select 1 from @LanguageCodes where LanguageCode = @DefaultLanguageCode) raiserror('Default language must be included in the language list.', 10, 0)            

        insert into dbo.Market (MarketId, Created, Modified, IsEnabled, MarketName, MarketDescription, DefaultCurrencyCode, DefaultLanguageCode, PricesIncludeTax)
        values (@MarketId, GETUTCDATE(), GETUTCDATE(), @IsEnabled, @MarketName, @MarketDescription, @DefaultCurrencyCode, @DefaultLanguageCode, @PricesIncludeTax)
        
        insert into dbo.MarketCurrencies (MarketId, CurrencyCode)
        select distinct @MarketId, CurrencyCode
        from @CurrencyCodes
        
        insert into dbo.MarketLanguages (MarketId, LanguageCode)
        select distinct @MarketId, LanguageCode
        from @LanguageCodes
        
        insert into dbo.MarketCountries (MarketId, CountryCode)
        select distinct @MarketId, CountryCode
        from @CountryCodes

        if @initialTranCount = 0 commit transaction ecf_Market_Create
    end try
    begin catch
        declare @msg nvarchar(4000), @severity int, @state int
        select @msg = ERROR_MESSAGE(), @severity = ERROR_SEVERITY(), @state = ERROR_STATE()
        if @initialTranCount = 0 rollback transaction
        raiserror(@msg, @severity, @state)
    end catch
end
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaFileDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaFileDelete]
(
@FileId int
)
AS
    SET NOCOUNT ON
DELETE FROM [mcmd_MetaFile]
WHERE
[FileId] = @FileId
RETURN @@Error
GO
PRINT N'Creating [dbo].[mc_OrderGroupLockDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_OrderGroupLockDelete]
@OrderLockId AS Int
AS
BEGIN
SET NOCOUNT ON;

DELETE FROM [OrderGroupLock]
WHERE
[OrderLockId] = @OrderLockId

END
GO
PRINT N'Creating [dbo].[ecf_Setting_SettingId]...';


GO
CREATE PROCEDURE [dbo].[ecf_Setting_SettingId]
	@SettingId int
AS
BEGIN
	select * from [CommonSettings] 
		where [SettingId] = @SettingId
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_DeleteMetaAttribute]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_DeleteMetaAttribute]
	@AttrOwnerId		INT,
	@AttrOwnerType	INT,
	@Key			NVARCHAR(512)
AS
	DELETE FROM MetaAttribute WHERE AttrOwnerId = @AttrOwnerId AND AttrOwnerType = @AttrOwnerType AND [Key] = @Key
GO
PRINT N'Creating [dbo].[ecf_Market_Get]...';


GO


create procedure dbo.ecf_Market_Get
    @MarketId nvarchar(8)
as
begin
    select
        m.MarketId,
        m.Created,
        m.Modified,
        m.IsEnabled,
		m.MarketName,
        m.MarketDescription,
        m.DefaultCurrencyCode,
        m.DefaultLanguageCode,
		m.PricesIncludeTax
    from dbo.Market m
    where m.MarketId = @MarketId
    
    select MarketId, CurrencyCode
    from dbo.MarketCurrencies
    where MarketId = @MarketId
    
    select MarketId, LanguageCode
    from dbo.MarketLanguages
    where MarketId = @MarketId

    select MarketId, CountryCode
    from dbo.MarketCountries
    where MarketId = @MarketId
end
GO
PRINT N'Creating [dbo].[mc_mcmd_TmpMetaFileMove]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_TmpMetaFileMove] 
	@FileUid uniqueidentifier
AS
            SET NOCOUNT ON

	INSERT INTO mcmd_MetaFile (FileUID, [FileName], Body)
	SELECT FileUID, [FileName], Body FROM mcmd_TmpMetaFile WHERE FileUID=@FileUid

	DELETE FROM mcmd_TmpMetaFile WHERE FileUID=@FileUID
GO
PRINT N'Creating [dbo].[mc_OrderGroupLockUpdate]...';


GO
CREATE PROCEDURE [dbo].[mc_OrderGroupLockUpdate]
@CustomerId AS UniqueIdentifier,
@Created AS DateTime,
@OrderGroupId AS Int,
@OrderLockId AS Int
AS
BEGIN
SET NOCOUNT ON;

UPDATE [OrderGroupLock] SET
[CustomerId] = @CustomerId,
[Created] = @Created,
[OrderGroupId] = @OrderGroupId WHERE
[OrderLockId] = @OrderLockId

END
GO
PRINT N'Creating [dbo].[ecf_Settings]...';


GO
CREATE PROCEDURE [dbo].[ecf_Settings]
AS
BEGIN
	select * from [CommonSettings] 
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_DeleteDContrainByTableAndField]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_DeleteDContrainByTableAndField]
	@TableName	NVARCHAR(256),
	@FieldName	NVARCHAR(256)
AS
	SET NOCOUNT ON

	DECLARE @DConstrainName NVARCHAR(256)

	DECLARE DConstrainCursor CURSOR local FOR
	    select df_constraints.name
	    from sys.objects df_constraints
	    join sys.columns cols on df_constraints.object_id = cols.default_object_id
	    where cols.object_id = OBJECT_ID(@TableName, 'TABLE')
	      and cols.name = @FieldName

	OPEN DConstrainCursor

	FETCH NEXT FROM DConstrainCursor  INTO @DConstrainName

	WHILE @@FETCH_STATUS = 0
	BEGIN
		EXEC('ALTER TABLE [dbo].[' + @TableName +'] DROP  CONSTRAINT '+ @DConstrainName)
		--
		FETCH NEXT FROM DConstrainCursor  INTO @DConstrainName
	END

	CLOSE DConstrainCursor
	DEALLOCATE DConstrainCursor
GO
PRINT N'Creating [dbo].[ecf_Market_GetAll]...';


GO

create procedure dbo.ecf_Market_GetAll
as
begin
    select MarketId, Created, Modified, IsEnabled, MarketName, MarketDescription, DefaultCurrencyCode, DefaultLanguageCode, PricesIncludeTax
    from dbo.Market
    
    select MarketId, CurrencyCode
    from dbo.MarketCurrencies
    
    select MarketId, LanguageCode
    from dbo.MarketLanguages

    select MarketId, CountryCode
    from dbo.MarketCountries
end
GO
PRINT N'Creating [dbo].[mc_tempsp_Remove]...';


GO
CREATE PROCEDURE [dbo].[mc_tempsp_Remove]
	@ExpirationDate DateTime
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @SpName NVARCHAR(255)
	DECLARE @DelQuery NVARCHAR(512)

	DECLARE TempSpList_Cursor CURSOR FOR
	SELECT name FROM dbo.sysobjects 
	WHERE 
		crdate <= @ExpirationDate AND
		name like N'tempsp_%' AND 
		OBJECTPROPERTY(id, N'IsProcedure') = 1

	OPEN TempSpList_Cursor

	FETCH NEXT FROM TempSpList_Cursor 
	INTO @SpName

	WHILE @@FETCH_STATUS = 0
	   BEGIN
			SET @DelQuery = N'DROP PROCEDURE [dbo].[' + @SpName +N']'
			--PRINT @DelQuery
			EXECUTE sp_executesql @DelQuery

			FETCH NEXT FROM TempSpList_Cursor 
			INTO @SpName
	   END

	CLOSE TempSpList_Cursor;
	DEALLOCATE TempSpList_Cursor;
END
GO
PRINT N'Creating [dbo].[mc_OrderGroupLockInsert]...';


GO
CREATE PROCEDURE [dbo].[mc_OrderGroupLockInsert]
@CustomerId AS UniqueIdentifier,
@Created AS DateTime,
@OrderGroupId AS Int,
@OrderLockId AS Int = NULL OUTPUT
AS
BEGIN
SET NOCOUNT ON;

INSERT INTO [OrderGroupLock]
(
[CustomerId],
[Created],
[OrderGroupId])
VALUES(
@CustomerId,
@Created,
@OrderGroupId)
SELECT @OrderLockId = SCOPE_IDENTITY();

END
GO
PRINT N'Creating [dbo].[ecf_Currency_Delete]...';


GO

create procedure dbo.ecf_Currency_Delete
    @CurrencyCode nvarchar(8)
as
begin
    delete from dbo.Currency
    where CurrencyCode = @CurrencyCode
end
GO
PRINT N'Creating [dbo].[mc_tempsp_RemoveAll]...';


GO

CREATE PROCEDURE [dbo].[mc_tempsp_RemoveAll]
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @SpName NVARCHAR(255)
	DECLARE @DelQuery NVARCHAR(512)

	DECLARE TempSpList_Cursor CURSOR FOR
	SELECT name FROM dbo.sysobjects 
	WHERE 
		name like N'tempsp_%' AND 
		OBJECTPROPERTY(id, N'sProcedure') = 1

	OPEN TempSpList_Cursor

	FETCH NEXT FROM TempSpList_Cursor 
	INTO @SpName

	WHILE @@FETCH_STATUS = 0
	   BEGIN
			SET @DelQuery = N'DROP PROCEDURE [dbo].[' + @SpName +N']'
			--PRINT @DelQuery
			EXECUTE sp_executesql @DelQuery

			FETCH NEXT FROM TempSpList_Cursor 
			INTO @SpName
	   END

	CLOSE TempSpList_Cursor;
	DEALLOCATE TempSpList_Cursor;
END
GO
PRINT N'Creating [dbo].[ecf_Currency_Update]...';


GO

create procedure dbo.ecf_Currency_Update
    @CurrencyCode nvarchar(8),
    @CurrencyName nvarchar(50)
as
begin
    update dbo.Currency
    set Modified = GETUTCDATE(), CurrencyName = @CurrencyName
    where CurrencyCode = @CurrencyCode
end
GO
PRINT N'Creating [dbo].[mc_tempsp_List]...';


GO

CREATE PROCEDURE [dbo].[mc_tempsp_List]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT name, crdate FROM dbo.[sysobjects]
	WHERE 
	name like N'tempsp_%' AND 
	OBJECTPROPERTY(id, N'IsProcedure') = 1
END
GO
PRINT N'Creating [dbo].[mc_OrderGroupNoteDelete]...';


GO
CREATE PROCEDURE [dbo].[mc_OrderGroupNoteDelete]
@OrderNoteId AS Int
AS
BEGIN
SET NOCOUNT ON;

DELETE FROM [OrderGroupNote]
WHERE
[OrderNoteId] = @OrderNoteId

END
GO
PRINT N'Creating [dbo].[ecf_ApplicationLog_LogId]...';


GO
CREATE PROCEDURE [dbo].[ecf_ApplicationLog_LogId]
	@LogId int
AS
BEGIN
	SELECT AL.* FROM ApplicationLog AL WHERE LogId = @LogId
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_CreateMetaClassProcedure]...';


GO
create procedure [dbo].[mdpsp_sys_CreateMetaClassProcedure]
    @MetaClassId int
as
begin
    set nocount on
    begin try
        declare @CRLF nchar(1) = CHAR(10)
        declare @MetaClassName nvarchar(256)
        declare @TableName sysname
        declare @IsEntryMetaClass bit = 0
        declare @IsNodeMetaClass bit = 0

        select @MetaClassName = Name, @TableName = TableName from MetaClass where MetaClassId = @MetaClassId
        SET @IsEntryMetaClass = (SELECT [dbo].[mdpfn_sys_IsInheritedFromMetaClass](@MetaClassId, 'CatalogEntry'))
        SET @IsNodeMetaClass = (SELECT [dbo].[mdpfn_sys_IsInheritedFromMetaClass](@MetaClassId, 'CatalogNode'))

        if @MetaClassName is null raiserror('Metaclass not found.',16,1)

        declare @azureCompatible bit
        SET @azureCompatible = (SELECT TOP 1 AzureCompatible FROM dbo.AzureCompatible)
        
        -- get required info for each field
        declare @ParameterIndex int
        declare @ColumnName sysname
        declare @FieldIsMultilanguage bit
        declare @FieldIsEncrypted bit
        declare @FieldIsNullable bit
        declare @ColumnDataType sysname
        declare fields cursor local for
            select
                mfindex.ParameterIndex,
                mf.Name as ColumnName,
                mf.MultiLanguageValue as FieldIsMultilanguage,
                mf.IsEncrypted as FieldIsEncrypted,
                mf.AllowNulls,
                mdt.SqlName + case
                        when mdt.Variable = 1 then 
							case when (mf.Length = -1) then '(max)'
							else '(' + CAST(mf.Length as nvarchar) + ')'
							end
                        when mf.DataTypeId in (5,24) and mfprecis.Value is not null and mfscale.Value is not null then '(' + cast(mfprecis.Value as nvarchar) + ',' + cast(mfscale.Value as nvarchar) + ')'
                        else '' end as ColumnDataType
            from (
                select ROW_NUMBER() over (order by innermf.Name) as ParameterIndex, innermf.MetaFieldId
                from MetaField innermf
                where innermf.SystemMetaClassId = 0
                  and exists (select 1 from MetaClassMetaFieldRelation cfr where cfr.MetaClassId = @MetaClassId and cfr.MetaFieldId = innermf.MetaFieldId)) mfindex
            join MetaField mf on mfindex.MetaFieldId = mf.MetaFieldId
            join MetaDataType mdt on mf.DataTypeId = mdt.DataTypeId
            left outer join MetaAttribute mfprecis on mf.MetaFieldId = mfprecis.AttrOwnerId and mfprecis.AttrOwnerType = 2 and mfprecis.[Key] = 'MdpPrecision'
            left outer join MetaAttribute mfscale on mf.MetaFieldId = mfscale.AttrOwnerId and mfscale.AttrOwnerType = 2 and mfscale.[Key] = 'MdpScale'

        -- aggregate field parts into lists for stored procedures
        declare @ParameterName nvarchar(max)
        declare @ColumnReadBase nvarchar(max)
        declare @ColumnReadLocal nvarchar(max)
        declare @WriteValue nvarchar(max)
        declare @ParameterDefinitions nvarchar(max) = ''
        declare @UnlocalizedSelectValues nvarchar(max) = ''
        declare @LocalizedSelectValues nvarchar(max) = ''
        declare @AllInsertColumns nvarchar(max) = ''
        declare @AllInsertValues nvarchar(max) = ''
        declare @BaseInsertColumns nvarchar(max) = ''
        declare @BaseInsertValues nvarchar(max) = ''
        declare @LocalInsertColumns nvarchar(max) = ''
        declare @LocalInsertValues nvarchar(max) = ''
        declare @AllUpdateActions nvarchar(max) = ''
        declare @BaseUpdateActions nvarchar(max) = ''
        declare @LocalUpdateActions nvarchar(max) = ''
        open fields
        while 1=1
        begin
            fetch next from fields into @ParameterIndex, @ColumnName, @FieldIsMultilanguage, @FieldIsEncrypted, @FieldIsNullable, @ColumnDataType
            if @@FETCH_STATUS != 0 break

            set @ParameterName = '@f' + cast(@ParameterIndex as nvarchar(10))
            set @ColumnReadBase = case when @azureCompatible <> 1 and @FieldIsEncrypted = 1 then 'dbo.mdpfn_sys_EncryptDecryptString(T.[' + @ColumnName + '],0)' + ' as [' + @ColumnName + ']' else 'T.[' + @ColumnName + ']' end
            set @ColumnReadLocal = case when @azureCompatible <> 1 and @FieldIsEncrypted = 1 then 'dbo.mdpfn_sys_EncryptDecryptString(L.[' + @ColumnName + '],0)' + ' as [' + @ColumnName + ']' else 'L.[' + @ColumnName + ']' end
            set @WriteValue = case when @azureCompatible <> 1 and @FieldIsEncrypted = 1 then 'dbo.mdpfn_sys_EncryptDecryptString(' + @ParameterName + ',1)' else @ParameterName end

            set @ParameterDefinitions = @ParameterDefinitions + ',' + @ParameterName + ' ' + @ColumnDataType
            set @UnlocalizedSelectValues = @UnlocalizedSelectValues + ',' + @ColumnReadBase
            set @LocalizedSelectValues = @LocalizedSelectValues + ',' + case when @FieldIsMultilanguage = 1 then @ColumnReadLocal else @ColumnReadBase end
            set @AllInsertColumns = @AllInsertColumns + ',[' + @ColumnName + ']'
            set @AllInsertValues = @AllInsertValues + ',' + @WriteValue
            set @BaseInsertColumns = @BaseInsertColumns + case when @FieldIsMultilanguage = 0 then ',[' + @ColumnName + ']' else '' end
            set @BaseInsertValues = @BaseInsertValues + case when @FieldIsMultilanguage = 0 then ',' + @WriteValue else '' end
            set @LocalInsertColumns = @LocalInsertColumns + case when @FieldIsMultilanguage = 1 then ',[' + @ColumnName + ']' else '' end
            set @LocalInsertValues = @LocalInsertValues + case when @FieldIsMultilanguage = 1 then ',' + @WriteValue else '' end
            set @AllUpdateActions = @AllUpdateActions + ',[' + @ColumnName + ']=' + @WriteValue
            set @BaseUpdateActions = @BaseUpdateActions + ',[' + @ColumnName + ']=' + case when @FieldIsMultilanguage = 0 then @WriteValue when @FieldIsNullable = 1 then 'null' else 'default' end
            set @LocalUpdateActions = @LocalUpdateActions + ',[' + @ColumnName + ']=' + case when @FieldIsMultilanguage = 1 then @WriteValue when @FieldIsNullable = 1 then 'null' else 'default' end
        end
        close fields

        declare @OpenEncryptionKey nvarchar(max)
        declare @CloseEncryptionKey nvarchar(max)
        if exists(  select 1
                    from MetaField mf
                    join MetaClassMetaFieldRelation cfr on mf.MetaFieldId = cfr.MetaFieldId
                    where cfr.MetaClassId = @MetaClassId and mf.SystemMetaClassId = 0 and mf.IsEncrypted = 1) and @azureCompatible <> 1
        begin
            set @OpenEncryptionKey = 'exec mdpsp_sys_OpenSymmetricKey' + @CRLF
            set @CloseEncryptionKey = 'exec mdpsp_sys_CloseSymmetricKey' + @CRLF
        end
        else
        begin
            set @OpenEncryptionKey = ''
            set @CloseEncryptionKey = ''
        end

        -- create stored procedures
        declare @procedures table (name sysname, defn nvarchar(max), verb nvarchar(max))
        IF @IsEntryMetaClass = 1 OR @IsNodeMetaClass = 1
        BEGIN
            insert into @procedures (name, defn)
            values ('mdpsp_avto_' + @TableName + '_ListSpecificRecord',
                'procedure dbo.[mdpsp_avto_' + @TableName + '_ListSpecificRecord] @Language nvarchar(20),@Count int as' + @CRLF +
                'begin' + @CRLF +
                    'if exists (SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = N''' + @TableName + ''') ' + @CRLF +
                    'begin' + @CRLF +
                        @OpenEncryptionKey +
                        'select TOP(@Count) T.ObjectId,C.IsActive,C.StartDate StartPublish,C.EndDate StopPublish,C.CatalogId,T.CreatorId,T.Created,T.ModifierId,T.Modified' + @LocalizedSelectValues + @CRLF +
                        'from [' + @TableName + '] T' + @CRLF +
                        'left join [' + @TableName + '_Localization] L on T.ObjectId=L.ObjectId and L.Language=@Language ' + @CRLF +
                        'inner join Catalog' + CASE WHEN @IsEntryMetaClass = 1 THEN 'Entry' ELSE 'Node' END + ' C on T.ObjectId = C.Catalog' + CASE WHEN @IsEntryMetaClass = 1 THEN 'Entry' ELSE 'Node' END + 'Id' + @CRLF +
						'inner join Catalog cat on cat.CatalogId = C.CatalogId ' + @CRLF +
						'inner join CatalogLanguage cl on cl.CatalogId = cat.CatalogId and cl.LanguageCode = @Language ' + @CRLF +
						'where C.MetaClassId = ' + CAST(@MetaClassId AS VARCHAR(16)) + @CRLF +
                        'order by T.ObjectId ASC ' + @CRLF +
                        @CloseEncryptionKey +
                    'end' + @CRLF +
                'end' + @CRLF)

            insert into @procedures (name, defn)
            values ('mdpsp_avto_' + @TableName + '_DeleteSpecificRecord',
                'procedure dbo.[mdpsp_avto_' + @TableName + '_DeleteSpecificRecord] @IdsToDelete dbo.udttIdTable readonly as' + @CRLF +
                'begin' + @CRLF +
                'DELETE M FROM [' + @TableName + '] M INNER JOIN @IdsToDelete I ON M.ObjectId = I.ID' + @CRLF +
                'DELETE M FROM [' + @TableName + '_Localization] M INNER JOIN @IdsToDelete I ON M.ObjectId = I.ID' + @CRLF +
                'end' + @CRLF)
        END
        ELSE
        BEGIN
            insert into @procedures (name, defn)
            values ('mdpsp_avto_' + @TableName + '_Get',
                'procedure dbo.[mdpsp_avto_' + @TableName + '_Get] @ObjectId int,@Language nvarchar(20)=null as ' + @CRLF +
                'begin' + @CRLF +
                @OpenEncryptionKey +
                'if @Language is null select T.ObjectId,T.CreatorId,T.Created,T.ModifierId,T.Modified' + @UnlocalizedSelectValues + @CRLF +
                'from [' + @TableName + '] T where ObjectId=@ObjectId' + @CRLF +
                'else select T.ObjectId,T.CreatorId,T.Created,T.ModifierId,T.Modified' + @LocalizedSelectValues + @CRLF +
                'from [' + @TableName + '] T' + @CRLF +
                'left join [' + @TableName + '_Localization] L on T.ObjectId=L.ObjectId and L.Language=@Language' + @CRLF +
                'where T.ObjectId= @ObjectId' + @CRLF +
                @CloseEncryptionKey +
                'end' + @CRLF)

            insert into @procedures (name, defn)
            values ('mdpsp_avto_' + @TableName + '_Update',
                'procedure dbo.[mdpsp_avto_' + @TableName + '_Update]' + @CRLF +
                '@ObjectId int,@Language nvarchar(20)=null,@CreatorId nvarchar(100),@Created datetime,@ModifierId nvarchar(100),@Modified datetime,@Retval int out' + @ParameterDefinitions + ' as' + @CRLF +
                'begin' + @CRLF +
                'set nocount on' + @CRLF +
                'declare @ins bit' + @CRLF +
                'begin try' + @CRLF +
                'begin transaction' + @CRLF +
                @OpenEncryptionKey +
                'if @ObjectId=-1 select @ObjectId=isnull(MAX(ObjectId),0)+1, @Retval=@ObjectId, @ins=0 from [' + @TableName + ']' + @CRLF +
                'else set @ins=case when exists(select 1 from [' + @TableName + '] where ObjectId=@ObjectId) then 0 else 1 end' + @CRLF +
                'if @Language is null' + @CRLF +
                'begin' + @CRLF +
                '  if @ins=1 insert [' + @TableName + '] (ObjectId,CreatorId,Created,ModifierId,Modified' + @AllInsertColumns + ')' + @CRLF +
                '  values (@ObjectId,@CreatorId,@Created,@ModifierId,@Modified' + @AllInsertValues + ')' + @CRLF +
                '  else update [' + @TableName + '] set CreatorId=@CreatorId,Created=@Created,ModifierId=@ModifierId,Modified=@Modified' + @AllUpdateActions + @CRLF +
                '  where ObjectId=@ObjectId' + @CRLF +
                'end' + @CRLF +
                'else' + @CRLF +
                'begin' + @CRLF +
                '  if @ins=1 insert [' + @TableName + '] (ObjectId,CreatorId,Created,ModifierId,Modified' + @BaseInsertColumns + ')' + @CRLF +
                '  values (@ObjectId,@CreatorId,@Created,@ModifierId,@Modified' + @BaseInsertValues + ')' + @CRLF +
                '  else update [' + @TableName + '] set CreatorId=@CreatorId,Created=@Created,ModifierId=@ModifierId,Modified=@Modified' + @BaseUpdateActions + @CRLF +
                '  where ObjectId=@ObjectId' + @CRLF +
                '  if not exists (select 1 from [' + @TableName + '_Localization] where ObjectId=@ObjectId and Language=@Language)' + @CRLF +
                '  insert [' + @TableName + '_Localization] (ObjectId,Language,ModifierId,Modified' + @LocalInsertColumns + ')' + @CRLF +
                '  values (@ObjectId,@Language,@ModifierId,@Modified' + @LocalInsertValues + ')' + @CRLF +
                '  else update [' + @TableName + '_Localization] set ModifierId=@ModifierId,Modified=@Modified' + @LocalUpdateActions + @CRLF +
                '  where ObjectId=@ObjectId and Language=@language' + @CRLF +
                'end' + @CRLF +
                @CloseEncryptionKey +
                'commit transaction' + @CRLF +
                'end try' + @CRLF +
                'begin catch' + @CRLF +
                '  declare @m nvarchar(4000),@v int,@t int' + @CRLF +
                '  select @m=ERROR_MESSAGE(),@v=ERROR_SEVERITY(),@t=ERROR_STATE()' + @CRLF +
                '  rollback transaction' + @CRLF +
                '  raiserror(@m, @v, @t)' + @CRLF +
                'end catch' + @CRLF +
                'end' + @CRLF)

            insert into @procedures (name, defn)
            values ('mdpsp_avto_' + @TableName + '_Delete',
                'procedure dbo.[mdpsp_avto_' + @TableName + '_Delete] @ObjectId int as' + @CRLF +
                'begin' + @CRLF +
                'delete [' + @TableName + '] where ObjectId=@ObjectId' + @CRLF +
                'delete [' + @TableName + '_Localization] where ObjectId=@ObjectId' + @CRLF +
				'DECLARE @AffectedMetaKeys udttIdTable ' + @CRLF +
					'INSERT INTO @AffectedMetaKeys ' + @CRLF +
				'SELECT MK.MetaKey ' + @CRLF +
					'FROM MetaKey MK ' + @CRLF +
				'WHERE MK.MetaObjectId = @ObjectId '  + @CRLF +
				'AND MK.MetaClassId = '+ CAST(@MetaClassId as nvarchar(10))  + @CRLF +
                'exec mdpsp_sys_DeleteMetaKeyObjects @AffectedMetaKeys ' + @CRLF +
				'end' + @CRLF)

            insert into @procedures (name, defn)
            values ('mdpsp_avto_' + @TableName + '_List',
                'procedure dbo.[mdpsp_avto_' + @TableName + '_List] @Language nvarchar(20)=null,@select_list nvarchar(max)='''',@search_condition nvarchar(max)='''' as' + @CRLF +
                'begin' + @CRLF +
                @OpenEncryptionKey +
                'if @Language is null select T.ObjectId,T.CreatorId,T.Created,T.ModifierId,T.Modified' + @UnlocalizedSelectValues + ' from [' + @TableName + '] T' + @CRLF +
                'else select T.ObjectId,T.CreatorId,T.Created,T.ModifierId,T.Modified' + @LocalizedSelectValues + @CRLF +
                'from [' + @TableName + '] T' + @CRLF +
                'left join [' + @TableName + '_Localization] L on T.ObjectId=L.ObjectId and L.Language=@Language' + @CRLF +
                @CloseEncryptionKey +
                'end' + @CRLF)

            insert into @procedures (name, defn)
            values ('mdpsp_avto_' + @TableName + '_Search',
                'procedure dbo.[mdpsp_avto_' + @TableName + '_Search] @Language nvarchar(20)=null,@select_list nvarchar(max)='''',@search_condition nvarchar(max)='''' as' + @CRLF +
                'begin' + @CRLF +
                'if len(@select_list)>0 set @select_list='',''+@select_list' + @CRLF +
                @OpenEncryptionKey +
                'if @Language is null exec(''select T.ObjectId,T.CreatorId,T.Created,T.ModifierId,T.Modified' + @UnlocalizedSelectValues + '''+@select_list+'' from [' + @TableName + '] T ''+@search_condition)' + @CRLF +
                'else exec(''select T.ObjectId,T.CreatorId,T.Created,T.ModifierId,T.Modified' + @LocalizedSelectValues + '''+@select_list+'' from [' + @TableName + '] T left join [' + @TableName + '_Localization] L on T.ObjectId=L.ObjectId and L.Language=@Language ''+@search_condition)' + @CRLF +
                @CloseEncryptionKey +
                'end' + @CRLF)
        END

        update tgt
        set verb = case when r.ROUTINE_NAME is null then 'create ' else 'alter ' end
        from @procedures tgt
        left outer join INFORMATION_SCHEMA.ROUTINES r on r.ROUTINE_SCHEMA COLLATE DATABASE_DEFAULT = 'dbo' and r.ROUTINE_NAME COLLATE DATABASE_DEFAULT = tgt.name COLLATE DATABASE_DEFAULT

        -- install procedures
        declare @sqlstatement nvarchar(max)
        declare procedure_cursor cursor local for select verb + defn from @procedures
        open procedure_cursor
        while 1=1
        begin
            fetch next from procedure_cursor into @sqlstatement
            if @@FETCH_STATUS != 0 break
            exec(@sqlstatement)
        end
        close procedure_cursor
    end try
    begin catch
        declare @m nvarchar(4000), @v int, @t int
        select @m = ERROR_MESSAGE(), @v = ERROR_SEVERITY(), @t = ERROR_STATE()
        raiserror(@m,@v,@t)
    end catch
end
GO
PRINT N'Creating [dbo].[ecf_Currency_Create]...';


GO

create procedure dbo.ecf_Currency_Create
    @CurrencyCode nvarchar(8),
    @CurrencyName nvarchar(50)
as
begin
    begin try
        declare @initialTranCount int = @@TRANCOUNT
        if @initialTranCount = 0 begin transaction
        
        if (select COUNT(*) from Application) != 1 raiserror('Multiple applications are not supported.', 10, 0)
        
        insert into dbo.Currency (CurrencyCode, Created, Modified, CurrencyName)
        select @CurrencyCode, GETUTCDATE(), GETUTCDATE(), @CurrencyName
        from Application a

        if @initialTranCount = 0 commit transaction
    end try
    begin catch
        declare @msg nvarchar(4000), @severity int, @state int
        select @msg = ERROR_MESSAGE(), @severity = ERROR_SEVERITY(), @state = ERROR_STATE()
        if @initialTranCount = 0 rollback transaction
        raiserror(@msg, @severity, @state)
    end catch
end
GO
PRINT N'Creating [dbo].[mc_mcmd_MetaEnumSelectMaxId]...';


GO
CREATE PROCEDURE [dbo].[mc_mcmd_MetaEnumSelectMaxId]
(
@TypeName nvarchar(255)
)
AS
SELECT Max([Id])
FROM mcmd_MetaEnum
WHERE
[TypeName] = @TypeName
GO
PRINT N'Creating [dbo].[ecf_ApplicationLog]...';


GO
CREATE PROCEDURE [dbo].[ecf_ApplicationLog]
	@IsSystemLog bit = 0,
	@Source nvarchar(100) = null,
	@Created datetime = null,
	@Operation nvarchar(50) = null,
	@ObjectType nvarchar(50) = null,
    @StartingRec int,
	@NumRecords int
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @SystemLogKey nvarchar(100)
	SET @SystemLogKey = 'system'; 

	WITH OrderedLogs AS 
	(
		select *, row_number() over(order by LogId desc) as RowNumber from ApplicationLog 
			where ((@IsSystemLog = 1 AND Source = @SystemLogKey) OR (@IsSystemLog = 0 AND NOT Source = @SystemLogKey))
				AND COALESCE(@Source, Source) = Source 
				AND COALESCE(@Operation, Operation) = Operation 
				AND COALESCE(@ObjectType, ObjectType) = ObjectType 
				AND COALESCE(@Created, Created) >= Created
	),
	OrderedLogsCount(TotalCount) as
	(
		select count(LogId) from OrderedLogs
	)
	select LogId, Source, Operation, ObjectKey, ObjectType, Username, Created, Succeeded, IPAddress, Notes, TotalCount from OrderedLogs, OrderedLogsCount
	where RowNumber between @StartingRec and @StartingRec + @NumRecords
	SET NOCOUNT OFF;
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_DeleteMetaKeyObjects]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_DeleteMetaKeyObjects]
	@MetaKeys	[dbo].[udttIdTable] READONLY
	
AS
BEGIN	
	
	IF EXISTS (SELECT 1 FROM @MetaKeys)
	BEGIN
		-- Delete MetaObjectValue
		DELETE MO FROM MetaObjectValue MO INNER JOIN @MetaKeys M ON MO.MetaKey = M.ID
		
		-- Delete MetaStringDictionaryValue
		DELETE MSD FROM MetaStringDictionaryValue MSD INNER JOIN @MetaKeys M ON MSD.MetaKey = M.ID
		
		--Delete MetaMultiValueDictionary
		DELETE MV FROM MetaMultiValueDictionary MV INNER JOIN @MetaKeys M ON MV.MetaKey = M.ID
		
		--Delete MetaFileValue
		DELETE MF FROM MetaFileValue MF INNER JOIN @MetaKeys M ON MF.MetaKey = M.ID
		
		--Delete MetaKey
		DELETE MK FROM MetaKey MK INNER JOIN @MetaKeys M ON MK.MetaKey = M.ID
		
	END
END
GO
PRINT N'Creating [dbo].[ecf_Currency_Get]...';


GO

create procedure dbo.ecf_Currency_Get
    @CurrencyCode nvarchar(8)
as
begin
    select CurrencyCode, CurrencyName
    from dbo.Currency
    where CurrencyCode = @CurrencyCode
end
GO
PRINT N'Creating [dbo].[ecf_Application]...';


GO
CREATE PROCEDURE [dbo].[ecf_Application]
    @ApplicationName nvarchar(200) = null,
    @IsActive bit = null
AS
begin
    select Name, IsActive
    from [Application]
    where isnull(@ApplicationName, Name) = Name
      and isnull(@IsActive, IsActive) = IsActive
end
GO
PRINT N'Creating [dbo].[mdpsp_sys_CloseSymmetricKey]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_CloseSymmetricKey] AS
	-- encryption is disabled by default. To enable encryption, execute EncryptionSupport.sql file of EPiServer.Commerce.Core package.
GO
PRINT N'Creating [dbo].[ecf_Currency_GetAll]...';


GO

create procedure dbo.ecf_Currency_GetAll
as
begin
    select CurrencyCode, CurrencyName
    from dbo.Currency
end
GO
PRINT N'Creating [dbo].[mdpsp_sys_OpenSymmetricKey]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_OpenSymmetricKey] AS
	-- encryption is disabled by default. To enable encryption, execute EncryptionSupport.sql file of EPiServer.Commerce.Core package.
GO
PRINT N'Creating [dbo].[mdpsp_sys_ClearMetaAttribute]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_ClearMetaAttribute]
	@AttrOwnerId		INT,
	@AttrOwnerType	INT
AS
	DELETE FROM MetaAttribute WHERE AttrOwnerId = @AttrOwnerId AND AttrOwnerType = @AttrOwnerType
GO
PRINT N'Creating [dbo].[CatalogNode_Delete]...';


GO
CREATE TRIGGER [dbo].[CatalogNode_Delete] ON CatalogNode FOR DELETE
AS
	--Delete all draft of deleted nodes
	DELETE d FROM ecfVersion d
	INNER JOIN deleted ON d.ObjectId = deleted.CatalogNodeId AND d.ObjectTypeId = 1

	--Delete all extra info of deleted nodes
	DELETE c FROM CatalogContentEx c 
	INNER JOIN deleted ON c.ObjectId = deleted.CatalogNodeId AND c.ObjectTypeId = 1

	--Delete all properties of deleted nodes
	DELETE p FROM CatalogContentProperty p
	INNER JOIN deleted ON p.ObjectId = deleted.CatalogNodeId AND p.ObjectTypeId = 1

	DECLARE @AffectedMetaKeys udttIdTable
	INSERT INTO @AffectedMetaKeys
	SELECT MK.MetaKey
	FROM MetaKey MK
		INNER JOIN deleted D
		ON MK.MetaObjectId = D.CatalogNodeId AND MK.MetaClassId = D.MetaClassId
	
	EXEC mdpsp_sys_DeleteMetaKeyObjects  @MetaKeys = @AffectedMetaKeys
GO
PRINT N'Creating [dbo].[CatalogEntry_Delete]...';


GO
CREATE TRIGGER [dbo].[CatalogEntry_Delete] ON CatalogEntry FOR DELETE
AS
	--Delete all draft of deleted entries
	DELETE d FROM ecfVersion d
	INNER JOIN deleted ON d.ObjectId = deleted.CatalogEntryId AND d.ObjectTypeId = 0

	--Delete all extra info of deleted entries
	DELETE c FROM CatalogContentEx c 
	INNER JOIN deleted ON c.ObjectId = deleted.CatalogEntryId AND c.ObjectTypeId = 0

	--Delete all properties of deleted entries
	DELETE p FROM CatalogContentProperty p
	INNER JOIN deleted ON p.ObjectId = deleted.CatalogEntryId AND p.ObjectTypeId = 0

	--Only need to delete metakey objects if they exist
	DECLARE @AffectedMetaKeys udttIdTable
	INSERT INTO @AffectedMetaKeys
	SELECT DISTINCT MK.MetaKey
	FROM MetaKey MK
		INNER JOIN deleted D
		ON MK.MetaObjectId = D.CatalogEntryId AND MK.MetaClassId = D.MetaClassId
	
	EXEC mdpsp_sys_DeleteMetaKeyObjects @AffectedMetaKeys
GO
PRINT N'Creating [dbo].[ecfVersion_UpdateMasterLanguage]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_UpdateMasterLanguage]
	@ObjectId			int,
	@ObjectTypeId		int
AS
BEGIN
	CREATE TABLE #RecursiveContents (ObjectId INT, ObjectTypeId INT)
	DECLARE @catalogId INT
	DECLARE @masterLanguage NVARCHAR(40)

	-- in case node content
	IF @ObjectTypeId = 1 
	BEGIN
		-- Get all nodes and entries under the @objectId
		DECLARE @catalogNodeIds udttCatalogNodeList
		INSERT INTO @catalogNodeIds VALUES (@ObjectId)

		DECLARE @hierarchy udttCatalogNodeList
		INSERT @hierarchy EXEC ecf_CatalogNode_GetAllChildNodes @catalogNodeIds

		INSERT INTO #RecursiveContents (ObjectId, ObjectTypeId) SELECT CatalogNodeId, 1 FROM @hierarchy

		INSERT INTO #RecursiveContents (ObjectId, ObjectTypeId)
		SELECT DISTINCT ce.CatalogEntryId, 0
		FROM CatalogEntry ce
		INNER JOIN NodeEntryRelation ner ON ce.CatalogEntryId = ner.CatalogEntryId
		INNER JOIN @hierarchy h ON h.CatalogNodeId = ner.CatalogNodeId

		-- get CatalogId from node content
		SELECT @catalogId = n.CatalogId, @masterLanguage = c.DefaultLanguage
		FROM CatalogNode n
		INNER JOIN Catalog c ON c.CatalogId = n.CatalogId
		WHERE CatalogNodeId = @ObjectId
	END
	ELSE
	BEGIN
		-- in case entry content, just update for only entry
		INSERT INTO #RecursiveContents (ObjectId, ObjectTypeId)
		VALUES (@ObjectId, @ObjectTypeId)

		-- get CatalogId from entry content
		SELECT @catalogId = e.CatalogId, @masterLanguage = c.DefaultLanguage 
		FROM CatalogEntry e
		INNER JOIN Catalog c ON c.CatalogId = e.CatalogId
		WHERE CatalogEntryId = @ObjectId
	END

	UPDATE v
	SET
		MasterLanguageName = @masterLanguage,
		v.CatalogId = @catalogId
	FROM	ecfVersion v
	INNER JOIN #RecursiveContents r ON r.ObjectId = v.ObjectId AND r.ObjectTypeId = v.ObjectTypeId

	DROP TABLE #RecursiveContents
END
GO
PRINT N'Creating [dbo].[ecf_CatalogNodeItemSeo_ValidateUriAndUriSegment]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogNodeItemSeo_ValidateUriAndUriSegment]
	@CatalogItemSeo dbo.udttCatalogItemSeo readonly
AS
BEGIN
	-- validate Node Uri and Uri Segment, then return invalid record
	DECLARE @ValidSeoUri dbo.udttCatalogItemSeo
	DECLARE @ValidUriSegment dbo.udttCatalogItemSeo
	
	INSERT INTO @ValidSeoUri ([LanguageCode], [CatalogNodeId], [CatalogEntryId], [Uri], [UriSegment] ) 
		EXEC [ecf_CatalogNodeItemSeo_ValidateUri] @CatalogItemSeo		
	
	INSERT INTO @ValidUriSegment ([LanguageCode], [CatalogNodeId], [CatalogEntryId], [Uri], [UriSegment] ) 
		EXEC [ecf_CatalogNodeItemSeo_ValidateUriSegment] @CatalogItemSeo

	MERGE @ValidSeoUri as U
	USING @ValidUriSegment as S
	ON 
		U.LanguageCode = S.LanguageCode COLLATE DATABASE_DEFAULT AND 
		U.CatalogNodeId = S.CatalogNodeId
	WHEN MATCHED -- update the UriSegment for existing row in #ValidSeoUri
		THEN UPDATE SET U.UriSegment = S.UriSegment
	WHEN NOT MATCHED BY TARGET -- insert new record if the record is does not exist in #ValidSeoUri table (source table)
		THEN INSERT VALUES(S.LanguageCode, S.CatalogNodeId, S.CatalogEntryId, S.Uri, S.UriSegment)
	;

	SELECT * FROM @ValidSeoUri
END
GO
PRINT N'Creating [dbo].[CatalogContentProperty_LoadAllLanguages]...';


GO
CREATE PROCEDURE [dbo].[CatalogContentProperty_LoadAllLanguages]
	@ObjectId int,
	@ObjectTypeId int,
	@MetaClassId int
AS
BEGIN   
	EXEC mdpsp_sys_OpenSymmetricKey

	SELECT P.ObjectId, P.ObjectTypeId, P.MetaFieldId, P.MetaClassId, P.CultureSpecific, P.MetaFieldName, P.LanguageName,
						P.Boolean, P.Number, P.FloatNumber, P.[Money], P.[Decimal], P.[Date], P.[Binary], P.[String], 
						CASE WHEN (F.IsEncrypted = 1 AND dbo.mdpfn_sys_IsLongStringMetaField(F.DataTypeId) = 1 )
						THEN dbo.mdpfn_sys_EncryptDecryptString(P.LongString, 0) 
						ELSE P.LongString END AS LongString, 
						P.[Guid]  
	FROM dbo.CatalogContentProperty P
	INNER JOIN MetaField F ON P.MetaFieldId = F.MetaFieldId
	WHERE ObjectId = @ObjectId AND
			ObjectTypeId = @ObjectTypeId AND
			MetaClassId = @MetaClassId

	EXEC mdpsp_sys_CloseSymmetricKey
	
	-- Select CatalogContentEx data
	EXEC CatalogContentEx_Load @ObjectId, @ObjectTypeId
END
GO
PRINT N'Creating [dbo].[CatalogContentProperty_LoadBatch]...';


GO
CREATE PROCEDURE [dbo].[CatalogContentProperty_LoadBatch]
	@PropertyReferences [udttCatalogContentPropertyReference] READONLY
AS
BEGIN
	
	IF dbo.mdpfn_sys_IsAzureCompatible() = 0  --Fields will be encrypted only when DB does not support Azure
		BEGIN
		EXEC mdpsp_sys_OpenSymmetricKey
		
		;WITH CTE1 AS (
			SELECT R.*, E.CatalogId
			FROM @PropertyReferences R
			INNER JOIN CatalogEntry E ON E.CatalogEntryId = R.ObjectId AND R.ObjectTypeId = 0
		UNION ALL
			SELECT R.*, N.CatalogId
			FROM @PropertyReferences R
			INNER JOIN CatalogNode N ON N.CatalogNodeId = R.ObjectId AND R.ObjectTypeId = 1
		),
		CTE2 AS (
			SELECT CTE1.ObjectId, CTE1.ObjectTypeId, CTE1.MetaClassId, CTE1.LanguageName, C.DefaultLanguage
			FROM CTE1
			INNER JOIN [Catalog] C ON C.CatalogId = CTE1.CatalogId
			INNER JOIN CatalogLanguage L ON L.CatalogId = CTE1.CatalogId AND L.LanguageCode = CTE1.LanguageName
		)
		-- Select CatalogContentProperty data
		SELECT P.ObjectId, P.ObjectTypeId, P.MetaFieldId, P.MetaClassId, P.MetaFieldName, P.LanguageName,
							P.Boolean, P.Number, P.FloatNumber, P.[Money], P.[Decimal], P.[Date], P.[Binary], P.[String], 
							CASE WHEN (F.IsEncrypted = 1 AND dbo.mdpfn_sys_IsLongStringMetaField(F.DataTypeId) = 1) 
								THEN dbo.mdpfn_sys_EncryptDecryptString(P.LongString, 0) 
								ELSE P.LongString END 
							AS LongString,
							P.[Guid]  
		FROM dbo.CatalogContentProperty P
		INNER JOIN MetaField F ON P.MetaFieldId = F.MetaFieldId
		INNER JOIN CTE2 ON
			P.ObjectId = CTE2.ObjectId AND
			P.ObjectTypeId = CTE2.ObjectTypeId AND
			P.MetaClassId = CTE2.MetaClassId AND
			((P.CultureSpecific = 1 AND P.LanguageName = CTE2.LanguageName COLLATE DATABASE_DEFAULT) OR ((P.CultureSpecific = 0 AND P.LanguageName = CTE2.DefaultLanguage COLLATE DATABASE_DEFAULT)))

		EXEC mdpsp_sys_CloseSymmetricKey
		END
	ELSE
		BEGIN
		
		;WITH CTE1 AS (
			SELECT R.*, E.CatalogId
			FROM @PropertyReferences R
			INNER JOIN CatalogEntry E ON E.CatalogEntryId = R.ObjectId AND R.ObjectTypeId = 0
		UNION ALL
			SELECT R.*, N.CatalogId
			FROM @PropertyReferences R
			INNER JOIN CatalogNode N ON N.CatalogNodeId = R.ObjectId AND R.ObjectTypeId = 1
		),
		CTE2 AS (
			SELECT CTE1.ObjectId, CTE1.ObjectTypeId, CTE1.MetaClassId, CTE1.LanguageName, C.DefaultLanguage
			FROM CTE1
			INNER JOIN [Catalog] C ON C.CatalogId = CTE1.CatalogId
			INNER JOIN CatalogLanguage L ON L.CatalogId = CTE1.CatalogId AND L.LanguageCode = CTE1.LanguageName
		)	
		SELECT P.ObjectId, P.ObjectTypeId, P.MetaFieldId, P.MetaClassId, P.MetaFieldName, P.LanguageName,
							P.Boolean, P.Number, P.FloatNumber, P.[Money], P.[Decimal], P.[Date], P.[Binary], P.[String], P.LongString LongString,
							P.[Guid]  
		FROM dbo.CatalogContentProperty P
		INNER JOIN CTE2 ON
			P.ObjectId = CTE2.ObjectId AND
			P.ObjectTypeId = CTE2.ObjectTypeId AND
			P.MetaClassId = CTE2.MetaClassId AND
			((P.CultureSpecific = 1 AND P.LanguageName = CTE2.LanguageName COLLATE DATABASE_DEFAULT) OR ((P.CultureSpecific = 0 AND P.LanguageName = CTE2.DefaultLanguage COLLATE DATABASE_DEFAULT)))
		END

	-- Select CatalogContentEx data
	SELECT *
	FROM dbo.CatalogContentEx Ex 
	INNER JOIN @PropertyReferences R ON Ex.ObjectId = R.ObjectId AND Ex.ObjectTypeId = R.ObjectTypeId
END
GO
PRINT N'Creating [dbo].[ecfVersionProperty_SyncBatchPublishedVersion]...';


GO
CREATE PROCEDURE [dbo].[ecfVersionProperty_SyncBatchPublishedVersion]
	@ContentDraftProperty dbo.udttCatalogContentProperty READONLY
AS
BEGIN	
	
	DECLARE @propertyData udttCatalogContentProperty

	IF dbo.mdpfn_sys_IsAzureCompatible() = 0 -- Fields will be encrypted only when only when DB does not support Azure
	BEGIN
		--update encrypted field: support only LongString field
		EXEC mdpsp_sys_OpenSymmetricKey

		INSERT INTO @propertyData (
			WorkId, ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, Boolean, Number,
			FloatNumber, [Money], [Decimal], [Date], [Binary], String,
			LongString,
			[Guid], [IsNull])
		SELECT
			ccd.WorkId, ccd.ObjectId, ccd.ObjectTypeId, cdp.MetaFieldId, cdp.MetaClassId, cdp.MetaFieldName, cdp.LanguageName, cdp.Boolean, cdp.Number,
			cdp.FloatNumber, cdp.[Money], cdp.[Decimal], cdp.[Date], cdp.[Binary], cdp.String, 
			CASE WHEN cdp.IsEncrypted = 1 THEN dbo.mdpfn_sys_EncryptDecryptString(cdp.LongString, 1) ELSE cdp.LongString END AS LongString, 
			cdp.[Guid], cdp.[IsNull]
		FROM @ContentDraftProperty cdp
		INNER JOIN ecfVersion ccd
		ON	ccd.ObjectId = cdp.ObjectId AND
			ccd.ObjectTypeId = cdp.ObjectTypeId AND
			ccd.LanguageName = cdp.LanguageName COLLATE DATABASE_DEFAULT
		WHERE ccd.[Status] = 4 OR ccd.IsCommonDraft = 1 --Draft properties of published version/common draft will be sync

		EXEC mdpsp_sys_CloseSymmetricKey
	END
	ELSE
	BEGIN
		INSERT INTO @propertyData (
			WorkId, ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, Boolean, Number,
			FloatNumber, [Money], [Decimal], [Date], [Binary], String, LongString, [Guid], [IsNull])
		SELECT ccd.WorkId, ccd.ObjectId, ccd.ObjectTypeId, cdp.MetaFieldId, cdp.MetaClassId, cdp.MetaFieldName, cdp.LanguageName, cdp.Boolean, cdp.Number,
			cdp.FloatNumber, cdp.[Money], cdp.[Decimal], cdp.[Date], cdp.[Binary], cdp.String, cdp.LongString, cdp.[Guid], cdp.[IsNull]
		FROM @ContentDraftProperty cdp
		INNER JOIN ecfVersion ccd
		ON	ccd.ObjectId = cdp.ObjectId AND
			ccd.ObjectTypeId = cdp.ObjectTypeId AND
			ccd.LanguageName = cdp.LanguageName COLLATE DATABASE_DEFAULT
		WHERE ccd.[Status] = 4 OR ccd.IsCommonDraft = 1 --Draft properties of published version/common draft will be sync
	END

	-- delete rows where values have been nulled out
	DELETE A 
	FROM [dbo].[ecfVersionProperty] A
	INNER JOIN @propertyData T
	ON	A.WorkId = T.WorkId AND 
		A.MetaFieldId = T.MetaFieldId AND
		T.[IsNull] = 1

	-- now null rows are handled, so remove them to not insert empty rows
	DELETE FROM @propertyData
	WHERE [IsNull] = 1

	-- update/insert items which are not in input
	MERGE	[dbo].[ecfVersionProperty] as A
	USING	@propertyData as I
	ON		A.WorkId = I.WorkId AND
			A.MetaFieldId = I.MetaFieldId 
	WHEN	MATCHED 
		-- update the ecfVersionProperty for existing row
		THEN UPDATE SET 		
			A.LanguageName = I.LanguageName,	
			A.Boolean = I.Boolean, 
			A.Number = I.Number, 
			A.FloatNumber = I.FloatNumber, 
			A.[Money] = I.[Money], 
			A.[Decimal] = I.[Decimal],
			A.[Date] = I.[Date], 
			A.[Binary] = I.[Binary], 
			A.[String] = I.[String], 
			A.LongString = I.LongString, 
			A.[Guid] = I.[Guid]

	WHEN	NOT MATCHED BY TARGET 
		-- insert new record if the record is does not exist in ecfVersionProperty table
		THEN 
			INSERT (
				WorkId, ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, Boolean, Number, 
				FloatNumber, [Money], [Decimal], [Date], [Binary], [String], LongString, [Guid])
			VALUES (
				I.WorkId, I.ObjectId, I.ObjectTypeId, I.MetaFieldId, I.MetaClassId, I.MetaFieldName, I.LanguageName, I.Boolean, I.Number, 
				I.FloatNumber, I.[Money], I.[Decimal], I.[Date], I.[Binary], I.[String], I.LongString, I.[Guid])
	;

	--Sync version properties with version
	UPDATE [dbo].[ecfVersion]
     SET [StartPublish] = I.[Date]
	FROM @PropertyData as I
	INNER JOIN [dbo].[ecfVersion] E 
		ON E.[WorkId] = I.[WorkId] 
	WHERE I.[MetaFieldName] = 'Epi_StartPublish'
	 
	  
	UPDATE [dbo].[ecfVersion]
     SET [StopPublish] = I.[Date]
	FROM @PropertyData as I
	INNER JOIN [dbo].[ecfVersion] E
		ON E.[WorkId] = I.[WorkId]
	WHERE I.[MetaFieldName] = 'Epi_StopPublish'

	UPDATE [dbo].[ecfVersion]
     SET [Status] = CASE when I.[Boolean] = 0 THEN 2
					ELSE 4 END
	FROM @PropertyData as I
	INNER JOIN [dbo].[ecfVersion] E
		ON E.[WorkId] = I.[WorkId]
	WHERE I.[MetaFieldName] = 'Epi_IsPublished'

END
GO
PRINT N'Creating [dbo].[CatalogContentProperty_SaveBatch]...';


GO

CREATE PROCEDURE [dbo].[CatalogContentProperty_SaveBatch]
	@ContentProperty dbo.udttCatalogContentProperty readonly,
	@Data dbo.[udttCatalogContentEx] readonly,
	@SyncVersion bit = 1
AS
BEGIN
	--delete items which are not in input
	DELETE A
	FROM [dbo].[CatalogContentProperty] A
	INNER JOIN @ContentProperty I
	ON	A.ObjectId = I.ObjectId AND
		A.ObjectTypeId = I.ObjectTypeId AND
		A.LanguageName = I.LanguageName COLLATE DATABASE_DEFAULT AND
		A.MetaFieldId = I.MetaFieldId
	WHERE I.[IsNull] = 1

	--update encrypted field: support only LongString field
	DECLARE @propertyData dbo.udttCatalogContentProperty

	IF dbo.mdpfn_sys_IsAzureCompatible() = 0 -- Fields will be encrypted only when only when DB does not support Azure
		BEGIN
			EXEC mdpsp_sys_OpenSymmetricKey

			INSERT INTO @propertyData (
				ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, CultureSpecific, Boolean, Number,
				FloatNumber, [Money], [Decimal], [Date], [Binary], [String],
				LongString,
				[Guid])
			SELECT
				ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, CultureSpecific, Boolean, Number,
				FloatNumber, [Money], [Decimal], [Date], [Binary], [String],
				CASE WHEN IsEncrypted = 1 THEN dbo.mdpfn_sys_EncryptDecryptString(LongString, 1) ELSE LongString END AS LongString,
				[Guid]
			FROM @ContentProperty
			WHERE [IsNull] = 0

			EXEC mdpsp_sys_CloseSymmetricKey
		END
	ELSE
		BEGIN
			INSERT INTO @propertyData (
				ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, CultureSpecific, Boolean, Number,
				FloatNumber, [Money], [Decimal], [Date], [Binary], [String], LongString, [Guid])
			SELECT
				ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, CultureSpecific, Boolean, Number,
				FloatNumber, [Money], [Decimal], [Date], [Binary], [String], LongString, [Guid]
			FROM @ContentProperty
			WHERE [IsNull] = 0
		END

	-- update/insert items which are not in input
	MERGE	[dbo].[CatalogContentProperty] as A
	USING	@propertyData as I
	ON		A.ObjectId = I.ObjectId AND
			A.ObjectTypeId = I.ObjectTypeId AND
			A.MetaFieldId = I.MetaFieldId AND
			A.LanguageName = I.LanguageName COLLATE DATABASE_DEFAULT
	WHEN	MATCHED
		-- update the CatalogContentProperty for existing row
		THEN UPDATE SET
			A.MetaClassId = I.MetaClassId,
			A.MetaFieldName = I.MetaFieldName,
			A.Boolean = I.Boolean,
			A.Number = I.Number,
			A.FloatNumber = I.FloatNumber,
			A.[Money] = I.[Money],
			A.[Decimal] = I.[Decimal],
			A.[Date] = I.[Date],
			A.[Binary] = I.[Binary],
			A.[String] = I.[String],
			A.LongString = I.LongString,
			A.[Guid] = I.[Guid]

	WHEN NOT MATCHED BY TARGET
		-- insert new record if the record does not exist in CatalogContentProperty table
		THEN
			INSERT (
				ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, CultureSpecific, Boolean, Number,
				FloatNumber, [Money], [Decimal], [Date], [Binary], [String], LongString, [Guid])
			VALUES (
				I.ObjectId, I.ObjectTypeId, I.MetaFieldId, I.MetaClassId, I.MetaFieldName, I.LanguageName, I.CultureSpecific, I.Boolean, I.Number,
				I.FloatNumber, I.[Money], I.[Decimal], I.[Date], I.[Binary], I.[String], I.LongString, I.[Guid])
	;

	-- Update ecfVersionProperty
	IF (@SyncVersion = 1)
	BEGIN
		EXEC ecfVersionProperty_SyncBatchPublishedVersion @ContentProperty
	END

	-- Update CatalogContentEx
	EXEC CatalogContentEx_Save @Data
END
GO
PRINT N'Creating [dbo].[CatalogContentProperty_Migrate]...';


GO
CREATE PROCEDURE [dbo].[CatalogContentProperty_Migrate]
	@ContentProperty dbo.udttCatalogContentProperty readonly,
	@ContentExData dbo.udttCatalogContentEx readonly
AS
BEGIN
	IF dbo.mdpfn_sys_IsAzureCompatible() = 0 -- Fields will be encrypted only when only when DB does not support Azure
	BEGIN
		--update encrypted field: support only LongString field
		EXEC mdpsp_sys_OpenSymmetricKey

		INSERT INTO CatalogContentProperty (
			ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, CultureSpecific, [Boolean], [Number], 
			FloatNumber, [Money], [Decimal], [Date], [Binary], [String], LongString, [Guid])
		SELECT
			ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, CultureSpecific, [Boolean], [Number], 
			FloatNumber, [Money], [Decimal], [Date], [Binary], [String], 
			CASE WHEN IsEncrypted = 1 THEN dbo.mdpfn_sys_EncryptDecryptString(LongString, 1) ELSE LongString END AS LongString,
			[Guid] 
		FROM @ContentProperty
		WHERE [IsNull] = 0

		EXEC mdpsp_sys_CloseSymmetricKey
	END
	ELSE
	BEGIN
		INSERT INTO CatalogContentProperty (
			ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, CultureSpecific, [Boolean], [Number], 
			FloatNumber, [Money], [Decimal], [Date], [Binary], [String], LongString, [Guid])
		SELECT
			ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, CultureSpecific, [Boolean], [Number], 
			FloatNumber, [Money], [Decimal], [Date], [Binary], [String], LongString, [Guid]
		FROM @ContentProperty
		WHERE [IsNull] = 0
	END

	EXEC CatalogContentEx_Save @ContentExData
END
GO
PRINT N'Creating [dbo].[CatalogContentProperty_DeleteByObjectId]...';


GO
CREATE PROCEDURE [dbo].[CatalogContentProperty_DeleteByObjectId]
	@ObjectId int,
	@ObjectTypeId int
AS
BEGIN

	DECLARE @ClassId INT
	SELECT @ClassId = T.MetaClassId
	FROM
		(SELECT CatalogEntryId AS ObjectId, 0 AS ObjectTypeId, MetaClassId FROM CatalogEntry
			UNION ALL
		SELECT CatalogNodeId AS ObjectId, 1 AS ObjectTypeId, MetaClassId FROM CatalogNode) T
	 WHERE ObjectId = @ObjectId AND ObjectTypeId = @ObjectTypeId

	--Delete published version
	DELETE CatalogContentProperty WHERE ObjectId = @ObjectId AND ObjectTypeId = @ObjectTypeId
	
	DECLARE @AffectedMetaKeys udttIdTable
	INSERT INTO @AffectedMetaKeys
	SELECT MK.MetaKey
		FROM MetaKey MK
	WHERE MK.MetaObjectId = @ObjectId 
	AND MK.MetaClassId = @ClassId

	-- Delete data for all reference type meta fields (dictionaries etc)
	exec mdpsp_sys_DeleteMetaKeyObjects @AffectedMetaKeys 

END
GO
PRINT N'Creating [dbo].[CatalogContentProperty_Load]...';


GO
CREATE PROCEDURE [dbo].[CatalogContentProperty_Load]
	@ObjectId int,
	@ObjectTypeId int,
	@MetaClassId int,
	@Language nvarchar(50)
AS
BEGIN
	DECLARE @catalogId INT
	DECLARE @FallbackLanguage nvarchar(50)

	SET @catalogId = CASE WHEN @ObjectTypeId = 0 THEN
							(SELECT CatalogId FROM CatalogEntry WHERE CatalogEntryId = @ObjectId)
							WHEN @ObjectTypeId = 1 THEN							
							(SELECT CatalogId FROM CatalogNode WHERE CatalogNodeId = @ObjectId)
						END
	SELECT @FallbackLanguage = DefaultLanguage FROM dbo.[Catalog] WHERE CatalogId = @catalogId

	-- load from fallback language only if @Language is not existing language of catalog.
	-- in other work, fallback language is used for invalid @Language value only.
	IF @Language NOT IN (SELECT LanguageCode FROM dbo.CatalogLanguage WHERE CatalogId = @catalogId)
		SET @Language = @FallbackLanguage
    
	IF dbo.mdpfn_sys_IsAzureCompatible() = 0 --Fields will be encrypted only when DB does not support Azure
		BEGIN
		EXEC mdpsp_sys_OpenSymmetricKey

		SELECT P.ObjectId, P.ObjectTypeId, P.MetaFieldId, P.MetaClassId, P.MetaFieldName, P.LanguageName,
							P.Boolean, P.Number, P.FloatNumber, P.[Money], P.[Decimal], P.[Date], P.[Binary], P.[String], 
							CASE WHEN (F.IsEncrypted = 1 AND dbo.mdpfn_sys_IsLongStringMetaField(F.DataTypeId) = 1 )
							THEN dbo.mdpfn_sys_EncryptDecryptString(P.LongString, 0) 
							ELSE P.LongString END AS LongString, 
							P.[Guid]  
		FROM dbo.CatalogContentProperty P
		INNER JOIN MetaField F ON P.MetaFieldId = F.MetaFieldId
		WHERE ObjectId = @ObjectId AND
				ObjectTypeId = @ObjectTypeId AND
				MetaClassId = @MetaClassId AND
				((F.MultiLanguageValue = 1 AND LanguageName = @Language COLLATE DATABASE_DEFAULT) OR ((F.MultiLanguageValue = 0 AND LanguageName = @FallbackLanguage COLLATE DATABASE_DEFAULT)))

		EXEC mdpsp_sys_CloseSymmetricKey
		END
	ELSE
		BEGIN
		SELECT P.ObjectId, P.ObjectTypeId, P.MetaFieldId, P.MetaClassId, P.MetaFieldName, P.LanguageName,
							P.Boolean, P.Number, P.FloatNumber, P.[Money], P.[Decimal], P.[Date], P.[Binary], P.[String], 
							P.LongString, 
							P.[Guid]
		FROM dbo.CatalogContentProperty P
		WHERE ObjectId = @ObjectId AND
				ObjectTypeId = @ObjectTypeId AND
				MetaClassId = @MetaClassId AND
				((P.CultureSpecific = 1 AND LanguageName = @Language COLLATE DATABASE_DEFAULT) OR ((P.CultureSpecific = 0 AND LanguageName = @FallbackLanguage COLLATE DATABASE_DEFAULT)))
		END

	-- Select CatalogContentEx data
	EXEC CatalogContentEx_Load @ObjectId, @ObjectTypeId
END
GO
PRINT N'Creating [dbo].[ecfVersionProperty_SyncPublishedVersion]...';


GO
CREATE PROCEDURE [dbo].[ecfVersionProperty_SyncPublishedVersion]
	@ContentDraftProperty dbo.udttCatalogContentProperty READONLY,
	@LanguageName NVARCHAR(20)
AS
BEGIN
	DECLARE @propertyData udttCatalogContentProperty
	DECLARE @propertiesToSyncCount INT

	IF dbo.mdpfn_sys_IsAzureCompatible() = 0 -- Fields will be encrypted only when only when DB does not support Azure
	BEGIN
		--update encrypted field: support only LongString field
		EXEC mdpsp_sys_OpenSymmetricKey

		INSERT INTO @propertyData (
			WorkId, ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName,Boolean, Number,
			FloatNumber, [Money], [Decimal], [Date], [Binary], String,
			LongString,
			[Guid], [IsNull]) 
		SELECT
			ccd.WorkId, ccd.ObjectId, ccd.ObjectTypeId, cdp.MetaFieldId, cdp.MetaClassId, cdp.MetaFieldName, @LanguageName, cdp.Boolean, cdp.Number,
			cdp.FloatNumber, cdp.[Money], cdp.[Decimal], cdp.[Date], cdp.[Binary], cdp.String, 
			CASE WHEN cdp.IsEncrypted = 1 THEN dbo.mdpfn_sys_EncryptDecryptString(cdp.LongString, 1) ELSE cdp.LongString END AS LongString, 
			cdp.[Guid], cdp.[IsNull]
		FROM @ContentDraftProperty cdp
		INNER JOIN ecfVersion ccd
		ON	ccd.ObjectId = cdp.ObjectId AND
			ccd.ObjectTypeId = cdp.ObjectTypeId AND
			ccd.LanguageName = @LanguageName COLLATE DATABASE_DEFAULT
		WHERE ccd.[Status] = 4 OR ccd.IsCommonDraft = 1 --Draft properties of published version/common draft will be sync
		
		SET @propertiesToSyncCount = @@ROWCOUNT

		EXEC mdpsp_sys_CloseSymmetricKey
	END
	ELSE
	BEGIN
		INSERT INTO @propertyData (
			WorkId, ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName,Boolean, Number,
			FloatNumber, [Money], [Decimal], [Date], [Binary], String, LongString,[Guid], [IsNull])
		SELECT
			ccd.WorkId, ccd.ObjectId, ccd.ObjectTypeId, cdp.MetaFieldId, cdp.MetaClassId, cdp.MetaFieldName, @LanguageName, cdp.Boolean, cdp.Number,
			cdp.FloatNumber, cdp.[Money], cdp.[Decimal], cdp.[Date], cdp.[Binary], cdp.String, cdp.LongString, cdp.[Guid], cdp.[IsNull]
		FROM @ContentDraftProperty cdp
		INNER JOIN ecfVersion ccd
		ON	ccd.ObjectId = cdp.ObjectId AND
			ccd.ObjectTypeId = cdp.ObjectTypeId AND
			ccd.LanguageName = @LanguageName COLLATE DATABASE_DEFAULT
		WHERE ccd.[Status] = 4 OR ccd.IsCommonDraft = 1 --Draft properties of published version/common draft will be sync

		SET @propertiesToSyncCount = @@ROWCOUNT
	END

	IF @propertiesToSyncCount > 0
		BEGIN
			-- delete rows where values have been nulled out
			DELETE A 
				FROM [dbo].[ecfVersionProperty] A
				INNER JOIN @propertyData T
				ON	A.WorkId = T.WorkId AND 
					A.MetaFieldId = T.MetaFieldId AND
					T.[IsNull] = 1
		END
	ELSE
		BEGIN
			-- nothing to update
			RETURN
		END

	-- Now null rows are handled, so remove them to not insert empty rows
	DELETE FROM @propertyData
	WHERE [IsNull] = 1

	-- update/insert items which are not in input
	MERGE	[dbo].[ecfVersionProperty] as A
	USING	@propertyData as I
	ON		A.WorkId = I.WorkId AND
			A.MetaFieldId = I.MetaFieldId 
	WHEN	MATCHED 
		-- update the ecfVersionProperty for existing row
		THEN UPDATE SET 		
			A.LanguageName = I.LanguageName,	
			A.Boolean = I.Boolean, 
			A.Number = I.Number, 
			A.FloatNumber = I.FloatNumber, 
			A.[Money] = I.[Money], 
			A.[Decimal] = I.[Decimal],
			A.[Date] = I.[Date], 
			A.[Binary] = I.[Binary], 
			A.[String] = I.[String], 
			A.LongString = I.LongString, 
			A.[Guid] = I.[Guid]
   WHEN	NOT  MATCHED BY TARGET
		-- insert new record if the record is does not exist in ecfVersionProperty table
		THEN 
			INSERT (
				WorkId, ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, Boolean, Number, 
				FloatNumber, [Money], [Decimal], [Date], [Binary], [String], LongString, [Guid])
			VALUES (
				I.WorkId, I.ObjectId, I.ObjectTypeId, I.MetaFieldId, I.MetaClassId, I.MetaFieldName, I.LanguageName, I.Boolean, I.Number, 
				I.FloatNumber, I.[Money], I.[Decimal], I.[Date], I.[Binary], I.[String], I.LongString, I.[Guid])
	;

END
GO
PRINT N'Creating [dbo].[CatalogContentProperty_Save]...';


GO
CREATE PROCEDURE [dbo].[CatalogContentProperty_Save]
	@ContentProperty dbo.udttCatalogContentProperty readonly,
	@ObjectId int,
	@ObjectTypeId int,
	@LanguageName NVARCHAR(50),
	@ContentExData dbo.udttCatalogContentEx readonly,
	@SyncVersion bit = 1
AS
BEGIN
	DECLARE @catalogId INT
	SET @catalogId =
		CASE
			WHEN @ObjectTypeId = 0 THEN
				(SELECT CatalogId FROM CatalogEntry WHERE CatalogEntryId = @ObjectId)
			WHEN @ObjectTypeId = 1 THEN
				(SELECT CatalogId FROM CatalogNode WHERE CatalogNodeId = @ObjectId)
		END
	IF @LanguageName NOT IN (SELECT LanguageCode FROM dbo.CatalogLanguage WHERE CatalogId = @catalogId)
	BEGIN
		SET @LanguageName = (SELECT DefaultLanguage FROM dbo.Catalog WHERE CatalogId = @catalogId)
	END

	--delete properties where is null in input table
	DELETE A
	FROM [dbo].[CatalogContentProperty] A
	INNER JOIN @ContentProperty I
	ON	A.ObjectId = I.ObjectId AND 
		A.ObjectTypeId = I.ObjectTypeId AND
		A.LanguageName = I.LanguageName COLLATE DATABASE_DEFAULT AND
		A.MetaFieldId = I.MetaFieldId
	WHERE I.[IsNull] = 1
	
	--update encrypted field: support only LongString field
	DECLARE @propertyData dbo.udttCatalogContentProperty
	
	IF dbo.mdpfn_sys_IsAzureCompatible() = 0 -- Fields will be encrypted only when only when DB does not support Azure
	BEGIN
		EXEC mdpsp_sys_OpenSymmetricKey

		INSERT INTO @propertyData (
			ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, CultureSpecific, Boolean, Number, 
			FloatNumber, [Money], [Decimal], [Date], [Binary], [String],
			LongString,
			[Guid])
		SELECT
			ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, @LanguageName, CultureSpecific, Boolean, Number, 
			FloatNumber, [Money], [Decimal], [Date], [Binary], [String], 
			CASE WHEN IsEncrypted = 1 THEN dbo.mdpfn_sys_EncryptDecryptString(LongString, 1) ELSE LongString END AS LongString, 
			[Guid]
		FROM @ContentProperty
		WHERE [IsNull] = 0

		EXEC mdpsp_sys_CloseSymmetricKey
	END
	ELSE
	BEGIN
		INSERT INTO @propertyData (
			ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, CultureSpecific, Boolean, Number, 
			FloatNumber, [Money], [Decimal], [Date], [Binary], [String], LongString, [Guid])
		SELECT
			ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, @LanguageName, CultureSpecific, Boolean, Number, 
			FloatNumber, [Money], [Decimal], [Date], [Binary], [String], LongString, [Guid]
		FROM @ContentProperty
		WHERE [IsNull] = 0

	END

	-- update/insert items which are not in input
	MERGE	[dbo].[CatalogContentProperty] as A
	USING	@propertyData as I
	ON		A.ObjectId = I.ObjectId AND 
			A.ObjectTypeId = I.ObjectTypeId AND 
			A.MetaFieldId = I.MetaFieldId AND
			A.LanguageName = I.LanguageName COLLATE DATABASE_DEFAULT
	WHEN	MATCHED 
		-- update the CatalogContentProperty for existing row
		THEN UPDATE SET
			A.MetaClassId = I.MetaClassId,
			A.MetaFieldName = I.MetaFieldName,
			A.CultureSpecific = I.CultureSpecific,
			A.Boolean = I.Boolean, 
			A.Number = I.Number, 
			A.FloatNumber = I.FloatNumber, 
			A.[Money] = I.[Money], 
			A.[Decimal] = I.[Decimal],
			A.[Date] = I.[Date], 
			A.[Binary] = I.[Binary], 
			A.[String] = I.[String], 
			A.LongString = I.LongString, 
			A.[Guid] = I.[Guid]

	WHEN	NOT MATCHED BY TARGET 
		-- insert new record if the record does not exist in CatalogContentProperty table
		THEN 
			INSERT (
				ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, CultureSpecific, Boolean, Number, 
				FloatNumber, [Money], [Decimal], [Date], [Binary], [String], LongString, [Guid])
			VALUES (
				I.ObjectId, I.ObjectTypeId, I.MetaFieldId, I.MetaClassId, I.MetaFieldName, I.LanguageName, I.CultureSpecific, I.Boolean, I.Number, 
				I.FloatNumber, I.[Money], I.[Decimal], I.[Date], I.[Binary], I.[String], I.LongString, I.[Guid])
	;

	--Update ecfVersionProperty
	IF (@SyncVersion = 1)
	BEGIN
		EXEC [ecfVersionProperty_SyncPublishedVersion] @ContentProperty, @LanguageName
	END

	-- Update CatalogContentEx table
	EXEC CatalogContentEx_Save @ContentExData
END
GO
PRINT N'Creating [dbo].[ecfVersion_SyncCatalogData]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_SyncCatalogData]
	@ContentDraft dbo.udttVersion READONLY,
	@SelectOutput BIT = 0
AS
BEGIN
	DECLARE @WorkIds table (WorkId int, ObjectId int, LanguageName nvarchar(20), MasterLanguageName nvarchar(20))

	-- Insert/Update draft table
	MERGE INTO dbo.ecfVersion AS target
	USING (SELECT d.ObjectId, d.ObjectTypeId, d.CatalogId, d.LanguageName, d.[MasterLanguageName], 1, d.[Status],
				  c.StartDate, c.Name, '', d.CreatedBy, d.Created, d.ModifiedBy, d.Modified,
				  c.EndDate, d.SeoUriSegment
			FROM @ContentDraft d
			INNER JOIN dbo.Catalog c on d.ObjectId = c.CatalogId)
	AS SOURCE(ObjectId, ObjectTypeId, CatalogId, LanguageName, [MasterLanguageName], IsCommonDraft, [Status], 
			  StartPublish, Name, Code, CreatedBy, Created, ModifiedBy, Modified,
			  StopPublish, SeoUriSegment)
	ON (target.ObjectId = SOURCE.ObjectId AND target.ObjectTypeId = SOURCE.ObjectTypeId AND target.[Status] = SOURCE.[Status] AND target.LanguageName = SOURCE.LanguageName COLLATE DATABASE_DEFAULT)
	WHEN MATCHED THEN 
		UPDATE SET 
			target.CatalogId = SOURCE.CatalogId,
			target.MasterLanguageName = SOURCE.MasterLanguageName, 
			target.IsCommonDraft = SOURCE.IsCommonDraft,
			target.StartPublish = SOURCE.StartPublish, 
			target.Name = SOURCE.Name, 
			target.Code = SOURCE.Code,
			target.Modified = SOURCE.Modified, 
			target.ModifiedBy = SOURCE.ModifiedBy,
			target.StopPublish = SOURCE.StopPublish,
			target.SeoUriSegment = SOURCE.SeoUriSegment
	WHEN NOT MATCHED THEN
		INSERT (ObjectId, ObjectTypeId, CatalogId, LanguageName, MasterLanguageName, IsCommonDraft, [Status], 
				StartPublish, Name, Code, CreatedBy, Created, ModifiedBy, Modified, StopPublish, SeoUriSegment)
		VALUES (SOURCE.ObjectId, SOURCE.ObjectTypeId, SOURCE.CatalogId, SOURCE.LanguageName, SOURCE.MasterLanguageName, SOURCE.IsCommonDraft, SOURCE.[Status], 
				SOURCE.StartPublish, SOURCE.Name, SOURCE.Code, SOURCE.CreatedBy, SOURCE.Created, SOURCE.ModifiedBy, SOURCE.Modified, SOURCE.StopPublish, SOURCE.SeoUriSegment)
	OUTPUT inserted.WorkId, inserted.ObjectId, inserted.LanguageName, inserted.MasterLanguageName INTO @WorkIds;

	-- Adjust any previous and already existing versions and making sure they are not flagged as common draft.
	-- For any updated rows having status Published (4) existing rows with the same status will be changed to
	-- Previously Published (5).
	UPDATE existing	SET 
		   existing.IsCommonDraft = 0,	
	       existing.Status = CASE WHEN updated.Status = 4 AND existing.Status = 4 THEN 5 ELSE existing.Status END
	FROM ecfVersion AS existing INNER JOIN @ContentDraft AS updated ON 
		existing.ObjectId = updated.ObjectId 
		AND existing.ObjectTypeId = updated.ObjectTypeId 
		AND existing.LanguageName = updated.LanguageName COLLATE DATABASE_DEFAULT
	WHERE existing.WorkId NOT IN (SELECT WorkId FROM @WorkIds);

	-- Insert/Update Catalog draft table
	DECLARE @catalogs AS dbo.[udttVersionCatalog]
	INSERT INTO @catalogs
		SELECT w.WorkId, c.DefaultCurrency, c.WeightBase, c.LengthBase, c.DefaultLanguage, [dbo].[fn_JoinCatalogLanguages](c.CatalogId) as Languages, c.IsPrimary, c.[Owner]
		FROM @WorkIds w
		INNER JOIN dbo.Catalog c ON w.ObjectId = c.CatalogId AND w.MasterLanguageName = c.DefaultLanguage COLLATE DATABASE_DEFAULT

	EXEC [ecfVersionCatalog_Save] @VersionCatalogs = @catalogs, @PublishAction = 1

	IF @SelectOutput = 1
		SELECT * FROM @WorkIds
END
GO
PRINT N'Creating [dbo].[ecfVersion_SyncNodeData]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_SyncNodeData]
	@ContentDraft dbo.udttVersion READONLY,
	@SelectOutput BIT = 0
AS
BEGIN
	DECLARE @WorkIds table (WorkId int, ObjectId int, LanguageName nvarchar(20), MasterLanguageName nvarchar(20))

	-- Insert/Update draft table
	MERGE INTO dbo.ecfVersion AS target
	USING (SELECT d.ObjectId, d.ObjectTypeId, c.CatalogId, d.LanguageName, d.[MasterLanguageName], 1, d.[Status], 
				  c.StartDate, c.Name, c.Code, d.CreatedBy, d.Created, d.ModifiedBy, d.Modified,
				  c.EndDate, s.Uri, s.Title, s.[Description], s.Keywords, s.UriSegment
			FROM @ContentDraft d
			INNER JOIN dbo.CatalogNode c on d.ObjectId = c.CatalogNodeId
			INNER JOIN dbo.CatalogItemSeo s on d.ObjectId = s.CatalogNodeId AND d.LanguageName = s.LanguageCode COLLATE DATABASE_DEFAULT)
	AS SOURCE(ObjectId, ObjectTypeId, CatalogId, LanguageName, MasterLanguageName, IsCommonDraft, [Status], 
			  StartPublish, Name, Code, CreatedBy, Created, ModifiedBy, Modified,
			  StopPublish, SeoUri, SeoTitle, SeoDescription, SeoKeywords, SeoUriSegment)
	ON (target.ObjectId = SOURCE.ObjectId AND target.ObjectTypeId = SOURCE.ObjectTypeId AND target.[Status] = SOURCE.[Status] AND target.LanguageName = SOURCE.LanguageName COLLATE DATABASE_DEFAULT)
	WHEN MATCHED THEN 
		UPDATE SET 
			target.CatalogId = SOURCE.CatalogId,
			target.IsCommonDraft = SOURCE.IsCommonDraft, 
			target.[Status] = SOURCE.[Status], 
			target.StartPublish = SOURCE.StartPublish, 
			target.Name = SOURCE.Name, 
			target.Code = SOURCE.Code, 
			target.Modified = SOURCE.Modified, 
			target.ModifiedBy = SOURCE.ModifiedBy,
			target.StopPublish = SOURCE.StopPublish,
			target.SeoUri = SOURCE.SeoUri, 
			target.SeoTitle = SOURCE.SeoTitle, 
			target.SeoDescription = SOURCE.SeoDescription, 
			target.SeoKeywords = SOURCE.SeoKeywords, 
			target.SeoUriSegment = SOURCE.SeoUriSegment
	WHEN NOT MATCHED THEN
		INSERT (ObjectId, ObjectTypeId, CatalogId, LanguageName, MasterLanguageName, IsCommonDraft, [Status], 
			    StartPublish, Name, Code, CreatedBy, Created, ModifiedBy, Modified,
				StopPublish, SeoUri, SeoTitle, SeoDescription, SeoKeywords, SeoUriSegment)
		VALUES (SOURCE.ObjectId, SOURCE.ObjectTypeId, SOURCE.CatalogId, SOURCE.LanguageName, SOURCE.MasterLanguageName, SOURCE.IsCommonDraft, SOURCE.[Status], 
				SOURCE.StartPublish, SOURCE.Name, SOURCE.Code, SOURCE.CreatedBy, SOURCE.Created, SOURCE.ModifiedBy, SOURCE.Modified,
				SOURCE.StopPublish, SOURCE.SeoUri, SOURCE.SeoTitle, SOURCE.SeoDescription, SOURCE.SeoKeywords, SOURCE.SeoUriSegment)
	OUTPUT inserted.WorkId, inserted.ObjectId, inserted.LanguageName, inserted.MasterLanguageName INTO @WorkIds;
	
	-- Adjust any previous and already existing versions and making sure they are not flagged as common draft.
	-- For any updated rows having status Published (4) existing rows with the same status will be changed to
	-- Previously Published (5).
	UPDATE existing	SET 
		   existing.IsCommonDraft = 0,	
	       existing.Status = CASE WHEN updated.Status = 4 AND existing.Status = 4 THEN 5 ELSE existing.Status END
	FROM ecfVersion AS existing INNER JOIN @ContentDraft AS updated ON 
		existing.ObjectId = updated.ObjectId 
		AND existing.ObjectTypeId = updated.ObjectTypeId 
		AND existing.LanguageName = updated.LanguageName COLLATE DATABASE_DEFAULT
	WHERE existing.WorkId NOT IN (SELECT WorkId FROM @WorkIds);

	-- Insert/Update Draft Asset
	DECLARE @draftAsset AS dbo.[udttCatalogContentAsset]
	INSERT INTO @draftAsset 
		SELECT w.WorkId, a.AssetType, a.AssetKey, a.GroupName, a.SortOrder 
		FROM @WorkIds w
		INNER JOIN dbo.CatalogItemAsset a ON w.ObjectId = a.CatalogNodeId WHERE a.CatalogNodeId > 0

	DECLARE @workIdList dbo.[udttObjectWorkId]
	INSERT INTO @workIdList 
		SELECT NULL, NULL, w.WorkId, NULL 
		FROM @WorkIds w
	
	EXEC [ecfVersionAsset_Save] @workIdList, @draftAsset

	DECLARE @versionProperties dbo.udttCatalogContentProperty
	INSERT INTO @versionProperties (
			WorkId, ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName,Boolean, Number,
			FloatNumber, [Money], [Decimal], [Date], [Binary], String, LongString, [Guid])
		SELECT
			w.WorkId, c.ObjectId, c.ObjectTypeId, c.MetaFieldId, c.MetaClassId, c.MetaFieldName, c.LanguageName, c.Boolean, c.Number,
			c.FloatNumber, c.[Money], c.[Decimal], c.[Date], c.[Binary], c.String, c.LongString, c.[Guid]
		FROM @workIds w
		INNER JOIN CatalogContentProperty c
		ON
			w.ObjectId = c.ObjectId AND
			w.LanguageName = c.LanguageName
		WHERE 
			c.ObjectTypeId = 1

	EXEC [ecfVersionProperty_SyncBatchPublishedVersion] @versionProperties

	IF @SelectOutput = 1
		SELECT * FROM @WorkIds
END
GO
PRINT N'Creating [dbo].[ecfVersion_SyncEntryData]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_SyncEntryData]
	@ContentDraft dbo.udttVersion READONLY,
	@SelectOutput BIT = 0
AS
BEGIN
	DECLARE @WorkIds table (WorkId int, ObjectId int, LanguageName nvarchar(20), MasterLanguageName nvarchar(20))
	
	-- Insert/Update draft table
	MERGE INTO dbo.ecfVersion AS target
	USING (SELECT d.ObjectId, d.ObjectTypeId, c.CatalogId, d.LanguageName, d.[MasterLanguageName], 1, d.[Status],
				  c.StartDate, c.Name, c.Code, d.CreatedBy, d.Created, d.ModifiedBy, d.Modified, 
				  c.EndDate, s.Uri, s.Title, s.[Description], s.Keywords, s.UriSegment
			FROM @ContentDraft d
			INNER JOIN dbo.CatalogEntry c on d.ObjectId = c.CatalogEntryId
			INNER JOIN dbo.CatalogItemSeo s on d.ObjectId = s.CatalogEntryId AND d.LanguageName = s.LanguageCode COLLATE DATABASE_DEFAULT)
	AS SOURCE(ObjectId, ObjectTypeId, CatalogId, LanguageName, MasterLanguageName, IsCommonDraft, [Status], 
			  StartPublish, Name, Code, CreatedBy, Created, ModifiedBy, Modified,
			  StopPublish, SeoUri, SeoTitle, SeoDescription, SeoKeywords, SeoUriSegment)
	ON (target.ObjectId = SOURCE.ObjectId AND target.ObjectTypeId = SOURCE.ObjectTypeId AND target.[Status] = SOURCE.[Status] AND target.LanguageName = SOURCE.LanguageName COLLATE DATABASE_DEFAULT)
	WHEN MATCHED THEN 
		UPDATE SET 
			target.CatalogId = SOURCE.CatalogId,
			target.IsCommonDraft = SOURCE.IsCommonDraft, 
			target.[Status] = SOURCE.[Status],
			target.StartPublish = SOURCE.StartPublish, 
			target.Name = SOURCE.Name, 
			target.Code = SOURCE.Code, 
			target.Modified = SOURCE.Modified, 
			target.ModifiedBy = SOURCE.ModifiedBy, 
			target.StopPublish = SOURCE.StopPublish,
			target.SeoUri = SOURCE.SeoUri, 
			target.SeoTitle = SOURCE.SeoTitle, 
			target.SeoDescription = SOURCE.SeoDescription, 
			target.SeoKeywords = SOURCE.SeoKeywords, 
			target.SeoUriSegment = SOURCE.SeoUriSegment
	WHEN NOT MATCHED THEN
		INSERT (ObjectId, ObjectTypeId, CatalogId, LanguageName, MasterLanguageName, IsCommonDraft, [Status], 
				StartPublish, Name, Code, CreatedBy, Created, ModifiedBy, Modified,
				StopPublish, SeoUri, SeoTitle, SeoDescription, SeoKeywords, SeoUriSegment)
		VALUES (SOURCE.ObjectId, SOURCE.ObjectTypeId, SOURCE.CatalogId, SOURCE.LanguageName, SOURCE.MasterLanguageName, SOURCE.IsCommonDraft, SOURCE.[Status], 
				SOURCE.StartPublish, SOURCE.Name, SOURCE.Code, SOURCE.CreatedBy, SOURCE.Created, SOURCE.ModifiedBy, SOURCE.Modified,
				SOURCE.StopPublish, SOURCE.SeoUri, SOURCE.SeoTitle, SOURCE.SeoDescription, SOURCE.SeoKeywords, SOURCE.SeoUriSegment)
	OUTPUT inserted.WorkId, inserted.ObjectId, inserted.LanguageName, inserted.MasterLanguageName INTO @WorkIds;
	
	-- Adjust any previous and already existing versions and making sure they are not flagged as common draft.
	-- For any updated rows having status Published (4) existing rows with the same status will be changed to
	-- Previously Published (5).
	UPDATE existing	SET 
		   existing.IsCommonDraft = 0,	
	       existing.Status = CASE WHEN updated.Status = 4 AND existing.Status = 4 THEN 5 ELSE existing.Status END
	FROM ecfVersion AS existing INNER JOIN @ContentDraft AS updated ON 
		existing.ObjectId = updated.ObjectId 
		AND existing.ObjectTypeId = updated.ObjectTypeId 
		AND existing.LanguageName = updated.LanguageName COLLATE DATABASE_DEFAULT
	WHERE existing.WorkId NOT IN (SELECT WorkId FROM @WorkIds);

	-- Insert/Update Draft Asset
	DECLARE @draftAsset AS dbo.[udttCatalogContentAsset]
	INSERT INTO @draftAsset 
		SELECT w.WorkId, a.AssetType, a.AssetKey, a.GroupName, a.SortOrder 
		FROM @WorkIds w
		INNER JOIN CatalogItemAsset a ON w.ObjectId = a.CatalogEntryId
	
	DECLARE @workIdList dbo.[udttObjectWorkId]
	INSERT INTO @workIdList 
		SELECT NULL, NULL, w.WorkId, NULL 
		FROM @WorkIds w
	
	EXEC [ecfVersionAsset_Save] @workIdList, @draftAsset

	-- Insert/Update Draft Variation
	DECLARE @draftVariant dbo.[udttVariantDraft]
	INSERT INTO @draftVariant
		SELECT ids.WorkId, v.TaxCategoryId, v.TrackInventory, v.[Weight], v.MinQuantity, v.MaxQuantity, v.[Length], v.Height, v.Width, v.PackageId
		FROM @WorkIds ids
		INNER JOIN Variation v on ids.ObjectId = v.CatalogEntryId
		
	EXEC [ecfVersionVariation_Save] @draftVariant

	DECLARE @versionProperties dbo.udttCatalogContentProperty
	INSERT INTO @versionProperties (
			WorkId, ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName,Boolean, Number,
			FloatNumber, [Money], [Decimal], [Date], [Binary], String, LongString, [Guid])
		SELECT
			w.WorkId, c.ObjectId, c.ObjectTypeId, c.MetaFieldId, c.MetaClassId, c.MetaFieldName, c.LanguageName, c.Boolean, c.Number,
			c.FloatNumber, c.[Money], c.[Decimal], c.[Date], c.[Binary], c.String, c.LongString, c.[Guid]
		FROM @workIds w
		INNER JOIN CatalogContentProperty c
		ON
			w.ObjectId = c.ObjectId AND
			w.LanguageName = c.LanguageName
		WHERE
			c.ObjectTypeId = 0

	EXEC [ecfVersionProperty_SyncBatchPublishedVersion] @versionProperties

	IF @SelectOutput = 1
		SELECT * FROM @WorkIds
END
GO
PRINT N'Creating [dbo].[ecfVersionProperty_ListByWorkIds]...';


GO
CREATE PROCEDURE [dbo].[ecfVersionProperty_ListByWorkIds]
	@ContentLinks dbo.udttObjectWorkId readonly
AS
BEGIN
	CREATE TABLE #nonMasterLinks (
		ObjectId INT, 
		ObjectTypeId INT, 
		WorkId INT,
		MasterWorkId INT
	)

	INSERT INTO #nonMasterLinks
	SELECT l.ObjectId, l.ObjectTypeId, l.WorkId, NULL
	FROM @ContentLinks l
	INNER JOIN ecfVersion d ON l.WorkId = d.WorkId
	WHERE d.LanguageName <> d.MasterLanguageName COLLATE DATABASE_DEFAULT

	UPDATE l SET MasterWorkId = d.WorkId
	FROM #nonMasterLinks l
	INNER JOIN ecfVersion d ON d.ObjectId = l.ObjectId AND d.ObjectTypeId = l.ObjectTypeId
	WHERE d.[Status] = 4 AND d.LanguageName = d.MasterLanguageName COLLATE DATABASE_DEFAULT

	DECLARE @IsAzureCompatible BIT
	SET @IsAzureCompatible = dbo.mdpfn_sys_IsAzureCompatible()

	IF @IsAzureCompatible = 1
	BEGIN

		-- select property for draft that is master language one or multi language property
		SELECT links.WorkId, draftProperty.ObjectId, draftProperty.ObjectTypeId, draftProperty.MetaFieldId, draftProperty.MetaClassId, draftProperty.MetaFieldName, draftProperty.LanguageName,
				draftProperty.[Boolean], draftProperty.[Number], draftProperty.[FloatNumber], draftProperty.[Money], draftProperty.[Decimal], draftProperty.[Date], draftProperty.[Binary], draftProperty.[String], 
				draftProperty.[LongString], 
				draftProperty.[Guid]
		FROM ecfVersionProperty draftProperty
		INNER JOIN @ContentLinks links ON links.WorkId = draftProperty.WorkId
		
		-- and fall back property
		UNION ALL
		SELECT links.WorkId, draftProperty.ObjectId, draftProperty.ObjectTypeId, draftProperty.MetaFieldId, draftProperty.MetaClassId, draftProperty.MetaFieldName, draftProperty.LanguageName,
				draftProperty.[Boolean], draftProperty.[Number], draftProperty.[FloatNumber], draftProperty.[Money], draftProperty.[Decimal], draftProperty.[Date], draftProperty.[Binary], draftProperty.[String], 
                draftProperty.LongString, 
				draftProperty.[Guid]
		FROM ecfVersionProperty draftProperty
		INNER JOIN #nonMasterLinks links ON links.MasterWorkId = draftProperty.WorkId
		WHERE draftProperty.CultureSpecific = 0

	END
	ELSE
	BEGIN
		-- Open and Close SymmetricKey do nothing if the system does not support encryption
		EXEC mdpsp_sys_OpenSymmetricKey
		-- select property for draft that is master language one or multi language property
		SELECT links.WorkId, draftProperty.ObjectId, draftProperty.ObjectTypeId, draftProperty.MetaFieldId, draftProperty.MetaClassId, draftProperty.MetaFieldName, draftProperty.LanguageName,
				draftProperty.[Boolean], draftProperty.[Number], draftProperty.[FloatNumber], draftProperty.[Money], draftProperty.[Decimal], draftProperty.[Date], draftProperty.[Binary], draftProperty.[String], 
				CASE WHEN (F.IsEncrypted = 1 AND dbo.mdpfn_sys_IsLongStringMetaField(F.DataTypeId) = 1) 
					THEN dbo.mdpfn_sys_EncryptDecryptString(draftProperty.LongString, 0) 
					ELSE draftProperty.LongString END as LongString, 
				draftProperty.[Guid]
		FROM ecfVersionProperty draftProperty
		INNER JOIN MetaField F ON F.MetaFieldId = draftProperty.MetaFieldId
		INNER JOIN @ContentLinks links ON links.WorkId = draftProperty.WorkId
		
		-- and fall back property
		UNION ALL
		SELECT links.WorkId, draftProperty.ObjectId, draftProperty.ObjectTypeId, draftProperty.MetaFieldId, draftProperty.MetaClassId, draftProperty.MetaFieldName, draftProperty.LanguageName,
				draftProperty.[Boolean], draftProperty.[Number], draftProperty.[FloatNumber], draftProperty.[Money], draftProperty.[Decimal], draftProperty.[Date], draftProperty.[Binary], draftProperty.[String], 
				CASE WHEN (F.IsEncrypted = 1 AND dbo.mdpfn_sys_IsLongStringMetaField(F.DataTypeId) = 1) 
					THEN dbo.mdpfn_sys_EncryptDecryptString(draftProperty.LongString, 0) 
					ELSE draftProperty.LongString END as LongString, 
				draftProperty.[Guid]
		FROM ecfVersionProperty draftProperty
		INNER JOIN MetaField F ON F.MetaFieldId = draftProperty.MetaFieldId
		INNER JOIN #nonMasterLinks links ON links.MasterWorkId = draftProperty.WorkId
		WHERE F.MultiLanguageValue = 0
		
		EXEC mdpsp_sys_CloseSymmetricKey

	END

	DROP TABLE #nonMasterLinks
END
GO
PRINT N'Creating [dbo].[ecfVersion_PublishContentVersion]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_PublishContentVersion]
	@WorkId			INT,
	@ObjectId		INT,
	@ObjectTypeId	INT,
	@LanguageName	NVARCHAR(50),
	@MaxVersions	INT,
	@ResetCommonDraft BIT = 1
AS
BEGIN
	-- Update old published version status to previously published
	UPDATE	ecfVersion
	SET		[Status] = 5, -- previously published = 5
	        IsCommonDraft = 0		
	WHERE	[Status] = 4 -- published = 4
			AND ObjectId = @ObjectId
			AND ObjectTypeId = @ObjectTypeId
			AND LanguageName = @LanguageName COLLATE DATABASE_DEFAULT
			AND WorkId != @WorkId

	-- Update is common draft
	IF @ResetCommonDraft = 1
		EXEC ecfVersion_SetCommonDraft @WorkId = @WorkId, @Force = 1

	-- Delete previously published version. The number of previous published version must be <= maxVersions.
	-- This only take effect by language
	CREATE TABLE #WorkIds(Id INT IDENTITY(1,1) NOT NULL, WorkId INT NOT NULL)
	INSERT INTO #WorkIds(WorkId)
	SELECT WorkId
	FROM ecfVersion
	WHERE ObjectId = @ObjectId AND ObjectTypeId = @ObjectTypeId AND [Status] = 5 AND LanguageName = @LanguageName COLLATE DATABASE_DEFAULT
	ORDER BY WorkId DESC
	
	-- Delete all previously published version that older than @MaxVersions of this content
	DELETE FROM ecfVersion
	WHERE WorkId IN (SELECT WorkId 
					 FROM  #WorkIds 
					 WHERE Id > @MaxVersions - 1)
	
	DROP TABLE #WorkIds
END
GO
PRINT N'Creating [dbo].[ecfVersion_Insert]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_Insert]
	@ObjectId int,
	@ObjectTypeId int,
	@CatalogId int,
	@Name [nvarchar](100),
	@Code [nvarchar](100),
	@LanguageName [nvarchar](50),
	@MasterLanguageName [nvarchar](50),
    @StartPublish [datetime],
	@StopPublish DATETIME,
	@Status int,
	@CreatedBy [nvarchar](100),
	@Created DATETIME,
	@ModifiedBy [nvarchar](256),
	@Modified DATETIME,
	@SeoUri nvarchar(255),
	@SeoTitle nvarchar(150),
	@SeoDescription nvarchar(355),
	@SeoKeywords nvarchar(355),
	@SeoUriSegment nvarchar(255),
	@WorkId int OUTPUT, 
	@MaxVersions INT = 20,
	@SkipSetCommonDraft BIT
AS
BEGIN
	-- Code and name are not culture specific, we need to copy them from the master language to all other languages.
	IF @LanguageName = @MasterLanguageName COLLATE DATABASE_DEFAULT
	BEGIN
		UPDATE ecfVersion SET Name = @Name, Code = @Code WHERE ObjectId = @ObjectId AND ObjectTypeId = @ObjectTypeId AND LanguageName <> @MasterLanguageName COLLATE DATABASE_DEFAULT
	END

	INSERT INTO ecfVersion(ObjectId, 
			LanguageName, 
			MasterLanguageName, 
			[Status], 
			StartPublish, 
			Name, 
			Code, 
			CreatedBy, 
			Created, 
			ModifiedBy,
			Modified,
			ObjectTypeId,
			CatalogId,
			StopPublish,
			SeoUri,
			SeoTitle,
			SeoDescription,
			SeoKeywords,
			SeoUriSegment)
	VALUES (@ObjectId, 
			@LanguageName, 
			@MasterLanguageName, 
			@Status, 
			@StartPublish, 
			@Name, 
			@Code, 
			@CreatedBy, 
			@Created, 
			@ModifiedBy, 
			@Modified, 
			@ObjectTypeId,
			@CatalogId,
			@StopPublish,
			@SeoUri,
			@SeoTitle,
			@SeoDescription,
			@SeoKeywords,
			@SeoUriSegment)

	SET @WorkId = SCOPE_IDENTITY();
	
	IF (@Status = 4)
	BEGIN
		EXEC ecfVersion_PublishContentVersion @WorkId, @ObjectId, @ObjectTypeId, @LanguageName, @MaxVersions, 0
	END

	/* Set New Work item as Common draft version if there is no common draft or the common draft is the published version */
	IF (@SkipSetCommonDraft = 0)
	BEGIN
		EXEC ecfVersion_SetCommonDraft @WorkId = @WorkId, @Force = 0
	END
END
GO
PRINT N'Creating [dbo].[ecfVersionProperty_Save]...';


GO
CREATE PROCEDURE [dbo].[ecfVersionProperty_Save]
	@WorkIds dbo.udttObjectWorkId READONLY,
	@ContentDraftProperty dbo.udttCatalogContentProperty READONLY
AS
BEGIN
	-- delete items which are not in input
	DELETE A
	FROM [dbo].[ecfVersionProperty] A
	INNER JOIN @WorkIds W ON W.WorkId = A.WorkId
	LEFT JOIN @ContentDraftProperty I ON A.WorkId = I.WorkId AND A.MetaFieldId = I.MetaFieldId 
	WHERE (I.WorkId IS NULL OR I.[IsNull] = 1)

	--update encrypted field: support only LongString field
	DECLARE @propertyData dbo.udttCatalogContentProperty
	IF dbo.mdpfn_sys_IsAzureCompatible() = 0 -- Fields will be encrypted only when only when DB does not support Azure
		BEGIN
			EXEC mdpsp_sys_OpenSymmetricKey

			INSERT INTO @propertyData (
				WorkId, ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, CultureSpecific, Boolean, Number, 
				FloatNumber, [Money], [Decimal], [Date], [Binary], [String],
				LongString,
				[Guid])
			SELECT
				WorkId, ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, CultureSpecific, Boolean, Number, 
				FloatNumber, [Money], [Decimal], [Date], [Binary], [String], 
				CASE WHEN IsEncrypted = 1 THEN dbo.mdpfn_sys_EncryptDecryptString(LongString, 1) ELSE LongString END AS LongString, 
				[Guid]
			FROM @ContentDraftProperty
			WHERE [IsNull] = 0

			EXEC mdpsp_sys_CloseSymmetricKey
		END
	ELSE
		BEGIN
			INSERT INTO @propertyData (
				WorkId, ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, CultureSpecific, Boolean, Number, 
				FloatNumber, [Money], [Decimal], [Date], [Binary], [String], LongString, [Guid])
			SELECT
				WorkId, ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, CultureSpecific, Boolean, Number, 
				FloatNumber, [Money], [Decimal], [Date], [Binary], [String], LongString, [Guid]
			FROM @ContentDraftProperty
			WHERE [IsNull] = 0
		END

	-- update/insert items
	MERGE	[dbo].[ecfVersionProperty] as A
	USING	@propertyData as I
	ON		A.WorkId = I.WorkId AND 
			A.MetaFieldId = I.MetaFieldId 
	WHEN	MATCHED 
		-- update the ecfVersionProperty for existing row
		THEN UPDATE SET 			
			A.Boolean = I.Boolean, 
			A.Number = I.Number, 
			A.FloatNumber = I.FloatNumber, 
			A.[Money] = I.[Money], 
			A.[Decimal] = I.[Decimal],
			A.[Date] = I.[Date], 
			A.[Binary] = I.[Binary], 
			A.[String] = I.[String], 
			A.LongString = I.LongString, 
			A.[Guid] = I.[Guid]

	WHEN	NOT MATCHED BY TARGET 
		-- insert new record if the record is does not exist in ecfVersionProperty table
		THEN 
			INSERT (
				WorkId, ObjectId, ObjectTypeId, MetaFieldId, MetaClassId, MetaFieldName, LanguageName, CultureSpecific, Boolean, Number, 
				FloatNumber, [Money], [Decimal], [Date], [Binary], [String], LongString, [Guid])
			VALUES (
				I.WorkId, I.ObjectId, I.ObjectTypeId, I.MetaFieldId, I.MetaClassId, I.MetaFieldName, I.LanguageName, I.CultureSpecific, I.Boolean, I.Number, 
				I.FloatNumber, I.[Money], I.[Decimal], I.[Date], I.[Binary], I.[String], I.LongString, I.[Guid])
	;
END
GO
PRINT N'Creating [dbo].[ecfVersion_Save]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_Save]
	@WorkId int,
	@ObjectId int,
	@ObjectTypeId int,
	@CatalogId int,
	@Name [nvarchar](100),
	@Code [nvarchar](100),
	@LanguageName [nvarchar](50),
	@MasterLanguageName [nvarchar](50),
    @StartPublish [datetime],
	@StopPublish DATETIME,
	@Status INT,
	@CreatedBy [nvarchar](100),
	@Created DATETIME,
	@ModifiedBy [nvarchar](100),
	@Modified DATETIME,
	@SeoUri nvarchar(255),
	@SeoTitle nvarchar(150),
	@SeoDescription nvarchar(355),
	@SeoKeywords nvarchar(355),
	@SeoUriSegment nvarchar(255),
	@MaxVersions INT = 20
AS
BEGIN
	-- Code and name are not culture specific, we need to copy them from the master language to all other languages.
	IF @LanguageName = @MasterLanguageName COLLATE DATABASE_DEFAULT
	BEGIN
		UPDATE ecfVersion SET Name = @Name, Code = @Code WHERE ObjectId = @ObjectId AND ObjectTypeId = @ObjectTypeId AND LanguageName <> @MasterLanguageName COLLATE DATABASE_DEFAULT
	END

	UPDATE ecfVersion
	SET ObjectId = @ObjectId,
		Code = @Code,
		Name = @Name,
		ObjectTypeId = @ObjectTypeId,
		CatalogId = @CatalogId,
		LanguageName = @LanguageName,
		MasterLanguageName = @MasterLanguageName,
		StartPublish = @StartPublish,
		StopPublish = @StopPublish,
		[Status] = @Status,
		CreatedBy = @CreatedBy,
	    Created = @Created,
		Modified = @Modified,
		ModifiedBy = @ModifiedBy,
		SeoUri = @SeoUri,
		SeoTitle = @SeoTitle,
		SeoDescription = @SeoDescription,
		SeoKeywords = @SeoKeywords,
		SeoUriSegment = @SeoUriSegment
	WHERE WorkId = @WorkId

	IF (@Status = 4)
	BEGIN
		EXEC ecfVersion_PublishContentVersion @WorkId, @ObjectId, @ObjectTypeId, @LanguageName, @MaxVersions
	END
END
GO
PRINT N'Creating [dbo].[ecfVersion_DeleteByWorkId]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_DeleteByWorkId]
	@WorkId int
AS
BEGIN
	DECLARE @MetaClassId INT
	DECLARE @ObjectId INT
	
	SELECT @MetaClassId = T.MetaClassId, @ObjectId = V.ObjectId
	FROM ecfVersion V
		INNER JOIN
		(SELECT CatalogEntryId AS ObjectId, 0 AS ObjectTypeId, MetaClassId FROM CatalogEntry
			UNION ALL
		SELECT CatalogNodeId AS ObjectId, 1 AS ObjectTypeId, MetaClassId FROM CatalogNode) T
		ON V.ObjectId = T.ObjectId AND V.ObjectTypeId = T.ObjectTypeId
	 WHERE V.WorkId = @WorkId

	DELETE FROM ecfVersion
	WHERE WorkId = @WorkId
	DECLARE @AffectedMetaKeys udttIdTable
		INSERT INTO @AffectedMetaKeys
			SELECT MK.MetaKey
			FROM MetaKey MK
			WHERE MK.MetaClassId = @MetaClassId
			AND MK.MetaObjectId = @ObjectId
			AND MK.WorkId = @WorkId

	-- Delete data for all reference type meta fields (dictionaries etc)
	EXEC mdpsp_sys_DeleteMetaKeyObjects @AffectedMetaKeys
END
GO
PRINT N'Creating [dbo].[aspnet_PersonalizationAdministration_GetCountOfState]...';


GO
CREATE PROCEDURE dbo.aspnet_PersonalizationAdministration_GetCountOfState (
    @Count int OUT,
    @AllUsersScope bit,
    @ApplicationName NVARCHAR(256),
    @Path NVARCHAR(256) = NULL,
    @UserName NVARCHAR(256) = NULL,
    @InactiveSinceDate DATETIME = NULL)
AS
BEGIN

    DECLARE @ApplicationId UNIQUEIDENTIFIER
    EXEC dbo.aspnet_Personalization_GetApplicationId @ApplicationName, @ApplicationId OUTPUT
    IF (@ApplicationId IS NULL)
        SELECT @Count = 0
    ELSE
        IF (@AllUsersScope = 1)
            SELECT @Count = COUNT(*)
            FROM dbo.aspnet_PersonalizationAllUsers AllUsers, dbo.aspnet_Paths Paths
            WHERE Paths.ApplicationId = @ApplicationId
                  AND AllUsers.PathId = Paths.PathId
                  AND (@Path IS NULL OR Paths.LoweredPath LIKE LOWER(@Path))
        ELSE
            SELECT @Count = COUNT(*)
            FROM dbo.aspnet_PersonalizationPerUser PerUser, dbo.aspnet_Users Users, dbo.aspnet_Paths Paths
            WHERE Paths.ApplicationId = @ApplicationId
                  AND PerUser.UserId = Users.UserId
                  AND PerUser.PathId = Paths.PathId
                  AND (@Path IS NULL OR Paths.LoweredPath LIKE LOWER(@Path))
                  AND (@UserName IS NULL OR Users.LoweredUserName LIKE LOWER(@UserName))
                  AND (@InactiveSinceDate IS NULL OR Users.LastActivityDate <= @InactiveSinceDate)
END
GO
PRINT N'Creating [dbo].[aspnet_PersonalizationAdministration_FindState]...';


GO
CREATE PROCEDURE dbo.aspnet_PersonalizationAdministration_FindState (
    @AllUsersScope bit,
    @ApplicationName NVARCHAR(256),
    @PageIndex              INT,
    @PageSize               INT,
    @Path NVARCHAR(256) = NULL,
    @UserName NVARCHAR(256) = NULL,
    @InactiveSinceDate DATETIME = NULL)
AS
BEGIN
    DECLARE @ApplicationId UNIQUEIDENTIFIER
    EXEC dbo.aspnet_Personalization_GetApplicationId @ApplicationName, @ApplicationId OUTPUT
    IF (@ApplicationId IS NULL)
        RETURN

    -- Set the page bounds
    DECLARE @PageLowerBound INT
    DECLARE @PageUpperBound INT
    DECLARE @TotalRecords   INT
    SET @PageLowerBound = @PageSize * @PageIndex
    SET @PageUpperBound = @PageSize - 1 + @PageLowerBound

    -- Create a temp table to store the selected results
    CREATE TABLE #PageIndex (
        IndexId int IDENTITY (0, 1) NOT NULL,
        ItemId UNIQUEIDENTIFIER
    )

    IF (@AllUsersScope = 1)
    BEGIN
        -- Insert into our temp table
        INSERT INTO #PageIndex (ItemId)
        SELECT Paths.PathId
        FROM dbo.aspnet_Paths Paths,
             ((SELECT Paths.PathId
               FROM dbo.aspnet_PersonalizationAllUsers AllUsers, dbo.aspnet_Paths Paths
               WHERE Paths.ApplicationId = @ApplicationId
                      AND AllUsers.PathId = Paths.PathId
                      AND (@Path IS NULL OR Paths.LoweredPath LIKE LOWER(@Path))
              ) AS SharedDataPerPath
              FULL OUTER JOIN
              (SELECT DISTINCT Paths.PathId
               FROM dbo.aspnet_PersonalizationPerUser PerUser, dbo.aspnet_Paths Paths
               WHERE Paths.ApplicationId = @ApplicationId
                      AND PerUser.PathId = Paths.PathId
                      AND (@Path IS NULL OR Paths.LoweredPath LIKE LOWER(@Path))
              ) AS UserDataPerPath
              ON SharedDataPerPath.PathId = UserDataPerPath.PathId
             )
        WHERE Paths.PathId = SharedDataPerPath.PathId OR Paths.PathId = UserDataPerPath.PathId
        ORDER BY Paths.Path ASC

        SELECT @TotalRecords = @@ROWCOUNT

        SELECT Paths.Path,
               SharedDataPerPath.LastUpdatedDate,
               SharedDataPerPath.SharedDataLength,
               UserDataPerPath.UserDataLength,
               UserDataPerPath.UserCount
        FROM dbo.aspnet_Paths Paths,
             ((SELECT PageIndex.ItemId AS PathId,
                      AllUsers.LastUpdatedDate AS LastUpdatedDate,
                      DATALENGTH(AllUsers.PageSettings) AS SharedDataLength
               FROM dbo.aspnet_PersonalizationAllUsers AllUsers, #PageIndex PageIndex
               WHERE AllUsers.PathId = PageIndex.ItemId
                     AND PageIndex.IndexId >= @PageLowerBound AND PageIndex.IndexId <= @PageUpperBound
              ) AS SharedDataPerPath
              FULL OUTER JOIN
              (SELECT PageIndex.ItemId AS PathId,
                      SUM(DATALENGTH(PerUser.PageSettings)) AS UserDataLength,
                      COUNT(*) AS UserCount
               FROM aspnet_PersonalizationPerUser PerUser, #PageIndex PageIndex
               WHERE PerUser.PathId = PageIndex.ItemId
                     AND PageIndex.IndexId >= @PageLowerBound AND PageIndex.IndexId <= @PageUpperBound
               GROUP BY PageIndex.ItemId
              ) AS UserDataPerPath
              ON SharedDataPerPath.PathId = UserDataPerPath.PathId
             )
        WHERE Paths.PathId = SharedDataPerPath.PathId OR Paths.PathId = UserDataPerPath.PathId
        ORDER BY Paths.Path ASC
    END
    ELSE
    BEGIN
        -- Insert into our temp table
        INSERT INTO #PageIndex (ItemId)
        SELECT PerUser.Id
        FROM dbo.aspnet_PersonalizationPerUser PerUser, dbo.aspnet_Users Users, dbo.aspnet_Paths Paths
        WHERE Paths.ApplicationId = @ApplicationId
              AND PerUser.UserId = Users.UserId
              AND PerUser.PathId = Paths.PathId
              AND (@Path IS NULL OR Paths.LoweredPath LIKE LOWER(@Path))
              AND (@UserName IS NULL OR Users.LoweredUserName LIKE LOWER(@UserName))
              AND (@InactiveSinceDate IS NULL OR Users.LastActivityDate <= @InactiveSinceDate)
        ORDER BY Paths.Path ASC, Users.UserName ASC

        SELECT @TotalRecords = @@ROWCOUNT

        SELECT Paths.Path, PerUser.LastUpdatedDate, DATALENGTH(PerUser.PageSettings), Users.UserName, Users.LastActivityDate
        FROM dbo.aspnet_PersonalizationPerUser PerUser, dbo.aspnet_Users Users, dbo.aspnet_Paths Paths, #PageIndex PageIndex
        WHERE PerUser.Id = PageIndex.ItemId
              AND PerUser.UserId = Users.UserId
              AND PerUser.PathId = Paths.PathId
              AND PageIndex.IndexId >= @PageLowerBound AND PageIndex.IndexId <= @PageUpperBound
        ORDER BY Paths.Path ASC, Users.UserName ASC
    END

    RETURN @TotalRecords
END
GO
PRINT N'Creating [dbo].[aspnet_PersonalizationAdministration_ResetUserState]...';


GO
CREATE PROCEDURE dbo.aspnet_PersonalizationAdministration_ResetUserState (
    @Count                  int                 OUT,
    @ApplicationName        NVARCHAR(256),
    @InactiveSinceDate      DATETIME            = NULL,
    @UserName               NVARCHAR(256)       = NULL,
    @Path                   NVARCHAR(256)       = NULL)
AS
BEGIN
    DECLARE @ApplicationId UNIQUEIDENTIFIER
    EXEC dbo.aspnet_Personalization_GetApplicationId @ApplicationName, @ApplicationId OUTPUT
    IF (@ApplicationId IS NULL)
        SELECT @Count = 0
    ELSE
    BEGIN
        DELETE FROM dbo.aspnet_PersonalizationPerUser
        WHERE Id IN (SELECT PerUser.Id
                     FROM dbo.aspnet_PersonalizationPerUser PerUser, dbo.aspnet_Users Users, dbo.aspnet_Paths Paths
                     WHERE Paths.ApplicationId = @ApplicationId
                           AND PerUser.UserId = Users.UserId
                           AND PerUser.PathId = Paths.PathId
                           AND (@InactiveSinceDate IS NULL OR Users.LastActivityDate <= @InactiveSinceDate)
                           AND (@UserName IS NULL OR Users.LoweredUserName = LOWER(@UserName))
                           AND (@Path IS NULL OR Paths.LoweredPath = LOWER(@Path)))

        SELECT @Count = @@ROWCOUNT
    END
END
GO
PRINT N'Creating [dbo].[aspnet_PersonalizationAdministration_ResetSharedState]...';


GO
CREATE PROCEDURE dbo.aspnet_PersonalizationAdministration_ResetSharedState (
    @Count int OUT,
    @ApplicationName NVARCHAR(256),
    @Path NVARCHAR(256))
AS
BEGIN
    DECLARE @ApplicationId UNIQUEIDENTIFIER
    EXEC dbo.aspnet_Personalization_GetApplicationId @ApplicationName, @ApplicationId OUTPUT
    IF (@ApplicationId IS NULL)
        SELECT @Count = 0
    ELSE
    BEGIN
        DELETE FROM dbo.aspnet_PersonalizationAllUsers
        WHERE PathId IN
            (SELECT AllUsers.PathId
             FROM dbo.aspnet_PersonalizationAllUsers AllUsers, dbo.aspnet_Paths Paths
             WHERE Paths.ApplicationId = @ApplicationId
                   AND AllUsers.PathId = Paths.PathId
                   AND Paths.LoweredPath = LOWER(@Path))

        SELECT @Count = @@ROWCOUNT
    END
END
GO
PRINT N'Creating [dbo].[aspnet_PersonalizationAdministration_DeleteAllState]...';


GO
CREATE PROCEDURE dbo.aspnet_PersonalizationAdministration_DeleteAllState (
    @AllUsersScope bit,
    @ApplicationName NVARCHAR(256),
    @Count int OUT)
AS
BEGIN
    DECLARE @ApplicationId UNIQUEIDENTIFIER
    EXEC dbo.aspnet_Personalization_GetApplicationId @ApplicationName, @ApplicationId OUTPUT
    IF (@ApplicationId IS NULL)
        SELECT @Count = 0
    ELSE
    BEGIN
        IF (@AllUsersScope = 1)
            DELETE FROM aspnet_PersonalizationAllUsers
            WHERE PathId IN
               (SELECT Paths.PathId
                FROM dbo.aspnet_Paths Paths
                WHERE Paths.ApplicationId = @ApplicationId)
        ELSE
            DELETE FROM aspnet_PersonalizationPerUser
            WHERE PathId IN
               (SELECT Paths.PathId
                FROM dbo.aspnet_Paths Paths
                WHERE Paths.ApplicationId = @ApplicationId)

        SELECT @Count = @@ROWCOUNT
    END
END
GO
PRINT N'Creating [dbo].[aspnet_PersonalizationPerUser_SetPageSettings]...';


GO
CREATE PROCEDURE dbo.aspnet_PersonalizationPerUser_SetPageSettings (
    @ApplicationName  NVARCHAR(256),
    @UserName         NVARCHAR(256),
    @Path             NVARCHAR(256),
    @PageSettings     IMAGE,
    @CurrentTimeUtc   DATETIME)
AS
BEGIN
    DECLARE @ApplicationId UNIQUEIDENTIFIER
    DECLARE @PathId UNIQUEIDENTIFIER
    DECLARE @UserId UNIQUEIDENTIFIER

    SELECT @ApplicationId = NULL
    SELECT @PathId = NULL
    SELECT @UserId = NULL

    EXEC dbo.aspnet_Applications_CreateApplication @ApplicationName, @ApplicationId OUTPUT

    SELECT @PathId = u.PathId FROM dbo.aspnet_Paths u WHERE u.ApplicationId = @ApplicationId AND u.LoweredPath = LOWER(@Path)
    IF (@PathId IS NULL)
    BEGIN
        EXEC dbo.aspnet_Paths_CreatePath @ApplicationId, @Path, @PathId OUTPUT
    END

    SELECT @UserId = u.UserId FROM dbo.aspnet_Users u WHERE u.ApplicationId = @ApplicationId AND u.LoweredUserName = LOWER(@UserName)
    IF (@UserId IS NULL)
    BEGIN
        EXEC dbo.aspnet_Users_CreateUser @ApplicationId, @UserName, 0, @CurrentTimeUtc, @UserId OUTPUT
    END

    UPDATE   dbo.aspnet_Users WITH (ROWLOCK)
    SET      LastActivityDate = @CurrentTimeUtc
    WHERE    UserId = @UserId
    IF (@@ROWCOUNT = 0) -- Username not found
        RETURN

    IF (EXISTS(SELECT PathId FROM dbo.aspnet_PersonalizationPerUser WHERE UserId = @UserId AND PathId = @PathId))
        UPDATE dbo.aspnet_PersonalizationPerUser SET PageSettings = @PageSettings, LastUpdatedDate = @CurrentTimeUtc WHERE UserId = @UserId AND PathId = @PathId
    ELSE
        INSERT INTO dbo.aspnet_PersonalizationPerUser(UserId, PathId, PageSettings, LastUpdatedDate) VALUES (@UserId, @PathId, @PageSettings, @CurrentTimeUtc)
    RETURN 0
END
GO
PRINT N'Creating [dbo].[aspnet_PersonalizationPerUser_ResetPageSettings]...';


GO
CREATE PROCEDURE dbo.aspnet_PersonalizationPerUser_ResetPageSettings (
    @ApplicationName  NVARCHAR(256),
    @UserName         NVARCHAR(256),
    @Path             NVARCHAR(256),
    @CurrentTimeUtc   DATETIME)
AS
BEGIN
    DECLARE @ApplicationId UNIQUEIDENTIFIER
    DECLARE @PathId UNIQUEIDENTIFIER
    DECLARE @UserId UNIQUEIDENTIFIER

    SELECT @ApplicationId = NULL
    SELECT @PathId = NULL
    SELECT @UserId = NULL

    EXEC dbo.aspnet_Personalization_GetApplicationId @ApplicationName, @ApplicationId OUTPUT
    IF (@ApplicationId IS NULL)
    BEGIN
        RETURN
    END

    SELECT @PathId = u.PathId FROM dbo.aspnet_Paths u WHERE u.ApplicationId = @ApplicationId AND u.LoweredPath = LOWER(@Path)
    IF (@PathId IS NULL)
    BEGIN
        RETURN
    END

    SELECT @UserId = u.UserId FROM dbo.aspnet_Users u WHERE u.ApplicationId = @ApplicationId AND u.LoweredUserName = LOWER(@UserName)
    IF (@UserId IS NULL)
    BEGIN
        RETURN
    END

    UPDATE   dbo.aspnet_Users WITH (ROWLOCK)
    SET      LastActivityDate = @CurrentTimeUtc
    WHERE    UserId = @UserId
    IF (@@ROWCOUNT = 0) -- Username not found
        RETURN

    DELETE FROM dbo.aspnet_PersonalizationPerUser WHERE PathId = @PathId AND UserId = @UserId
    RETURN 0
END
GO
PRINT N'Creating [dbo].[aspnet_PersonalizationPerUser_GetPageSettings]...';


GO
CREATE PROCEDURE dbo.aspnet_PersonalizationPerUser_GetPageSettings (
    @ApplicationName  NVARCHAR(256),
    @UserName         NVARCHAR(256),
    @Path             NVARCHAR(256),
    @CurrentTimeUtc   DATETIME)
AS
BEGIN
    DECLARE @ApplicationId UNIQUEIDENTIFIER
    DECLARE @PathId UNIQUEIDENTIFIER
    DECLARE @UserId UNIQUEIDENTIFIER

    SELECT @ApplicationId = NULL
    SELECT @PathId = NULL
    SELECT @UserId = NULL

    EXEC dbo.aspnet_Personalization_GetApplicationId @ApplicationName, @ApplicationId OUTPUT
    IF (@ApplicationId IS NULL)
    BEGIN
        RETURN
    END

    SELECT @PathId = u.PathId FROM dbo.aspnet_Paths u WHERE u.ApplicationId = @ApplicationId AND u.LoweredPath = LOWER(@Path)
    IF (@PathId IS NULL)
    BEGIN
        RETURN
    END

    SELECT @UserId = u.UserId FROM dbo.aspnet_Users u WHERE u.ApplicationId = @ApplicationId AND u.LoweredUserName = LOWER(@UserName)
    IF (@UserId IS NULL)
    BEGIN
        RETURN
    END

    UPDATE   dbo.aspnet_Users WITH (ROWLOCK)
    SET      LastActivityDate = @CurrentTimeUtc
    WHERE    UserId = @UserId
    IF (@@ROWCOUNT = 0) -- Username not found
        RETURN

    SELECT p.PageSettings FROM dbo.aspnet_PersonalizationPerUser p WHERE p.PathId = @PathId AND p.UserId = @UserId
END
GO
PRINT N'Creating [dbo].[aspnet_PersonalizationAllUsers_SetPageSettings]...';


GO
CREATE PROCEDURE dbo.aspnet_PersonalizationAllUsers_SetPageSettings (
    @ApplicationName  NVARCHAR(256),
    @Path             NVARCHAR(256),
    @PageSettings     IMAGE,
    @CurrentTimeUtc   DATETIME)
AS
BEGIN
    DECLARE @ApplicationId UNIQUEIDENTIFIER
    DECLARE @PathId UNIQUEIDENTIFIER

    SELECT @ApplicationId = NULL
    SELECT @PathId = NULL

    EXEC dbo.aspnet_Applications_CreateApplication @ApplicationName, @ApplicationId OUTPUT

    SELECT @PathId = u.PathId FROM dbo.aspnet_Paths u WHERE u.ApplicationId = @ApplicationId AND u.LoweredPath = LOWER(@Path)
    IF (@PathId IS NULL)
    BEGIN
        EXEC dbo.aspnet_Paths_CreatePath @ApplicationId, @Path, @PathId OUTPUT
    END

    IF (EXISTS(SELECT PathId FROM dbo.aspnet_PersonalizationAllUsers WHERE PathId = @PathId))
        UPDATE dbo.aspnet_PersonalizationAllUsers SET PageSettings = @PageSettings, LastUpdatedDate = @CurrentTimeUtc WHERE PathId = @PathId
    ELSE
        INSERT INTO dbo.aspnet_PersonalizationAllUsers(PathId, PageSettings, LastUpdatedDate) VALUES (@PathId, @PageSettings, @CurrentTimeUtc)
    RETURN 0
END
GO
PRINT N'Creating [dbo].[aspnet_PersonalizationAllUsers_ResetPageSettings]...';


GO
CREATE PROCEDURE dbo.aspnet_PersonalizationAllUsers_ResetPageSettings (
    @ApplicationName  NVARCHAR(256),
    @Path              NVARCHAR(256))
AS
BEGIN
    DECLARE @ApplicationId UNIQUEIDENTIFIER
    DECLARE @PathId UNIQUEIDENTIFIER

    SELECT @ApplicationId = NULL
    SELECT @PathId = NULL

    EXEC dbo.aspnet_Personalization_GetApplicationId @ApplicationName, @ApplicationId OUTPUT
    IF (@ApplicationId IS NULL)
    BEGIN
        RETURN
    END

    SELECT @PathId = u.PathId FROM dbo.aspnet_Paths u WHERE u.ApplicationId = @ApplicationId AND u.LoweredPath = LOWER(@Path)
    IF (@PathId IS NULL)
    BEGIN
        RETURN
    END

    DELETE FROM dbo.aspnet_PersonalizationAllUsers WHERE PathId = @PathId
    RETURN 0
END
GO
PRINT N'Creating [dbo].[aspnet_PersonalizationAllUsers_GetPageSettings]...';


GO
CREATE PROCEDURE dbo.aspnet_PersonalizationAllUsers_GetPageSettings (
    @ApplicationName  NVARCHAR(256),
    @Path              NVARCHAR(256))
AS
BEGIN
    DECLARE @ApplicationId UNIQUEIDENTIFIER
    DECLARE @PathId UNIQUEIDENTIFIER

    SELECT @ApplicationId = NULL
    SELECT @PathId = NULL

    EXEC dbo.aspnet_Personalization_GetApplicationId @ApplicationName, @ApplicationId OUTPUT
    IF (@ApplicationId IS NULL)
    BEGIN
        RETURN
    END

    SELECT @PathId = u.PathId FROM dbo.aspnet_Paths u WHERE u.ApplicationId = @ApplicationId AND u.LoweredPath = LOWER(@Path)
    IF (@PathId IS NULL)
    BEGIN
        RETURN
    END

    SELECT p.PageSettings FROM dbo.aspnet_PersonalizationAllUsers p WHERE p.PathId = @PathId
END
GO
PRINT N'Creating [dbo].[ecf_Search_CatalogEntry]...';


GO
create procedure dbo.ecf_Search_CatalogEntry
	@SearchSetId uniqueidentifier,
	@ResponseGroup INT = NULL
as
begin
    declare @entries dbo.udttEntityList
    insert into @entries (EntityId, SortOrder)
    select r.CatalogEntryId, r.SortOrder
    from CatalogEntrySearchResults r
    where r.SearchSetId = @SearchSetId
    
	exec dbo.ecf_CatalogEntry_List @entries, @ResponseGroup

	delete CatalogEntrySearchResults
	where SearchSetId = @SearchSetId
end
GO
PRINT N'Creating [dbo].[aspnet_Roles_CreateRole]...';


GO
CREATE PROCEDURE dbo.aspnet_Roles_CreateRole
    @ApplicationName  nvarchar(256),
    @RoleName         nvarchar(256)
AS
BEGIN
    DECLARE @ApplicationId uniqueidentifier
    SELECT  @ApplicationId = NULL

    DECLARE @ErrorCode     int
    SET @ErrorCode = 0

    DECLARE @TranStarted   bit
    SET @TranStarted = 0

    IF( @@TRANCOUNT = 0 )
    BEGIN
        BEGIN TRANSACTION
        SET @TranStarted = 1
    END
    ELSE
        SET @TranStarted = 0

    EXEC dbo.aspnet_Applications_CreateApplication @ApplicationName, @ApplicationId OUTPUT

    IF( @@ERROR <> 0 )
    BEGIN
        SET @ErrorCode = -1
        GOTO Cleanup
    END

    IF (EXISTS(SELECT RoleId FROM dbo.aspnet_Roles WHERE LoweredRoleName = LOWER(@RoleName) AND ApplicationId = @ApplicationId))
    BEGIN
        SET @ErrorCode = 1
        GOTO Cleanup
    END

    INSERT INTO dbo.aspnet_Roles
                (ApplicationId, RoleName, LoweredRoleName)
         VALUES (@ApplicationId, @RoleName, LOWER(@RoleName))

    IF( @@ERROR <> 0 )
    BEGIN
        SET @ErrorCode = -1
        GOTO Cleanup
    END

    IF( @TranStarted = 1 )
    BEGIN
        SET @TranStarted = 0
        COMMIT TRANSACTION
    END

    RETURN(0)

Cleanup:

    IF( @TranStarted = 1 )
    BEGIN
        SET @TranStarted = 0
        ROLLBACK TRANSACTION
    END

    RETURN @ErrorCode

END
GO
PRINT N'Creating [dbo].[ecf_CatalogNode_CatalogParentNodeCode]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogNode_CatalogParentNodeCode]
	@CatalogName nvarchar(150),
	@ParentNodeCode nvarchar(100),
	@ReturnInactive bit = 0
AS
BEGIN
	declare @CatalogId int
	declare @ParentNodeId int

	select @CatalogId = CatalogId from [Catalog] where [Name] = @CatalogName
	select @ParentNodeId = CatalogNodeId from [CatalogNode] where Code = @ParentNodeCode

	EXECUTE [ecf_CatalogNode_CatalogParentNode] @CatalogId,@ParentNodeId,@ReturnInactive
END
GO
PRINT N'Creating [dbo].[ecf_CatalogEntrySearch]...';


GO
CREATE PROCEDURE [dbo].[ecf_CatalogEntrySearch]
(
	@SearchSetId				uniqueidentifier,
	@Language 					nvarchar(50),
	@Catalogs 					nvarchar(max),
	@CatalogNodes 				nvarchar(max),
	@SQLClause 					nvarchar(max),
	@MetaSQLClause 				nvarchar(max),
	@KeywordPhrase				nvarchar(max),
	@OrderBy 					nvarchar(max),
	@Classes					nvarchar(max) = N'',
	@StartingRec				int,
	@NumRecords					int,
	@JoinType					nvarchar(50),
	@SourceTableName			sysname,
	@TargetQuery				nvarchar(max),
	@SourceJoinKey				sysname,
	@TargetJoinKey				sysname,
	@RecordCount				int OUTPUT,
	@ReturnTotalCount			bit = 1
)
AS

BEGIN
	SET NOCOUNT ON
	
	DECLARE @FilterVariables_tmp 		nvarchar(max)
	DECLARE @query_tmp 		nvarchar(max)
	DECLARE @FilterQuery_tmp 		nvarchar(max)
	declare @FromQuery_tmp nvarchar(max)
	declare @SelectCountQuery_tmp nvarchar(max)
	declare @FullQuery nvarchar(max)
	DECLARE @JoinQuery_tmp 		nvarchar(max)

	-- Precalculate length for constant strings
	DECLARE @MetaSQLClauseLength bigint
	DECLARE @KeywordPhraseLength bigint
	SET @MetaSQLClauseLength = LEN(@MetaSQLClause)
	SET @KeywordPhraseLength = LEN(@KeywordPhrase)

	set @RecordCount = -1

	-- ######## CREATE FILTER QUERY
	-- CREATE "JOINS" NEEDED
	-- Create filter query
	set @FilterQuery_tmp = N''
	--set @FilterQuery_tmp = N' INNER JOIN Catalog [Catalog] ON [Catalog].CatalogId = CatalogEntry.CatalogId'

	-- Only add NodeEntryRelation table join if one Node filter is specified, if more than one then we can't inner join it
	if(Len(@CatalogNodes) != 0 and (select count(Item) from ecf_splitlist(@CatalogNodes)) <= 1)
	begin
		set @FilterQuery_tmp = @FilterQuery_tmp + N' INNER JOIN NodeEntryRelation NodeEntryRelation ON CatalogEntry.CatalogEntryId = NodeEntryRelation.CatalogEntryId '
	end
	
	-- If nodes specified, no need to filter by catalog since that is done in node filter
	if(Len(@CatalogNodes) = 0)
	begin
		set @FilterQuery_tmp = @FilterQuery_tmp + N' INNER JOIN @Catalogs_temp catalogs ON CatalogEntry.CatalogId = catalogs.CatalogId '
	end

	-- If language specified, then filter by language	
	if (Len(@Language) != 0)
	begin
		set @FilterQuery_tmp = @FilterQuery_tmp + N' INNER JOIN CatalogLanguage l ON l.CatalogId = CatalogEntry.CatalogId AND l.LanguageCode = N'''+@Language+'''' 
	end	

	-- CREATE "WHERE" NEEDED
	set @FilterQuery_tmp = @FilterQuery_tmp + N' WHERE 1=1'  --BUGBUG

	IF(@KeywordPhraseLength>0)
		SET @FilterQuery_tmp = @FilterQuery_tmp + N' AND CatalogEntry.Name LIKE N''%' + @KeywordPhrase + '%'' ';	

	if(Len(@CatalogNodes) != 0)
	begin
		set @FilterQuery_tmp = @FilterQuery_tmp + N' AND'
		-- Different filter if more than one category is specified
		if ((select count(Item) from ecf_splitlist(@CatalogNodes)) > 1)
		begin 
			set @FilterQuery_tmp = @FilterQuery_tmp + N' CatalogEntry.CatalogEntryId in (select NodeEntryRelation.CatalogEntryId from NodeEntryRelation NodeEntryRelation where '
		end
		set @FilterQuery_tmp = @FilterQuery_tmp + N' NodeEntryRelation.CatalogNodeId IN (select CatalogNode.CatalogNodeId from CatalogNode CatalogNode'
		set @FilterQuery_tmp = @FilterQuery_tmp + N' WHERE (CatalogNode.[Code] in (select Item from ecf_splitlist(''' + @CatalogNodes + '''))) AND NodeEntryRelation.CatalogId in (select * from @Catalogs_temp)'
		set @FilterQuery_tmp = @FilterQuery_tmp + N')'
		--set @FilterQuery_tmp = @FilterQuery_tmp; + N' WHERE (CatalogNode.[Code] in (select Item from ecf_splitlist(''' + @CatalogNodes + ''')))'
	end

	-- Different filter if more than one category is specified
	if(Len(@CatalogNodes) != 0 and (select count(Item) from ecf_splitlist(@CatalogNodes)) > 1)
	begin
		set @FilterQuery_tmp = @FilterQuery_tmp + N')'
	end

	--set @FilterQuery_tmp = @FilterQuery_tmp + N')'

	-- add sql clause statement here, if specified
	if(Len(@SQLClause) != 0)
	begin
		set @FilterQuery_tmp = @FilterQuery_tmp + N' AND (' + @SqlClause + ')'
	end

	-- Create from command	
	SET @FromQuery_tmp = N'FROM [CatalogEntry] CatalogEntry' 
	
	--add meta class name filter
	DECLARE @MetaClassNameFilter NVARCHAR(MAX)
	SET @MetaClassNameFilter = ''
	IF (LEN(@Classes) > 0)
	BEGIN
		SET @MetaClassNameFilter = ' AND MC.Name IN (select Item from ecf_splitlist(''' +@Classes + '''))'
	END

	--if @MetaSQLClause is not empty, we filter by _ExcludedCatalogEntryMarkets field and also meta class name if it is not empty.
	IF(@MetaSQLClauseLength>0)
	BEGIN
		SET @FromQuery_tmp = @FromQuery_tmp + @MetaSQLClause
	END
	--if not, we filter by meta class name if it is not empty.
	ELSE IF (LEN(@Classes) > 0)
	BEGIN
		SET @FromQuery_tmp = @FromQuery_tmp + N' 
				INNER JOIN
				(
					select distinct CP.ObjectId 
					from CatalogContentProperty CP
					inner join MetaClass MC ON MC.MetaClassId = CP.MetaClassId
					Where CP.ObjectTypeId = 0 --entry only
						' + @MetaClassNameFilter +' 
				) FilteredEntries ON FilteredEntries.ObjectId = [CatalogEntry].CatalogEntryId
		 '
	END

	-- attach inner join if needed
	if(@JoinType is not null and Len(@JoinType) > 0)
	begin
		set @Query_tmp = ''
		EXEC [ecf_CreateTableJoinQuery] @SourceTableName, @TargetQuery, @SourceJoinKey, @TargetJoinKey, @JoinType, @Query_tmp OUT
		print(@Query_tmp)
		set @FromQuery_tmp = @FromQuery_tmp + N' ' + @Query_tmp
	end
	--print(@FromQuery_tmp)
	
	-- order by statement here
	if(Len(@OrderBy) = 0 and Len(@CatalogNodes) != 0 and CHARINDEX(',', @CatalogNodes) = 0)
	begin
		set @OrderBy = 'NodeEntryRelation.SortOrder'
	end
	else if(Len(@OrderBy) = 0)
	begin
		set @OrderBy = 'CatalogEntry.CatalogEntryId'
	end

	--print(@FilterQuery_tmp)
	-- add catalogs temp variable that will be used to filter out catalogs
	set @FilterVariables_tmp = 'declare @Catalogs_temp table (CatalogId int);'
	set @FilterVariables_tmp = @FilterVariables_tmp + 'INSERT INTO @Catalogs_temp select CatalogId from Catalog'
	if(Len(RTrim(LTrim(@Catalogs)))>0)
		set @FilterVariables_tmp = @FilterVariables_tmp + ' WHERE ([Catalog].[Name] in (select Item from ecf_splitlist(''' + @Catalogs + ''')))'
	set @FilterVariables_tmp = @FilterVariables_tmp + ';'

	if(@ReturnTotalCount = 1) -- Only return count if we requested it
		begin
			set @FullQuery = N'SELECT count([CatalogEntry].CatalogEntryId) OVER() TotalRecords, [CatalogEntry].CatalogEntryId,  ROW_NUMBER() OVER(ORDER BY ' + @OrderBy + N') RowNumber ' + @FromQuery_tmp + @FilterQuery_tmp
			-- use temp table variable
			set @FullQuery = N'with OrderedResults as (' + @FullQuery +') INSERT INTO @Page_temp (TotalRecords, ObjectId, SortOrder) SELECT top(' + cast(@NumRecords as nvarchar(50)) + ') TotalRecords, CatalogEntryId, RowNumber FROM OrderedResults WHERE RowNumber > ' + cast(@StartingRec as nvarchar(50)) + ';'
			--print(@FullQuery)
			set @FullQuery = @FilterVariables_tmp + 'declare @Page_temp table (TotalRecords int,ObjectId int,SortOrder int);' + @FullQuery + ';select @RecordCount = TotalRecords from @Page_temp;INSERT INTO CatalogEntrySearchResults (SearchSetId, CatalogEntryId, SortOrder) SELECT ''' + cast(@SearchSetId as nvarchar(100)) + N''', ObjectId, SortOrder from @Page_temp;'
			exec sp_executesql @FullQuery, N'@RecordCount int output', @RecordCount = @RecordCount OUTPUT
			
			--print @FullQuery
			--exec(@FullQuery)			
		end
	else
		begin
			-- simplified query with no TotalRecords, should give some performance gain
			set @FullQuery = N'SELECT [CatalogEntry].CatalogEntryId, ROW_NUMBER() OVER(ORDER BY ' + @OrderBy + N') RowNumber ' + @FromQuery_tmp + @FilterQuery_tmp
			
			set @FullQuery = @FilterVariables_tmp + N'with OrderedResults as (' + @FullQuery +') INSERT INTO CatalogEntrySearchResults (SearchSetId, CatalogEntryId, SortOrder) SELECT top(' + cast(@NumRecords as nvarchar(50)) + ') ''' + cast(@SearchSetId as nvarchar(100)) + N''', CatalogEntryId, RowNumber FROM OrderedResults WHERE RowNumber > ' + cast(@StartingRec as nvarchar(50)) + ';'
			--print(@FullQuery)
			--select * from CatalogEntrySearchResults
			exec(@FullQuery)
		end

	-- print(@FullQuery)
	SET NOCOUNT OFF
END
GO
PRINT N'Creating [dbo].[aspnet_Profile_DeleteProfiles]...';


GO

CREATE PROCEDURE dbo.aspnet_Profile_DeleteProfiles
    @ApplicationName        nvarchar(256),
    @UserNames              nvarchar(4000)
AS
BEGIN
    DECLARE @UserName     nvarchar(256)
    DECLARE @CurrentPos   int
    DECLARE @NextPos      int
    DECLARE @NumDeleted   int
    DECLARE @DeletedUser  int
    DECLARE @TranStarted  bit
    DECLARE @ErrorCode    int

    SET @ErrorCode = 0
    SET @CurrentPos = 1
    SET @NumDeleted = 0
    SET @TranStarted = 0

    IF( @@TRANCOUNT = 0 )
    BEGIN
        BEGIN TRANSACTION
        SET @TranStarted = 1
    END
    ELSE
    	SET @TranStarted = 0

    WHILE (@CurrentPos <= LEN(@UserNames))
    BEGIN
        SELECT @NextPos = CHARINDEX(N',', @UserNames,  @CurrentPos)
        IF (@NextPos = 0 OR @NextPos IS NULL)
            SELECT @NextPos = LEN(@UserNames) + 1

        SELECT @UserName = SUBSTRING(@UserNames, @CurrentPos, @NextPos - @CurrentPos)
        SELECT @CurrentPos = @NextPos+1

        IF (LEN(@UserName) > 0)
        BEGIN
            SELECT @DeletedUser = 0
            EXEC dbo.aspnet_Users_DeleteUser @ApplicationName, @UserName, 4, @DeletedUser OUTPUT
            IF( @@ERROR <> 0 )
            BEGIN
                SET @ErrorCode = -1
                GOTO Cleanup
            END
            IF (@DeletedUser <> 0)
                SELECT @NumDeleted = @NumDeleted + 1
        END
    END
    SELECT @NumDeleted
    IF (@TranStarted = 1)
    BEGIN
    	SET @TranStarted = 0
    	COMMIT TRANSACTION
    END
    SET @TranStarted = 0

    RETURN 0

Cleanup:
    IF (@TranStarted = 1 )
    BEGIN
        SET @TranStarted = 0
    	ROLLBACK TRANSACTION
    END
    RETURN @ErrorCode
END
GO
PRINT N'Creating [dbo].[aspnet_Profile_SetProperties]...';


GO

CREATE PROCEDURE dbo.aspnet_Profile_SetProperties
    @ApplicationName        nvarchar(256),
    @PropertyNames          ntext,
    @PropertyValuesString   ntext,
    @PropertyValuesBinary   image,
    @UserName               nvarchar(256),
    @IsUserAnonymous        bit,
    @CurrentTimeUtc         datetime
AS
BEGIN
    DECLARE @ApplicationId uniqueidentifier
    SELECT  @ApplicationId = NULL

    DECLARE @ErrorCode     int
    SET @ErrorCode = 0

    DECLARE @TranStarted   bit
    SET @TranStarted = 0

    IF( @@TRANCOUNT = 0 )
    BEGIN
       BEGIN TRANSACTION
       SET @TranStarted = 1
    END
    ELSE
    	SET @TranStarted = 0

    EXEC dbo.aspnet_Applications_CreateApplication @ApplicationName, @ApplicationId OUTPUT

    IF( @@ERROR <> 0 )
    BEGIN
        SET @ErrorCode = -1
        GOTO Cleanup
    END

    DECLARE @UserId uniqueidentifier
    DECLARE @LastActivityDate datetime
    SELECT  @UserId = NULL
    SELECT  @LastActivityDate = @CurrentTimeUtc

    SELECT @UserId = UserId
    FROM   dbo.aspnet_Users
    WHERE  ApplicationId = @ApplicationId AND LoweredUserName = LOWER(@UserName)
    IF (@UserId IS NULL)
        EXEC dbo.aspnet_Users_CreateUser @ApplicationId, @UserName, @IsUserAnonymous, @LastActivityDate, @UserId OUTPUT

    IF( @@ERROR <> 0 )
    BEGIN
        SET @ErrorCode = -1
        GOTO Cleanup
    END

    UPDATE dbo.aspnet_Users
    SET    LastActivityDate=@CurrentTimeUtc
    WHERE  UserId = @UserId

    IF( @@ERROR <> 0 )
    BEGIN
        SET @ErrorCode = -1
        GOTO Cleanup
    END

    IF (EXISTS( SELECT *
               FROM   dbo.aspnet_Profile
               WHERE  UserId = @UserId))
        UPDATE dbo.aspnet_Profile
        SET    PropertyNames=@PropertyNames, PropertyValuesString = @PropertyValuesString,
               PropertyValuesBinary = @PropertyValuesBinary, LastUpdatedDate=@CurrentTimeUtc
        WHERE  UserId = @UserId
    ELSE
        INSERT INTO dbo.aspnet_Profile(UserId, PropertyNames, PropertyValuesString, PropertyValuesBinary, LastUpdatedDate)
             VALUES (@UserId, @PropertyNames, @PropertyValuesString, @PropertyValuesBinary, @CurrentTimeUtc)

    IF( @@ERROR <> 0 )
    BEGIN
        SET @ErrorCode = -1
        GOTO Cleanup
    END

    IF( @TranStarted = 1 )
    BEGIN
    	SET @TranStarted = 0
    	COMMIT TRANSACTION
    END

    RETURN 0

Cleanup:

    IF( @TranStarted = 1 )
    BEGIN
        SET @TranStarted = 0
    	ROLLBACK TRANSACTION
    END

    RETURN @ErrorCode

END
GO
PRINT N'Creating [dbo].[mdpsp_sys_RefreshSystemMetaClassInfoAll]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_RefreshSystemMetaClassInfoAll]
AS
SET NOCOUNT ON
BEGIN TRAN
	DECLARE classall_cursor CURSOR FOR
		SELECT MetaClassId FROM MetaClass WHERE IsSystem =1

	DECLARE @MetaClassId	INT

	OPEN classall_cursor
	FETCH NEXT FROM classall_cursor INTO @MetaClassId

	WHILE @@FETCH_STATUS = 0
	BEGIN
		PRINT @MetaClassId
		EXEC  mdpsp_sys_RefreshSystemMetaClassInfo @MetaClassId
		IF @@ERROR <> 0 GOTO ERR

	FETCH NEXT FROM classall_cursor INTO @MetaClassId
	END

	CLOSE classall_cursor
	DEALLOCATE classall_cursor

	COMMIT TRAN
RETURN

ERR:
	CLOSE classall_cursor
	DEALLOCATE classall_cursor

	ROLLBACK TRAN
RETURN
GO
PRINT N'Creating [dbo].[mdpsp_sys_MetaFieldIsEncrypted]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_MetaFieldIsEncrypted]
	@MetaFieldId 	INT,
	@IsEncrypted	BIT
AS
	SET NOCOUNT ON

	BEGIN TRAN

	IF NOT EXISTS( SELECT * FROM MetaField WHERE MetaFieldId = @MetaFieldId)
	BEGIN
		RAISERROR ('Wrong @MetaFieldId. The field is system or not exists.', 16,1)
		GOTO ERR
	END

	UPDATE MetaField SET IsEncrypted = @IsEncrypted WHERE MetaFieldId = @MetaFieldId

	DECLARE class_w_search CURSOR FOR
		SELECT MCMFR.MetaClassId FROM MetaClassMetaFieldRelation MCMFR
			INNER JOIN MetaField MF ON MF.MetaFieldId = MCMFR.MetaFieldId
			INNER JOIN MetaClass MC ON MC.MetaClassId = MCMFR.MetaClassId
		WHERE MCMFR.MetaFieldId = @MetaFieldId AND (MC.IsSystem = 1 OR MF.SystemMetaClassId = 0 )

	DECLARE @MetaClassId INT

	OPEN class_w_search
	FETCH NEXT FROM class_w_search INTO @MetaClassId

	WHILE @@FETCH_STATUS = 0
	BEGIN
		EXEC mdpsp_sys_CreateMetaClassProcedure @MetaClassId

		IF @@ERROR <> 0
		BEGIN
			CLOSE class_w_search
			DEALLOCATE class_w_search

			GOTO ERR
		END

		FETCH NEXT FROM class_w_search INTO @MetaClassId
	END

	CLOSE class_w_search
	DEALLOCATE class_w_search

	COMMIT TRAN

RETURN

ERR:
	ROLLBACK TRAN
RETURN
GO
PRINT N'Creating [dbo].[mdpsp_sys_MetaFieldAllowMultiLanguage]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_MetaFieldAllowMultiLanguage]
	@MetaFieldId 	INT,
	@MultiLanguageValue	BIT
AS
	SET NOCOUNT ON

	BEGIN TRAN

	IF NOT EXISTS( SELECT * FROM MetaField WHERE MetaFieldId = @MetaFieldId)
	BEGIN
		RAISERROR ('Wrong @MetaFieldId. The field is system or not exists.', 16,1)
		GOTO ERR
	END

	UPDATE MetaField SET MultiLanguageValue = @MultiLanguageValue WHERE MetaFieldId = @MetaFieldId

	DECLARE class_w_search CURSOR FOR
		SELECT MCMFR.MetaClassId FROM MetaClassMetaFieldRelation MCMFR
			INNER JOIN MetaField MF ON MF.MetaFieldId = MCMFR.MetaFieldId
			INNER JOIN MetaClass MC ON MC.MetaClassId = MCMFR.MetaClassId
		WHERE MCMFR.MetaFieldId = @MetaFieldId AND (MC.IsSystem = 1 OR MF.SystemMetaClassId = 0 )

	DECLARE @MetaClassId INT

	OPEN class_w_search
	FETCH NEXT FROM class_w_search INTO @MetaClassId

	WHILE @@FETCH_STATUS = 0
	BEGIN
		EXEC mdpsp_sys_CreateMetaClassProcedure @MetaClassId

		IF @@ERROR <> 0
		BEGIN
			CLOSE class_w_search
			DEALLOCATE class_w_search

			GOTO ERR
		END

		FETCH NEXT FROM class_w_search INTO @MetaClassId
	END

	CLOSE class_w_search
	DEALLOCATE class_w_search

	COMMIT TRAN

RETURN

ERR:
	ROLLBACK TRAN
RETURN
GO
PRINT N'Creating [dbo].[ecf_Search_ShoppingCart_CustomerAndName]...';


GO
CREATE PROCEDURE [dbo].[ecf_Search_ShoppingCart_CustomerAndName]
    @CustomerId uniqueidentifier,
	@Name nvarchar(64) = null
AS
BEGIN
    declare @results udttOrderGroupId
    
    insert into @results (OrderGroupId)
	select [OrderGroupId]
	from [OrderGroup_ShoppingCart] PO
	join OrderGroup OG on PO.ObjectId = OG.OrderGroupId
	where ([CustomerId] = @CustomerId) and [Name] = @Name

    exec dbo.ecf_Search_OrderGroup @results

	IF(EXISTS(SELECT OrderGroupId from OrderGroup where OrderGroupId IN (SELECT [OrderGroupId] FROM @results)))
	begin
	    -- Return Purchase Order Details
		DECLARE @search_condition nvarchar(max)
		CREATE TABLE #OrderSearchResults (OrderGroupId int)
		insert into #OrderSearchResults (OrderGroupId) select OrderGroupId from @results
		SET @search_condition = N'INNER JOIN OrderGroup OG ON OG.OrderGroupId = T.ObjectId WHERE [T].[ObjectId] IN (SELECT [OrderGroupId] FROM #OrderSearchResults)'
		exec mdpsp_avto_OrderGroup_ShoppingCart_Search NULL, '''OrderGroup'' TableName, [OG].*', @search_condition

		DROP TABLE #OrderSearchResults
	end
END
GO
PRINT N'Creating [dbo].[ecf_Search_ShoppingCart_Customer]...';


GO
CREATE PROCEDURE [dbo].[ecf_Search_ShoppingCart_Customer]
	@CustomerId uniqueidentifier
AS
BEGIN
    declare @results udttOrderGroupId
    
    insert into @results (OrderGroupId)
	select [OrderGroupId]
	from [OrderGroup_ShoppingCart] PO 
	join OrderGroup OG on PO.ObjectId = OG.OrderGroupId 
	where ([CustomerId] = @CustomerId)
	
	exec dbo.ecf_Search_OrderGroup @results
	
	IF(EXISTS(SELECT OrderGroupId from OrderGroup where OrderGroupId IN (SELECT [OrderGroupId] FROM @results)))
	begin
	    -- Return Purchase Order Details
		DECLARE @search_condition nvarchar(max)
		CREATE TABLE #OrderSearchResults (OrderGroupId int)
		insert into #OrderSearchResults (OrderGroupId) select OrderGroupId from @results
		SET @search_condition = N'INNER JOIN OrderGroup OG ON OG.OrderGroupId = T.ObjectId WHERE [T].[ObjectId] IN (SELECT [OrderGroupId] FROM #OrderSearchResults)'
		exec mdpsp_avto_OrderGroup_ShoppingCart_Search NULL, '''OrderGroup'' TableName, [OG].*', @search_condition
        
		DROP TABLE #OrderSearchResults
	end
END
GO
PRINT N'Creating [dbo].[ecf_Search_ShoppingCart]...';


GO
CREATE PROCEDURE [dbo].[ecf_Search_ShoppingCart]
	@SQLClause 					nvarchar(max),
	@MetaSQLClause 				nvarchar(max),
    @OrderBy 					nvarchar(max),
	@Namespace					nvarchar(1024) = N'',
	@Classes					nvarchar(max) = N'',
    @StartingRec 				int,
	@NumRecords   				int,
	@RecordCount                int OUTPUT,
	@ReturnTotalCount	        bit = 1
AS
BEGIN
    declare @results udttOrderGroupId
    insert into @results (OrderGroupId)    
    exec dbo.ecf_OrderSearch
        @SQLClause, 
        @MetaSQLClause, 
        @OrderBy, 
        @Namespace, 
        @Classes, 
        @StartingRec, 
        @NumRecords, 
        @RecordCount output,
        @ReturnTotalCount
    
    exec dbo.ecf_Search_OrderGroup @results
    
	IF(EXISTS(SELECT OrderGroupId from OrderGroup where OrderGroupId IN (SELECT [OrderGroupId] FROM @results)))
	begin
	    -- Return Purchase Order Details
		DECLARE @search_condition nvarchar(max)
		CREATE TABLE #OrderSearchResults (OrderGroupId int)
		insert into #OrderSearchResults (OrderGroupId) select OrderGroupId from @results
		if(Len(@OrderBy) = 0)
		begin
			set @OrderBy = 'OrderGroupId DESC'
		end
		SET @search_condition = N'INNER JOIN OrderGroup OG ON OG.OrderGroupId = T.ObjectId WHERE [T].[ObjectId] IN (SELECT [OrderGroupId] FROM #OrderSearchResults) ORDER BY ' + @OrderBy
		exec mdpsp_avto_OrderGroup_ShoppingCart_Search NULL, '''OrderGroup'' TableName, [OG].*', @search_condition

		DROP TABLE #OrderSearchResults
	end
END
GO
PRINT N'Creating [dbo].[ecf_Search_PurchaseOrder_CustomerAndName]...';


GO
CREATE PROCEDURE [dbo].[ecf_Search_PurchaseOrder_CustomerAndName]
    @CustomerId uniqueidentifier,
	@Name nvarchar(64)
AS
BEGIN
    declare @results udttOrderGroupId
    
    insert into @results (OrderGroupId)
	select [OrderGroupId] 
	from [OrderGroup_PurchaseOrder] PO 
	join OrderGroup OG on PO.ObjectId = OG.OrderGroupId 
	where ([CustomerId] = @CustomerId) and [Name] = @Name
	
	exec dbo.ecf_Search_OrderGroup @results
	
	-- Return Purchase Order Details
	DECLARE @search_condition nvarchar(max)
	CREATE TABLE #OrderSearchResults (OrderGroupId int)
	insert into #OrderSearchResults select OrderGroupId from @results
	SET @search_condition = N'INNER JOIN OrderGroup OG ON OG.OrderGroupId = T.ObjectId WHERE [T].[ObjectId] IN (SELECT [OrderGroupId] FROM #OrderSearchResults)'
	exec mdpsp_avto_OrderGroup_PurchaseOrder_Search NULL, '''OrderGroup'' TableName, [OG].*', @search_condition	

	DROP TABLE #OrderSearchResults
END
GO
PRINT N'Creating [dbo].[ecf_Search_PurchaseOrder_Customer]...';


GO
CREATE PROCEDURE [dbo].[ecf_Search_PurchaseOrder_Customer]
    @CustomerId uniqueidentifier
AS
BEGIN
    declare @results udttOrderGroupId
    
    insert into @results (OrderGroupId)
	select [OrderGroupId]
	from [OrderGroup_PurchaseOrder] PO
	join OrderGroup OG on PO.ObjectId = OG.OrderGroupId
	where ([CustomerId] = @CustomerId)
	
	exec dbo.ecf_Search_OrderGroup @results
	
	-- Return Purchase Order Details
	DECLARE @search_condition nvarchar(max)
	CREATE TABLE #OrderSearchResults (OrderGroupId int)
	insert into #OrderSearchResults (OrderGroupId) select OrderGroupId from @results
	SET @search_condition = N'INNER JOIN OrderGroup OG ON OG.OrderGroupId = T.ObjectId WHERE [T].[ObjectId] IN (SELECT [OrderGroupId] FROM #OrderSearchResults)'
	exec mdpsp_avto_OrderGroup_PurchaseOrder_Search NULL, '''OrderGroup'' TableName, [OG].*', @search_condition

	DROP TABLE #OrderSearchResults
END
GO
PRINT N'Creating [dbo].[ecf_Search_PurchaseOrder]...';


GO
CREATE PROCEDURE [dbo].[ecf_Search_PurchaseOrder]
	@SQLClause 					nvarchar(max),
	@MetaSQLClause 				nvarchar(max),
    @OrderBy 					nvarchar(max),
	@Namespace					nvarchar(1024) = N'',
	@Classes					nvarchar(max) = N'',
    @StartingRec 				int,
	@NumRecords   				int,
	@RecordCount                int OUTPUT,
	@ReturnTotalCount	        bit = 1
AS
BEGIN
    declare @results udttOrderGroupId
    insert into @results (OrderGroupId)    
    exec dbo.ecf_OrderSearch
        @SQLClause, 
        @MetaSQLClause, 
        @OrderBy, 
        @Namespace, 
        @Classes, 
        @StartingRec, 
        @NumRecords, 
        @RecordCount output,
        @ReturnTotalCount
	
	exec [dbo].[ecf_Search_OrderGroup] @results

    -- Return Purchase Order Details
	DECLARE @search_condition nvarchar(max)
	CREATE TABLE #OrderSearchResults (OrderGroupId int)
	insert into #OrderSearchResults select OrderGroupId from @results
	if(Len(@OrderBy) = 0)
	begin
		set @OrderBy = 'OrderGroupId DESC'
	end
	SET @search_condition = N'INNER JOIN OrderGroup OG ON OG.OrderGroupId = T.ObjectId WHERE [T].[ObjectId] IN (SELECT [OrderGroupId] FROM #OrderSearchResults) ORDER BY ' + @OrderBy
	exec mdpsp_avto_OrderGroup_PurchaseOrder_Search NULL, '''OrderGroup'' TableName, [OG].*', @search_condition

	DROP TABLE #OrderSearchResults
END
GO
PRINT N'Creating [dbo].[ecf_Search_PaymentPlan_CustomerAndName]...';


GO
CREATE PROCEDURE [dbo].[ecf_Search_PaymentPlan_CustomerAndName]
    @CustomerId uniqueidentifier,
	@Name nvarchar(64)
AS
BEGIN
	declare @results udttOrderGroupId
    
    insert into @results (OrderGroupId)    
    select OrderGroupId 
    from [OrderGroup_PaymentPlan] PO 
    join OrderGroup OG on PO.ObjectId = OG.OrderGroupId 
    where ([CustomerId] = @CustomerId) and [Name] = @Name
    
    exec [dbo].[ecf_Search_OrderGroup] @results

    -- Return Purchase Order Details
	DECLARE @search_condition nvarchar(max)
	CREATE TABLE #OrderSearchResults (OrderGroupId int)
	insert into #OrderSearchResults select OrderGroupId from @results
	SET @search_condition = N'INNER JOIN OrderGroup OG ON OG.OrderGroupId = T.ObjectId WHERE [T].[ObjectId] IN (SELECT [OrderGroupId] FROM #OrderSearchResults)'
	exec mdpsp_avto_OrderGroup_PaymentPlan_Search NULL, '''OrderGroup'' TableName, [OG].*', @search_condition

	DROP TABLE #OrderSearchResults
END
GO
PRINT N'Creating [dbo].[ecf_Search_PaymentPlan_Customer]...';


GO
CREATE PROCEDURE [dbo].[ecf_Search_PaymentPlan_Customer]
    @CustomerId uniqueidentifier
AS
BEGIN
	declare @results udttOrderGroupId
    
    insert into @results (OrderGroupId)    
    select OrderGroupId 
    from [OrderGroup_PaymentPlan] PO 
    join OrderGroup OG on PO.ObjectId = OG.OrderGroupId
    where ([CustomerId] = @CustomerId)
        
    exec [dbo].[ecf_Search_OrderGroup] @results

    -- Return Purchase Order Details
	DECLARE @search_condition nvarchar(max)
	CREATE TABLE #OrderSearchResults (OrderGroupId int)
	insert into #OrderSearchResults select OrderGroupId from @results
	SET @search_condition = N'INNER JOIN OrderGroup OG ON OG.OrderGroupId = T.ObjectId WHERE [T].[ObjectId] IN (SELECT [OrderGroupId] FROM #OrderSearchResults)'
	exec mdpsp_avto_OrderGroup_PaymentPlan_Search NULL, '''OrderGroup'' TableName, [OG].*', @search_condition

	DROP TABLE #OrderSearchResults
END
GO
PRINT N'Creating [dbo].[ecf_Search_PaymentPlan]...';


GO
CREATE PROCEDURE [dbo].[ecf_Search_PaymentPlan]
	@SQLClause 					nvarchar(max),
	@MetaSQLClause 				nvarchar(max),
    @OrderBy 					nvarchar(max),
	@Namespace					nvarchar(1024) = N'',
	@Classes					nvarchar(max) = N'',
    @StartingRec 				int,
	@NumRecords   				int,
	@RecordCount                int OUTPUT,
	@ReturnTotalCount	        bit = 1
AS
BEGIN
    declare @results udttOrderGroupId
    insert into @results (OrderGroupId)    
    exec dbo.ecf_OrderSearch
        @SQLClause, 
        @MetaSQLClause, 
        @OrderBy, 
        @Namespace, 
        @Classes, 
        @StartingRec, 
        @NumRecords, 
        @RecordCount output,
        @ReturnTotalCount
    
    exec dbo.ecf_Search_OrderGroup @results

    -- Return Purchase Order Details
	DECLARE @search_condition nvarchar(max)
	CREATE TABLE #OrderSearchResults (OrderGroupId int)
	insert into #OrderSearchResults select OrderGroupId from @results
	if(Len(@OrderBy) = 0)
	begin
		set @OrderBy = 'OrderGroupId DESC'
	end
	SET @search_condition = N'INNER JOIN OrderGroup OG ON OG.OrderGroupId = T.ObjectId WHERE [T].[ObjectId] IN (SELECT [OrderGroupId] FROM #OrderSearchResults) ORDER BY ' + @OrderBy
	exec mdpsp_avto_OrderGroup_PaymentPlan_Search NULL, '''OrderGroup'' TableName, [OG].*', @search_condition

	DROP TABLE #OrderSearchResults
END
GO
PRINT N'Creating [dbo].[aspnet_Membership_CreateUser]...';


GO
CREATE PROCEDURE dbo.aspnet_Membership_CreateUser
    @ApplicationName                        nvarchar(256),
    @UserName                               nvarchar(256),
    @Password                               nvarchar(128),
    @PasswordSalt                           nvarchar(128),
    @Email                                  nvarchar(256),
    @PasswordQuestion                       nvarchar(256),
    @PasswordAnswer                         nvarchar(128),
    @IsApproved                             bit,
    @CurrentTimeUtc                         datetime,
    @CreateDate                             datetime = NULL,
    @UniqueEmail                            int      = 0,
    @PasswordFormat                         int      = 0,
    @UserId                                 uniqueidentifier OUTPUT
AS
BEGIN
    DECLARE @ApplicationId uniqueidentifier
    SELECT  @ApplicationId = NULL

    DECLARE @NewUserId uniqueidentifier
    SELECT @NewUserId = NULL

    DECLARE @IsLockedOut bit
    SET @IsLockedOut = 0

    DECLARE @LastLockoutDate  datetime
    SET @LastLockoutDate = CONVERT( datetime, '17540101', 112 )

    DECLARE @FailedPasswordAttemptCount int
    SET @FailedPasswordAttemptCount = 0

    DECLARE @FailedPasswordAttemptWindowStart  datetime
    SET @FailedPasswordAttemptWindowStart = CONVERT( datetime, '17540101', 112 )

    DECLARE @FailedPasswordAnswerAttemptCount int
    SET @FailedPasswordAnswerAttemptCount = 0

    DECLARE @FailedPasswordAnswerAttemptWindowStart  datetime
    SET @FailedPasswordAnswerAttemptWindowStart = CONVERT( datetime, '17540101', 112 )

    DECLARE @NewUserCreated bit
    DECLARE @ReturnValue   int
    SET @ReturnValue = 0

    DECLARE @ErrorCode     int
    SET @ErrorCode = 0

    DECLARE @TranStarted   bit
    SET @TranStarted = 0

    IF( @@TRANCOUNT = 0 )
    BEGIN
	    BEGIN TRANSACTION
	    SET @TranStarted = 1
    END
    ELSE
    	SET @TranStarted = 0

    EXEC dbo.aspnet_Applications_CreateApplication @ApplicationName, @ApplicationId OUTPUT

    IF( @@ERROR <> 0 )
    BEGIN
        SET @ErrorCode = -1
        GOTO Cleanup
    END

    SET @CreateDate = @CurrentTimeUtc

    SELECT  @NewUserId = UserId FROM dbo.aspnet_Users WHERE LOWER(@UserName) = LoweredUserName AND @ApplicationId = ApplicationId
    IF ( @NewUserId IS NULL )
    BEGIN
        SET @NewUserId = @UserId
        EXEC @ReturnValue = dbo.aspnet_Users_CreateUser @ApplicationId, @UserName, 0, @CreateDate, @NewUserId OUTPUT
        SET @NewUserCreated = 1
    END
    ELSE
    BEGIN
        SET @NewUserCreated = 0
        IF( @NewUserId <> @UserId AND @UserId IS NOT NULL )
        BEGIN
            SET @ErrorCode = 6
            GOTO Cleanup
        END
    END

    IF( @@ERROR <> 0 )
    BEGIN
        SET @ErrorCode = -1
        GOTO Cleanup
    END

    IF( @ReturnValue = -1 )
    BEGIN
        SET @ErrorCode = 10
        GOTO Cleanup
    END

    IF ( EXISTS ( SELECT UserId
                  FROM   dbo.aspnet_Membership
                  WHERE  @NewUserId = UserId ) )
    BEGIN
        SET @ErrorCode = 6
        GOTO Cleanup
    END

    SET @UserId = @NewUserId

    IF (@UniqueEmail = 1)
    BEGIN
        IF (EXISTS (SELECT *
                    FROM  dbo.aspnet_Membership m WITH ( UPDLOCK, HOLDLOCK )
                    WHERE ApplicationId = @ApplicationId AND LoweredEmail = LOWER(@Email)))
        BEGIN
            SET @ErrorCode = 7
            GOTO Cleanup
        END
    END

    IF (@NewUserCreated = 0)
    BEGIN
        UPDATE dbo.aspnet_Users
        SET    LastActivityDate = @CreateDate
        WHERE  @UserId = UserId
        IF( @@ERROR <> 0 )
        BEGIN
            SET @ErrorCode = -1
            GOTO Cleanup
        END
    END

    INSERT INTO dbo.aspnet_Membership
                ( ApplicationId,
                  UserId,
                  Password,
                  PasswordSalt,
                  Email,
                  LoweredEmail,
                  PasswordQuestion,
                  PasswordAnswer,
                  PasswordFormat,
                  IsApproved,
                  IsLockedOut,
                  CreateDate,
                  LastLoginDate,
                  LastPasswordChangedDate,
                  LastLockoutDate,
                  FailedPasswordAttemptCount,
                  FailedPasswordAttemptWindowStart,
                  FailedPasswordAnswerAttemptCount,
                  FailedPasswordAnswerAttemptWindowStart )
         VALUES ( @ApplicationId,
                  @UserId,
                  @Password,
                  @PasswordSalt,
                  @Email,
                  LOWER(@Email),
                  @PasswordQuestion,
                  @PasswordAnswer,
                  @PasswordFormat,
                  @IsApproved,
                  @IsLockedOut,
                  @CreateDate,
                  @CreateDate,
                  @CreateDate,
                  @LastLockoutDate,
                  @FailedPasswordAttemptCount,
                  @FailedPasswordAttemptWindowStart,
                  @FailedPasswordAnswerAttemptCount,
                  @FailedPasswordAnswerAttemptWindowStart )

    IF( @@ERROR <> 0 )
    BEGIN
        SET @ErrorCode = -1
        GOTO Cleanup
    END

    IF( @TranStarted = 1 )
    BEGIN
	    SET @TranStarted = 0
	    COMMIT TRANSACTION
    END

    RETURN 0

Cleanup:

    IF( @TranStarted = 1 )
    BEGIN
        SET @TranStarted = 0
    	ROLLBACK TRANSACTION
    END

    RETURN @ErrorCode

END
GO
PRINT N'Creating [dbo].[ecf_OrderGroup_Delete]...';


GO

CREATE PROCEDURE [dbo].[ecf_OrderGroup_Delete]
(
	@OrderGroupId int
)
AS
BEGIN
	SET NOCOUNT ON
	DECLARE @TempObjectId int

	-- Delete OrderForm
	DECLARE _cursorOrderForm CURSOR READ_ONLY FAST_FORWARD FOR 
		SELECT OrderFormId FROM [OrderForm] where OrderGroupId = @OrderGroupId
	OPEN _cursorOrderForm
	FETCH NEXT FROM _cursorOrderForm INTO @TempObjectId
	WHILE (@@fetch_status = 0) BEGIN
		EXEC [dbo].[ecf_OrderForm_Delete] @TempObjectId
		FETCH NEXT FROM _cursorOrderForm INTO @TempObjectId
	END
	CLOSE _cursorOrderForm
	DEALLOCATE _cursorOrderForm
	
	-- Delete OrderGroupAddress
	DECLARE _cursor CURSOR READ_ONLY FAST_FORWARD FOR 
		SELECT OrderGroupAddressId FROM [OrderGroupAddress] where OrderGroupId = @OrderGroupId
	OPEN _cursor
	FETCH NEXT FROM _cursor INTO @TempObjectId
	WHILE (@@fetch_status = 0) BEGIN
	EXEC [dbo].[mdpsp_avto_OrderGroupAddressEx_Delete] @TempObjectId
		FETCH NEXT FROM _cursor INTO @TempObjectId
	END
	CLOSE _cursor
	DEALLOCATE _cursor
	DELETE FROM [OrderGroupAddress] where OrderGroupId = @OrderGroupId

	EXEC [dbo].[mdpsp_avto_OrderGroup_PaymentPlan_Delete] @OrderGroupId
	EXEC [dbo].[mdpsp_avto_OrderGroup_PurchaseOrder_Delete] @OrderGroupId
	EXEC [dbo].[mdpsp_avto_OrderGroup_ShoppingCart_Delete] @OrderGroupId
	DELETE FROM [OrderGroup] where OrderGroupId = @OrderGroupId

	RETURN @@Error
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_DeleteMetaFieldFromMetaClass]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_DeleteMetaFieldFromMetaClass]
	@MetaClassId	INT,
	@MetaFieldId	INT
AS
BEGIN
	IF NOT EXISTS(SELECT * FROM MetaClassMetaFieldRelation WHERE MetaFieldId = @MetaFieldId AND MetaClassId = @MetaClassId)
	BEGIN
		--RAISERROR ('Wrong @MetaFieldId and @MetaClassId.', 16, 1)
		-- GOTO ERR
		RETURN
	END

	-- Step 0. Prepare
	SET NOCOUNT ON

	DECLARE @MetaFieldName NVARCHAR(256)
	DECLARE @MetaFieldOwnerTable NVARCHAR(256)
	DECLARE @BaseMetaFieldOwnerTable NVARCHAR(256)
	DECLARE @IsAbstractClass BIT

	-- Step 1. Find a Field Name
	-- Step 2. Find a TableName
	IF NOT EXISTS(SELECT * FROM MetaField MF WHERE MetaFieldId = @MetaFieldId AND SystemMetaClassId = 0 )
	BEGIN
		RAISERROR ('Wrong @MetaFieldId.', 16, 1)
		GOTO ERR
	END

	SELECT @MetaFieldName = MF.[Name] FROM MetaField MF WHERE MetaFieldId = @MetaFieldId AND SystemMetaClassId = 0

	IF NOT EXISTS(SELECT * FROM MetaClass MC WHERE MetaClassId = @MetaClassId AND IsSystem = 0)
	BEGIN
		RAISERROR ('Wrong @MetaClassId.', 16, 1)
		GOTO ERR
	END

	SELECT @BaseMetaFieldOwnerTable = MC.TableName, @IsAbstractClass = MC.IsAbstract FROM MetaClass MC
		WHERE MetaClassId = @MetaClassId AND IsSystem = 0

	SET @MetaFieldOwnerTable = @BaseMetaFieldOwnerTable
	
	DECLARE @IsCatalogMetaClass BIT
	SET @IsCatalogMetaClass = dbo.mdpfn_sys_IsCatalogMetaDataTable(@MetaFieldOwnerTable)

	IF @@ERROR <> 0 GOTO ERR

	BEGIN TRAN

	IF @IsAbstractClass = 0
	BEGIN
		DECLARE @AffectedMetaKeys udttIdTable
		INSERT INTO @AffectedMetaKeys
			SELECT MK.MetaKey
			FROM MetaKey MK
			WHERE MK.MetaClassId = @MetaClassId
			AND MK.MetaFieldId = @MetaFieldId 
			
		EXEC mdpsp_sys_DeleteMetaKeyObjects @AffectedMetaKeys
		IF @@ERROR <> 0 GOTO ERR

		IF @IsCatalogMetaClass = 0
		BEGIN
			-- Step 3. Delete Constrains
			EXEC mdpsp_sys_DeleteDContrainByTableAndField @MetaFieldOwnerTable, @MetaFieldName

			IF @@ERROR <> 0 GOTO ERR
			
			-- Step 4. Delete Field
			EXEC ('ALTER TABLE ['+@MetaFieldOwnerTable+'] DROP COLUMN [' + @MetaFieldName + ']')

			IF @@ERROR <> 0 GOTO ERR
			
			-- Update 2007/10/05: Remove meta field from Localization table (if table exists)
			SET @MetaFieldOwnerTable = @BaseMetaFieldOwnerTable + '_Localization'

			if exists (select * from dbo.sysobjects where id = object_id(@MetaFieldOwnerTable) and OBJECTPROPERTY(id, N'IsUserTable') = 1)
			begin
				-- a). Delete constraints
				EXEC mdpsp_sys_DeleteDContrainByTableAndField @MetaFieldOwnerTable, @MetaFieldName
				-- a). Drop column
				EXEC ('ALTER TABLE ['+@MetaFieldOwnerTable+'] DROP COLUMN [' + @MetaFieldName + ']')
			end
		END
		ELSE
		BEGIN
			-- Delete the appropriated property from both Property and Draft Property tables.
			DELETE FROM CatalogContentProperty WHERE MetaFieldId = @MetaFieldId AND MetaClassId = @MetaClassId
			DELETE FROM ecfVersionProperty WHERE MetaFieldId = @MetaFieldId AND MetaClassId = @MetaClassId
		END
	END

	-- Step 5. Delete Field Info Record
	DELETE FROM MetaClassMetaFieldRelation WHERE MetaFieldId = @MetaFieldId AND MetaClassId = @MetaClassId
	IF @@ERROR <> 0 GOTO ERR

	IF @IsAbstractClass = 0 AND @IsCatalogMetaClass = 0
	BEGIN
		EXEC mdpsp_sys_CreateMetaClassProcedure @MetaClassId

		IF @@ERROR <> 0 GOTO ERR
	END

	COMMIT TRAN
	RETURN
ERR:
	ROLLBACK TRAN

	RETURN @@Error
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_AddMetaFieldToMetaClass]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_AddMetaFieldToMetaClass]
	@MetaClassId	INT,
	@MetaFieldId	INT,
	@Weight	INT
AS
BEGIN
	-- Step 0. Prepare
	SET NOCOUNT ON

	DECLARE @IsAbstractClass	BIT
	SELECT @IsAbstractClass = IsAbstract FROM MetaClass WHERE MetaClassId = @MetaClassId

    BEGIN TRAN
	IF NOT EXISTS( SELECT * FROM MetaClass WHERE MetaClassId = @MetaClassId AND IsSystem = 0)
	BEGIN
		RAISERROR ('Wrong @MetaClassId. The class is system or not exists.', 16,1)
		GOTO ERR
	END

	IF NOT EXISTS( SELECT * FROM MetaField WHERE MetaFieldId = @MetaFieldId AND SystemMetaClassId = 0)
	BEGIN
		RAISERROR ('Wrong @MetaFieldId. The field is system or not exists.', 16,1)
		GOTO ERR
	END

	DECLARE @IsCatalogMetaClass BIT
	SET @IsCatalogMetaClass = 0

	IF @IsAbstractClass = 0
	BEGIN
		-- Step 1. Insert a new column.
		DECLARE @Name		NVARCHAR(256)
		DECLARE @DataTypeId	INT
		DECLARE @Length		INT
		DECLARE @AllowNulls		BIT
		DECLARE @MultiLanguageValue BIT
		DECLARE @AllowSearch	BIT
		DECLARE @IsEncrypted	BIT

		SELECT @Name = [Name], @DataTypeId = DataTypeId,  @Length = [Length], @AllowNulls = AllowNulls, @MultiLanguageValue = MultiLanguageValue, @AllowSearch = AllowSearch, @IsEncrypted = IsEncrypted
		FROM [MetaField]
        WHERE MetaFieldId = @MetaFieldId AND SystemMetaClassId = 0

		-- Step 1-1. Create a new column query.

		DECLARE @MetaClassTableName NVARCHAR(256)
		DECLARE @SqlDataTypeName NVARCHAR(256)
		DECLARE @IsVariableDataType BIT
		DECLARE @DefaultValue	NVARCHAR(50)

		SELECT @MetaClassTableName = TableName FROM MetaClass WHERE MetaClassId = @MetaClassId

		IF @@ERROR<> 0 GOTO ERR

		SET @IsCatalogMetaClass = dbo.mdpfn_sys_IsCatalogMetaDataTable(@MetaClassTableName)

		IF @IsCatalogMetaClass = 0
		BEGIN
			SELECT @SqlDataTypeName = SqlName,  @IsVariableDataType = Variable, @DefaultValue = DefaultValue FROM MetaDataType WHERE DataTypeId= @DataTypeId

			IF @@ERROR<> 0 GOTO ERR

			DECLARE @ExecLine 			NVARCHAR(1024)
			DECLARE @ExecLineLocalization 	NVARCHAR(1024)

			SET @ExecLine = 'ALTER TABLE [dbo].['+@MetaClassTableName+'] ADD ['+@Name+'] ' + @SqlDataTypeName
			SET @ExecLineLocalization = 'ALTER TABLE [dbo].['+@MetaClassTableName+'_Localization] ADD ['+@Name+'] ' + @SqlDataTypeName

			IF @IsVariableDataType = 1
			BEGIN
				IF(@Length = -1)
				BEGIN
					SET @ExecLine = @ExecLine + '(max)'
					SET @ExecLineLocalization = @ExecLineLocalization + '(max)'
				END
				ELSE
				BEGIN
					SET @ExecLine = @ExecLine + ' (' + STR(@Length) + ')'
					SET @ExecLineLocalization = @ExecLineLocalization + ' (' + STR(@Length) + ')'
				END
			END
			ELSE
			BEGIN
				IF @DataTypeId = 5 OR @DataTypeId = 24
				BEGIN
					DECLARE @MdpPrecision NVARCHAR(10)
					DECLARE @MdpScale NVARCHAR(10)

					SET @MdpPrecision = NULL
					SET @MdpScale = NULL

					SELECT @MdpPrecision = [Value] FROM MetaAttribute
					WHERE
						AttrOwnerId = @MetaFieldId AND
						AttrOwnerType = 2 AND
						[Key] = 'MdpPrecision'

					SELECT @MdpScale = [Value] FROM MetaAttribute
					WHERE
						AttrOwnerId = @MetaFieldId AND
						AttrOwnerType = 2 AND
						[Key] = 'MdpScale'

					IF @MdpPrecision IS NOT NULL AND @MdpScale IS NOT NULL
					BEGIN
						SET @ExecLine = @ExecLine + ' (' + @MdpPrecision + ',' + @MdpScale + ')'
						SET @ExecLineLocalization = @ExecLineLocalization + ' (' + @MdpPrecision + ',' + @MdpScale + ')'
					END
				END
			END

			SET @ExecLineLocalization = @ExecLineLocalization + ' NULL'

			IF @AllowNulls = 1
			BEGIN
				SET @ExecLine = @ExecLine + ' NULL'
			END
			ELSE
				BEGIN
					SET @ExecLine = @ExecLine + ' NOT NULL DEFAULT ' + @DefaultValue

					--IF @IsVariableDataType = 1
					--BEGIN
						--SET @ExecLine = @ExecLine + ' (' + STR(@Length) + ')'
					--END

					SET @ExecLine = @ExecLine  +'  WITH VALUES'
				END

			--PRINT (@ExecLine)

			-- Step 1-2. Create a new column.
			EXEC (@ExecLine)

			IF @@ERROR<> 0 GOTO ERR

			-- Step 1-3. Create a new localization column.
			EXEC (@ExecLineLocalization)

			IF @@ERROR <> 0 GOTO ERR
		END
	END

	-- Step 2. Insert a record in to MetaClassMetaFieldRelation table.
	INSERT INTO [MetaClassMetaFieldRelation] (MetaClassId, MetaFieldId, Weight) VALUES(@MetaClassId, @MetaFieldId, @Weight)

	IF @@ERROR <> 0 GOTO ERR

	IF @IsAbstractClass = 0 AND @IsCatalogMetaClass = 0
	BEGIN
		EXEC mdpsp_sys_CreateMetaClassProcedure @MetaClassId

		IF @@ERROR <> 0 GOTO ERR
	END

	--IF @@ERROR <> 0 GOTO ERR

	COMMIT TRAN

    RETURN

ERR:
	ROLLBACK TRAN
    RETURN
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_DeleteMetaField]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_DeleteMetaField]
	@MetaFieldId	INT
AS
BEGIN
	-- Step 0. Prepare
	SET NOCOUNT ON

	BEGIN TRAN

	IF NOT EXISTS(SELECT * FROM MetaClassMetaFieldRelation WHERE MetaFieldId = @MetaFieldId)
	BEGIN
		-- Step 5. Delete Dictionary Record
		DELETE FROM MetaDictionary WHERE MetaFieldId = @MetaFieldId

		IF @@ERROR <> 0 GOTO ERR

		-- Step 5. Delete Field Info Record
		DELETE FROM MetaField WHERE MetaFieldId = @MetaFieldId

		IF @@ERROR <> 0 GOTO ERR

		EXEC mdpsp_sys_ClearMetaAttribute @MetaFieldId, 2

		IF @@ERROR <> 0 GOTO ERR
	END
	ELSE
	BEGIN
		RAISERROR ('The MetaClass have got a link to @MetaFieldId.', 16, 1)
		GOTO ERR
	END

	COMMIT TRAN
	RETURN
ERR:
	ROLLBACK TRAN
	RETURN @@Error
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_DeleteMetaClass]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_DeleteMetaClass]
	@MetaClassId	INT
AS
BEGIN
	-- Step 0. Prepare
	SET NOCOUNT ON

	BEGIN TRAN

	DECLARE @MetaFieldOwnerTable	NVARCHAR(256)

	-- Check Childs Table
	IF EXISTS(SELECT *  FROM MetaClass MC WHERE ParentClassId = @MetaClassId)
	BEGIN
		RAISERROR ('The class have childs.', 16, 1)
		GOTO ERR
	END

	-- Step 1. Find a TableName
	IF EXISTS(SELECT *  FROM MetaClass MC WHERE MetaClassId = @MetaClassId)
	BEGIN
		IF EXISTS(SELECT *  FROM MetaClass MC WHERE MetaClassId = @MetaClassId AND IsSystem = 0 AND IsAbstract = 0)
		BEGIN
			SELECT @MetaFieldOwnerTable = TableName  FROM MetaClass MC WHERE MetaClassId = @MetaClassId AND IsSystem = 0 AND IsAbstract = 0

			IF @@ERROR <> 0 GOTO ERR

			EXEC mdpsp_sys_DeleteMetaClassProcedure @MetaClassId

			IF @@ERROR <> 0 GOTO ERR

			-- Step 2. Delete Table or View
			IF dbo.mdpfn_sys_IsCatalogMetaDataTable(@MetaFieldOwnerTable) = 1
			BEGIN
				EXEC('DROP VIEW [dbo].[' + @MetaFieldOwnerTable + ']')
				IF @@ERROR <> 0 GOTO ERR

				EXEC('DROP VIEW [dbo].[' + @MetaFieldOwnerTable + '_Localization]')
				IF @@ERROR <> 0 GOTO ERR
			END
			ELSE
			BEGIN
				EXEC('DROP TABLE [dbo].[' + @MetaFieldOwnerTable + ']')
				IF @@ERROR <> 0 GOTO ERR

				EXEC('DROP TABLE [dbo].[' + @MetaFieldOwnerTable + '_Localization]')
				IF @@ERROR <> 0 GOTO ERR
			END
			DECLARE @AffectedMetaKeys udttIdTable
			INSERT INTO @AffectedMetaKeys
				SELECT MK.MetaKey
			FROM MetaKey MK
			WHERE MK.MetaClassId = @MetaClassId
			
			EXEC mdpsp_sys_DeleteMetaKeyObjects @AffectedMetaKeys
			 IF @@ERROR <> 0 GOTO ERR

			-- Delete Meta Attribute
			EXEC mdpsp_sys_ClearMetaAttribute @MetaClassId, 1

			 IF @@ERROR <> 0 GOTO ERR

			-- Step 3. Delete MetaField Relations
			DELETE FROM MetaClassMetaFieldRelation WHERE MetaClassId = @MetaClassId

			IF @@ERROR <> 0 GOTO ERR

			-- Step 3. Delete MetaClass
			DELETE FROM MetaClass WHERE MetaClassId = @MetaClassId

			IF @@ERROR <> 0 GOTO ERR
		END
		ELSE
		BEGIN
			-- Delete Meta Attribute
			EXEC mdpsp_sys_ClearMetaAttribute @MetaClassId, 1

			 IF @@ERROR <> 0 GOTO ERR

			-- Step 3. Delete MetaField Relations
			DELETE FROM MetaClassMetaFieldRelation WHERE MetaClassId = @MetaClassId

			IF @@ERROR <> 0 GOTO ERR

			-- Step 3. Delete MetaField
			DELETE FROM MetaField WHERE SystemMetaClassId = @MetaClassId

			IF @@ERROR <> 0 GOTO ERR

			-- Step 3. Delete MetaClass
			DELETE FROM MetaClass WHERE MetaClassId = @MetaClassId

			IF @@ERROR <> 0 GOTO ERR

		END
		
		
	END
	ELSE
	BEGIN
		RAISERROR ('Wrong @MetaClassId.', 16, 1)
		GOTO ERR
	END

	COMMIT TRAN
	RETURN

ERR:
	ROLLBACK TRAN
	RETURN
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_CreateMetaClass]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_CreateMetaClass]
	@Namespace 		NVARCHAR(1024),
	@Name 		NVARCHAR(256),
	@FriendlyName		NVARCHAR(256),
	@TableName 		NVARCHAR(256),
	@ParentClassId 		INT,
	@IsSystem		BIT,
	@IsAbstract		BIT	=	0,
	@Description 		NVARCHAR(MAX),
	@Retval 		INT OUTPUT
AS
BEGIN
	-- Step 0. Prepare
	SET NOCOUNT ON
	SET @Retval = -1

BEGIN TRAN
	-- Step 1. Insert a new record in to the MetaClass table
	INSERT INTO [MetaClass] ([Namespace], [Name], [FriendlyName], [Description], [TableName], [ParentClassId], [PrimaryKeyName], [IsSystem], [IsAbstract])
		VALUES (@Namespace, @Name, @FriendlyName, @Description, @TableName, @ParentClassId, 'undefined', @IsSystem, @IsAbstract)

	IF @@ERROR <> 0 GOTO ERR

	SET @Retval = @@IDENTITY
	
	IF @IsSystem = 1
	BEGIN
		IF NOT EXISTS(SELECT * FROM sysobjects WHERE [name] = @TableName AND [type] = 'U')
		BEGIN
			RAISERROR ('Wrong System TableName.', 16,1 )
			GOTO ERR
		END

		-- Step 3-2. Insert a new record in to the MetaField table
		INSERT INTO [MetaField] ([Namespace], [Name], [FriendlyName], [SystemMetaClassId], [DataTypeId], [Length], [AllowNulls], [MultiLanguageValue], [AllowSearch], [IsEncrypted])
			 SELECT @Namespace + N'.' + @Name, SC.[name], SC.[name], @Retval, MDT.[DataTypeId], SC.[length], SC.[isnullable], 0, 0, 0  FROM syscolumns AS SC
				INNER JOIN sysobjects SO ON SO.[id] = SC.[id]
				INNER JOIN systypes ST ON ST.[xtype] = SC.[xtype]
				INNER JOIN MetaDataType MDT ON LOWER(MDT.[Name]) = LOWER(ST.[name]) COLLATE DATABASE_DEFAULT
			WHERE SO.[id] = OBJECT_ID(@TableName) AND OBJECTPROPERTY(SO.[id], N'IsTable') = 1 AND ST.[name]<>'sysname'
			ORDER BY colorder

		IF @@ERROR<> 0 GOTO ERR

		-- Step 3-2. Insert a new record in to the MetaClassMetaFieldRelation table
		INSERT INTO [MetaClassMetaFieldRelation] (MetaClassId, MetaFieldId)
			SELECT @Retval, MetaFieldId FROM MetaField WHERE [SystemMetaClassId] = @Retval
	END
	ELSE
	BEGIN
		IF @IsAbstract = 0
		BEGIN
			DECLARE @IsCatalogMetaClass BIT
			SET @IsCatalogMetaClass = dbo.mdpfn_sys_IsInheritedFromMetaClass(@Retval, 'CatalogEntry')
			IF @IsCatalogMetaClass = 0 	SET @IsCatalogMetaClass = dbo.mdpfn_sys_IsInheritedFromMetaClass(@Retval, 'CatalogNode')
			
			IF EXISTS(SELECT * FROM MetaClass WHERE MetaClassId = @ParentClassId /* AND @IsSystem = 1 */ )
			BEGIN
				-- Step 3-2. Insert a new record in to the MetaClassMetaFieldRelation table
				INSERT INTO [MetaClassMetaFieldRelation]  (MetaClassId, MetaFieldId)
					SELECT @Retval, MetaFieldId FROM MetaField WHERE [SystemMetaClassId] = @ParentClassId
			END

			IF @@ERROR<> 0 GOTO ERR
			
			IF @IsCatalogMetaClass = 0
			BEGIN
				-- Step 2. Create the @TableName table.
				EXEC('CREATE TABLE [dbo].[' + @TableName  + '] ([ObjectId] [int] NOT NULL , [CreatorId] [nvarchar](100), [Created] [datetime], [ModifierId] [nvarchar](100) , [Modified] [datetime] )')

				IF @@ERROR <> 0 GOTO ERR

				EXEC('ALTER TABLE [dbo].[' + @TableName  + '] WITH NOCHECK ADD CONSTRAINT [PK_' + @TableName  + '] PRIMARY KEY  CLUSTERED ([ObjectId])')

				IF @@ERROR <> 0 GOTO ERR

				-- Step 2-2. Create the @TableName_Localization table
				EXEC('CREATE TABLE [dbo].[' + @TableName + '_Localization] ([Id] [int] IDENTITY (1, 1)  NOT NULL, [ObjectId] [int] NOT NULL , [ModifierId] [nvarchar](100), [Modified] [datetime], [Language] nvarchar(20) NOT NULL)')

				IF @@ERROR<> 0 GOTO ERR

				EXEC('ALTER TABLE [dbo].[' + @TableName  + '_Localization] WITH NOCHECK ADD CONSTRAINT [PK_' + @TableName  + '_Localization] PRIMARY KEY  CLUSTERED ([Id])')

				IF @@ERROR<> 0 GOTO ERR

				EXEC ('CREATE NONCLUSTERED INDEX IX_' + @TableName + '_Localization_Language ON dbo.' + @TableName + '_Localization ([Language])')

				IF @@ERROR<> 0 GOTO ERR

				EXEC ('CREATE UNIQUE NONCLUSTERED INDEX IX_' + @TableName + '_Localization_ObjectId ON dbo.' + @TableName + '_Localization (ObjectId,[Language])')

				IF @@ERROR<> 0 GOTO ERR
				
				declare @system_root_class_id int
				;with cte as (
					select MetaClassId, ParentClassId, IsSystem
					from MetaClass
					where MetaClassId = @ParentClassId
					union all
					select mc.MetaClassId, mc.ParentClassId, mc.IsSystem
					from cte
					join MetaClass mc on cte.ParentClassId = mc.MetaClassId and cte.IsSystem = 0
				)
				select @system_root_class_id = MetaClassId
				from cte
				where IsSystem = 1

				if exists (select 1 from MetaClass where MetaClassId = @ParentClassId and IsSystem = 1)
				begin
					declare @parent_table sysname
					declare @parent_key_column sysname
					select @parent_table = mc.TableName, @parent_key_column = c.name
					from MetaClass mc
					join sys.key_constraints kc on kc.parent_object_id = OBJECT_ID('[dbo].[' + mc.TableName + ']', 'U')
					join sys.index_columns ic on kc.parent_object_id = ic.object_id and kc.unique_index_id = ic.index_id
					join sys.columns c on ic.object_id = c.object_id and ic.column_id = c.column_id
					where mc.MetaClassId = @system_root_class_id
						and kc.type = 'PK'
						and ic.index_column_id = 1
					
					declare @child_table nvarchar(4000)
					declare child_tables cursor local for select @TableName as table_name union all select @TableName + '_Localization'
					open child_tables
					while 1=1
					begin
						fetch next from child_tables into @child_table
						if @@FETCH_STATUS != 0 break
						
						declare @fk_name nvarchar(4000) = 'FK_' + @child_table + '_' + @parent_table
						
						declare @pdeletecascade nvarchar(30) = ' on delete cascade'
						if (@child_table like '%_Localization'
							and @Namespace = 'Mediachase.Commerce.Orders.System') 
							begin
							set @pdeletecascade = ''
							end

						declare @fk_sql nvarchar(4000) =
							'alter table [dbo].[' + @child_table + '] add ' +
							case when LEN(@fk_name) <= 128 then 'constraint [' + @fk_name + '] ' else '' end +
							'foreign key (ObjectId) references [dbo].[' + @parent_table + '] ([' + @parent_key_column + '])'+ @pdeletecascade + ' on update cascade'
													
						execute dbo.sp_executesql @fk_sql
					end
					close child_tables
					
					if @@ERROR != 0 goto ERR
				end

				EXEC mdpsp_sys_CreateMetaClassProcedure @Retval
				IF @@ERROR <> 0 GOTO ERR
			END
		END
	END

	-- Update PK Value
	DECLARE @PrimaryKeyName	NVARCHAR(256)
	SELECT @PrimaryKeyName = name FROM sysobjects WHERE OBJECTPROPERTY(id, N'IsPrimaryKey') = 1 and parent_obj = OBJECT_ID(@TableName) and OBJECTPROPERTY(parent_obj, N'IsUserTable') = 1

	IF @PrimaryKeyName IS NOT NULL
		UPDATE [MetaClass] SET PrimaryKeyName = @PrimaryKeyName WHERE MetaClassId = @Retval

	COMMIT TRAN
RETURN

ERR:
	ROLLBACK TRAN
	SET @Retval = -1
RETURN
END
GO
PRINT N'Creating [dbo].[mdpsp_sys_CreateMetaClassProcedureAll]...';


GO
CREATE PROCEDURE [dbo].[mdpsp_sys_CreateMetaClassProcedureAll]
AS
SET NOCOUNT ON
BEGIN TRAN
	DECLARE classall_cursor CURSOR FOR
		SELECT MetaClassId FROM MetaClass WHERE IsSystem =0 AND IsAbstract = 0

	DECLARE @MetaClassId	INT

	OPEN classall_cursor
	FETCH NEXT FROM classall_cursor INTO @MetaClassId

	WHILE @@FETCH_STATUS = 0
	BEGIN
		--PRINT @MetaClassId
		EXEC  mdpsp_sys_CreateMetaClassProcedure @MetaClassId
		IF @@ERROR <> 0 GOTO ERR

	FETCH NEXT FROM classall_cursor INTO @MetaClassId
	END

	CLOSE classall_cursor
	DEALLOCATE classall_cursor

	COMMIT TRAN
RETURN

ERR:
	CLOSE classall_cursor
	DEALLOCATE classall_cursor

	ROLLBACK TRAN
RETURN
GO
PRINT N'Creating [dbo].[ecfVersion_ListByNodeWorkIds]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_ListByNodeWorkIds]
	@ContentLinks dbo.udttObjectWorkId readonly
AS
BEGIN
	
	SELECT draft.*, n.ContentGuid, NULL AS ClassTypeId, n.MetaClassId, ISNULL(p.Boolean, 0) AS IsPublished, n.ParentNodeId AS ParentId 
	FROM ecfVersion AS draft
	INNER JOIN @ContentLinks links ON draft.WorkId = links.WorkId AND draft.ObjectId = links.ObjectId AND draft.ObjectTypeId = links.ObjectTypeId
	INNER JOIN CatalogNode n ON links.ObjectId = n.CatalogNodeId AND links.ObjectTypeId = 1
	INNER JOIN CatalogLanguage cl ON draft.CatalogId = cl.CatalogId AND draft.LanguageName = cl.LanguageCode
	LEFT JOIN ecfVersionProperty p ON  p.WorkId = draft.WorkId
										AND p.MetaFieldName = 'Epi_IsPublished' COLLATE DATABASE_DEFAULT

	EXEC [ecfVersionProperty_ListByWorkIds] @ContentLinks

	EXEC [ecfVersionAsset_ListByWorkIds] @ContentLinks

END
GO
PRINT N'Creating [dbo].[ecfVersion_ListByEntryWorkIds]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_ListByEntryWorkIds]
	@ContentLinks dbo.udttObjectWorkId readonly
AS
BEGIN
	SELECT draft.*, e.ContentGuid, e.ClassTypeId, e.MetaClassId, e.IsPublished AS IsPublished, NULL AS ParentId 
	FROM ecfVersion AS draft
	INNER JOIN @ContentLinks links ON draft.WorkId = links.WorkId AND draft.ObjectId = links.ObjectId AND draft.ObjectTypeId = links.ObjectTypeId
	INNER JOIN CatalogEntry e ON links.ObjectId = e.CatalogEntryId AND links.ObjectTypeId = 0
	INNER JOIN CatalogLanguage cl ON draft.CatalogId = cl.CatalogId AND draft.LanguageName = cl.LanguageCode COLLATE DATABASE_DEFAULT
	
	
	EXEC [ecfVersionProperty_ListByWorkIds] @ContentLinks

	EXEC [ecfVersionAsset_ListByWorkIds] @ContentLinks

	EXEC [ecfVersionVariation_ListByWorkIds] @ContentLinks

	--get relations for entry versions
	SELECT TOP 1 r.CatalogEntryId, r.CatalogNodeId, r.CatalogId
	FROM NodeEntryRelation r
	INNER JOIN @ContentLinks links ON links.ObjectId = r.CatalogEntryId AND links.ObjectTypeId = 0
	WHERE r.IsPrimary = 1 
END
GO
PRINT N'Creating [dbo].[ecfVersion_ListByCatalogWorkIds]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_ListByCatalogWorkIds]
	@ContentLinks dbo.udttObjectWorkId readonly
AS
BEGIN
	
	SELECT draft.*, c.ContentGuid, NULL AS ClassTypeId, NULL AS MetaClassId, c.IsActive AS IsPublished, NULL AS ParentId 
	FROM ecfVersion AS draft
	INNER JOIN @ContentLinks links ON draft.WorkId = links.WorkId AND draft.ObjectId = links.ObjectId AND draft.ObjectTypeId = links.ObjectTypeId
	INNER JOIN [Catalog] c ON c.CatalogId = links.ObjectId AND links.ObjectTypeId = 2
	INNER JOIN CatalogLanguage cl ON draft.CatalogId = cl.CatalogId AND draft.LanguageName = cl.LanguageCode COLLATE DATABASE_DEFAULT

	EXEC [ecfVersionProperty_ListByWorkIds] @ContentLinks

	EXEC [ecfVersionAsset_ListByWorkIds] @ContentLinks

	EXEC [ecfVersionCatalog_ListByWorkIds] @ContentLinks

END
GO
PRINT N'Creating [dbo].[ecfVersion_Update]...';


GO
CREATE PROCEDURE [dbo].[ecfVersion_Update]
	@WorkIds dbo.udttObjectWorkId readonly,
	@PublishAction bit,
	@ContentDraftProperty dbo.[udttCatalogContentProperty] readonly,
	@ContentDraftAsset dbo.[udttCatalogContentAsset] readonly,
	@AssetWorkIds dbo.[udttObjectWorkId] readonly,
	@Variants dbo.[udttVariantDraft] readonly,
	@VersionCatalogs dbo.[udttVersionCatalog] readonly,
	@IsVariant bit = 0,
	@IsCatalog bit = 0
AS
BEGIN
	-- Save draft properties
	EXEC [ecfVersionProperty_Save] @WorkIds = @WorkIds, @ContentDraftProperty = @ContentDraftProperty

	-- Save asset draft
	EXEC [ecfVersionAsset_Save] @WorkIds = @AssetWorkIds, @ContentDraftAsset = @ContentDraftAsset

	-- Save variation
	IF @IsVariant = 1
		EXEC [ecfVersionVariation_Save] @Variants = @Variants

	-- Save catalog draft
	IF @IsCatalog = 1
		EXEC [ecfVersionCatalog_Save] @VersionCatalogs = @VersionCatalogs, @PublishAction = @PublishAction
END
GO
/*Post-Deployment Script Template
--------------------------------------------------------------------------------------
 This file contains SQL statements that will be appended to the build script.		
 Use SQLCMD syntax to include a file in the post-deployment script.			
 Example:      :r .\myfile.sql								
 Use SQLCMD syntax to reference a variable in the post-deployment script.		
 Example:      :setvar TableName MyTable							
               SELECT * FROM [$(TableName)]					
--------------------------------------------------------------------------------------
*/
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[dbo].[vw_aspnet_Applications] TO [aspnet_Membership_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[dbo].[vw_aspnet_Applications] TO [aspnet_Personalization_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[dbo].[vw_aspnet_Applications] TO [aspnet_Profile_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[dbo].[vw_aspnet_Applications] TO [aspnet_Roles_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[dbo].[vw_aspnet_WebPartState_User] TO [aspnet_Personalization_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[dbo].[vw_aspnet_WebPartState_Shared] TO [aspnet_Personalization_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[dbo].[vw_aspnet_WebPartState_Paths] TO [aspnet_Personalization_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[dbo].[vw_aspnet_UsersInRoles] TO [aspnet_Roles_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[dbo].[vw_aspnet_Roles] TO [aspnet_Roles_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[dbo].[vw_aspnet_Profiles] TO [aspnet_Profile_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[dbo].[vw_aspnet_MembershipUsers] TO [aspnet_Membership_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[dbo].[vw_aspnet_Users] TO [aspnet_Membership_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[dbo].[vw_aspnet_Users] TO [aspnet_Personalization_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[dbo].[vw_aspnet_Users] TO [aspnet_Profile_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[dbo].[vw_aspnet_Users] TO [aspnet_Roles_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_RegisterSchemaVersion] TO [aspnet_Membership_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_RegisterSchemaVersion] TO [aspnet_Membership_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_RegisterSchemaVersion] TO [aspnet_Personalization_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_RegisterSchemaVersion] TO [aspnet_Personalization_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_RegisterSchemaVersion] TO [aspnet_Profile_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_RegisterSchemaVersion] TO [aspnet_Profile_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_RegisterSchemaVersion] TO [aspnet_Roles_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_RegisterSchemaVersion] TO [aspnet_Roles_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_RegisterSchemaVersion] TO [aspnet_WebEvent_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_UnRegisterSchemaVersion] TO [aspnet_Membership_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_UnRegisterSchemaVersion] TO [aspnet_Membership_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_UnRegisterSchemaVersion] TO [aspnet_Personalization_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_UnRegisterSchemaVersion] TO [aspnet_Personalization_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_UnRegisterSchemaVersion] TO [aspnet_Profile_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_UnRegisterSchemaVersion] TO [aspnet_Profile_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_UnRegisterSchemaVersion] TO [aspnet_Roles_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_UnRegisterSchemaVersion] TO [aspnet_Roles_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_UnRegisterSchemaVersion] TO [aspnet_WebEvent_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_CheckSchemaVersion] TO [aspnet_Membership_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_CheckSchemaVersion] TO [aspnet_Membership_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_CheckSchemaVersion] TO [aspnet_Personalization_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_CheckSchemaVersion] TO [aspnet_Personalization_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_CheckSchemaVersion] TO [aspnet_Profile_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_CheckSchemaVersion] TO [aspnet_Profile_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_CheckSchemaVersion] TO [aspnet_Roles_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_CheckSchemaVersion] TO [aspnet_Roles_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_CheckSchemaVersion] TO [aspnet_WebEvent_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Users_DeleteUser] TO [aspnet_Membership_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_GetUserByName] TO [aspnet_Membership_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_GetUserByName] TO [aspnet_Membership_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_CreateUser] TO [aspnet_Membership_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_GetPasswordWithFormat] TO [aspnet_Membership_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_GetUserByEmail] TO [aspnet_Membership_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_GetUserByEmail] TO [aspnet_Membership_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_GetUserByUserId] TO [aspnet_Membership_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_GetUserByUserId] TO [aspnet_Membership_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_ResetPassword] TO [aspnet_Membership_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_SetPassword] TO [aspnet_Membership_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_GetPassword] TO [aspnet_Membership_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_UpdateUserInfo] TO [aspnet_Membership_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_ChangePasswordQuestionAndAnswer] TO [aspnet_Membership_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_UpdateUser] TO [aspnet_Membership_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_UnlockUser] TO [aspnet_Membership_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_FindUsersByName] TO [aspnet_Membership_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_GetNumberOfUsersOnline] TO [aspnet_Membership_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_GetNumberOfUsersOnline] TO [aspnet_Membership_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_GetAllUsers] TO [aspnet_Membership_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Membership_FindUsersByEmail] TO [aspnet_Membership_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Profile_GetProperties] TO [aspnet_Profile_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Profile_DeleteInactiveProfiles] TO [aspnet_Profile_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Profile_DeleteProfiles] TO [aspnet_Profile_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Profile_SetProperties] TO [aspnet_Profile_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Profile_GetProfiles] TO [aspnet_Profile_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Profile_GetNumberOfInactiveProfiles] TO [aspnet_Profile_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Roles_RoleExists] TO [aspnet_Roles_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Roles_DeleteRole] TO [aspnet_Roles_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Roles_CreateRole] TO [aspnet_Roles_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_UsersInRoles_GetRolesForUser] TO [aspnet_Roles_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_UsersInRoles_GetRolesForUser] TO [aspnet_Roles_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_UsersInRoles_IsUserInRole] TO [aspnet_Roles_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_UsersInRoles_IsUserInRole] TO [aspnet_Roles_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Roles_GetAllRoles] TO [aspnet_Roles_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_UsersInRoles_FindUsersInRole] TO [aspnet_Roles_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_UsersInRoles_GetUsersInRoles] TO [aspnet_Roles_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_UsersInRoles_RemoveUsersFromRoles] TO [aspnet_Roles_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_UsersInRoles_AddUsersToRoles] TO [aspnet_Roles_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Personalization_GetApplicationId] TO [aspnet_Personalization_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_Paths_CreatePath] TO [aspnet_Personalization_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_PersonalizationPerUser_SetPageSettings] TO [aspnet_Personalization_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_PersonalizationPerUser_ResetPageSettings] TO [aspnet_Personalization_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_PersonalizationPerUser_GetPageSettings] TO [aspnet_Personalization_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_PersonalizationAllUsers_SetPageSettings] TO [aspnet_Personalization_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_PersonalizationAllUsers_ResetPageSettings] TO [aspnet_Personalization_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_PersonalizationAllUsers_GetPageSettings] TO [aspnet_Personalization_BasicAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_PersonalizationAdministration_GetCountOfState] TO [aspnet_Personalization_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_PersonalizationAdministration_FindState] TO [aspnet_Personalization_ReportingAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_PersonalizationAdministration_ResetUserState] TO [aspnet_Personalization_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_PersonalizationAdministration_ResetSharedState] TO [aspnet_Personalization_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_PersonalizationAdministration_DeleteAllState] TO [aspnet_Personalization_FullAccess]
    AS [dbo];


GO
PRINT N'Creating Permission...';


GO
GRANT EXECUTE
    ON OBJECT::[dbo].[aspnet_WebEvent_LogEvent] TO [aspnet_WebEvent_FullAccess]
    AS [dbo];


/*
This script was created by Visual Studio on 2013-12-11 at 12:52.
Run this script on (local).CommerceManagerLocalRaven (EP\gogo) to make it the same as (local).CommerceManagerLocalHead (EP\gogo).
This script performs its actions in the following order:
1. Disable foreign-key constraints.
2. Perform DELETE commands.
3. Perform UPDATE commands.
4. Perform INSERT commands.
5. Re-enable foreign-key constraints.
Please back up your target database before running this script.
*/

/* Flag the DB as Azure compatible as default */
IF NOT EXISTS (SELECT * FROM dbo.AzureCompatible)
	INSERT INTO dbo.AzureCompatible VALUES (1)
ELSE
	UPDATE dbo.AzureCompatible SET AzureCompatible = 1

SET NUMERIC_ROUNDABORT OFF
GO
SET XACT_ABORT, ANSI_PADDING, ANSI_WARNINGS, CONCAT_NULL_YIELDS_NULL, ARITHABORT, QUOTED_IDENTIFIER, ANSI_NULLS ON
GO
/*Pointer used for text / image updates. This might not be needed, but is declared here just in case*/
DECLARE @pv binary(16)

BEGIN TRANSACTION
ALTER TABLE [dbo].[mcmd_MetaClassDataSource] DROP CONSTRAINT [FK_mcmd_MetaClassDataSource_mcmd_MetaClass]
ALTER TABLE [dbo].[ShipmentDiscount] DROP CONSTRAINT [FK_ShipmentDiscount_Shipment]
ALTER TABLE [dbo].[TaxLanguage] DROP CONSTRAINT [FK_TaxLanguage_Tax]
ALTER TABLE [dbo].[ShippingMethodParameter] DROP CONSTRAINT [FK_ShippingMethodParameter_ShippingMethod]
ALTER TABLE [dbo].[ShippingOptionParameter] DROP CONSTRAINT [FK_ShippingOptionParameter_ShippingOption]
ALTER TABLE [dbo].[MetaMultiValueDictionary] DROP CONSTRAINT [FK_MetaMultiValueDictionary_MetaKey]
ALTER TABLE [dbo].[OrderFormPayment] DROP CONSTRAINT [FK_OrderFormPayment_OrderForm]
ALTER TABLE [dbo].[ShippingMethodCase] DROP CONSTRAINT [FK_ShippingMethodCase_JurisdictionGroup]
ALTER TABLE [dbo].[ShippingMethodCase] DROP CONSTRAINT [ShippingMethod_ShippingMethodCase_FK1]
ALTER TABLE [dbo].[MetaDictionaryLocalization] DROP CONSTRAINT [FK_MetaDictionaryLocalization_MetaDictionary]
ALTER TABLE [dbo].[CurrencyRate] DROP CONSTRAINT [FK_CurrencyRate_Currency]
ALTER TABLE [dbo].[CurrencyRate] DROP CONSTRAINT [FK_CurrencyRate_Currency1]
ALTER TABLE [dbo].[OrderFormDiscount] DROP CONSTRAINT [FK_OrderFormDiscount_OrderForm]
ALTER TABLE [dbo].[PriceValue] DROP CONSTRAINT [FK_PriceValue_PriceGroup]
ALTER TABLE [dbo].[ShippingMethod] DROP CONSTRAINT [FK_ShippingMethod_ShippingOption]
ALTER TABLE [dbo].[ShippingRegion] DROP CONSTRAINT [FK_ShippingRegion_ShippingMethod]
ALTER TABLE [dbo].[ShippingRegion] DROP CONSTRAINT [StateProvince_ShippingRegion_FK1]
ALTER TABLE [dbo].[mcmd_MetaFieldMap] DROP CONSTRAINT [FK_mcmd_MetaFieldMap_mcmd_MetaClass]
ALTER TABLE [dbo].[mcmd_MetaFieldMap] DROP CONSTRAINT [FK_mcmd_MetaFieldMap_mcmd_MetaClass1]
ALTER TABLE [dbo].[TaxValue] DROP CONSTRAINT [FK_TaxValue_JurisdictionGroup]
ALTER TABLE [dbo].[TaxValue] DROP CONSTRAINT [Tax_TaxValue_FK1]
ALTER TABLE [dbo].[LineItemDiscount] DROP CONSTRAINT [FK_LineItemDiscount_LineItem]
ALTER TABLE [dbo].[LineItem] DROP CONSTRAINT [FK_LineItem_OrderForm]
ALTER TABLE [dbo].[mcmd_MetaField] DROP CONSTRAINT [FK_mcmd_MetaField_mcmd_MetaClass]
ALTER TABLE [dbo].[aspnet_PersonalizationAllUsers] DROP CONSTRAINT [FK_PersAllUser_Paths]
ALTER TABLE [dbo].[Shipment] DROP CONSTRAINT [FK_Shipment_OrderForm]
ALTER TABLE [dbo].[OrderForm] DROP CONSTRAINT [FK_OrderForm_OrderGroup]
ALTER TABLE [dbo].[Variation] DROP CONSTRAINT [FK_Variation_CatalogEntry]
ALTER TABLE [dbo].[Variation] DROP CONSTRAINT [FK_Variation_Merchant]
ALTER TABLE [dbo].[aspnet_Profile] DROP CONSTRAINT [FK_Profile_Users]
ALTER TABLE [dbo].[CatalogLanguage] DROP CONSTRAINT [FK_CatalogLanguage_Catalog]
ALTER TABLE [dbo].[OrderGroupAddress] DROP CONSTRAINT [FK_OrderGroupAddress_OrderGroup]
ALTER TABLE [dbo].[ShippingCountry] DROP CONSTRAINT [FK_ShippingCountry_Country]
ALTER TABLE [dbo].[ShippingCountry] DROP CONSTRAINT [FK_ShippingCountry_ShippingMethod]
ALTER TABLE [dbo].[JurisdictionRelation] DROP CONSTRAINT [FK_JurisdictionRelation_Jurisdiction]
ALTER TABLE [dbo].[JurisdictionRelation] DROP CONSTRAINT [FK_JurisdictionRelation_JurisdictionGroup]
ALTER TABLE [dbo].[MetaClassMetaFieldRelation] DROP CONSTRAINT [FK_MetaClassMetaFieldRelation_MetaClass]
ALTER TABLE [dbo].[MetaClassMetaFieldRelation] DROP CONSTRAINT [FK_MetaClassMetaFieldRelation_MetaField]
ALTER TABLE [dbo].[CatalogEntryRelation] DROP CONSTRAINT [FK_CatalogEntryRelation_CatalogEntry]
ALTER TABLE [dbo].[CatalogEntryRelation] DROP CONSTRAINT [FK_CatalogEntryRelation_CatalogEntry1]
ALTER TABLE [dbo].[CatalogEntryAssociation] DROP CONSTRAINT [FK_CatalogEntryAssociation_CatalogAssociation]
ALTER TABLE [dbo].[CatalogEntryAssociation] DROP CONSTRAINT [FK_CatalogEntryAssociation_CatalogEntry]
ALTER TABLE [dbo].[CatalogEntryAssociation] DROP CONSTRAINT [FK_CatalogEntryAssociation_AssociationType]
ALTER TABLE [dbo].[CatalogAssociation] DROP CONSTRAINT [FK_CatalogAssociation_CatalogEntry]
ALTER TABLE [dbo].[CatalogEntry] DROP CONSTRAINT [FK_CatalogEntity_Catalog]
ALTER TABLE [dbo].[aspnet_Roles] DROP CONSTRAINT [FK_Roles_Application]
ALTER TABLE [dbo].[aspnet_Paths] DROP CONSTRAINT [FK_Paths_Application]
ALTER TABLE [dbo].[PaymentMethodParameter] DROP CONSTRAINT [PaymentMethod_PaymentMethodParameter_FK1]
ALTER TABLE [dbo].[aspnet_UsersInRoles] DROP CONSTRAINT [FK_UsersInRoles_Roles]
ALTER TABLE [dbo].[aspnet_UsersInRoles] DROP CONSTRAINT [FK_UsersInRoles_Users]
ALTER TABLE [dbo].[CatalogSecurity] DROP CONSTRAINT [FK_CatalogSecurity_Catalog]
ALTER TABLE [dbo].[MetaDictionary] DROP CONSTRAINT [FK_MetaDictionary_MetaField]
ALTER TABLE [dbo].[MetaField] DROP CONSTRAINT [FK_MetaField_MetaDataType]
ALTER TABLE [dbo].[MarketPaymentMethods] DROP CONSTRAINT [FK_MarketPaymentMethods_Market]
ALTER TABLE [dbo].[MarketPaymentMethods] DROP CONSTRAINT [FK_MarketPaymentMethods_PaymentMethod]
ALTER TABLE [dbo].[PriceDetail] DROP CONSTRAINT [FK_PriceDetail_CatalogEntry]
ALTER TABLE [dbo].[PriceDetail] DROP CONSTRAINT [FK_PriceDetail_Currency]
ALTER TABLE [dbo].[PriceDetail] DROP CONSTRAINT [FK_PriceDetail_Market]
ALTER TABLE [dbo].[PriceDetail] DROP CONSTRAINT [FK_PriceDetail_PriceType]
ALTER TABLE [dbo].[MarketLanguages] DROP CONSTRAINT [FK_MarketLanguages_Market]
ALTER TABLE [dbo].[StateProvince] DROP CONSTRAINT [FK_StateProvince_Country]
ALTER TABLE [dbo].[MarketCountries] DROP CONSTRAINT [FK_MarketCountries_Market]
ALTER TABLE [dbo].[aspnet_Membership] DROP CONSTRAINT [FK_Membership_Applications]
ALTER TABLE [dbo].[aspnet_Membership] DROP CONSTRAINT [FK_Membership_Users]
ALTER TABLE [dbo].[MetaFileValue] DROP CONSTRAINT [FK_MetaFileValue_MetaKey]
ALTER TABLE [dbo].[CatalogNode] DROP CONSTRAINT [FK_CatalogItem_Catalog]
ALTER TABLE [dbo].[CatalogNodeRelation] DROP CONSTRAINT [FK_CatalogItemCategory_Catalog]
ALTER TABLE [dbo].[CatalogNodeRelation] DROP CONSTRAINT [FK_CatalogItemCategory_CatalogItem]
ALTER TABLE [dbo].[SiteCatalog] DROP CONSTRAINT [FK_SiteCatalog_Catalog]
ALTER TABLE [dbo].[ShippingPaymentRestriction] DROP CONSTRAINT [FK_ShippingPaymentRestriction_PaymentMethod]
ALTER TABLE [dbo].[ShippingPaymentRestriction] DROP CONSTRAINT [FK_ShippingPaymentRestriction_ShippingMethod]
ALTER TABLE [dbo].[aspnet_PersonalizationPerUser] DROP CONSTRAINT [FK_PersPerUser_Paths]
ALTER TABLE [dbo].[aspnet_PersonalizationPerUser] DROP CONSTRAINT [FK_PersPerUser_Users]
ALTER TABLE [dbo].[aspnet_Users] DROP CONSTRAINT [FK_Users_Applications]
ALTER TABLE [dbo].[ShippingPackage] DROP CONSTRAINT [FK_ShippingPackage_Package]
ALTER TABLE [dbo].[ShippingPackage] DROP CONSTRAINT [FK_ShippingPackage_ShippingOption]
ALTER TABLE [dbo].[PriceGroup] DROP CONSTRAINT [FK_PriceGroup_CatalogEntry]
ALTER TABLE [dbo].[PriceGroup] DROP CONSTRAINT [FK_PriceGroup_Currency]
ALTER TABLE [dbo].[PriceGroup] DROP CONSTRAINT [FK_PriceGroup_Market]
ALTER TABLE [dbo].[PriceGroup] DROP CONSTRAINT [FK_PriceGroup_PriceType]
ALTER TABLE [dbo].[MarketCurrencies] DROP CONSTRAINT [FK_MarketCurrencies_Market]
ALTER TABLE [dbo].[Market] DROP CONSTRAINT [FK_Market_Currency]
ALTER TABLE [dbo].[NodeEntryRelation] DROP CONSTRAINT [FK_NodeEntryRelation_Catalog]
ALTER TABLE [dbo].[NodeEntryRelation] DROP CONSTRAINT [FK_NodeEntryRelation_CatalogEntry]
ALTER TABLE [dbo].[NodeEntryRelation] DROP CONSTRAINT [FK_NodeEntryRelation_CatalogNode]
ALTER TABLE [dbo].[mcmd_SelectedEnumValue] DROP CONSTRAINT [FK_mcmd_SelectedEnumValue_mcmd_MetaEnum]
INSERT INTO [dbo].[Market] ([MarketId], [Created], [Modified], [IsEnabled], [MarketName], [MarketDescription], [DefaultCurrencyCode], [DefaultLanguageCode]) VALUES (N'DEFAULT', '20131211 08:56:45.417', '20131211 08:56:45.417', 1, N'Default Market', N'Default Market', N'USD', N'en')
INSERT INTO [dbo].[MarketCurrencies] ([MarketId], [CurrencyCode]) VALUES (N'DEFAULT', N'USD')
SET IDENTITY_INSERT [dbo].[Currency] ON
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'AED', '20150715 15:30:46.845', '20150715 15:30:46.845', N'UAE Dirham', 1)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'AFN', '20150715 15:30:46.846', '20150715 15:30:46.846', N'Afghanistan Afghani', 2)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'ALL', '20150715 15:30:46.846', '20150715 15:30:46.846', N'Albanian Lek', 3)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'AMD', '20150715 15:30:46.846', '20150715 15:30:46.846', N'Armenian Dram', 4)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'ANG', '20150715 15:30:46.847', '20150715 15:30:46.847', N'Netherlands Antillean Guilder', 5)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'AOA', '20150715 15:30:46.847', '20150715 15:30:46.847', N'Angolan Kwanza', 6)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'ARS', '20150715 15:30:46.847', '20150715 15:30:46.847', N'Argentine Peso', 7)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'AUD', '20150715 15:30:46.847', '20150715 15:30:46.847', N'Australian Dollar', 8)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'AWG', '20150715 15:30:46.847', '20150715 15:30:46.847', N'Aruban Florin', 9)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'AZN', '20150715 15:30:46.847', '20150715 15:30:46.847', N'Azerbaijanian Manat', 10)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'BAM', '20150715 15:30:46.847', '20150715 15:30:46.847', N'Convertible Mark', 11)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'BBD', '20150715 15:30:46.847', '20150715 15:30:46.847', N'Barbados Dollar', 12)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'BDT', '20150715 15:30:46.847', '20150715 15:30:46.847', N'Bangladeshi Taka', 13)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'BGN', '20150715 15:30:46.847', '20150715 15:30:46.847', N'Bulgarian Lev', 14)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'BHD', '20150715 15:30:46.848', '20150715 15:30:46.848', N'Bahraini Dinar', 15)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'BIF', '20150715 15:30:46.848', '20150715 15:30:46.848', N'Burundi Franc', 16)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'BMD', '20150715 15:30:46.848', '20150715 15:30:46.848', N'Bermudian Dollar', 17)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'BND', '20150715 15:30:46.848', '20150715 15:30:46.848', N'Brunei Dollar', 18)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'BOB', '20150715 15:30:46.848', '20150715 15:30:46.848', N'Boliviano', 19)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'BOV', '20150715 15:30:46.849', '20150715 15:30:46.849', N'Bolivian Mvdol', 20)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'BRL', '20150715 15:30:46.849', '20150715 15:30:46.849', N'Brazilian Real', 21)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'BSD', '20150715 15:30:46.849', '20150715 15:30:46.849', N'Bahamian Dollar', 22)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'BTN', '20150715 15:30:46.849', '20150715 15:30:46.849', N'Bhutanese Ngultrum', 23)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'BWP', '20150715 15:30:46.852', '20150715 15:30:46.852', N'Botswana Pula', 24)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'BYR', '20150715 15:30:46.855', '20150715 15:30:46.855', N'Belarussian Ruble', 25)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'BZD', '20150715 15:30:46.856', '20150715 15:30:46.856', N'Belize Dollar', 26)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'CAD', '20150715 15:30:46.857', '20150715 15:30:46.857', N'Canadian Dollar', 27)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'CDF', '20150715 15:30:46.857', '20150715 15:30:46.857', N'Congolese Franc', 28)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'CHE', '20150715 15:30:46.858', '20150715 15:30:46.858', N'WIR Euro', 29)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'CHF', '20150715 15:30:46.859', '20150715 15:30:46.859', N'Swiss Franc', 30)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'CHW', '20150715 15:30:46.859', '20150715 15:30:46.859', N'WIR Franc', 31)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'CLF', '20150715 15:30:46.860', '20150715 15:30:46.860', N'Unidad de Fomento', 32)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'CLP', '20150715 15:30:46.861', '20150715 15:30:46.861', N'Chilean Peso', 33)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'CNY', '20150715 15:30:46.863', '20150715 15:30:46.863', N'Yuan Renminbi', 34)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'COP', '20150715 15:30:46.865', '20150715 15:30:46.865', N'Colombian Peso', 35)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'COU', '20150715 15:30:46.867', '20150715 15:30:46.867', N'Unidad de Valor Real', 36)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'CRC', '20150715 15:30:46.869', '20150715 15:30:46.869', N'Costa Rican Colon', 37)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'CUC', '20150715 15:30:46.871', '20150715 15:30:46.871', N'Peso Convertible', 38)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'CUP', '20150715 15:30:46.876', '20150715 15:30:46.876', N'Cuban Peso', 39)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'CVE', '20150715 15:30:46.879', '20150715 15:30:46.879', N'Cabo Verde Escudo', 40)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'CZK', '20150715 15:30:46.880', '20150715 15:30:46.880', N'Czech Koruna', 41)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'DJF', '20150715 15:30:46.880', '20150715 15:30:46.880', N'Djibouti Franc', 42)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'DKK', '20150715 15:30:46.881', '20150715 15:30:46.881', N'Danish Krone', 43)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'DOP', '20150715 15:30:46.883', '20150715 15:30:46.883', N'Dominican Peso', 44)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'DZD', '20150715 15:30:46.886', '20150715 15:30:46.886', N'Algerian Dinar', 45)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'EGP', '20150715 15:30:46.889', '20150715 15:30:46.889', N'Egyptian Pound', 46)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'ERN', '20150715 15:30:46.891', '20150715 15:30:46.891', N' Eritrean Nakfa', 47)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'ETB', '20150715 15:30:46.892', '20150715 15:30:46.892', N'Ethiopian Birr', 48)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'EUR', '20150715 15:30:46.893', '20150715 15:30:46.893', N'Euro', 49)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'FJD', '20150715 15:30:46.893', '20150715 15:30:46.893', N'Fiji Dollar', 50)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'FKP', '20150715 15:30:46.894', '20150715 15:30:46.894', N'Falkland Islands Pound', 51)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'GBP', '20150715 15:30:46.895', '20150715 15:30:46.895', N'Pound Sterling', 52)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'GEL', '20150715 15:30:46.895', '20150715 15:30:46.895', N'Georgian Lari', 53)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'GHS', '20150715 15:30:46.896', '20150715 15:30:46.896', N'Ghana Cedi', 54)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'GIP', '20150715 15:30:46.896', '20150715 15:30:46.896', N'Gibraltar Pound', 55)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'GMD', '20150715 15:30:46.896', '20150715 15:30:46.896', N'Gambian Dalasi', 56)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'GNF', '20150715 15:30:46.897', '20150715 15:30:46.897', N'Guinea Franc', 57)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'GTQ', '20150715 15:30:46.897', '20150715 15:30:46.897', N' Guatemalan Quetzal ', 58)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'GYD', '20150715 15:30:46.897', '20150715 15:30:46.897', N'Guyana Dollar', 59)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'HKD', '20150715 15:30:46.898', '20150715 15:30:46.898', N'Hong Kong Dollar', 60)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'HNL', '20150715 15:30:46.898', '20150715 15:30:46.898', N'Honduran Lempira', 61)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'HRK', '20150715 15:30:46.898', '20150715 15:30:46.898', N'Croatian Kuna', 62)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'HTG', '20150715 15:30:46.899', '20150715 15:30:46.899', N'Haitian Gourde', 63)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'HUF', '20150715 15:30:46.899', '20150715 15:30:46.899', N'Hungarian Forint', 64)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'IDR', '20150715 15:30:46.899', '20150715 15:30:46.899', N'Indonesian Rupiah ', 65)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'ILS', '20150715 15:30:46.900', '20150715 15:30:46.900', N'New Israeli Sheqel', 66)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'INR', '20150715 15:30:46.900', '20150715 15:30:46.900', N'Indian Rupee', 67)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'IQD', '20150715 15:30:46.901', '20150715 15:30:46.901', N'Iraqi Dinar', 68)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'IRR', '20150715 15:30:46.901', '20150715 15:30:46.901', N'Iranian Rial', 69)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'ISK', '20150715 15:30:46.903', '20150715 15:30:46.903', N'Iceland Krona', 70)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'JMD', '20150715 15:30:46.903', '20150715 15:30:46.903', N'Jamaican Dollar', 71)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'JOD', '20150715 15:30:46.904', '20150715 15:30:46.904', N'Jordanian Dinar', 72)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'JPY', '20150715 15:30:46.904', '20150715 15:30:46.904', N'Japanese Yen', 73)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'KES', '20150715 15:30:46.905', '20150715 15:30:46.905', N'Kenyan Shilling', 74)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'KGS', '20150715 15:30:46.905', '20150715 15:30:46.905', N'Kyrgyzstani Som', 75)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'KHR', '20150715 15:30:46.905', '20150715 15:30:46.905', N'Cambodian Riel', 76)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'KMF', '20150715 15:30:46.906', '20150715 15:30:46.906', N'Comoro Franc', 77)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'KPW', '20150715 15:30:46.906', '20150715 15:30:46.906', N'North Korean Won', 78)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'KRW', '20150715 15:30:46.906', '20150715 15:30:46.906', N'South Korean Won ', 79)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'KWD', '20150715 15:30:46.907', '20150715 15:30:46.907', N'Kuwaiti Dinar', 80)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'KYD', '20150715 15:30:46.907', '20150715 15:30:46.907', N'Cayman Islands Dollar', 81)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'KZT', '20150715 15:30:46.908', '20150715 15:30:46.908', N'Kazakhstani Tenge', 82)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'LAK', '20150715 15:30:46.908', '20150715 15:30:46.908', N'Lao Kip', 83)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'LBP', '20150715 15:30:46.909', '20150715 15:30:46.909', N'Lebanese Pound', 84)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'LKR', '20150715 15:30:46.909', '20150715 15:30:46.909', N'Sri Lanka Rupee', 85)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'LRD', '20150715 15:30:46.910', '20150715 15:30:46.910', N'Liberian Dollar', 86)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'LSL', '20150715 15:30:46.910', '20150715 15:30:46.910', N'Lesotho Loti', 87)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'LYD', '20150715 15:30:46.910', '20150715 15:30:46.910', N'Libyan Dinar', 88)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'MAD', '20150715 15:30:46.911', '20150715 15:30:46.911', N'Moroccan Dirham', 89)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'MDL', '20150715 15:30:46.911', '20150715 15:30:46.911', N'Moldovan Leu', 90)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'MGA', '20150715 15:30:46.911', '20150715 15:30:46.911', N'Malagasy Ariary', 91)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'MKD', '20150715 15:30:46.911', '20150715 15:30:46.911', N'Macedonian Denar', 92)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'MMK', '20150715 15:30:46.912', '20150715 15:30:46.912', N'Myanmar Kyat', 93)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'MNT', '20150715 15:30:46.912', '20150715 15:30:46.912', N'Mongolian Tugrik', 94)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'MOP', '20150715 15:30:46.912', '20150715 15:30:46.912', N'Macanese Pataca', 95)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'MRO', '20150715 15:30:46.913', '20150715 15:30:46.913', N'Mauritanian Ouguiya', 96)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'MUR', '20150715 15:30:46.913', '20150715 15:30:46.913', N'Mauritius Rupee', 97)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'MWK', '20150715 15:30:46.913', '20150715 15:30:46.913', N'Malawian Kwacha', 98)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'MVR', '20150715 15:30:46.914', '20150715 15:30:46.914', N'Maldivian Rufiyaa', 99)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'MXN', '20150715 15:30:46.914', '20150715 15:30:46.914', N'Mexican Peso', 100)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'MXV', '20150715 15:30:46.914', '20150715 15:30:46.914', N'Mexican Unidad de Inversion', 101)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'MYR', '20150715 15:30:46.915', '20150715 15:30:46.915', N'Malaysian Ringgit', 102)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'MZN', '20150715 15:30:46.915', '20150715 15:30:46.915', N'Mozambique Metical', 103)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'NAD', '20150715 15:30:46.915', '20150715 15:30:46.915', N'Namibia Dollar', 104)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'NGN', '20150715 15:30:46.916', '20150715 15:30:46.916', N'Nigerian Naira', 105)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'NIO', '20150715 15:30:46.916', '20150715 15:30:46.916', N'Cordoba Oro', 106)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'NOK', '20150715 15:30:46.917', '20150715 15:30:46.917', N'Norwegian Krone', 107)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'NPR', '20150715 15:30:46.917', '20150715 15:30:46.917', N'Nepalese Rupee', 108)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'NZD', '20150715 15:30:46.918', '20150715 15:30:46.918', N'New Zealand Dollar', 109)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'OMR', '20150715 15:30:46.918', '20150715 15:30:46.918', N'Rial Omani', 110)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'PAB', '20150715 15:30:46.919', '20150715 15:30:46.919', N'Panamanian Balboa', 111)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'PEN', '20150715 15:30:46.919', '20150715 15:30:46.919', N'Nuevo Sol', 112)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'PGK', '20150715 15:30:46.919', '20150715 15:30:46.919', N'Papua New Guinea Kina', 113)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'PHP', '20150715 15:30:46.920', '20150715 15:30:46.920', N'Philippine Peso', 114)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'PKR', '20150715 15:30:46.920', '20150715 15:30:46.920', N'Pakistan Rupee', 115)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'PLN', '20150715 15:30:46.921', '20150715 15:30:46.921', N'Polish Zloty', 116)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'PYG', '20150715 15:30:46.921', '20150715 15:30:46.921', N'Guarani', 117)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'QAR', '20150715 15:30:46.921', '20150715 15:30:46.921', N'Qatari Rial', 118)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'RON', '20150715 15:30:46.922', '20150715 15:30:46.922', N'Romanian Leu', 119)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'RSD', '20150715 15:30:46.922', '20150715 15:30:46.922', N'Serbian Dinar', 120)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'RUB', '20150715 15:30:46.922', '20150715 15:30:46.922', N'Russian Ruble', 121)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'RWF', '20150715 15:30:46.923', '20150715 15:30:46.923', N'Rwanda Franc', 122)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'SAR', '20150715 15:30:46.923', '20150715 15:30:46.923', N'Saudi Riyal', 123)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'SBD', '20150715 15:30:46.923', '20150715 15:30:46.923', N'Solomon Islands Dollar', 124)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'SCR', '20150715 15:30:46.924', '20150715 15:30:46.924', N'Seychelles Rupee', 125)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'SDG', '20150715 15:30:46.924', '20150715 15:30:46.924', N'Sudanese Pound', 126)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'SEK', '20150715 15:30:46.925', '20150715 15:30:46.925', N'Swedish Krona', 127)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'SGD', '20150715 15:30:46.925', '20150715 15:30:46.925', N'Singapore Dollar', 128)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'SHP', '20150715 15:30:46.926', '20150715 15:30:46.926', N'Saint Helena Pound', 129)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'SLL', '20150715 15:30:46.926', '20150715 15:30:46.926', N'Sierra Leonean Leone', 130)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'SOS', '20150715 15:30:46.926', '20150715 15:30:46.926', N'Somali Shilling', 131)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'SRD', '20150715 15:30:46.927', '20150715 15:30:46.927', N'Surinam Dollar', 132)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'SSP', '20150715 15:30:46.927', '20150715 15:30:46.927', N'South Sudanese Pound', 133)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'STD', '20150715 15:30:46.928', '20150715 15:30:46.928', N'Dobra', 134)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'SVC', '20150715 15:30:46.928', '20150715 15:30:46.928', N'El Salvador Colon', 135)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'SYP', '20150715 15:30:46.928', '20150715 15:30:46.928', N'Syrian Pound', 136)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'SZL', '20150715 15:30:46.930', '20150715 15:30:46.930', N'Swazi Lilangeni', 137)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'THB', '20150715 15:30:46.930', '20150715 15:30:46.930', N'Thailand Baht', 138)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'TJS', '20150715 15:30:46.930', '20150715 15:30:46.930', N'Tajikistan Somoni', 139)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'TMT', '20150715 15:30:46.930', '20150715 15:30:46.930', N'Turkmenistan New Manat', 140)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'TND', '20150715 15:30:46.931', '20150715 15:30:46.931', N'Tunisian Dinar', 141)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'TOP', '20150715 15:30:46.931', '20150715 15:30:46.931', N'Tonga Paanga', 142)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'TRY', '20150715 15:30:46.932', '20150715 15:30:46.932', N'Turkish Lira', 143)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'TTD', '20150715 15:30:46.932', '20150715 15:30:46.932', N'Trinidad and Tobago Dollar', 144)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'TWD', '20150715 15:30:46.932', '20150715 15:30:46.932', N'New Taiwan Dollar', 145)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'TZS', '20150715 15:30:46.933', '20150715 15:30:46.933', N'Tanzanian Shilling', 146)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'UAH', '20150715 15:30:46.933', '20150715 15:30:46.933', N'Ukrainian Hryvnia', 147)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'UGX', '20150715 15:30:46.934', '20150715 15:30:46.934', N'Uganda Shilling', 148)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'USD', '20150715 15:30:46.934', '20150715 15:30:46.934', N'US Dollar', 149)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'USN', '20150715 15:30:46.935', '20150715 15:30:46.935', N'US Dollar Next Day', 150)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'UYI', '20150715 15:30:46.935', '20150715 15:30:46.935', N'Uruguay Peso en Unidades Indexadas ', 151)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'UYU', '20150715 15:30:46.936', '20150715 15:30:46.936', N'Peso Uruguayo', 152)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'UZS', '20150715 15:30:46.936', '20150715 15:30:46.936', N'Uzbekistan Sum', 153)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'VEF', '20150715 15:30:46.937', '20150715 15:30:46.937', N'Venezuela Bolivares Fuertes', 154)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'VND', '20150715 15:30:46.937', '20150715 15:30:46.937', N'Vietnamese Dong', 155)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'WST', '20150715 15:30:46.937', '20150715 15:30:46.937', N'Samoa Tala', 156)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'VUV', '20150715 15:30:46.938', '20150715 15:30:46.938', N'Vanuatu Vatu', 157)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'YER', '20150715 15:30:46.938', '20150715 15:30:46.938', N'Yemeni Rial', 158)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'ZAR', '20150715 15:30:46.938', '20150715 15:30:46.938', N'South African Rand', 159)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'ZMW', '20150715 15:30:46.939', '20150715 15:30:46.939', N'Zambian Kwacha', 160)
INSERT INTO [dbo].[Currency] ([CurrencyCode], [Created], [Modified], [CurrencyName], [CompatCurrencyId]) VALUES (N'ZWL', '20150715 15:30:46.939', '20150715 15:30:46.939', N'Zimbabwe Dollar', 161)
SET IDENTITY_INSERT [dbo].[Currency] OFF
INSERT INTO [dbo].[aspnet_Users] ([ApplicationId], [LoweredUserName], [UserId], [UserName], [MobileAlias], [IsAnonymous], [LastActivityDate]) VALUES (N'dae8247f-1940-4833-902d-d4a7cfc9d57f', N'admin', N'45f3ed19-05b0-4bc9-97c4-9d323b0a8959', N'admin', NULL, 0, '20131211 08:56:54.577')
INSERT INTO [dbo].[PaymentMethod] ([PaymentMethodId], [Name], [Description], [LanguageId], [SystemKeyword], [IsActive], [IsDefault], [ClassName], [PaymentImplementationClassName], [SupportsRecurring], [Ordering], [Created], [Modified]) VALUES (N'3b1cd10d-0c22-4bf4-9fba-563a9c27605c', N'Pay By Phone', N'Pay by phone payment', N'en', N'Generic', 1, 1, N'Mediachase.Commerce.Plugins.Payment.GenericPaymentGateway, Mediachase.Commerce.Plugins.Payment', N'Mediachase.Commerce.Orders.OtherPayment, Mediachase.Commerce', 1, 2, '20100420 00:00:00.000', '20100420 00:00:00.000')
INSERT INTO [dbo].[PaymentMethod] ([PaymentMethodId], [Name], [Description], [LanguageId], [SystemKeyword], [IsActive], [IsDefault], [ClassName], [PaymentImplementationClassName], [SupportsRecurring], [Ordering], [Created], [Modified]) VALUES (N'4b6e692f-d6fb-4552-9439-3a39d2251316', N'Pay By Credit Card', N'Pay By Credit Card', N'en', N'Authorize', 1, 0, N'Mediachase.Commerce.Plugins.Payment.Authorize.AuthorizePaymentGateway, Mediachase.Commerce.Plugins.Payment', N'Mediachase.Commerce.Orders.CreditCardPayment, Mediachase.Commerce', 1, 2, '20100420 00:00:00.000', '20100420 00:00:00.000')
INSERT INTO [dbo].[PaymentMethod] ([PaymentMethodId], [Name], [Description], [LanguageId], [SystemKeyword], [IsActive], [IsDefault], [ClassName], [PaymentImplementationClassName], [SupportsRecurring], [Ordering], [Created], [Modified]) VALUES (N'a6141930-df6c-48a7-8339-724ca005af52', N'Pay per Telefon', N'Pay per Telefon', N'de', N'Generic', 1, 1, N'Mediachase.Commerce.Plugins.Payment.GenericPaymentGateway, Mediachase.Commerce.Plugins.Payment', N'Mediachase.Commerce.Orders.OtherPayment, Mediachase.Commerce', 1, 2, '20100420 00:00:00.000', '20100420 00:00:00.000')
INSERT INTO [dbo].[PaymentMethod] ([PaymentMethodId], [Name], [Description], [LanguageId], [SystemKeyword], [IsActive], [IsDefault], [ClassName], [PaymentImplementationClassName], [SupportsRecurring], [Ordering], [Created], [Modified]) VALUES (N'c1ba5772-5c6f-473d-a812-fde7a350c0cf', N'ExchangePayment', N'Exchange Payment', N'en', N'Exchange', 0, 0, N'Mediachase.Commerce.Plugins.Payment.GenericPaymentGateway, Mediachase.Commerce.Plugins.Payment', N'Mediachase.Commerce.Orders.OtherPayment, Mediachase.Commerce', 1, 2, '20100420 00:00:00.000', '20100420 00:00:00.000')
INSERT INTO [dbo].[PaymentMethod] ([PaymentMethodId], [Name], [Description], [LanguageId], [SystemKeyword], [IsActive], [IsDefault], [ClassName], [PaymentImplementationClassName], [SupportsRecurring], [Ordering], [Created], [Modified]) VALUES (N'c59b8070-07fb-4177-a458-0e992432ffa5', N'Pago por telfono', N'Pago por telfono', N'es', N'Generic', 1, 1, N'Mediachase.Commerce.Plugins.Payment.GenericPaymentGateway, Mediachase.Commerce.Plugins.Payment', N'Mediachase.Commerce.Orders.OtherPayment, Mediachase.Commerce', 1, 2, '20100420 00:00:00.000', '20100420 00:00:00.000')
INSERT INTO [dbo].[aspnet_Applications] ([ApplicationId], [ApplicationName], [LoweredApplicationName], [Description]) VALUES (N'dae8247f-1940-4833-902d-d4a7cfc9d57f', N'ECApplication', N'ecapplication', NULL)
INSERT INTO [dbo].[aspnet_Membership] ([UserId], [ApplicationId], [Password], [PasswordFormat], [PasswordSalt], [MobilePIN], [Email], [LoweredEmail], [PasswordQuestion], [PasswordAnswer], [IsApproved], [IsLockedOut], [CreateDate], [LastLoginDate], [LastPasswordChangedDate], [LastLockoutDate], [FailedPasswordAttemptCount], [FailedPasswordAttemptWindowStart], [FailedPasswordAnswerAttemptCount], [FailedPasswordAnswerAttemptWindowStart], [Comment]) VALUES (N'45f3ed19-05b0-4bc9-97c4-9d323b0a8959', N'dae8247f-1940-4833-902d-d4a7cfc9d57f', N'h7I4zig4aMBSJuMqnfI98uZrof9PWvOs5WBSTUjn++ejyQtei7oiOIawJLmGzHGnEDUzZf7P+aF8ICmXbQ2KPQ==', 1, N'yzdvrrY2IljwAxvEjYUgZg==', NULL, N'admin@yourcompany.com', N'admin@yourcompany.com', NULL, NULL, 1, 0, '20131211 08:56:54.577', '20131211 08:56:54.577', '20131211 08:56:54.577', '17540101 00:00:00.000', 0, '17540101 00:00:00.000', 0, '17540101 00:00:00.000', NULL)
INSERT INTO [dbo].[MarketCountries] ([MarketId], [CountryCode]) VALUES (N'DEFAULT', N'USA')
SET IDENTITY_INSERT [dbo].[Country] ON
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (1, N'Aruba', 0, 1, N'ABW')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (2, N'Afghanistan', 0, 1, N'AFG')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (3, N'Angola', 0, 1, N'AGO')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (4, N'Anguilla', 0, 1, N'AIA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (5, N'Albania', 0, 1, N'ALB')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (6, N'Andorra', 0, 1, N'AND')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (7, N'Netherlands Antilles', 0, 1, N'ANT')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (8, N'United Arab Emirates', 0, 1, N'ARE')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (9, N'Argentina', 0, 1, N'ARG')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (10, N'Armenia', 0, 1, N'ARM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (11, N'American Samoa', 0, 1, N'ASM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (12, N'Antarctica', 0, 1, N'ATA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (13, N'French Southern Territories', 0, 1, N'ATF')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (14, N'Antigua and Barbuda', 0, 1, N'ATG')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (15, N'Australia', 0, 1, N'AUS')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (16, N'Austria', 0, 1, N'AUT')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (17, N'Azerbaijan', 0, 1, N'AZE')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (18, N'Burundi', 0, 1, N'BDI')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (19, N'Belgium', 0, 1, N'BEL')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (20, N'Benin', 0, 1, N'BEN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (21, N'Burkina Faso', 0, 1, N'BFA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (22, N'Bangladesh', 0, 1, N'BGD')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (23, N'Bulgaria', 0, 1, N'BGR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (24, N'Bahrain', 0, 1, N'BHR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (25, N'Bahamas', 0, 1, N'BHS')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (26, N'Bosnia and Herzegovina', 0, 1, N'BIH')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (27, N'Belarus', 0, 1, N'BLR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (28, N'Belize', 0, 1, N'BLZ')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (29, N'Bermuda', 0, 1, N'BMU')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (30, N'Bolivia', 0, 1, N'BOL')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (31, N'Brazil', 0, 1, N'BRA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (32, N'Barbados', 0, 1, N'BRB')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (33, N'Brunei Darussalam', 0, 1, N'BRN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (34, N'Bhutan', 0, 1, N'BTN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (35, N'Bouvet Island', 0, 1, N'BVT')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (36, N'Botswana', 0, 1, N'BWA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (37, N'Central African Republic', 0, 1, N'CAF')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (38, N'Canada', 0, 1, N'CAN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (39, N'Cocos (Keeling) Islands', 0, 1, N'CCK')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (40, N'Switzerland', 0, 1, N'CHE')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (41, N'Chile', 0, 1, N'CHL')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (42, N'China', 0, 1, N'CHN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (43, N'Cote d''Ivoire', 0, 1, N'CIV')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (44, N'Cameroon', 0, 1, N'CMR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (45, N'Congo, Democratic Republic of the', 0, 1, N'COD')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (46, N'Congo, Republic of the', 0, 1, N'COG')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (47, N'Cook Islands', 0, 1, N'COK')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (48, N'Colombia', 0, 1, N'COL')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (49, N'Comoros', 0, 1, N'COM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (50, N'Cabo Verde', 0, 1, N'CPV')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (51, N'Costa Rica', 0, 1, N'CRI')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (52, N'Cuba', 0, 1, N'CUB')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (53, N'Christmas Island', 0, 1, N'CXR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (54, N'Cayman Islands', 0, 1, N'CYM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (55, N'Cyprus', 0, 1, N'CYP')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (56, N'Czech Republic', 0, 1, N'CZE')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (57, N'Germany', 0, 1, N'DEU')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (58, N'Djibouti', 0, 1, N'DJI')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (59, N'Dominica', 0, 1, N'DMA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (60, N'Denmark', 0, 1, N'DNK')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (61, N'Dominican Republic', 0, 1, N'DOM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (62, N'Algeria', 0, 1, N'DZA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (63, N'Ecuador', 0, 1, N'ECU')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (64, N'Egypt', 0, 1, N'EGY')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (65, N'Eritrea', 0, 1, N'ERI')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (66, N'Western Sahara', 0, 1, N'ESH')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (67, N'Spain', 0, 1, N'ESP')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (68, N'Estonia', 0, 1, N'EST')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (69, N'Ethiopia', 0, 1, N'ETH')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (70, N'Finland', 0, 1, N'FIN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (71, N'Fiji', 0, 1, N'FJI')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (72, N'Falkland Islands (Malvinas)', 0, 1, N'FLK')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (73, N'France', 0, 1, N'FRA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (74, N'Faroe Islands', 0, 1, N'FRO')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (75, N'Micronesia, Federated States of', 0, 1, N'FSM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (76, N'Gabon', 0, 1, N'GAB')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (77, N'United Kingdom', 0, 1, N'GBR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (78, N'Georgia', 0, 1, N'GEO')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (79, N'Ghana', 0, 1, N'GHA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (80, N'Gibraltar', 0, 1, N'GIB')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (81, N'Guinea', 0, 1, N'GIN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (82, N'Guadeloupe', 0, 1, N'GLP')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (83, N'Gambia', 0, 1, N'GMB')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (84, N'Guinea-Bissau', 0, 1, N'GNB')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (85, N'Equatorial Guinea', 0, 1, N'GNQ')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (86, N'Greece', 0, 1, N'GRC')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (87, N'Grenada', 0, 1, N'GRD')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (88, N'Greenland', 0, 1, N'GRL')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (89, N'Guatemala', 0, 1, N'GTM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (90, N'French Guiana', 0, 1, N'GUF')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (91, N'Guam', 0, 1, N'GUM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (92, N'Guyana', 0, 1, N'GUY')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (93, N'Hong Kong', 0, 1, N'HKG')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (94, N'Heard Island and Mcdonald Islands', 0, 1, N'HMD')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (95, N'Honduras', 0, 1, N'HND')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (96, N'Croatia', 0, 1, N'HRV')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (97, N'Haiti', 0, 1, N'HTI')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (98, N'Hungary', 0, 1, N'HUN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (99, N'Indonesia', 0, 1, N'IDN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (100, N'India', 0, 1, N'IND')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (101, N'British Indian Ocean Territory', 0, 1, N'IOT')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (102, N'Ireland', 0, 1, N'IRL')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (103, N'Iran, Islamic Republic of', 0, 1, N'IRN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (104, N'Iraq', 0, 1, N'IRQ')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (105, N'Iceland', 0, 1, N'ISL')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (106, N'Israel', 0, 1, N'ISR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (107, N'Italy', 0, 1, N'ITA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (108, N'Jamaica', 0, 1, N'JAM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (109, N'Jordan', 0, 1, N'JOR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (110, N'Japan', 0, 1, N'JPN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (111, N'Kazakhstan', 0, 1, N'KAZ')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (112, N'Kenya', 0, 1, N'KEN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (113, N'Kyrgyzstan', 0, 1, N'KGZ')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (114, N'Cambodia', 0, 1, N'KHM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (115, N'Kiribati', 0, 1, N'KIR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (116, N'Saint Kitts and Nevis', 0, 1, N'KNA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (117, N'Korea, Republic of', 0, 1, N'KOR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (118, N'Kuwait', 0, 1, N'KWT')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (119, N'Lao People''s Democratic Republic', 0, 1, N'LAO')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (120, N'Lebanon', 0, 1, N'LBN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (121, N'Liberia', 0, 1, N'LBR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (122, N'Libya', 0, 1, N'LBY')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (123, N'Saint Lucia', 0, 1, N'LCA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (124, N'Liechtenstein', 0, 1, N'LIE')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (125, N'Sri Lanka', 0, 1, N'LKA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (126, N'Lesotho', 0, 1, N'LSO')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (127, N'Lithuania', 0, 1, N'LTU')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (128, N'Luxembourg', 0, 1, N'LUX')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (129, N'Latvia', 0, 1, N'LVA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (130, N'Macao', 0, 1, N'MAC')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (131, N'Morocco', 0, 1, N'MAR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (132, N'Monaco', 0, 1, N'MCO')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (133, N'Moldova, Republic of', 0, 1, N'MDA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (134, N'Madagascar', 0, 1, N'MDG')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (135, N'Maldives', 0, 1, N'MDV')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (136, N'Mexico', 0, 1, N'MEX')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (137, N'Marshall Islands', 0, 1, N'MHL')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (138, N'Macedonia, Republic of', 0, 1, N'MKD')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (139, N'Mali', 0, 1, N'MLI')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (140, N'Malta', 0, 1, N'MLT')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (141, N'Myanmar', 0, 1, N'MMR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (142, N'Mongolia', 0, 1, N'MNG')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (143, N'Northern Mariana Islands', 0, 1, N'MNP')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (144, N'Mozambique', 0, 1, N'MOZ')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (145, N'Mauritania', 0, 1, N'MRT')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (146, N'Montserrat', 0, 1, N'MSR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (147, N'Martinique', 0, 1, N'MTQ')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (148, N'Mauritius', 0, 1, N'MUS')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (149, N'Malawi', 0, 1, N'MWI')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (150, N'Malaysia', 0, 1, N'MYS')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (151, N'Mayotte', 0, 1, N'MYT')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (152, N'Namibia', 0, 1, N'NAM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (153, N'New Caledonia', 0, 1, N'NCL')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (154, N'Niger', 0, 1, N'NER')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (155, N'Norfolk Island', 0, 1, N'NFK')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (156, N'Nigeria', 0, 1, N'NGA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (157, N'Nicaragua', 0, 1, N'NIC')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (158, N'Niue', 0, 1, N'NIU')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (159, N'Netherlands', 0, 1, N'NLD')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (160, N'Norway', 0, 1, N'NOR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (161, N'Nepal', 0, 1, N'NPL')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (162, N'Nauru', 0, 1, N'NRU')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (163, N'New Zealand', 0, 1, N'NZL')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (164, N'Oman', 0, 1, N'OMN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (165, N'Pakistan', 0, 1, N'PAK')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (166, N'Panama', 0, 1, N'PAN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (167, N'Pitcairn', 0, 1, N'PCN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (168, N'Peru', 0, 1, N'PER')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (169, N'Philippines', 0, 1, N'PHL')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (170, N'Palau', 0, 1, N'PLW')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (171, N'Papua New Guinea', 0, 1, N'PNG')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (172, N'Poland', 0, 1, N'POL')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (173, N'Puerto Rico', 0, 1, N'PRI')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (174, N'Korea, Democratic People''s Republic of', 0, 1, N'PRK')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (175, N'Portugal', 0, 1, N'PRT')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (176, N'Paraguay', 0, 1, N'PRY')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (177, N'Palestine, State of', 0, 1, N'PSE')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (178, N'French Polynesia', 0, 1, N'PYF')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (179, N'Qatar', 0, 1, N'QAT')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (180, N'Reunion', 0, 1, N'REU')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (181, N'Romania', 0, 1, N'ROM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (182, N'Russian Federation', 0, 1, N'RUS')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (183, N'Rwanda', 0, 1, N'RWA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (184, N'Saudi Arabia', 0, 1, N'SAU')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (185, N'Serbia', 0, 1, N'SRB')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (186, N'Sudan', 0, 1, N'SDN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (187, N'Senegal', 0, 1, N'SEN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (188, N'Singapore', 0, 1, N'SGP')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (189, N'South Georgia and the South Sandwich Islands', 0, 1, N'SGS')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (190, N'Saint Helena, Ascension and Tristan da Cunha', 0, 1, N'SHN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (191, N'Svalbard and Jan Mayen', 0, 1, N'SJM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (192, N'Solomon Islands', 0, 1, N'SLB')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (193, N'Sierra Leone', 0, 1, N'SLE')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (194, N'El Salvador', 0, 1, N'SLV')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (195, N'San Marino', 0, 1, N'SMR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (196, N'Somalia', 0, 1, N'SOM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (197, N'Saint Pierre and Miquelon', 0, 1, N'SPM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (198, N'Sao Tome and Principe', 0, 1, N'STP')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (199, N'Suriname', 0, 1, N'SUR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (200, N'Slovakia', 0, 1, N'SVK')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (201, N'Slovenia', 0, 1, N'SVN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (202, N'Sweden', 0, 1, N'SWE')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (203, N'Swaziland', 0, 1, N'SWZ')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (204, N'Seychelles', 0, 1, N'SYC')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (205, N'Syrian Arab Republic', 0, 1, N'SYR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (206, N'Turks and Caicos Islands', 0, 1, N'TCA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (207, N'Chad', 0, 1, N'TCD')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (208, N'Togo', 0, 1, N'TGO')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (209, N'Thailand', 0, 1, N'THA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (210, N'Tajikistan', 0, 1, N'TJK')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (211, N'Tokelau', 0, 1, N'TKL')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (212, N'Turkmenistan', 0, 1, N'TKM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (213, N'Timor-Leste', 0, 1, N'TLS')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (214, N'Tonga', 0, 1, N'TON')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (215, N'Trinidad and Tobago', 0, 1, N'TTO')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (216, N'Tunisia', 0, 1, N'TUN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (217, N'Turkey', 0, 1, N'TUR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (218, N'Tuvalu', 0, 1, N'TUV')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (219, N'Taiwan, Province of China', 0, 1, N'TWN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (220, N'Tanzania, United Republic of', 0, 1, N'TZA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (221, N'Uganda', 0, 1, N'UGA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (222, N'Ukraine', 0, 1, N'UKR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (223, N'United States Minor Outlying Islands', 0, 1, N'UMI')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (224, N'Uruguay', 0, 1, N'URY')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (225, N'United States', -1, 1, N'USA')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (226, N'Uzbekistan', 0, 1, N'UZB')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (227, N'Holy See (Vatican City State)', 0, 1, N'VAT')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (228, N'Saint Vincent and the Grenadines', 0, 1, N'VCT')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (229, N'Venezuela', 0, 1, N'VEN')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (230, N'Virgin Islands, British', 0, 1, N'VGB')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (231, N'Virgin Islands, U.s.', 0, 1, N'VIR')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (232, N'Viet Nam', 0, 1, N'VNM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (233, N'Vanuatu', 0, 1, N'VUT')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (234, N'Wallis and Futuna', 0, 1, N'WLF')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (235, N'Samoa', 0, 1, N'WSM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (236, N'Yemen', 0, 1, N'YEM')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (237, N'South Africa', 0, 1, N'ZAF')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (238, N'Zambia', 0, 1, N'ZMB')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (239, N'Zimbabwe', 0, 1, N'ZWE')
INSERT INTO [dbo].[Country] ([CountryId], [Name], [Ordering], [Visible], [Code]) VALUES (240, N'Montenegro', 0, 1, N'MNE')
SET IDENTITY_INSERT [dbo].[Country] OFF
SET IDENTITY_INSERT [dbo].[StateProvince] ON
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (1, N'Alaska', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (2, N'Alabama', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (3, N'American Samoa', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (4, N'Arizona', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (5, N'Arkansas', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (6, N'California', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (7, N'Colorado', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (8, N'Connecticut', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (9, N'Delaware', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (10, N'District of Columbia', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (11, N'Federated States of Micronesia', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (12, N'Florida', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (13, N'Georgia', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (14, N'Guam', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (15, N'Hawaii', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (16, N'Idaho', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (17, N'Illinois', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (18, N'Indiana', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (19, N'Iowa', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (20, N'Kansas', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (21, N'Kentucky', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (22, N'Louisiana', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (23, N'Maine', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (24, N'Marshall Islands', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (25, N'Maryland', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (26, N'Massachusetts', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (27, N'Michigan', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (28, N'Minnesota', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (29, N'Mississippi', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (30, N'Missouri', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (31, N'Montana', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (32, N'Nebraska', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (33, N'Nevada', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (34, N'New Hampshire', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (35, N'New Jersey', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (36, N'New Mexico', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (37, N'New York', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (38, N'North Carolina', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (39, N'North Dakota', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (40, N'Northern Mariana Islands', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (41, N'Ohio', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (42, N'Oklahoma', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (43, N'Oregon', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (44, N'Palau', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (45, N'Pennsylvania', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (46, N'Puerto Rico', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (47, N'Rhode Island', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (48, N'South Carolina', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (49, N'South Dakota', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (50, N'Tennessee', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (51, N'Texas', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (52, N'Utah', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (53, N'Vermont', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (54, N'Virgin Islands', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (55, N'Virginia', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (56, N'Washington', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (57, N'West Virginia', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (58, N'Wisconsin', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (59, N'Wyoming', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (60, N'Armed Forces Africa', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (61, N'Armed Forces Americas (except Canada)', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (62, N'Armed Forces Canada', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (63, N'Armed Forces Europe', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (64, N'Armed Forces Middle East', 0, 1, 225)
INSERT INTO [dbo].[StateProvince] ([StateProvinceId], [Name], [Ordering], [Visible], [CountryId]) VALUES (65, N'Armed Forces Pacific', 0, 1, 225)
SET IDENTITY_INSERT [dbo].[StateProvince] OFF
INSERT INTO [dbo].[MarketLanguages] ([MarketId], [LanguageCode]) VALUES (N'DEFAULT', N'en')
INSERT INTO [dbo].[MarketPaymentMethods] ([MarketId], [PaymentMethodId]) VALUES (N'DEFAULT', N'3b1cd10d-0c22-4bf4-9fba-563a9c27605c')
INSERT INTO [dbo].[MarketPaymentMethods] ([MarketId], [PaymentMethodId]) VALUES (N'DEFAULT', N'4b6e692f-d6fb-4552-9439-3a39d2251316')
INSERT INTO [dbo].[MarketPaymentMethods] ([MarketId], [PaymentMethodId]) VALUES (N'DEFAULT', N'a6141930-df6c-48a7-8339-724ca005af52')
INSERT INTO [dbo].[MarketPaymentMethods] ([MarketId], [PaymentMethodId]) VALUES (N'DEFAULT', N'c1ba5772-5c6f-473d-a812-fde7a350c0cf')
INSERT INTO [dbo].[MarketPaymentMethods] ([MarketId], [PaymentMethodId]) VALUES (N'DEFAULT', N'c59b8070-07fb-4177-a458-0e992432ffa5')
INSERT INTO [dbo].[aspnet_UsersInRoles] ([UserId], [RoleId]) VALUES (N'45f3ed19-05b0-4bc9-97c4-9d323b0a8959', N'54fe9056-83ca-4b17-b80d-4037388f79a6')
INSERT INTO [dbo].[aspnet_UsersInRoles] ([UserId], [RoleId]) VALUES (N'45f3ed19-05b0-4bc9-97c4-9d323b0a8959', N'aeb9c440-b56f-4c2a-a1d9-710dad71ebc1')
INSERT INTO [dbo].[aspnet_UsersInRoles] ([UserId], [RoleId]) VALUES (N'45f3ed19-05b0-4bc9-97c4-9d323b0a8959', N'cd7d1b9c-5fe4-472d-88c3-c9c216e6eb0f')
INSERT INTO [dbo].[PriceType] ([PriceTypeId], [PriceTypeName]) VALUES (0, N'Default Price')
INSERT INTO [dbo].[PriceType] ([PriceTypeId], [PriceTypeName]) VALUES (1, N'Specific Customer')
INSERT INTO [dbo].[PriceType] ([PriceTypeId], [PriceTypeName]) VALUES (2, N'Customer Price Group')
SET IDENTITY_INSERT [dbo].[Warehouse] ON
INSERT INTO [dbo].[Warehouse] ([WarehouseId], [Name], [CreatorId], [Created], [ModifierId], [Modified], [IsActive], [IsPrimary], [SortOrder], [Code], [IsFulfillmentCenter], [IsPickupLocation], [IsDeliveryLocation], [FirstName], [LastName], [Organization], [Line1], [Line2], [City], [State], [CountryCode], [CountryName], [PostalCode], [RegionCode], [RegionName], [DaytimePhoneNumber], [EveningPhoneNumber], [FaxNumber], [Email]) VALUES (1, N'Default Warehouse', N'', '20131211 09:56:48.990', N'', '20131211 09:56:48.990', 1, 1, 0, N'default', 1, 1, 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL)
SET IDENTITY_INSERT [dbo].[Warehouse] OFF
INSERT INTO [dbo].[aspnet_Roles] ([ApplicationId], [LoweredRoleName], [RoleId], [RoleName], [Description]) VALUES (N'dae8247f-1940-4833-902d-d4a7cfc9d57f', N'administrators', N'aeb9c440-b56f-4c2a-a1d9-710dad71ebc1', N'Administrators', NULL)
INSERT INTO [dbo].[aspnet_Roles] ([ApplicationId], [LoweredRoleName], [RoleId], [RoleName], [Description]) VALUES (N'dae8247f-1940-4833-902d-d4a7cfc9d57f', N'webadmins', N'54fe9056-83ca-4b17-b80d-4037388f79a6', N'WebAdmins', NULL)
INSERT INTO [dbo].[aspnet_Roles] ([ApplicationId], [LoweredRoleName], [RoleId], [RoleName], [Description]) VALUES (N'dae8247f-1940-4833-902d-d4a7cfc9d57f', N'webeditors', N'cd7d1b9c-5fe4-472d-88c3-c9c216e6eb0f', N'WebEditors', NULL)
SET IDENTITY_INSERT [dbo].[Jurisdiction] ON
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (1, N'United States', N'', N'USA', 2, N'', N'', N'', N'', N'', N'', N'USA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (2, N'UK postcode - Aberdeen(AB)', NULL, N'GBR', 2, N'AB', NULL, NULL, NULL, NULL, NULL, N'GBR-AB')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (3, N'UK postcode - St Albans(AL)', NULL, N'GBR', 2, N'AL', NULL, NULL, NULL, NULL, NULL, N'GBR-AL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (4, N'UK postcode - Birmingham(B)', NULL, N'GBR', 2, N'B', NULL, NULL, NULL, NULL, NULL, N'GBR-B')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (5, N'UK postcode - Bath(BA)', NULL, N'GBR', 2, N'BA', NULL, NULL, NULL, NULL, NULL, N'GBR-BA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (6, N'UK postcode - Blackburn(BB)', NULL, N'GBR', 2, N'BB', NULL, NULL, NULL, NULL, NULL, N'GBR-BB')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (7, N'UK postcode - Bradford(BD)', NULL, N'GBR', 2, N'BD', NULL, NULL, NULL, NULL, NULL, N'GBR-BD')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (8, N'UK postcode - Bournemouth(BH)', NULL, N'GBR', 2, N'BH', NULL, NULL, NULL, NULL, NULL, N'GBR-BH')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (9, N'UK postcode - Bolton(BL)', NULL, N'GBR', 2, N'BL', NULL, NULL, NULL, NULL, NULL, N'GBR-BL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (10, N'UK postcode - Brighton(BN)', NULL, N'GBR', 2, N'BN', NULL, NULL, NULL, NULL, NULL, N'GBR-BN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (11, N'UK postcode - Bromley(BR)', NULL, N'GBR', 2, N'BR', NULL, NULL, NULL, NULL, NULL, N'GBR-BR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (12, N'UK postcode - Bristol(BS)', NULL, N'GBR', 2, N'BS', NULL, NULL, NULL, NULL, NULL, N'GBR-BS')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (13, N'UK postcode - Belfast(BT)', NULL, N'GBR', 2, N'BT', NULL, NULL, NULL, NULL, NULL, N'GBR-BT')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (14, N'UK postcode - Carlisle(CA)', NULL, N'GBR', 2, N'CA', NULL, NULL, NULL, NULL, NULL, N'GBR-CA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (15, N'UK postcode - Cambridge(CB)', NULL, N'GBR', 2, N'CB', NULL, NULL, NULL, NULL, NULL, N'GBR-CB')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (16, N'UK postcode - Cardiff(CF)', NULL, N'GBR', 2, N'CF', NULL, NULL, NULL, NULL, NULL, N'GBR-CF')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (17, N'UK postcode - Chester(CH)', NULL, N'GBR', 2, N'CH', NULL, NULL, NULL, NULL, NULL, N'GBR-CH')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (18, N'UK postcode - Chelmsford(CM)', NULL, N'GBR', 2, N'CM', NULL, NULL, NULL, NULL, NULL, N'GBR-CM')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (19, N'UK postcode - Colchester(CO)', NULL, N'GBR', 2, N'CO', NULL, NULL, NULL, NULL, NULL, N'GBR-CO')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (20, N'UK postcode - Croydon(CR)', NULL, N'GBR', 2, N'CR', NULL, NULL, NULL, NULL, NULL, N'GBR-CR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (21, N'UK postcode - Canterbury(CT)', NULL, N'GBR', 2, N'CT', NULL, NULL, NULL, NULL, NULL, N'GBR-CT')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (22, N'UK postcode - Coventry(CV)', NULL, N'GBR', 2, N'CV', NULL, NULL, NULL, NULL, NULL, N'GBR-CV')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (23, N'UK postcode - Crewe(CW)', NULL, N'GBR', 2, N'CW', NULL, NULL, NULL, NULL, NULL, N'GBR-CW')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (24, N'UK postcode - Dartford(DA)', NULL, N'GBR', 2, N'DA', NULL, NULL, NULL, NULL, NULL, N'GBR-DA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (25, N'UK postcode - Dundee(DD)', NULL, N'GBR', 2, N'DD', NULL, NULL, NULL, NULL, NULL, N'GBR-DD')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (26, N'UK postcode - Derby(DE)', NULL, N'GBR', 2, N'DE', NULL, NULL, NULL, NULL, NULL, N'GBR-DE')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (27, N'UK postcode - Dumfries(DG)', NULL, N'GBR', 2, N'DG', NULL, NULL, NULL, NULL, NULL, N'GBR-DG')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (28, N'UK postcode - Durham(DH)', NULL, N'GBR', 2, N'DH', NULL, NULL, NULL, NULL, NULL, N'GBR-DH')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (29, N'UK postcode - Darlington(DL)', NULL, N'GBR', 2, N'DL', NULL, NULL, NULL, NULL, NULL, N'GBR-DL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (30, N'UK postcode - Doncaster(DN)', NULL, N'GBR', 2, N'DN', NULL, NULL, NULL, NULL, NULL, N'GBR-DN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (31, N'UK postcode - Dorchester(DT)', NULL, N'GBR', 2, N'DT', NULL, NULL, NULL, NULL, NULL, N'GBR-DT')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (32, N'UK postcode - Dudley(DY)', NULL, N'GBR', 2, N'DY', NULL, NULL, NULL, NULL, NULL, N'GBR-DY')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (33, N'UK postcode - London E(E)', NULL, N'GBR', 2, N'E', NULL, NULL, NULL, NULL, NULL, N'GBR-E')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (34, N'UK postcode - London EC(EC)', NULL, N'GBR', 2, N'EC', NULL, NULL, NULL, NULL, NULL, N'GBR-EC')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (35, N'UK postcode - Edinburgh(EH)', NULL, N'GBR', 2, N'EH', NULL, NULL, NULL, NULL, NULL, N'GBR-EH')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (36, N'UK postcode - Enfield(EN)', NULL, N'GBR', 2, N'EN', NULL, NULL, NULL, NULL, NULL, N'GBR-EN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (37, N'UK postcode - Exeter(EX)', NULL, N'GBR', 2, N'EX', NULL, NULL, NULL, NULL, NULL, N'GBR-EX')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (38, N'UK postcode - Falkirk(FK)', NULL, N'GBR', 2, N'FK', NULL, NULL, NULL, NULL, NULL, N'GBR-FK')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (39, N'UK postcode - Blackpool(FY)', NULL, N'GBR', 2, N'FY', NULL, NULL, NULL, NULL, NULL, N'GBR-FY')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (40, N'UK postcode - Glasgow(G)', NULL, N'GBR', 2, N'G', NULL, NULL, NULL, NULL, NULL, N'GBR-G')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (41, N'UK postcode - Gloucester(GL)', NULL, N'GBR', 2, N'GL', NULL, NULL, NULL, NULL, NULL, N'GBR-GL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (42, N'UK postcode - Guildford(GU)', NULL, N'GBR', 2, N'GU', NULL, NULL, NULL, NULL, NULL, N'GBR-GU')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (43, N'UK postcode - Guernsey(GY)', NULL, N'GBR', 2, N'GY', NULL, NULL, NULL, NULL, NULL, N'GBR-GY')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (44, N'UK postcode - Harrow(HA)', NULL, N'GBR', 2, N'HA', NULL, NULL, NULL, NULL, NULL, N'GBR-HA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (45, N'UK postcode - Huddersfield(HD)', NULL, N'GBR', 2, N'HD', NULL, NULL, NULL, NULL, NULL, N'GBR-HD')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (46, N'UK postcode - Harrogate(HG)', NULL, N'GBR', 2, N'HG', NULL, NULL, NULL, NULL, NULL, N'GBR-HG')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (47, N'UK postcode - Hemel Hempstead(HP)', NULL, N'GBR', 2, N'HP', NULL, NULL, NULL, NULL, NULL, N'GBR-HP')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (48, N'UK postcode - Hereford(HR)', NULL, N'GBR', 2, N'HR', NULL, NULL, NULL, NULL, NULL, N'GBR-HR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (49, N'UK postcode - Outer Hebride(HS)', NULL, N'GBR', 2, N'HS', NULL, NULL, NULL, NULL, NULL, N'GBR-HS')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (50, N'UK postcode - Hull(HU)', NULL, N'GBR', 2, N'HU', NULL, NULL, NULL, NULL, NULL, N'GBR-HU')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (51, N'UK postcode - Halifax(HX)', NULL, N'GBR', 2, N'HX', NULL, NULL, NULL, NULL, NULL, N'GBR-HX')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (52, N'UK postcode - Ilfor(IG)', NULL, N'GBR', 2, N'IG', NULL, NULL, NULL, NULL, NULL, N'GBR-IG')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (53, N'UK postcode - Isle of Man(IM)', NULL, N'GBR', 2, N'IM', NULL, NULL, NULL, NULL, NULL, N'GBR-IM')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (54, N'UK postcode - Ipswich(IP)', NULL, N'GBR', 2, N'IP', NULL, NULL, NULL, NULL, NULL, N'GBR-IP')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (55, N'UK postcode - Inverness(IV)', NULL, N'GBR', 2, N'IV', NULL, NULL, NULL, NULL, NULL, N'GBR-IV')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (56, N'UK postcode - Morayshire(IV3-IV24)', NULL, N'GBR', 2, N'IV3', N'IV24', NULL, NULL, NULL, NULL, N'GBR-IV3')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (57, N'UK postcode - Morayshire(IV26-IV99)', NULL, N'GBR', 2, N'IV26', N'IV99', NULL, NULL, NULL, NULL, N'GBR-IV26')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (58, N'UK postcode - Jersey(JE)', NULL, N'GBR', 2, N'JE', NULL, NULL, NULL, NULL, NULL, N'GBR-JE')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (59, N'UK postcode - Kilmarnock(KA)', NULL, N'GBR', 2, N'KA', NULL, NULL, NULL, NULL, NULL, N'GBR-KA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (60, N'UK postcode - Brodwick & Millport(KA27-KA28)', NULL, N'GBR', 2, N'KA27', N'KA28', NULL, NULL, NULL, NULL, N'GBR-KA27')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (61, N'UK postcode - Kingston upon Thames(KT)', NULL, N'GBR', 2, N'KT', NULL, NULL, NULL, NULL, NULL, N'GBR-KT')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (62, N'UK postcode - Kirkwall(KW)', NULL, N'GBR', 2, N'KW', NULL, NULL, NULL, NULL, NULL, N'GBR-KW')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (63, N'UK postcode - Orkney(KW1-KW17)', NULL, N'GBR', 2, N'KW1', N'KW17', NULL, NULL, NULL, NULL, N'GBR-KW1')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (64, N'UK postcode - Kirkcaldy(KY)', NULL, N'GBR', 2, N'KY', NULL, NULL, NULL, NULL, NULL, N'GBR-KY')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (65, N'UK postcode - Liverpool(L)', NULL, N'GBR', 2, N'L', NULL, NULL, NULL, NULL, NULL, N'GBR-L')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (66, N'UK postcode - Lancaster(LA)', NULL, N'GBR', 2, N'LA', NULL, NULL, NULL, NULL, NULL, N'GBR-LA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (67, N'UK postcode - Llandrindod Well(LD)', NULL, N'GBR', 2, N'LD', NULL, NULL, NULL, NULL, NULL, N'GBR-LD')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (68, N'UK postcode - Leicester(LE)', NULL, N'GBR', 2, N'LE', NULL, NULL, NULL, NULL, NULL, N'GBR-LE')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (69, N'UK postcode - Llandudno(LL)', NULL, N'GBR', 2, N'LL', NULL, NULL, NULL, NULL, NULL, N'GBR-LL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (70, N'UK postcode - Lincoln(LN)', NULL, N'GBR', 2, N'LN', NULL, NULL, NULL, NULL, NULL, N'GBR-LN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (71, N'UK postcode - Leeds(LS)', NULL, N'GBR', 2, N'LS', NULL, NULL, NULL, NULL, NULL, N'GBR-LS')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (72, N'UK postcode - Luton(LU)', NULL, N'GBR', 2, N'LU', NULL, NULL, NULL, NULL, NULL, N'GBR-LU')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (73, N'UK postcode - Manchester(M)', NULL, N'GBR', 2, N'M', NULL, NULL, NULL, NULL, NULL, N'GBR-M')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (74, N'UK postcode - Rochester(ME)', NULL, N'GBR', 2, N'ME', NULL, NULL, NULL, NULL, NULL, N'GBR-ME')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (75, N'UK postcode - Milton Keynes(MK)', NULL, N'GBR', 2, N'MK', NULL, NULL, NULL, NULL, NULL, N'GBR-MK')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (76, N'UK postcode - Motherwell(ML)', NULL, N'GBR', 2, N'ML', NULL, NULL, NULL, NULL, NULL, N'GBR-ML')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (77, N'UK postcode - London N(N)', NULL, N'GBR', 2, N'N', NULL, NULL, NULL, NULL, NULL, N'GBR-N')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (78, N'UK postcode - Newcastle upon Tyne(NE)', NULL, N'GBR', 2, N'NE', NULL, NULL, NULL, NULL, NULL, N'GBR-NE')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (79, N'UK postcode - Nottingham(NG)', NULL, N'GBR', 2, N'NG', NULL, NULL, NULL, NULL, NULL, N'GBR-NG')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (80, N'UK postcode - Northampton(NN)', NULL, N'GBR', 2, N'NN', NULL, NULL, NULL, NULL, NULL, N'GBR-NN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (81, N'UK postcode - Newport(NP)', NULL, N'GBR', 2, N'NP', NULL, NULL, NULL, NULL, NULL, N'GBR-NP')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (82, N'UK postcode - Norwich(NR)', NULL, N'GBR', 2, N'NR', NULL, NULL, NULL, NULL, NULL, N'GBR-NR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (83, N'UK postcode - London NW(NW)', NULL, N'GBR', 2, N'NW', NULL, NULL, NULL, NULL, NULL, N'GBR-NW')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (84, N'UK postcode - Oldham(OL)', NULL, N'GBR', 2, N'OL', NULL, NULL, NULL, NULL, NULL, N'GBR-OL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (85, N'UK postcode - Oxford(OX)', NULL, N'GBR', 2, N'OX', NULL, NULL, NULL, NULL, NULL, N'GBR-OX')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (86, N'UK postcode - Paisley(PA)', NULL, N'GBR', 2, N'PA', NULL, NULL, NULL, NULL, NULL, N'GBR-PA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (87, N'UK postcode - Argyll(PA20-PA99)', NULL, N'GBR', 2, N'PA20', N'PA99', NULL, NULL, NULL, NULL, N'GBR-PA20')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (88, N'UK postcode - Peterborough(PE)', NULL, N'GBR', 2, N'PE', NULL, NULL, NULL, NULL, NULL, N'GBR-PE')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (89, N'UK postcode - Perth(PH)', NULL, N'GBR', 2, N'PH', NULL, NULL, NULL, NULL, NULL, N'GBR-PH')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (90, N'UK postcode - Inverness-Shire(PH19-PH44)', NULL, N'GBR', 2, N'PH19', N'PH44', NULL, NULL, NULL, NULL, N'GBR-PH19')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (91, N'UK postcode - Plymouth(PL)', NULL, N'GBR', 2, N'PL', NULL, NULL, NULL, NULL, NULL, N'GBR-PL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (92, N'UK postcode - Portsmouth(PO)', NULL, N'GBR', 2, N'PO', NULL, NULL, NULL, NULL, NULL, N'GBR-PO')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (93, N'UK postcode - Preston(PR)', NULL, N'GBR', 2, N'PR', NULL, NULL, NULL, NULL, NULL, N'GBR-PR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (94, N'UK postcode - Reading(RG)', NULL, N'GBR', 2, N'RG', NULL, NULL, NULL, NULL, NULL, N'GBR-RG')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (95, N'UK postcode - Redhill(RH)', NULL, N'GBR', 2, N'RH', NULL, NULL, NULL, NULL, NULL, N'GBR-RH')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (96, N'UK postcode - Romford(RM)', NULL, N'GBR', 2, N'RM', NULL, NULL, NULL, NULL, NULL, N'GBR-RM')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (97, N'UK postcode - Sheffield(S)', NULL, N'GBR', 2, N'S', NULL, NULL, NULL, NULL, NULL, N'GBR-S')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (98, N'UK postcode - Swansea(SA)', NULL, N'GBR', 2, N'SA', NULL, NULL, NULL, NULL, NULL, N'GBR-SA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (99, N'UK postcode - London SE(SE)', NULL, N'GBR', 2, N'SE', NULL, NULL, NULL, NULL, NULL, N'GBR-SE')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (100, N'UK postcode - Stevenage(SG)', NULL, N'GBR', 2, N'SG', NULL, NULL, NULL, NULL, NULL, N'GBR-SG')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (101, N'UK postcode - Stockport(SK)', NULL, N'GBR', 2, N'SK', NULL, NULL, NULL, NULL, NULL, N'GBR-SK')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (102, N'UK postcode - Slough(SL)', NULL, N'GBR', 2, N'SL', NULL, NULL, NULL, NULL, NULL, N'GBR-SL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (103, N'UK postcode - Sutto(SM)', NULL, N'GBR', 2, N'SM', NULL, NULL, NULL, NULL, NULL, N'GBR-SM')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (104, N'UK postcode - Swindon(SN)', NULL, N'GBR', 2, N'SN', NULL, NULL, NULL, NULL, NULL, N'GBR-SN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (105, N'UK postcode - Southampton(SO)', NULL, N'GBR', 2, N'SO', NULL, NULL, NULL, NULL, NULL, N'GBR-SO')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (106, N'UK postcode - Salisbury(SP)', NULL, N'GBR', 2, N'SP', NULL, NULL, NULL, NULL, NULL, N'GBR-SP')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (107, N'UK postcode - Sunderland(SR)', NULL, N'GBR', 2, N'SR', NULL, NULL, NULL, NULL, NULL, N'GBR-SR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (108, N'UK postcode - Southend on Sea(SS)', NULL, N'GBR', 2, N'SS', NULL, NULL, NULL, NULL, NULL, N'GBR-SS')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (109, N'UK postcode - Stoke-on-Trent(ST)', NULL, N'GBR', 2, N'ST', NULL, NULL, NULL, NULL, NULL, N'GBR-ST')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (110, N'UK postcode - London SW(SW)', NULL, N'GBR', 2, N'SW', NULL, NULL, NULL, NULL, NULL, N'GBR-SW')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (111, N'UK postcode - Shrewsbury(SY)', NULL, N'GBR', 2, N'SY', NULL, NULL, NULL, NULL, NULL, N'GBR-SY')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (112, N'UK postcode - Taunton(TA)', NULL, N'GBR', 2, N'TA', NULL, NULL, NULL, NULL, NULL, N'GBR-TA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (113, N'UK postcode - Galashiels(TD)', NULL, N'GBR', 2, N'TD', NULL, NULL, NULL, NULL, NULL, N'GBR-TD')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (114, N'UK postcode - Telford(TF)', NULL, N'GBR', 2, N'TF', NULL, NULL, NULL, NULL, NULL, N'GBR-TF')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (115, N'UK postcode - Tonbridge(TN)', NULL, N'GBR', 2, N'TN', NULL, NULL, NULL, NULL, NULL, N'GBR-TN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (116, N'UK postcode - Torquay(TQ)', NULL, N'GBR', 2, N'TQ', NULL, NULL, NULL, NULL, NULL, N'GBR-TQ')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (117, N'UK postcode - Truro(TR)', NULL, N'GBR', 2, N'TR', NULL, NULL, NULL, NULL, NULL, N'GBR-TR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (118, N'UK postcode - Truro(TR2-TR25)', NULL, N'GBR', 2, N'TR2', N'TR25', NULL, NULL, NULL, NULL, N'GBR-TR2')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (119, N'UK postcode - Cleveland(TS)', NULL, N'GBR', 2, N'TS', NULL, NULL, NULL, NULL, NULL, N'GBR-TS')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (120, N'UK postcode - Twickenham(TW)', NULL, N'GBR', 2, N'TW', NULL, NULL, NULL, NULL, NULL, N'GBR-TW')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (121, N'UK postcode - Southall(UB)', NULL, N'GBR', 2, N'UB', NULL, NULL, NULL, NULL, NULL, N'GBR-UB')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (122, N'UK postcode - London W(W)', NULL, N'GBR', 2, N'W', NULL, NULL, NULL, NULL, NULL, N'GBR-W')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (123, N'UK postcode - Warrington(WA)', NULL, N'GBR', 2, N'WA', NULL, NULL, NULL, NULL, NULL, N'GBR-WA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (124, N'UK postcode - London WC(WC)', NULL, N'GBR', 2, N'WC', NULL, NULL, NULL, NULL, NULL, N'GBR-WC')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (125, N'UK postcode - Watford(WD)', NULL, N'GBR', 2, N'WD', NULL, NULL, NULL, NULL, NULL, N'GBR-WD')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (126, N'UK postcode - Wakefield(WF)', NULL, N'GBR', 2, N'WF', NULL, NULL, NULL, NULL, NULL, N'GBR-WF')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (127, N'UK postcode - Wigan(WN)', NULL, N'GBR', 2, N'WN', NULL, NULL, NULL, NULL, NULL, N'GBR-WN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (128, N'UK postcode - Worcester(WR)', NULL, N'GBR', 2, N'WR', NULL, NULL, NULL, NULL, NULL, N'GBR-WR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (129, N'UK postcode - Walsall(WS)', NULL, N'GBR', 2, N'WS', NULL, NULL, NULL, NULL, NULL, N'GBR-WS')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (130, N'UK postcode - Wolverhampton(WV)', NULL, N'GBR', 2, N'WV', NULL, NULL, NULL, NULL, NULL, N'GBR-WV')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (131, N'UK postcode - York(YO)', NULL, N'GBR', 2, N'YO', NULL, NULL, NULL, NULL, NULL, N'GBR-YO')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (132, N'UK postcode - Lerwick(ZE)', NULL, N'GBR', 2, N'ZE', NULL, NULL, NULL, NULL, NULL, N'GBR-ZE')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (133, N'Country - Afghanistan(AFG)', NULL, N'AFG', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'AFG')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (134, N'Country - Aland Islands(ALA)', NULL, N'ALA', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'ALA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (135, N'Country - Albania(ALB)', NULL, N'ALB', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'ALB')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (136, N'Country - Algeria(DZA)', NULL, N'DZA', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'DZA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (137, N'Country - American Samoa(ASM)', NULL, N'ASM', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'ASM')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (138, N'Country - Andorra(AND)', NULL, N'AND', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'AND')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (139, N'Country - Angola(AGO)', NULL, N'AGO', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'AGO')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (140, N'Country - Anguilla(AIA)', NULL, N'AIA', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'AIA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (141, N'Country - Antarctica(ATA)', NULL, N'ATA', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'ATA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (142, N'Country - Antigua and Barbuda(ATG)', NULL, N'ATG', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'ATG')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (143, N'Country - Argentina(ARG)', NULL, N'ARG', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'ARG')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (144, N'Country - Armenia(ARM)', NULL, N'ARM', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'ARM')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (145, N'Country - Aruba(ABW)', NULL, N'ABW', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'ABW')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (146, N'Country - Australia(AUS)', NULL, N'AUS', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'AUS')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (147, N'Country - Austria(AUT)', NULL, N'AUT', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'AUT')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (148, N'Country - Azerbaijan(AZE)', NULL, N'AZE', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'AZE')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (149, N'Country - Bahamas(BHS)', NULL, N'BHS', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BHS')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (150, N'Country - Bahrain(BHR)', NULL, N'BHR', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BHR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (151, N'Country - Bangladesh(BGD)', NULL, N'BGD', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BGD')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (152, N'Country - Barbados(BRB)', NULL, N'BRB', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BRB')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (153, N'Country - Belarus(BLR)', NULL, N'BLR', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BLR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (154, N'Country - Belgium(BEL)', NULL, N'BEL', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BEL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (155, N'Country - Belize(BLZ)', NULL, N'BLZ', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BLZ')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (156, N'Country - Benin(BEN)', NULL, N'BEN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BEN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (157, N'Country - Bermuda(BMU)', NULL, N'BMU', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BMU')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (158, N'Country - Bhutan(BTN)', NULL, N'BTN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BTN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (159, N'Country - Bolivia(BOL)', NULL, N'BOL', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BOL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (160, N'Country - Bosnia and Herzegovina(BIH)', NULL, N'BIH', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BIH')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (161, N'Country - Botswana(BWA)', NULL, N'BWA', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BWA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (162, N'Country - Bouvet Island(BVT)', NULL, N'BVT', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BVT')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (163, N'Country - Brazil(BRA)', NULL, N'BRA', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BRA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (164, N'Country - British Virgin Islands(VGB)', NULL, N'VGB', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'VGB')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (165, N'Country - British Indian Ocean Territory(IOT)', NULL, N'IOT', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'IOT')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (166, N'Country - Brunei Darussalam(BRN)', NULL, N'BRN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BRN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (167, N'Country - Bulgaria(BGR)', NULL, N'BGR', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BGR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (168, N'Country - Burkina Faso(BFA)', NULL, N'BFA', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BFA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (169, N'Country - Burundi(BDI)', NULL, N'BDI', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BDI')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (170, N'Country - Cambodia(KHM)', NULL, N'KHM', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'KHM')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (171, N'Country - Cameroon(CMR)', NULL, N'CMR', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'CMR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (172, N'Country - Canada(CAN)', NULL, N'CAN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'CAN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (173, N'Country - Cape Verde(CPV)', NULL, N'CPV', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'CPV')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (174, N'Country - Cayman Islands(CYM)', NULL, N'CYM', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'CYM')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (175, N'Country - Central African Republic(CAF)', NULL, N'CAF', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'CAF')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (176, N'Country - Chad(TCD)', NULL, N'TCD', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'TCD')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (177, N'Country - Chile(CHL)', NULL, N'CHL', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'CHL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (178, N'Country - China(CHN)', NULL, N'CHN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'CHN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (179, N'Country - Hong Kong Special Administrative Region of China(HKG)', NULL, N'HKG', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'HKG')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (180, N'Country - Macao Special Administrative Region of China(MAC)', NULL, N'MAC', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MAC')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (181, N'Country - Christmas Island(CXR)', NULL, N'CXR', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'CXR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (182, N'Country - Cocos (Keeling) Islands(CCK)', NULL, N'CCK', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'CCK')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (183, N'Country - Colombia(COL)', NULL, N'COL', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'COL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (184, N'Country - Comoros(COM)', NULL, N'COM', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'COM')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (185, N'Country - Congo (Brazzaville)(COG)', NULL, N'COG', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'COG')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (186, N'Country - Congo, Democratic Republic of the(COD)', NULL, N'COD', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'COD')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (187, N'Country - Cook Islands(COK)', NULL, N'COK', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'COK')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (188, N'Country - Costa Rica(CRI)', NULL, N'CRI', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'CRI')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (189, N'Country - Cte d''Ivoire(CIV)', NULL, N'CIV', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'CIV')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (190, N'Country - Croatia(HRV)', NULL, N'HRV', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'HRV')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (191, N'Country - Cuba(CUB)', NULL, N'CUB', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'CUB')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (192, N'Country - Cyprus(CYP)', NULL, N'CYP', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'CYP')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (193, N'Country - Czech Republic(CZE)', NULL, N'CZE', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'CZE')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (194, N'Country - Denmark(DNK)', NULL, N'DNK', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'DNK')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (195, N'Country - Djibouti(DJI)', NULL, N'DJI', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'DJI')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (196, N'Country - Dominica(DMA)', NULL, N'DMA', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'DMA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (197, N'Country - Dominican Republic(DOM)', NULL, N'DOM', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'DOM')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (198, N'Country - Ecuador(ECU)', NULL, N'ECU', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'ECU')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (199, N'Country - Egypt(EGY)', NULL, N'EGY', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'EGY')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (200, N'Country - El Salvador(SLV)', NULL, N'SLV', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'SLV')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (201, N'Country - Equatorial Guinea(GNQ)', NULL, N'GNQ', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'GNQ')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (202, N'Country - Eritrea(ERI)', NULL, N'ERI', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'ERI')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (203, N'Country - Estonia(EST)', NULL, N'EST', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'EST')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (204, N'Country - Ethiopia(ETH)', NULL, N'ETH', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'ETH')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (205, N'Country - Falkland Islands (Malvinas)(FLK)', NULL, N'FLK', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'FLK')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (206, N'Country - Faroe Islands(FRO)', NULL, N'FRO', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'FRO')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (207, N'Country - Fiji(FJI)', NULL, N'FJI', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'FJI')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (208, N'Country - Finland(FIN)', NULL, N'FIN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'FIN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (209, N'Country - France(FRA)', NULL, N'FRA', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'FRA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (210, N'Country - French Guiana(GUF)', NULL, N'GUF', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'GUF')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (211, N'Country - French Polynesia(PYF)', NULL, N'PYF', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'PYF')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (212, N'Country - French Southern Territories(ATF)', NULL, N'ATF', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'ATF')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (213, N'Country - Gabon(GAB)', NULL, N'GAB', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'GAB')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (214, N'Country - Gambia(GMB)', NULL, N'GMB', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'GMB')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (215, N'Country - Georgia(GEO)', NULL, N'GEO', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'GEO')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (216, N'Country - Germany(DEU)', NULL, N'DEU', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'DEU')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (217, N'Country - Ghana(GHA)', NULL, N'GHA', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'GHA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (218, N'Country - Gibraltar(GIB)', NULL, N'GIB', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'GIB')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (219, N'Country - Greece(GRC)', NULL, N'GRC', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'GRC')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (220, N'Country - Greenland(GRL)', NULL, N'GRL', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'GRL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (221, N'Country - Grenada(GRD)', NULL, N'GRD', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'GRD')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (222, N'Country - Guadeloupe(GLP)', NULL, N'GLP', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'GLP')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (223, N'Country - Guam(GUM)', NULL, N'GUM', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'GUM')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (224, N'Country - Guatemala(GTM)', NULL, N'GTM', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'GTM')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (225, N'Country - Guernsey(GGY)', NULL, N'GGY', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'GGY')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (226, N'Country - Guinea(GIN)', NULL, N'GIN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'GIN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (227, N'Country - Guinea-Bissau(GNB)', NULL, N'GNB', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'GNB')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (228, N'Country - Guyana(GUY)', NULL, N'GUY', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'GUY')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (229, N'Country - Haiti(HTI)', NULL, N'HTI', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'HTI')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (230, N'Country - Heard Island and Mcdonald Islands(HMD)', NULL, N'HMD', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'HMD')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (231, N'Country - Holy See (Vatican City State)(VAT)', NULL, N'VAT', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'VAT')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (232, N'Country - Honduras(HND)', NULL, N'HND', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'HND')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (233, N'Country - Hungary(HUN)', NULL, N'HUN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'HUN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (234, N'Country - Iceland(ISL)', NULL, N'ISL', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'ISL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (235, N'Country - India(IND)', NULL, N'IND', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'IND')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (236, N'Country - Indonesia(IDN)', NULL, N'IDN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'IDN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (237, N'Country - Iran, Islamic Republic of(IRN)', NULL, N'IRN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'IRN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (238, N'Country - Iraq(IRQ)', NULL, N'IRQ', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'IRQ')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (239, N'Country - Ireland(IRL)', NULL, N'IRL', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'IRL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (240, N'Country - Isle of Man(IMN)', NULL, N'IMN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'IMN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (241, N'Country - Israel(ISR)', NULL, N'ISR', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'ISR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (242, N'Country - Italy(ITA)', NULL, N'ITA', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'ITA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (243, N'Country - Jamaica(JAM)', NULL, N'JAM', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'JAM')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (244, N'Country - Japan(JPN)', NULL, N'JPN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'JPN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (245, N'Country - Jersey(JEY)', NULL, N'JEY', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'JEY')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (246, N'Country - Jordan(JOR)', NULL, N'JOR', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'JOR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (247, N'Country - Kazakhstan(KAZ)', NULL, N'KAZ', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'KAZ')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (248, N'Country - Kenya(KEN)', NULL, N'KEN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'KEN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (249, N'Country - Kiribati(KIR)', NULL, N'KIR', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'KIR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (250, N'Country - Korea, Democratic People''s Republic of(PRK)', NULL, N'PRK', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'PRK')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (251, N'Country - Korea, Republic of(KOR)', NULL, N'KOR', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'KOR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (252, N'Country - Kuwait(KWT)', NULL, N'KWT', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'KWT')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (253, N'Country - Kyrgyzstan(KGZ)', NULL, N'KGZ', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'KGZ')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (254, N'Country - Lao PDR(LAO)', NULL, N'LAO', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'LAO')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (255, N'Country - Latvia(LVA)', NULL, N'LVA', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'LVA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (256, N'Country - Lebanon(LBN)', NULL, N'LBN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'LBN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (257, N'Country - Lesotho(LSO)', NULL, N'LSO', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'LSO')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (258, N'Country - Liberia(LBR)', NULL, N'LBR', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'LBR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (259, N'Country - Libyan Arab Jamahiriya(LBY)', NULL, N'LBY', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'LBY')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (260, N'Country - Liechtenstein(LIE)', NULL, N'LIE', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'LIE')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (261, N'Country - Lithuania(LTU)', NULL, N'LTU', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'LTU')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (262, N'Country - Luxembourg(LUX)', NULL, N'LUX', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'LUX')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (263, N'Country - Macedonia, Republic of(MKD)', NULL, N'MKD', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MKD')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (264, N'Country - Madagascar(MDG)', NULL, N'MDG', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MDG')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (265, N'Country - Malawi(MWI)', NULL, N'MWI', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MWI')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (266, N'Country - Malaysia(MYS)', NULL, N'MYS', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MYS')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (267, N'Country - Maldives(MDV)', NULL, N'MDV', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MDV')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (268, N'Country - Mali(MLI)', NULL, N'MLI', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MLI')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (269, N'Country - Malta(MLT)', NULL, N'MLT', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MLT')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (270, N'Country - Marshall Islands(MHL)', NULL, N'MHL', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MHL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (271, N'Country - Martinique(MTQ)', NULL, N'MTQ', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MTQ')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (272, N'Country - Mauritania(MRT)', NULL, N'MRT', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MRT')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (273, N'Country - Mauritius(MUS)', NULL, N'MUS', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MUS')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (274, N'Country - Mayotte(MYT)', NULL, N'MYT', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MYT')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (275, N'Country - Mexico(MEX)', NULL, N'MEX', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MEX')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (276, N'Country - Micronesia, Federated States of(FSM)', NULL, N'FSM', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'FSM')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (277, N'Country - Moldova(MDA)', NULL, N'MDA', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MDA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (278, N'Country - Monaco(MCO)', NULL, N'MCO', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MCO')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (279, N'Country - Mongolia(MNG)', NULL, N'MNG', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MNG')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (280, N'Country - Montenegro(MNE)', NULL, N'MNE', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MNE')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (281, N'Country - Montserrat(MSR)', NULL, N'MSR', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MSR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (282, N'Country - Morocco(MAR)', NULL, N'MAR', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MAR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (283, N'Country - Mozambique(MOZ)', NULL, N'MOZ', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MOZ')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (284, N'Country - Myanmar(MMR)', NULL, N'MMR', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MMR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (285, N'Country - Namibia(NAM)', NULL, N'NAM', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'NAM')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (286, N'Country - Nauru(NRU)', NULL, N'NRU', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'NRU')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (287, N'Country - Nepal(NPL)', NULL, N'NPL', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'NPL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (288, N'Country - Netherlands(NLD)', NULL, N'NLD', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'NLD')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (289, N'Country - Netherlands Antilles(ANT)', NULL, N'ANT', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'ANT')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (290, N'Country - New Caledonia(NCL)', NULL, N'NCL', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'NCL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (291, N'Country - New Zealand(NZL)', NULL, N'NZL', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'NZL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (292, N'Country - Nicaragua(NIC)', NULL, N'NIC', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'NIC')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (293, N'Country - Niger(NER)', NULL, N'NER', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'NER')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (294, N'Country - Nigeria(NGA)', NULL, N'NGA', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'NGA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (295, N'Country - Niue(NIU)', NULL, N'NIU', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'NIU')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (296, N'Country - Norfolk Island(NFK)', NULL, N'NFK', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'NFK')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (297, N'Country - Northern Mariana Islands(MNP)', NULL, N'MNP', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MNP')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (298, N'Country - Norway(NOR)', NULL, N'NOR', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'NOR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (299, N'Country - Oman(OMN)', NULL, N'OMN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'OMN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (300, N'Country - Pakistan(PAK)', NULL, N'PAK', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'PAK')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (301, N'Country - Palau(PLW)', NULL, N'PLW', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'PLW')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (302, N'Country - Palestinian Territory, Occupied(PSE)', NULL, N'PSE', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'PSE')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (303, N'Country - Panama(PAN)', NULL, N'PAN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'PAN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (304, N'Country - Papua New Guinea(PNG)', NULL, N'PNG', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'PNG')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (305, N'Country - Paraguay(PRY)', NULL, N'PRY', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'PRY')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (306, N'Country - Peru(PER)', NULL, N'PER', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'PER')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (307, N'Country - Philippines(PHL)', NULL, N'PHL', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'PHL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (308, N'Country - Pitcairn(PCN)', NULL, N'PCN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'PCN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (309, N'Country - Poland(POL)', NULL, N'POL', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'POL')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (310, N'Country - Portugal(PRT)', NULL, N'PRT', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'PRT')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (311, N'Country - Puerto Rico(PRI)', NULL, N'PRI', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'PRI')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (312, N'Country - Qatar(QAT)', NULL, N'QAT', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'QAT')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (313, N'Country - Runion(REU)', NULL, N'REU', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'REU')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (314, N'Country - Romania(ROU)', NULL, N'ROU', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'ROU')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (315, N'Country - Russian Federation(RUS)', NULL, N'RUS', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'RUS')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (316, N'Country - Rwanda(RWA)', NULL, N'RWA', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'RWA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (317, N'Country - Saint-Barthlemy(BLM)', NULL, N'BLM', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'BLM')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (318, N'Country - Saint Helena(SHN)', NULL, N'SHN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'SHN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (319, N'Country - Saint Kitts and Nevis(KNA)', NULL, N'KNA', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'KNA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (320, N'Country - Saint Lucia(LCA)', NULL, N'LCA', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'LCA')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (321, N'Country - Saint-Martin (French part)(MAF)', NULL, N'MAF', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'MAF')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (322, N'Country - Saint Pierre and Miquelon(SPM)', NULL, N'SPM', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'SPM')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (323, N'Country - Saint Vincent and Grenadines(VCT)', NULL, N'VCT', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'VCT')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (324, N'Country - Samoa(WSM)', NULL, N'WSM', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'WSM')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (325, N'Country - San Marino(SMR)', NULL, N'SMR', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'SMR')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (326, N'Country - Sao Tome and Principe(STP)', NULL, N'STP', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'STP')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (327, N'Country - Saudi Arabia(SAU)', NULL, N'SAU', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'SAU')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (328, N'Country - Senegal(SEN)', NULL, N'SEN', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'SEN')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (329, N'Country - Serbia(SRB)', NULL, N'SRB', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'SRB')
INSERT INTO [dbo].[Jurisdiction] ([JurisdictionId], [DisplayName], [StateProvinceCode], [CountryCode], [JurisdictionType], [ZipPostalCodeStart], [ZipPostalCodeEnd], [City], [District], [County], [GeoCode], [Code]) VALUES (330, N'Country - Seychelles(SYC)', NULL, N'SYC', 2, NULL, NULL, NULL, NULL, NULL, NULL, N'SYC')
SET IDENTITY_INSERT [dbo].[Jurisdiction] OFF
INSERT INTO [dbo].[JurisdictionRelation] ([JurisdictionId], [JurisdictionGroupId]) VALUES (1, 1)
INSERT INTO [dbo].[AssociationType] ([AssociationTypeId], [Description]) VALUES (N'OPTIONAL', N'Optional')
INSERT INTO [dbo].[AssociationType] ([AssociationTypeId], [Description]) VALUES (N'REQUIRED', N'Required')
INSERT INTO [dbo].[Application] ([Name], [IsActive]) VALUES (N'ECApplication', 1)
INSERT INTO [dbo].[ShippingMethod] ([ShippingMethodId], [ShippingOptionId], [LanguageId], [IsActive], [Name], [Description], [BasePrice], [Currency], [DisplayName], [IsDefault], [Ordering], [Created], [Modified]) VALUES (N'1d77f587-ca7b-4090-92f3-19cdac7f6cf2', N'8826e08e-636d-4962-8607-dbf80fe1945c', N'en', 1, N'Default Shipping', N'Calculates shipping based on weight and zone.', 2.0000, N'USD', N'Ground Shipping', 1, 0, '20081007 18:21:37.000', '20081008 20:27:44.000')
INSERT INTO [dbo].[ShippingMethod] ([ShippingMethodId], [ShippingOptionId], [LanguageId], [IsActive], [Name], [Description], [BasePrice], [Currency], [DisplayName], [IsDefault], [Ordering], [Created], [Modified]) VALUES (N'43cf66b4-8940-4c95-9b87-97ae8bf44cbd', N'18ede71f-3df3-4d9e-a4cb-3d25881c1ec6', N'en', 1, N'Online Download', NULL, 10.0000, N'USD', N'Fixed Shipping Rate', 0, 0, '20070101 00:00:00.000', '20070101 00:00:00.000')
INSERT INTO [dbo].[ShippingMethod] ([ShippingMethodId], [ShippingOptionId], [LanguageId], [IsActive], [Name], [Description], [BasePrice], [Currency], [DisplayName], [IsDefault], [Ordering], [Created], [Modified]) VALUES (N'dade7f46-646b-4a16-9226-4e574c8c79e6', N'18ede71f-3df3-4d9e-a4cb-3d25881c1ec6', N'en', 1, N'In Store Pickup', NULL, 0.0000, N'USD', N'In Store Pickup', 0, 0, '20130417 10:11:32.000', '20130417 10:11:32.000')
INSERT INTO [dbo].[MarketShippingMethods] ([MarketId], [ShippingMethodId]) VALUES (N'DEFAULT', N'1d77f587-ca7b-4090-92f3-19cdac7f6cf2')
INSERT INTO [dbo].[MarketShippingMethods] ([MarketId], [ShippingMethodId]) VALUES (N'DEFAULT', N'43cf66b4-8940-4c95-9b87-97ae8bf44cbd')
INSERT INTO [dbo].[MarketShippingMethods] ([MarketId], [ShippingMethodId]) VALUES (N'DEFAULT', N'dade7f46-646b-4a16-9226-4e574c8c79e6')
SET IDENTITY_INSERT [dbo].[JurisdictionGroup] ON
INSERT INTO [dbo].[JurisdictionGroup] ([JurisdictionGroupId], [DisplayName], [JurisdictionType], [Code]) VALUES (1, N'United States', 2, N'USA')
SET IDENTITY_INSERT [dbo].[JurisdictionGroup] OFF
SET IDENTITY_INSERT [dbo].[CurrencyRate] ON
INSERT INTO [dbo].[CurrencyRate] ([CurrencyRateId], [AverageRate], [EndOfDayRate], [ModifiedDate], [FromCurrencyId], [ToCurrencyId], [CurrencyRateDate]) VALUES (1, 0.9597, 0.9597, '20131211 08:56:55.210', 1, 23, '20131211 09:56:55.187')
INSERT INTO [dbo].[CurrencyRate] ([CurrencyRateId], [AverageRate], [EndOfDayRate], [ModifiedDate], [FromCurrencyId], [ToCurrencyId], [CurrencyRateDate]) VALUES (2, 1.042, 1.042, '20131211 08:56:55.210', 23, 1, '20131211 09:56:55.187')
INSERT INTO [dbo].[CurrencyRate] ([CurrencyRateId], [AverageRate], [EndOfDayRate], [ModifiedDate], [FromCurrencyId], [ToCurrencyId], [CurrencyRateDate]) VALUES (3, 1.29, 1.29, '20131211 08:56:55.210', 7, 23, '20131211 09:56:55.187')
INSERT INTO [dbo].[CurrencyRate] ([CurrencyRateId], [AverageRate], [EndOfDayRate], [ModifiedDate], [FromCurrencyId], [ToCurrencyId], [CurrencyRateDate]) VALUES (4, 0.7752, 0.7752, '20131211 08:56:55.210', 23, 7, '20131211 09:56:55.187')
SET IDENTITY_INSERT [dbo].[CurrencyRate] OFF
SET IDENTITY_INSERT [dbo].[ShippingMethodCase] ON
INSERT INTO [dbo].[ShippingMethodCase] ([ShippingMethodCaseId], [Total], [Charge], [ShippingMethodId], [JurisdictionGroupId], [StartDate], [EndDate]) VALUES (1, 0, 10.0000, N'1d77f587-ca7b-4090-92f3-19cdac7f6cf2', 1, '20081008 00:00:00.000', '20201008 00:00:00.000')
SET IDENTITY_INSERT [dbo].[ShippingMethodCase] OFF
INSERT INTO [dbo].[ShippingOption] ([ShippingOptionId], [Name], [Description], [SystemKeyword], [ClassName], [Created], [Modified]) VALUES (N'18ede71f-3df3-4d9e-a4cb-3d25881c1ec6', N'Generic Gateway', N'', N'Generic', N'Mediachase.Commerce.Plugins.Shipping.Generic.GenericGateway, Mediachase.Commerce.Plugins.Shipping', '20070101 00:00:00.000', '20070101 00:00:00.000')
INSERT INTO [dbo].[ShippingOption] ([ShippingOptionId], [Name], [Description], [SystemKeyword], [ClassName], [Created], [Modified]) VALUES (N'8826e08e-636d-4962-8607-dbf80fe1945c', N'Weight/Jurisdiction Gateway', N'', N'WeightJurisdiction', N'Mediachase.Commerce.Plugins.Shipping.WeightJurisdictionGateway, Mediachase.Commerce.Plugins.Shipping', '20081007 18:21:01.000', '20081008 18:54:12.000')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (0, N'BigInt', N'bigint', N'MSSQL Common Type', 8, N'bigint', 1, 0, 1, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (1, N'Binary', N'binary', N'MSSQL Common Type', 8000, N'binary', 1, 0, 1, N'')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (2, N'Bit', N'bit', N'MSSQL Common Type', 1, N'bit', 1, 0, 1, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (3, N'Char', N'char', N'MSSQL Common Type', 8000, N'char', 1, 0, 1, N'''''')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (4, N'DateTime', N'datetime', N'MSSQL Common Type', 8, N'datetime', 1, 0, 1, N'getdate()')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (5, N'Decimal', N'decimal', N'MSSQL Common Type', 17, N'decimal', 1, 0, 1, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (6, N'Float', N'float', N'MSSQL Common Type', 8, N'float', 1, 0, 1, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (7, N'Image', N'image', N'MSSQL Common Type', 16, N'image', 1, 0, 1, N'')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (8, N'Int', N'int', N'MSSQL Common Type', 4, N'int', 1, 0, 1, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (9, N'Money', N'money', N'MSSQL Common Type', 8, N'money', 1, 0, 1, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (10, N'NChar', N'nchar', N'MSSQL Common Type', 8000, N'nchar', 1, 0, 1, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (11, N'NText', N'ntext', N'MSSQL Common Type', -1, N'nvarchar', 1, 1, 1, N'''''')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (12, N'NVarChar', N'nvarchar', N'MSSQL Common Type', 8000, N'nvarchar', 1, 1, 1, N'''''')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (13, N'Real', N'real', N'MSSQL Common Type', 4, N'real', 1, 0, 1, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (14, N'UniqueIdentifier', N'uniqueidentifier', N'MSSQL Common Type', 16, N'uniqueidentifier', 1, 0, 1, N'newid()')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (15, N'SmallDateTime', N'smalldatetime', N'MSSQL Common Type', 4, N'smalldatetime', 1, 0, 1, N'getdate()')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (16, N'SmallInt', N'smallint', N'MSSQL Common Type', 2, N'smallint', 1, 0, 1, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (17, N'SmallMoney', N'smallmoney', N'MSSQL Common Type', 4, N'smallmoney', 1, 0, 1, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (18, N'Text', N'text', N'MSSQL Common Type', 16, N'text', 1, 0, 1, N'''''')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (19, N'Timestamp', N'timestamp', N'MSSQL Common Type', 8, N'timestamp', 0, 0, 1, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (20, N'TinyInt', N'tinyint', N'MSSQL Common Type', 1, N'tinyint', 1, 0, 1, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (21, N'VarBinary', N'varbinary', N'MSSQL Common Type', 8000, N'varbinary', 1, 1, 1, N'')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (22, N'VarChar', N'varchar', N'MSSQL Common Type', 8000, N'varchar', 1, 1, 1, N'''''')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (23, N'Variant', N'sql_variant', N'MSSQL Common Type', 8016, N'sql_variant', 1, 0, 1, N'''''')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (24, N'Numeric', N'numeric', N'MSSQL Common Type', 17, N'numeric', 1, 0, 1, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (25, N'Sysname', N'sysname', N'MSSQL Common Type', 256, N'sysname', 0, 1, 1, N'''''')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (26, N'Integer', N'Integer', N'Meta Data Type', 4, N'int', 1, 0, 0, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (27, N'Boolean', N'Boolean', N'Meta Data Type', 1, N'bit', 1, 0, 0, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (28, N'Date', N'Date', N'Meta Data Type', 8, N'datetime', 1, 0, 0, N'getdate()')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (29, N'Email', N'Email', N'Meta Data Type', 256, N'varchar', 1, 1, 0, N'''''')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (30, N'URL', N'URL', N'Meta Data Type', 512, N'varchar', 1, 1, 0, N'''''')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (31, N'ShortString', N'Short String', N'Meta Data Type', 4000, N'nvarchar', 1, 1, 0, N'''''')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (32, N'LongString', N'Long String', N'Meta Data Type', -1, N'nvarchar', 1, 1, 0, N'''''')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (33, N'LongHtmlString', N'Long Html String', N'Meta Data Type', -1, N'nvarchar', 1, 1, 0, N'''''')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (34, N'DictionarySingleValue', N'Dictionary Single Value', N'Meta Data Type', 4, N'int', 1, 0, 0, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (35, N'DictionaryMultiValue', N'Dictionary Multi Value', N'Meta Data Type', 4, N'int', 1, 0, 0, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (36, N'EnumSingleValue', N'Enum Single Value', N'Meta Data Type', 4, N'int', 1, 0, 0, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (37, N'EnumMultiValue', N'Enum Multi Value', N'Meta Data Type', 4, N'int', 1, 0, 0, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (38, N'StringDictionary', N'String Dictionary', N'Meta Data Type', 4, N'int', 1, 0, 0, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (39, N'File', N'File', N'Meta Data Type', 4, N'int', 1, 0, 0, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (40, N'ImageFile', N'Image File', N'Meta Data Type', 4, N'int', 1, 0, 0, N'0')
INSERT INTO [dbo].[MetaDataType] ([DataTypeId], [Name], [FriendlyName], [Description], [Length], [SqlName], [AllowNulls], [Variable], [IsSQLCommonType], [DefaultValue]) VALUES (41, N'MetaObject', N'Meta Object', N'Meta Data Type', 4, N'int', 1, 0, 0, N'0')

INSERT INTO [dbo].[Security_RoleAssignment] ([SecurityRoleAssignmentId], [RoleParticipant], [Role], [Scope], [CheckMode], [IsOnlyForOwner]) VALUES (N'0f99f665-9b1e-4ab1-9586-9b07ca04bf86', N'45f3ed19-05b0-4bc9-97c4-9d323b0a8959', N'Registered', NULL, NULL, 0)
INSERT INTO [dbo].[Security_RoleAssignment] ([SecurityRoleAssignmentId], [RoleParticipant], [Role], [Scope], [CheckMode], [IsOnlyForOwner]) VALUES (N'739da5b5-534f-48d3-aa6b-a720a2c6b8a3', N'45f3ed19-05b0-4bc9-97c4-9d323b0a8959', N'Admins', NULL, NULL, 0)
INSERT INTO [dbo].[Security_RoleAssignment] ([SecurityRoleAssignmentId], [RoleParticipant], [Role], [Scope], [CheckMode], [IsOnlyForOwner]) VALUES (N'79bd5c99-0835-4fa0-8b57-a954ab7f01d2', N'45f3ed19-05b0-4bc9-97c4-9d323b0a8959', N'Management Users', NULL, NULL, 0)
INSERT INTO [dbo].[Security_RoleAssignment] ([SecurityRoleAssignmentId], [RoleParticipant], [Role], [Scope], [CheckMode], [IsOnlyForOwner]) VALUES (N'a9a4e386-ea6a-4154-a1e3-19bf1b70966c', N'45f3ed19-05b0-4bc9-97c4-9d323b0a8959', N'Everyone', NULL, NULL, 0)
INSERT INTO [dbo].[OrderStatus] ([OrderStatusId], [Name]) VALUES (1, N'OnHold')
INSERT INTO [dbo].[OrderStatus] ([OrderStatusId], [Name]) VALUES (2, N'PartiallyShipped')
INSERT INTO [dbo].[OrderStatus] ([OrderStatusId], [Name]) VALUES (3, N'InProgress')
INSERT INTO [dbo].[OrderStatus] ([OrderStatusId], [Name]) VALUES (4, N'Completed')
INSERT INTO [dbo].[OrderStatus] ([OrderStatusId], [Name]) VALUES (5, N'Cancelled')
INSERT INTO [dbo].[OrderStatus] ([OrderStatusId], [Name]) VALUES (6, N'AwaitingExchange')
SET IDENTITY_INSERT [dbo].[RolePermission] ON

INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (1, N'Administrators', N'core:mng:login')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (2, N'Administrators', N'core:mng:settings')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (3, N'Administrators', N'core:mng:businessfoundation')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (25, N'Administrators', N'core:mng:leftmenu')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (4, N'Administrators', N'core:mng:search')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (5, N'Administrators', N'core:admin:syslog:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (6, N'Administrators', N'core:admin:syslog:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (7, N'Administrators', N'core:admin:applog:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (8, N'Administrators', N'core:admin:applog:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (9, N'Administrators', N'businessfoundation:tabviewpermission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (10, N'Administrators', N'businessfoundation:organization:list:permission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (11, N'Administrators', N'businessfoundation:organization:view:permission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (12, N'Administrators', N'businessfoundation:organization:create:permission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (13, N'Administrators', N'businessfoundation:organization:edit:permission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (14, N'Administrators', N'businessfoundation:organization:delete:permission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (15, N'Administrators', N'businessfoundation:contact:create:permission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (16, N'Administrators', N'businessfoundation:contact:view:permission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (17, N'Administrators', N'businessfoundation:contact:delete:permission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (18, N'Administrators', N'businessfoundation:contact:edit:permission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (19, N'Administrators', N'businessfoundation:contact:list:permission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (20, N'Administrators', N'customer:tabviewpermission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (21, N'Administrators', N'customer:roles:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (22, N'Administrators', N'customer:roles:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (23, N'Administrators', N'customer:roles:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (24, N'Administrators', N'customer:roles:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (31, N'Administrators', N'catalog:tabviewpermission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (32, N'Administrators', N'catalog:ctlg:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (33, N'Administrators', N'catalog:ctlg:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (34, N'Administrators', N'catalog:ctlg:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (35, N'Administrators', N'catalog:ctlg:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (36, N'Administrators', N'catalog:ctlg:mng:import')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (37, N'Administrators', N'catalog:ctlg:mng:export')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (38, N'Administrators', N'catalog:ctlg:nodes:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (39, N'Administrators', N'catalog:ctlg:nodes:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (40, N'Administrators', N'catalog:ctlg:nodes:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (41, N'Administrators', N'catalog:ctlg:nodes:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (42, N'Administrators', N'catalog:ctlg:entries:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (43, N'Administrators', N'catalog:ctlg:entries:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (44, N'Administrators', N'catalog:ctlg:entries:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (45, N'Administrators', N'catalog:ctlg:entries:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (46, N'Administrators', N'catalog:admin:warehouses:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (47, N'Administrators', N'catalog:admin:warehouses:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (48, N'Administrators', N'catalog:admin:warehouses:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (49, N'Administrators', N'catalog:admin:warehouses:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (50, N'Administrators', N'catalog:admin:country:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (51, N'Administrators', N'catalog:admin:country:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (52, N'Administrators', N'catalog:admin:country:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (53, N'Administrators', N'catalog:admin:country:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (54, N'Administrators', N'catalog:admin:taxcategories:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (55, N'Administrators', N'catalog:admin:taxcategories:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (56, N'Administrators', N'catalog:admin:taxcategories:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (57, N'Administrators', N'catalog:admin:taxcategories:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (58, N'Administrators', N'catalog:admin:currencies:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (59, N'Administrators', N'catalog:admin:currencies:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (60, N'Administrators', N'catalog:admin:currencies:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (61, N'Administrators', N'catalog:admin:currencies:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (62, N'Administrators', N'catalog:admin:meta:cls:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (63, N'Administrators', N'catalog:admin:meta:cls:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (64, N'Administrators', N'catalog:admin:meta:cls:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (65, N'Administrators', N'catalog:admin:meta:cls:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (66, N'Administrators', N'catalog:admin:meta:fld:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (67, N'Administrators', N'catalog:admin:meta:fld:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (68, N'Administrators', N'catalog:admin:meta:fld:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (69, N'Administrators', N'catalog:admin:meta:fld:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (91, N'Administrators', N'order:tabviewpermission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (92, N'Administrators', N'order:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (93, N'Administrators', N'order:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (94, N'Administrators', N'order:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (95, N'Administrators', N'order:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (96, N'Administrators', N'order:mng:notify')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (97, N'Administrators', N'order:mng:payments')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (98, N'Administrators', N'order:admin:payments:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (99, N'Administrators', N'order:admin:payments:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (100, N'Administrators', N'order:admin:payments:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (101, N'Administrators', N'order:admin:payments:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (102, N'Administrators', N'order:admin:shipping:jur:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (103, N'Administrators', N'order:admin:shipping:jur:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (104, N'Administrators', N'order:admin:shipping:jur:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (105, N'Administrators', N'order:admin:shipping:jur:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (106, N'Administrators', N'order:admin:shipping:providers:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (107, N'Administrators', N'order:admin:shipping:providers:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (108, N'Administrators', N'order:admin:shipping:providers:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (109, N'Administrators', N'order:admin:shipping:providers:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (110, N'Administrators', N'order:admin:shipping:packages:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (111, N'Administrators', N'order:admin:shipping:packages:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (112, N'Administrators', N'order:admin:shipping:packages:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (113, N'Administrators', N'order:admin:shipping:packages:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (114, N'Administrators', N'order:admin:shipping:methods:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (115, N'Administrators', N'order:admin:shipping:methods:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (116, N'Administrators', N'order:admin:shipping:methods:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (117, N'Administrators', N'order:admin:shipping:methods:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (118, N'Administrators', N'order:admin:taxes:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (119, N'Administrators', N'order:admin:taxes:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (120, N'Administrators', N'order:admin:taxes:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (121, N'Administrators', N'order:admin:taxes:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (122, N'Administrators', N'order:admin:taxes:mng:import')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (123, N'Administrators', N'order:admin:meta:cls:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (124, N'Administrators', N'order:admin:meta:cls:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (125, N'Administrators', N'order:admin:meta:cls:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (126, N'Administrators', N'order:admin:meta:cls:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (127, N'Administrators', N'order:admin:meta:fld:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (128, N'Administrators', N'order:admin:meta:fld:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (129, N'Administrators', N'order:admin:meta:fld:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (130, N'Administrators', N'order:admin:meta:fld:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (131, N'Administrators', N'order:mng:return:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (132, N'Administrators', N'order:mng:return:create:exchange')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (133, N'Administrators', N'order:mng:split:shipments')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (134, N'Administrators', N'order:mng:return:receiving')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (135, N'Administrators', N'order:mng:shipment:packing')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (136, N'Administrators', N'order:mng:shipment:complete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (137, N'Administrators', N'order:mng:discretionary:credit:payment')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (138, N'Administrators', N'order:mng:discount')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (139, N'Administrators', N'order:mng:change:price')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (140, N'Administrators', N'markets:tabviewpermission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (141, N'Administrators', N'markets:market:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (142, N'Administrators', N'markets:market:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (143, N'Administrators', N'markets:market:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (144, N'Administrators', N'markets:market:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (145, N'Administrators', N'reporting:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (146, N'Administrators', N'reporting:tabviewpermission')

INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (147, N'Order Managers', N'core:mng:login')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (148, N'Order Managers', N'order:tabviewpermission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (149, N'Order Managers', N'order:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (150, N'Order Managers', N'order:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (151, N'Order Managers', N'order:mng:notify')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (152, N'Order Managers', N'order:mng:payments')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (153, N'Order Managers', N'order:mng:return:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (154, N'Order Managers', N'order:mng:return:create:exchange')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (155, N'Order Managers', N'order:mng:split:shipments')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (156, N'Order Supervisor', N'core:mng:login')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (157, N'Order Supervisor', N'order:tabviewpermission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (158, N'Order Supervisor', N'order:mng:return:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (159, N'Order Supervisor', N'order:mng:return:create:exchange')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (160, N'Order Supervisor', N'order:mng:return:receiving')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (161, N'Order Supervisor', N'order:mng:shipment:packing')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (162, N'Order Supervisor', N'order:mng:shipment:complete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (163, N'Order Supervisor', N'order:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (164, N'Order Supervisor', N'order:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (165, N'Order Supervisor', N'order:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (166, N'Order Supervisor', N'order:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (167, N'Order Supervisor', N'order:mng:notify')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (168, N'Order Supervisor', N'order:mng:payments')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (169, N'Order Supervisor', N'order:mng:split:shipments')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (170, N'Order Supervisor', N'order:mng:discretionary:credit:payment')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (171, N'Order Supervisor', N'order:mng:discount')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (172, N'Order Supervisor', N'order:mng:change:price')

INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (173, N'Shipping Manager', N'core:mng:login')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (174, N'Shipping Manager', N'order:tabviewpermission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (175, N'Shipping Manager', N'order:mng:shipment:packing')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (176, N'Shipping Manager', N'order:mng:shipment:complete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (177, N'Shipping Manager', N'order:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (178, N'Receiving Manager', N'core:mng:login')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (179, N'Receiving Manager', N'order:tabviewpermission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (180, N'Receiving Manager', N'order:mng:return:receiving')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (181, N'Receiving Manager', N'order:mng:view')

INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (182, N'Everyone', N'empty')

INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (183, N'Registered', N'empty')

INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (184, N'Management Users', N'core:mng:login')

INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (185, N'WebAdmins', N'asset:tabviewpermission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (186, N'WebAdmins', N'asset:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (187, N'WebAdmins', N'asset:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (188, N'WebAdmins', N'asset:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (189, N'WebAdmins', N'asset:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (190, N'WebAdmins', N'catalog:tabviewpermission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (191, N'WebAdmins', N'catalog:ctlg:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (192, N'WebAdmins', N'catalog:ctlg:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (193, N'WebAdmins', N'catalog:ctlg:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (194, N'WebAdmins', N'catalog:ctlg:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (195, N'WebAdmins', N'catalog:ctlg:mng:import')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (196, N'WebAdmins', N'catalog:ctlg:mng:export')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (197, N'WebAdmins', N'catalog:ctlg:nodes:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (198, N'WebAdmins', N'catalog:ctlg:nodes:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (199, N'WebAdmins', N'catalog:ctlg:nodes:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (200, N'WebAdmins', N'catalog:ctlg:nodes:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (201, N'WebAdmins', N'catalog:ctlg:entries:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (202, N'WebAdmins', N'catalog:ctlg:entries:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (203, N'WebAdmins', N'catalog:ctlg:entries:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (204, N'WebAdmins', N'catalog:ctlg:entries:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (205, N'WebAdmins', N'core:mng:businessfoundation')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (206, N'WebAdmins', N'core:mng:leftmenu')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (207, N'WebAdmins', N'core:mng:login')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (208, N'WebAdmins', N'core:mng:search')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (209, N'WebAdmins', N'core:mng:settings')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (210, N'WebAdmins', N'customer:roles:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (211, N'WebAdmins', N'customer:roles:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (212, N'WebAdmins', N'customer:roles:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (213, N'WebAdmins', N'customer:roles:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (214, N'WebAdmins', N'customer:tabviewpermission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (215, N'WebAdmins', N'DetailedErrorMessage')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (237, N'WebAdmins', N'markets:market:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (238, N'WebAdmins', N'markets:market:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (239, N'WebAdmins', N'markets:market:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (240, N'WebAdmins', N'markets:market:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (241, N'WebAdmins', N'markets:tabviewpermission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (242, N'WebAdmins', N'order:tabviewpermission')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (243, N'WebAdmins', N'order:mng:change:price')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (244, N'WebAdmins', N'order:mng:discount')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (245, N'WebAdmins', N'order:mng:discretionary:credit:payment')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (246, N'WebAdmins', N'order:mng:return:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (247, N'WebAdmins', N'order:mng:return:create:exchange')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (248, N'WebAdmins', N'order:mng:return:receiving')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (249, N'WebAdmins', N'order:mng:shipment:complete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (250, N'WebAdmins', N'order:mng:shipment:packing')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (251, N'WebAdmins', N'order:mng:split:shipments')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (252, N'WebAdmins', N'order:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (253, N'WebAdmins', N'order:mng:create')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (254, N'WebAdmins', N'order:mng:edit')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (255, N'WebAdmins', N'order:mng:delete')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (256, N'WebAdmins', N'order:mng:notify')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (257, N'WebAdmins', N'order:mng:payments')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (258, N'WebAdmins', N'reporting:mng:view')
INSERT INTO [dbo].[RolePermission] ([RolePermissionId], [RoleName], [Permission]) VALUES (259, N'WebAdmins', N'reporting:tabviewpermission')

SET IDENTITY_INSERT [dbo].[RolePermission] OFF
----schema version data load
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 2, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 3, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 4, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 5, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 6, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 7, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 8, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 9, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 10, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 11, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 12, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 13, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 14, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 15, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 16, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 17, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 18, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 19, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 20, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 21, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 22, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 23, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 24, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 25, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 26, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 27, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 28, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 29, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 30, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 31, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 32, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 0, 33, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 1, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 1, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 1, 2, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 2, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 2, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 3, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 4, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 5, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 5, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 5, 2, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 6, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (5, 6, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 0, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 0, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 0, 2, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 1, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 1, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 2, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 3, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 3, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 3, 2, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 4, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 4, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 4, 2, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 4, 3, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 5, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 6, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 7, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 7, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 8, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 9, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 9, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 9, 2, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 9, 3, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 10, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 10, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 10, 2, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 10, 3, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 10, 4, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 10, 5, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (6, 10, 6, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 0, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 0, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 0, 2, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 0, 3, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 0, 4, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 0, 5, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 0, 6, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 0, 7, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 0, 8, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 0, 9, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 0, 10, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 0, 11, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 0, 12, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 0, 13, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 0, 14, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 0, 15, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 0, 16, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 1, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 1, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 2, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 2, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 2, 2, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 3, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 3, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 4, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 4, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 4, 2, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 4, 3, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 4, 4, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 4, 5, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 4, 6, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 4, 7, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 4, 8, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 4, 9, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 5, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 5, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 5, 2, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 5, 3, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 5, 4, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 5, 5, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 5, 6, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 5, 7, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 5, 8, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 5, 9, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 6, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 6, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 6, 2, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 6, 3, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 6, 4, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 7, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 8, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 9, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 10, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (7, 10, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 0, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 0, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 0, 2, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 0, 3, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 0, 4, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 0, 5, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 0, 6, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 0, 7, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 0, 8, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 0, 9, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 0, 10, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 0, 11, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 0, 12, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 1, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 1, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 1, 2, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 1, 3, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 1, 4, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (8, 1, 5, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (9, 0, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (9, 0, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (9, 0, 2, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (9, 0, 3, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (9, 0, 4, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (9, 1, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (9, 1, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (9, 1, 2, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (9, 1, 3, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (9, 1, 4, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (9, 1, 5, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (9, 1, 6, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (9, 1, 7, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (9, 1, 8, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 0, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 1, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 2, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 3, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 4, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 5, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 6, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 7, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 8, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 9, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 10, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 11, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 12, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 13, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 14, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 15, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 16, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 17, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 18, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 19, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 20, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 21, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 22, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 23, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 24, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 25, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 26, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 27, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 28, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 29, GETUTCDATE())
INSERT INTO [dbo].[SchemaVersion] ([Major], [Minor], [Patch], [InstallDate]) VALUES (10, 0, 30, GETUTCDATE())
----last schema version
INSERT INTO [dbo].[aspnet_SchemaVersions] ([Feature], [CompatibleSchemaVersion], [IsCurrentVersion]) VALUES (N'common', N'1', 1)
INSERT INTO [dbo].[aspnet_SchemaVersions] ([Feature], [CompatibleSchemaVersion], [IsCurrentVersion]) VALUES (N'health monitoring', N'1', 1)
INSERT INTO [dbo].[aspnet_SchemaVersions] ([Feature], [CompatibleSchemaVersion], [IsCurrentVersion]) VALUES (N'membership', N'1', 1)
INSERT INTO [dbo].[aspnet_SchemaVersions] ([Feature], [CompatibleSchemaVersion], [IsCurrentVersion]) VALUES (N'personalization', N'1', 1)
INSERT INTO [dbo].[aspnet_SchemaVersions] ([Feature], [CompatibleSchemaVersion], [IsCurrentVersion]) VALUES (N'profile', N'1', 1)
INSERT INTO [dbo].[aspnet_SchemaVersions] ([Feature], [CompatibleSchemaVersion], [IsCurrentVersion]) VALUES (N'role manager', N'1', 1)
SET IDENTITY_INSERT [dbo].[CommonSettings] ON
INSERT INTO [dbo].[CommonSettings] ([SettingId], [Name], [Value]) VALUES (1, N'DefaultLanguage', N'en')
INSERT INTO [dbo].[CommonSettings] ([SettingId], [Name], [Value]) VALUES (2, N'DefaultCurrency', N'USD')
INSERT INTO [dbo].[CommonSettings] ([SettingId], [Name], [Value]) VALUES (3, N'DefaultLength', N'FT')
INSERT INTO [dbo].[CommonSettings] ([SettingId], [Name], [Value]) VALUES (4, N'DefaultWeight', N'LBS')
SET IDENTITY_INSERT [dbo].[CommonSettings] OFF
SET IDENTITY_INSERT [dbo].[mcmd_MetaFieldType] ON
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (1, N'Guid', N'{GlobalMetaInfo:Guid}', 2, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (2, N'DateTime', N'{GlobalMetaInfo:DateTime}', 1, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (3, N'Date', N'{GlobalMetaInfo:Date}', 1, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (4, N'Integer', N'{GlobalMetaInfo:Integer}', 0, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (5, N'Float', N'{GlobalMetaInfo:Float}', 3, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (6, N'Currency', N'{GlobalMetaInfo:Currency}', 4, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (7, N'CheckboxBoolean', N'{GlobalMetaInfo:CheckboxBoolean}', 5, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (8, N'DropDownBoolean', N'{GlobalMetaInfo:DropDownBoolean}', 5, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (9, N'Text', N'{GlobalMetaInfo:Text}', 6, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (10, N'EMail', N'{GlobalMetaInfo:EMail}', 6, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (11, N'Url', N'{GlobalMetaInfo:Url}', 6, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (12, N'LongText', N'{GlobalMetaInfo:LongText}', 6, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (13, N'Html', N'{GlobalMetaInfo:Html}', 6, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (14, N'File', N'{GlobalMetaInfo:File}', 7, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (15, N'Image', N'{GlobalMetaInfo:Image}', 7, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (16, N'Reference', N'{GlobalMetaInfo:Reference}', 9, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (17, N'ReferencedField', N'{GlobalMetaInfo:ReferencedField}', 10, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (18, N'BackReference', N'{GlobalMetaInfo:BackReference}', 11, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (19, N'Card', N'Card', 12, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (20, N'Link', N'{GlobalMetaInfo:Link}', 14, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (21, N'Aggregation', N'{GlobalMetaInfo:Aggregation}', 15, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (22, N'IntegerPercent', N'{GlobalMetaInfo:IntegerPercent}', 0, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (23, N'FloatPercent', N'{GlobalMetaInfo:FloatPercent}', 3, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (24, N'Duration', N'{GlobalMetaInfo:Duration}', 0, NULL, NULL, N'System', 1)
INSERT INTO [dbo].[mcmd_MetaFieldType] ([MetaFieldTypeId], [Name], [FriendlyName], [McDataType], [XSViews], [XSAttributes], [Owner], [AccessLevel]) VALUES (25, N'Decimal', N'{GlobalMetaInfo:Decimal}', 18, NULL, NULL, N'System', 1)
SET IDENTITY_INSERT [dbo].[mcmd_MetaFieldType] OFF
SET IDENTITY_INSERT [dbo].[ReturnReasonDictionary] ON
INSERT INTO [dbo].[ReturnReasonDictionary] ([ReturnReasonText], [ReturnReasonId], [Ordering], [Visible]) VALUES (N'Faulty', 1, 0, 1)
INSERT INTO [dbo].[ReturnReasonDictionary] ([ReturnReasonText], [ReturnReasonId], [Ordering], [Visible]) VALUES (N'Incorrect Item', 3, 0, 1)
INSERT INTO [dbo].[ReturnReasonDictionary] ([ReturnReasonText], [ReturnReasonId], [Ordering], [Visible]) VALUES (N'Unwanted Gift', 2, 0, 1)
SET IDENTITY_INSERT [dbo].[ReturnReasonDictionary] OFF
INSERT INTO [dbo].[OrderShipmentStatus] ([OrderShipmentStatusId], [Name]) VALUES (1, N'AwaitingInventory')
INSERT INTO [dbo].[OrderShipmentStatus] ([OrderShipmentStatusId], [Name]) VALUES (2, N'Cancelled')
INSERT INTO [dbo].[OrderShipmentStatus] ([OrderShipmentStatusId], [Name]) VALUES (3, N'InventoryAssigned')
INSERT INTO [dbo].[OrderShipmentStatus] ([OrderShipmentStatusId], [Name]) VALUES (4, N'OnHold')
INSERT INTO [dbo].[OrderShipmentStatus] ([OrderShipmentStatusId], [Name]) VALUES (5, N'Packing')
INSERT INTO [dbo].[OrderShipmentStatus] ([OrderShipmentStatusId], [Name]) VALUES (6, N'Released')
INSERT INTO [dbo].[OrderShipmentStatus] ([OrderShipmentStatusId], [Name]) VALUES (7, N'Shipped')
INSERT INTO [dbo].[ReturnFormStatus] ([ReturnFormStatusId], [Name]) VALUES (1, N'Complete')
INSERT INTO [dbo].[ReturnFormStatus] ([ReturnFormStatusId], [Name]) VALUES (2, N'Canceled')
INSERT INTO [dbo].[ReturnFormStatus] ([ReturnFormStatusId], [Name]) VALUES (3, N'AwaitingStockReturn')
INSERT INTO [dbo].[ReturnFormStatus] ([ReturnFormStatusId], [Name]) VALUES (4, N'AwaitingCompletion')
INSERT INTO [dbo].[OrderNoteType] ([OrderNoteTypeId], [Name]) VALUES (1, N'Info')
INSERT INTO [dbo].[OrderNoteType] ([OrderNoteTypeId], [Name]) VALUES (2, N'Shipment')
INSERT INTO [dbo].[OrderNoteType] ([OrderNoteTypeId], [Name]) VALUES (3, N'ReturnsExchange')
INSERT INTO [dbo].[OrderNoteType] ([OrderNoteTypeId], [Name]) VALUES (4, N'Payments')
ALTER TABLE [dbo].[mcmd_MetaClassDataSource]
    ADD CONSTRAINT [FK_mcmd_MetaClassDataSource_mcmd_MetaClass] FOREIGN KEY ([MetaClassId]) REFERENCES [dbo].[mcmd_MetaClass] ([MetaClassId]) ON DELETE CASCADE
ALTER TABLE [dbo].[ShipmentDiscount]
    ADD CONSTRAINT [FK_ShipmentDiscount_Shipment] FOREIGN KEY ([ShipmentId]) REFERENCES [dbo].[Shipment] ([ShipmentId])
ALTER TABLE [dbo].[TaxLanguage]
    ADD CONSTRAINT [FK_TaxLanguage_Tax] FOREIGN KEY ([TaxId]) REFERENCES [dbo].[Tax] ([TaxId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[ShippingMethodParameter]
    ADD CONSTRAINT [FK_ShippingMethodParameter_ShippingMethod] FOREIGN KEY ([ShippingMethodId]) REFERENCES [dbo].[ShippingMethod] ([ShippingMethodId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[ShippingOptionParameter]
    ADD CONSTRAINT [FK_ShippingOptionParameter_ShippingOption] FOREIGN KEY ([ShippingOptionId]) REFERENCES [dbo].[ShippingOption] ([ShippingOptionId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[MetaMultiValueDictionary]
    ADD CONSTRAINT [FK_MetaMultiValueDictionary_MetaKey] FOREIGN KEY ([MetaKey]) REFERENCES [dbo].[MetaKey] ([MetaKey])
ALTER TABLE [dbo].[OrderFormPayment]
    ADD CONSTRAINT [FK_OrderFormPayment_OrderForm] FOREIGN KEY ([OrderFormId]) REFERENCES [dbo].[OrderForm] ([OrderFormId])
ALTER TABLE [dbo].[ShippingMethodCase]
    ADD CONSTRAINT [FK_ShippingMethodCase_JurisdictionGroup] FOREIGN KEY ([JurisdictionGroupId]) REFERENCES [dbo].[JurisdictionGroup] ([JurisdictionGroupId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[ShippingMethodCase]
    ADD CONSTRAINT [ShippingMethod_ShippingMethodCase_FK1] FOREIGN KEY ([ShippingMethodId]) REFERENCES [dbo].[ShippingMethod] ([ShippingMethodId])
ALTER TABLE [dbo].[MetaDictionaryLocalization]
    ADD CONSTRAINT [FK_MetaDictionaryLocalization_MetaDictionary] FOREIGN KEY ([MetaDictionaryId]) REFERENCES [dbo].[MetaDictionary] ([MetaDictionaryId]) ON DELETE CASCADE
ALTER TABLE [dbo].[CurrencyRate]
    ADD CONSTRAINT [FK_CurrencyRate_Currency] FOREIGN KEY ([FromCurrencyId]) REFERENCES [dbo].[Currency] ([CompatCurrencyId])
ALTER TABLE [dbo].[CurrencyRate]
    ADD CONSTRAINT [FK_CurrencyRate_Currency1] FOREIGN KEY ([ToCurrencyId]) REFERENCES [dbo].[Currency] ([CompatCurrencyId])
ALTER TABLE [dbo].[OrderFormDiscount]
    ADD CONSTRAINT [FK_OrderFormDiscount_OrderForm] FOREIGN KEY ([OrderFormId]) REFERENCES [dbo].[OrderForm] ([OrderFormId])
ALTER TABLE [dbo].[PriceValue]
    ADD CONSTRAINT [FK_PriceValue_PriceGroup] FOREIGN KEY ([PriceGroupId]) REFERENCES [dbo].[PriceGroup] ([PriceGroupId]) ON DELETE CASCADE
ALTER TABLE [dbo].[ShippingMethod]
    ADD CONSTRAINT [FK_ShippingMethod_ShippingOption] FOREIGN KEY ([ShippingOptionId]) REFERENCES [dbo].[ShippingOption] ([ShippingOptionId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[ShippingRegion]
    ADD CONSTRAINT [FK_ShippingRegion_ShippingMethod] FOREIGN KEY ([ShippingMethodId]) REFERENCES [dbo].[ShippingMethod] ([ShippingMethodId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[ShippingRegion]
    ADD CONSTRAINT [StateProvince_ShippingRegion_FK1] FOREIGN KEY ([StateProvinceId]) REFERENCES [dbo].[StateProvince] ([StateProvinceId])
ALTER TABLE [dbo].[mcmd_MetaFieldMap]
    ADD CONSTRAINT [FK_mcmd_MetaFieldMap_mcmd_MetaClass] FOREIGN KEY ([SrcMetaClassId]) REFERENCES [dbo].[mcmd_MetaClass] ([MetaClassId])
ALTER TABLE [dbo].[mcmd_MetaFieldMap]
    ADD CONSTRAINT [FK_mcmd_MetaFieldMap_mcmd_MetaClass1] FOREIGN KEY ([DestMetaClassId]) REFERENCES [dbo].[mcmd_MetaClass] ([MetaClassId])
ALTER TABLE [dbo].[TaxValue]
    ADD CONSTRAINT [FK_TaxValue_JurisdictionGroup] FOREIGN KEY ([JurisdictionGroupId]) REFERENCES [dbo].[JurisdictionGroup] ([JurisdictionGroupId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[TaxValue]
    ADD CONSTRAINT [Tax_TaxValue_FK1] FOREIGN KEY ([TaxId]) REFERENCES [dbo].[Tax] ([TaxId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[LineItemDiscount]
    ADD CONSTRAINT [FK_LineItemDiscount_LineItem] FOREIGN KEY ([LineItemId]) REFERENCES [dbo].[LineItem] ([LineItemId])
ALTER TABLE [dbo].[LineItem]
    ADD CONSTRAINT [FK_LineItem_OrderForm] FOREIGN KEY ([OrderFormId]) REFERENCES [dbo].[OrderForm] ([OrderFormId])
ALTER TABLE [dbo].[mcmd_MetaField]
    ADD CONSTRAINT [FK_mcmd_MetaField_mcmd_MetaClass] FOREIGN KEY ([MetaClassId]) REFERENCES [dbo].[mcmd_MetaClass] ([MetaClassId]) ON DELETE CASCADE
ALTER TABLE [dbo].[aspnet_PersonalizationAllUsers]
    ADD  CONSTRAINT [FK_PersAllUser_Paths] FOREIGN KEY ([PathId]) REFERENCES [dbo].[aspnet_Paths] ([PathId])
ALTER TABLE [dbo].[Shipment]
    ADD CONSTRAINT [FK_Shipment_OrderForm] FOREIGN KEY ([OrderFormId]) REFERENCES [dbo].[OrderForm] ([OrderFormId])
ALTER TABLE [dbo].[OrderForm]
    ADD CONSTRAINT [FK_OrderForm_OrderGroup] FOREIGN KEY ([OrderGroupId]) REFERENCES [dbo].[OrderGroup] ([OrderGroupId])
ALTER TABLE [dbo].[Variation]
    ADD CONSTRAINT [FK_Variation_CatalogEntry] FOREIGN KEY ([CatalogEntryId]) REFERENCES [dbo].[CatalogEntry] ([CatalogEntryId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[Variation]
    ADD CONSTRAINT [FK_Variation_Merchant] FOREIGN KEY ([MerchantId]) REFERENCES [dbo].[Merchant] ([MerchantId]) ON DELETE SET NULL ON UPDATE SET NULL
ALTER TABLE [dbo].[aspnet_Profile]
    ADD CONSTRAINT [FK_Profile_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId])
ALTER TABLE [dbo].[CatalogLanguage]
    ADD CONSTRAINT [FK_CatalogLanguage_Catalog] FOREIGN KEY ([CatalogId]) REFERENCES [dbo].[Catalog] ([CatalogId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[OrderGroupAddress]
    ADD CONSTRAINT [FK_OrderGroupAddress_OrderGroup] FOREIGN KEY ([OrderGroupId]) REFERENCES [dbo].[OrderGroup] ([OrderGroupId])
ALTER TABLE [dbo].[ShippingCountry]
    ADD CONSTRAINT [FK_ShippingCountry_Country] FOREIGN KEY ([CountryId]) REFERENCES [dbo].[Country] ([CountryId])
ALTER TABLE [dbo].[ShippingCountry]
    ADD CONSTRAINT [FK_ShippingCountry_ShippingMethod] FOREIGN KEY ([ShippingMethodId]) REFERENCES [dbo].[ShippingMethod] ([ShippingMethodId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[JurisdictionRelation]
    ADD CONSTRAINT [FK_JurisdictionRelation_Jurisdiction] FOREIGN KEY ([JurisdictionId]) REFERENCES [dbo].[Jurisdiction] ([JurisdictionId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[JurisdictionRelation]
    ADD CONSTRAINT [FK_JurisdictionRelation_JurisdictionGroup] FOREIGN KEY ([JurisdictionGroupId]) REFERENCES [dbo].[JurisdictionGroup] ([JurisdictionGroupId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[MetaClassMetaFieldRelation]
    ADD CONSTRAINT [FK_MetaClassMetaFieldRelation_MetaClass] FOREIGN KEY ([MetaClassId]) REFERENCES [dbo].[MetaClass] ([MetaClassId])
ALTER TABLE [dbo].[MetaClassMetaFieldRelation]
    ADD CONSTRAINT [FK_MetaClassMetaFieldRelation_MetaField] FOREIGN KEY ([MetaFieldId]) REFERENCES [dbo].[MetaField] ([MetaFieldId])
ALTER TABLE [dbo].[CatalogEntryRelation]
    ADD CONSTRAINT [FK_CatalogEntryRelation_CatalogEntry] FOREIGN KEY ([ChildEntryId]) REFERENCES [dbo].[CatalogEntry] ([CatalogEntryId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[CatalogEntryRelation]
    ADD CONSTRAINT [FK_CatalogEntryRelation_CatalogEntry1] FOREIGN KEY ([ParentEntryId]) REFERENCES [dbo].[CatalogEntry] ([CatalogEntryId])
ALTER TABLE [dbo].[CatalogEntryAssociation]
    ADD CONSTRAINT [FK_CatalogEntryAssociation_CatalogAssociation] FOREIGN KEY ([CatalogAssociationId]) REFERENCES [dbo].[CatalogAssociation] ([CatalogAssociationId])
ALTER TABLE [dbo].[CatalogEntryAssociation]
    ADD CONSTRAINT [FK_CatalogEntryAssociation_CatalogEntry] FOREIGN KEY ([CatalogEntryId]) REFERENCES [dbo].[CatalogEntry] ([CatalogEntryId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[CatalogEntryAssociation]
    ADD CONSTRAINT [FK_CatalogEntryAssociation_AssociationType] FOREIGN KEY ([AssociationTypeId]) REFERENCES [dbo].[AssociationType] ([AssociationTypeId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[CatalogAssociation]
    ADD CONSTRAINT [FK_CatalogAssociation_CatalogEntry] FOREIGN KEY ([CatalogEntryId]) REFERENCES [dbo].[CatalogEntry] ([CatalogEntryId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[CatalogEntry]
    ADD CONSTRAINT [FK_CatalogEntity_Catalog] FOREIGN KEY ([CatalogId]) REFERENCES [dbo].[Catalog] ([CatalogId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[aspnet_Roles]
    ADD FOREIGN KEY ([ApplicationId]) REFERENCES [dbo].[aspnet_Applications] ([ApplicationId])
ALTER TABLE [dbo].[aspnet_Paths]
    ADD FOREIGN KEY ([ApplicationId]) REFERENCES [dbo].[aspnet_Applications] ([ApplicationId])
ALTER TABLE [dbo].[PaymentMethodParameter]
    ADD CONSTRAINT [PaymentMethod_PaymentMethodParameter_FK1] FOREIGN KEY ([PaymentMethodId]) REFERENCES [dbo].[PaymentMethod] ([PaymentMethodId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[aspnet_UsersInRoles]
    ADD CONSTRAINT [FK_UsersInRoles_Roles] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[aspnet_Roles] ([RoleId])
ALTER TABLE [dbo].[aspnet_UsersInRoles]
    ADD CONSTRAINT [FK_UsersInRoles_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId])
ALTER TABLE [dbo].[CatalogSecurity]
    ADD CONSTRAINT [FK_CatalogSecurity_Catalog] FOREIGN KEY ([CatalogId]) REFERENCES [dbo].[Catalog] ([CatalogId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[MetaDictionary]
    ADD CONSTRAINT [FK_MetaDictionary_MetaField] FOREIGN KEY ([MetaFieldId]) REFERENCES [dbo].[MetaField] ([MetaFieldId])
ALTER TABLE [dbo].[MetaField]
    ADD CONSTRAINT [FK_MetaField_MetaDataType] FOREIGN KEY ([DataTypeId]) REFERENCES [dbo].[MetaDataType] ([DataTypeId])
ALTER TABLE [dbo].[MarketPaymentMethods]
    ADD CONSTRAINT [FK_MarketPaymentMethods_Market] FOREIGN KEY ([MarketId]) REFERENCES [dbo].[Market] ([MarketId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[MarketPaymentMethods]
    ADD CONSTRAINT [FK_MarketPaymentMethods_PaymentMethod] FOREIGN KEY ([PaymentMethodId]) REFERENCES [dbo].[PaymentMethod] ([PaymentMethodId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[PriceDetail]
    ADD CONSTRAINT [FK_PriceDetail_CatalogEntry] FOREIGN KEY ([CatalogEntryCode]) REFERENCES [dbo].[CatalogEntry] ([Code]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[PriceDetail]
    ADD CONSTRAINT [FK_PriceDetail_Currency] FOREIGN KEY ([CurrencyCode]) REFERENCES [dbo].[Currency] ([CurrencyCode]) ON DELETE CASCADE
ALTER TABLE [dbo].[PriceDetail]
    ADD CONSTRAINT [FK_PriceDetail_Market] FOREIGN KEY ([MarketId]) REFERENCES [dbo].[Market] ([MarketId]) ON DELETE CASCADE
ALTER TABLE [dbo].[PriceDetail]
    ADD CONSTRAINT [FK_PriceDetail_PriceType] FOREIGN KEY ([PriceTypeId]) REFERENCES [dbo].[PriceType] ([PriceTypeId])
ALTER TABLE [dbo].[MarketLanguages]
    ADD CONSTRAINT [FK_MarketLanguages_Market] FOREIGN KEY ([MarketId]) REFERENCES [dbo].[Market] ([MarketId]) ON DELETE CASCADE
ALTER TABLE [dbo].[StateProvince]
    ADD CONSTRAINT [FK_StateProvince_Country] FOREIGN KEY ([CountryId]) REFERENCES [dbo].[Country] ([CountryId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[MarketCountries]
    ADD CONSTRAINT [FK_MarketCountries_Market] FOREIGN KEY ([MarketId]) REFERENCES [dbo].[Market] ([MarketId]) ON DELETE CASCADE
ALTER TABLE [dbo].[aspnet_Membership]
    ADD CONSTRAINT [FK_Membership_Applications] FOREIGN KEY ([ApplicationId]) REFERENCES [dbo].[aspnet_Applications] ([ApplicationId])
ALTER TABLE [dbo].[aspnet_Membership]
    ADD CONSTRAINT [FK_Membership_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId])
ALTER TABLE [dbo].[MetaFileValue]
    ADD CONSTRAINT [FK_MetaFileValue_MetaKey] FOREIGN KEY ([MetaKey]) REFERENCES [dbo].[MetaKey] ([MetaKey])
ALTER TABLE [dbo].[CatalogNode]
    ADD CONSTRAINT [FK_CatalogItem_Catalog] FOREIGN KEY ([CatalogId]) REFERENCES [dbo].[Catalog] ([CatalogId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[CatalogNodeRelation]
    ADD CONSTRAINT [FK_CatalogItemCategory_Catalog] FOREIGN KEY ([CatalogId]) REFERENCES [dbo].[Catalog] ([CatalogId])
ALTER TABLE [dbo].[CatalogNodeRelation]
    ADD CONSTRAINT [FK_CatalogItemCategory_CatalogItem] FOREIGN KEY ([ChildNodeId]) REFERENCES [dbo].[CatalogNode] ([CatalogNodeId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[SiteCatalog]
    ADD CONSTRAINT [FK_SiteCatalog_Catalog] FOREIGN KEY ([CatalogId]) REFERENCES [dbo].[Catalog] ([CatalogId])
ALTER TABLE [dbo].[ShippingPaymentRestriction]
    ADD CONSTRAINT [FK_ShippingPaymentRestriction_PaymentMethod] FOREIGN KEY ([PaymentMethodId]) REFERENCES [dbo].[PaymentMethod] ([PaymentMethodId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[ShippingPaymentRestriction]
    ADD CONSTRAINT [FK_ShippingPaymentRestriction_ShippingMethod] FOREIGN KEY ([ShippingMethodId]) REFERENCES [dbo].[ShippingMethod] ([ShippingMethodId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[aspnet_PersonalizationPerUser]
    ADD CONSTRAINT [FK_PersPerUser_Paths] FOREIGN KEY ([PathId]) REFERENCES [dbo].[aspnet_Paths] ([PathId])
ALTER TABLE [dbo].[aspnet_PersonalizationPerUser]
    ADD CONSTRAINT [FK_PersPerUser_Users] FOREIGN KEY ([UserId]) REFERENCES [dbo].[aspnet_Users] ([UserId])
ALTER TABLE [dbo].[aspnet_Users]
    ADD CONSTRAINT [FK_Users_Applications] FOREIGN KEY ([ApplicationId]) REFERENCES [dbo].[aspnet_Applications] ([ApplicationId])
ALTER TABLE [dbo].[ShippingPackage]
    ADD CONSTRAINT [FK_ShippingPackage_Package] FOREIGN KEY ([PackageId]) REFERENCES [dbo].[Package] ([PackageId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[ShippingPackage]
    ADD CONSTRAINT [FK_ShippingPackage_ShippingOption] FOREIGN KEY ([ShippingOptionId]) REFERENCES [dbo].[ShippingOption] ([ShippingOptionId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[PriceGroup]
    ADD CONSTRAINT [FK_PriceGroup_CatalogEntry] FOREIGN KEY ([CatalogEntryCode]) REFERENCES [dbo].[CatalogEntry] ([Code]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[PriceGroup]
    ADD CONSTRAINT [FK_PriceGroup_Currency] FOREIGN KEY ([CurrencyCode]) REFERENCES [dbo].[Currency] ([CurrencyCode]) ON DELETE CASCADE
ALTER TABLE [dbo].[PriceGroup]
    ADD CONSTRAINT [FK_PriceGroup_Market] FOREIGN KEY ([MarketId]) REFERENCES [dbo].[Market] ([MarketId]) ON DELETE CASCADE
ALTER TABLE [dbo].[PriceGroup]
    ADD CONSTRAINT [FK_PriceGroup_PriceType] FOREIGN KEY ([PriceTypeId]) REFERENCES [dbo].[PriceType] ([PriceTypeId])
ALTER TABLE [dbo].[MarketCurrencies]
    ADD CONSTRAINT [FK_MarketCurrencies_Market] FOREIGN KEY ([MarketId]) REFERENCES [dbo].[Market] ([MarketId]) ON DELETE CASCADE
ALTER TABLE [dbo].[Market]
    ADD CONSTRAINT [FK_Market_Currency] FOREIGN KEY ([DefaultCurrencyCode]) REFERENCES [dbo].[Currency] ([CurrencyCode])
ALTER TABLE [dbo].[NodeEntryRelation]
    ADD CONSTRAINT [FK_NodeEntryRelation_Catalog] FOREIGN KEY ([CatalogId]) REFERENCES [dbo].[Catalog] ([CatalogId])
ALTER TABLE [dbo].[NodeEntryRelation]
    ADD CONSTRAINT [FK_NodeEntryRelation_CatalogEntry] FOREIGN KEY ([CatalogEntryId]) REFERENCES [dbo].[CatalogEntry] ([CatalogEntryId]) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE [dbo].[NodeEntryRelation]
    ADD CONSTRAINT [FK_NodeEntryRelation_CatalogNode] FOREIGN KEY ([CatalogNodeId]) REFERENCES [dbo].[CatalogNode] ([CatalogNodeId])
ALTER TABLE [dbo].[mcmd_SelectedEnumValue]
    ADD CONSTRAINT [FK_mcmd_SelectedEnumValue_mcmd_MetaEnum] FOREIGN KEY ([Id], [TypeName]) REFERENCES [dbo].[mcmd_MetaEnum] ([Id], [TypeName]) ON DELETE CASCADE
COMMIT TRANSACTION




PRINT N'Generating reporting dates...';

GO

DECLARE @EndDate Date
SET @EndDate = DATEADD(year, 10, GETUTCDATE()) 
EXEC ecf_GenerateReportingDates @EndDate

GO

